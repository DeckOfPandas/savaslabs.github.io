<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Installing XHProf to profile your Drupal module | Savas Labs</title>
  
  <meta name="description" content="XHProf is a profiling tool for PHP code – it tracks the amount of time and memory your code spends in each function call, allowing you to spot bottlenecks in...">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="canonical" href="http://savaslabs.com/2016/05/26/installing-xhprof.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="http://savaslabs.com/feed.xml" />
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Durham, North Carolina",
        "postalCode": "27701",
        "streetAddress": "201 W Main St."
      },
      "description": "A full-service web agency leveraging the power of Drupal.
",
      "email": "info@savaslabs.com",
      "name": "Savas Labs",
      "telephone": "(919) 432-4660",
      "url": "http://savaslabs.com",
      "logo": "http://savaslabs.com/assets/img/logo.png"
    }
</script>

  
  
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Installing XHProf to profile your Drupal module",
    "about": "Step-by-step, how to install and use XHProf to profile your Drupal module.",
    "articleBody": "


&lt;div class=&quot;post&quot;&gt;
  &lt;header class=&quot;post-header&quot;&gt;
    &lt;h1 class=&quot;post-title&quot;&gt;Installing XHProf to profile your Drupal module&lt;/h1&gt;
    &lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;
    &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
    &lt;p&gt;May 26, 2016 &lt;/p&gt;&lt;br&gt;
    &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/php/&quot;&gt;PHP&lt;/a&gt;, &lt;a href=&quot;/blog/tag/performance/&quot;&gt;Performance&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;, &lt;a href=&quot;/blog/tag/module-development/&quot;&gt;Module Development&lt;/a&gt;&lt;/p&gt;
    
    &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    
      &lt;div class=&quot;post-featured-image&quot;&gt;
        &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-1000by1000-c366a8.jpg&quot; media=&quot;(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-737by737-c366a8.jpg&quot; media=&quot;(min-width: 400px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-800by800-c366a8.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-400by400-c366a8.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-400by400-c366a8.jpg&quot; class=&quot;image--post-featured-image&quot; itemprop=&quot;image&quot; alt=&quot;an XHProf callgraph&quot; &gt;
  &lt;/picture&gt;

      &lt;/div&gt;
    
  &lt;/header&gt;

  

  &lt;article class=&quot;post-content&quot;&gt;
    &lt;p&gt;XHProf is a profiling tool for PHP code – it tracks the amount of time and memory your code spends in each function call, allowing you to spot bottlenecks in the code and identify where it’s worth spending resources on optimization. There are have been a &lt;a href=&quot;http://www.linuxjournal.com/article/7213&quot;&gt;number of PHP profilers over the years&lt;/a&gt;, and XDebug has &lt;a href=&quot;https://xdebug.org/docs/profiler&quot;&gt;a profiler as well&lt;/a&gt;, but XHProf is the first one I’ve successfully managed to configure correctly and interpret the output of.&lt;/p&gt;

&lt;p&gt;I had run across a number of blog posts about using XHProf + Drupal, but never actually got it to work sucessfully for a project. Because so much of the documentation online is incomplete or out-of-date, I thought it would be useful to document my process using XHProf to profile a Drupal 8 custom module here. YMMV, but please post your thoughts/experiences in the comments!&lt;/p&gt;

&lt;h3 id=&quot;how-to-find-documentation&quot;&gt;How to find documentation&lt;/h3&gt;

&lt;p&gt;I find the &lt;a href=&quot;http://php.net/manual/en/book.xhprof.php&quot;&gt;php.net XHProf manual entry&lt;/a&gt; super-confusing and circular. Part of the problem is that Facebook’s original documentation for the library has since been removed from the internet and is only accessible via &lt;a href=&quot;http://web.archive.org&quot;&gt;the WayBack Machine&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If there’s only one thing you take away from this blog post, let it be: read and bookmark the WayBack machine view of the original XHProf documentation, which is at &lt;a href=&quot;http://web.archive.org/web/20110514095512/http://mirror.facebook.net/facebook/xhprof/doc.html&quot;&gt;http://web.archive.org/web/20110514095512/http://mirror.facebook.net/facebook/xhprof/doc.html&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;install-xhprof-in-a-vm&quot;&gt;Install XHProf in a VM&lt;/h3&gt;

&lt;p&gt;If you’re not running DrupalVM, you’ll need to install XHProf manually via &lt;a href=&quot;https://pecl.php.net/&quot;&gt;PECL&lt;/a&gt;. On &lt;a href=&quot;http://docs.drupalvm.com/en/latest/&quot;&gt;DrupalVM&lt;/a&gt;, &lt;a href=&quot;http://docs.drupalvm.com/en/latest/extras/profile-code/#xhprof&quot;&gt;XHProf is already installed&lt;/a&gt; and you can skip to the next step.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo pecl install xhprof-beta&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Note that all these commands are for Ubuntu flavors of linux. If you’re on Red Hat / CentOS you’ll want to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;yum&lt;/code&gt; equivalents. I had to first install the &lt;code class=&quot;highlighter-rouge&quot;&gt;php5-dev&lt;/code&gt; package to get PECL working properly:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get install php5-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And, if you want to view nice callgraph trees like the one below you’ll need to install the graphviz package &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo apt-get install graphviz&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-callgraph.jpg&quot; alt=&quot;Image of a sample XHProf callgraph&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;configure-php-to-run-xhprof&quot;&gt;Configure PHP to run XHProf&lt;/h3&gt;

&lt;p&gt;You need to tell PHP to enable the xhprof extension via your php.ini files. Usually these are in &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/php5/apache2/php.ini&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/php5/cli/php.ini&lt;/code&gt;. Add the following lines to the bottom of each file if they’re not there already. You will also need to create the &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/tmp/xhprof&lt;/code&gt; directory if it doesn’t already exist.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;[xhprof]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;extension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;xhprof.so&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;;
; directory used by default implementation of the iXHProfRuns
; interface (namely, the XHProfRuns_Default class) for storing
; XHProf runs.
;
&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;xhprof.output_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/var/tmp/xhprof&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Lastly, restart Apache so that the PHP config changes take effect.&lt;/p&gt;

&lt;h3 id=&quot;set-up-a-path-to-view-the-xhprof-gui&quot;&gt;Set up a path to view the XHProf GUI&lt;/h3&gt;

&lt;p&gt;The XHProf GUI runs off a set of HTML files in the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory. If you’ve been following the install steps above, you should be able to find that directory at &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/php/xhprof_html&lt;/code&gt;. Now you need to set up your virtual host configuration to serve the files in the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory.&lt;/p&gt;

&lt;p&gt;I find the easiest way to do this is just to symlink the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory into the existing webroot of whatever site you’re working on locally, for example:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ln -s /usr/share/php/xhprof_html /var/www/my-website-dir/xhprof&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;If you’re using DrupalVM, a separate vhost configuration will already be set up for XHProf, and the default URL is &lt;code class=&quot;highlighter-rouge&quot;&gt;http://xhprof.drupalvm.dev/&lt;/code&gt; although it can be changed in your &lt;code class=&quot;highlighter-rouge&quot;&gt;config.yml&lt;/code&gt; file.&lt;/p&gt;

&lt;h3 id=&quot;hooking-xhprof-into-your-module-code&quot;&gt;Hooking XHProf into your module code&lt;/h3&gt;

&lt;p&gt;Generally, the process of profiling a chunk of code using XHProf goes as follows:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Call &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_enable()&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Run the code you want profiled&lt;/li&gt;
  &lt;li&gt;Once the code has finished running, call &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_disable()&lt;/code&gt;. That function will return the profiler data, which you can either display to the screen (not recommended), or…&lt;/li&gt;
  &lt;li&gt;Store the profiler data to a file by creating a new &lt;code class=&quot;highlighter-rouge&quot;&gt;XHProfRuns_Default();&lt;/code&gt; object and calling its &lt;code class=&quot;highlighter-rouge&quot;&gt;save_run&lt;/code&gt; method.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In the case below, I’m profiling a module that implements a few Drush commands from the command line which I’d like to optimize. So I created &lt;code class=&quot;highlighter-rouge&quot;&gt;_modulename_xhprof_enable()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;_modulename_xhprof_disable()&lt;/code&gt; functions – the names don’t matter here – and then added a &lt;code class=&quot;highlighter-rouge&quot;&gt;--profile&lt;/code&gt; flag to my Drush command options which, when it is set to true, calls my custom enable/disable functions before and after the Drush command runs.&lt;/p&gt;

&lt;p&gt;Here’s what those look like in full:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Helper function to enable xhprof.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_mymodule_enable_xhprof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;function_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;xhprof_enable&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Tell XHProf to track both CPU time and memory usage
&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;xhprof_enable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;XHPROF_FLAGS_CPU&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XHPROF_FLAGS_MEMORY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Don&#39;t treat these functions as separate function callss
&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;// in the results.
&lt;/span&gt;        &lt;span class=&quot;s1&quot;&gt;&#39;ignored_functions&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;call_user_func&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;s1&quot;&gt;&#39;call_user_func_array&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;/**
 * Helper function to disable xhprof and save logs.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_mymodule_disable_xhprof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;function_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;xhprof_enable&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$xhprof_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;xhprof_disable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// Saving the XHProf run
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// using the default implementation of iXHProfRuns.
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;include_once&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/xhprof_lib/utils/xhprof_lib.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;include_once&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/xhprof_lib/utils/xhprof_runs.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nv&quot;&gt;$xhprof_runs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XHProfRuns_Default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Save the run under a namespace &quot;xhprof_foo&quot;.
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// **NOTE**:
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// By default save_run() will automatically generate a unique
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// run id for you. [You can override that behavior by passing
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// a run id (optional arg) to the save_run() method instead.]
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// .
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$run_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$xhprof_runs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;save_run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$xhprof_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;xhprof_mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;---------------&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Assuming you have set up the http based UI for &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;XHProf at some address, you can view run at &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http://mywebsiteurl.dev/xhprof/index.php?run=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$run_id&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;source=xhprof_mymodule&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;---------------&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt; command here works fine for a Drush command, but for other tasks you could log the run url using watchdog.&lt;/p&gt;

&lt;p&gt;Note: Another way to run XHProf on a Drupal site is using the &lt;a href=&quot;https://www.drupal.org/project/xhprof&quot;&gt;XHProf&lt;/a&gt; module, but I haven’t had great luck with that.&lt;/p&gt;

&lt;h3 id=&quot;viewing-profiler-results&quot;&gt;Viewing profiler results&lt;/h3&gt;

&lt;p&gt;If everything is configured correctly, when you run your module you should get a run ID output either to the screen (via &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt;, as above, or however you’ve configured this logging). Visit the URL you configured above for xhprof, and you should see a list of all the stored runs. Clicking on a run will bring up the full profiler report.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-screenshot.jpg&quot; alt=&quot;Sample screenshot of an XHProf profiler report&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;now-what&quot;&gt;Now what?&lt;/h3&gt;

&lt;p&gt;Now you’ve got all this data – how to make sense of it? What to do with it? Stay tuned for more discussion of how to interpret XHProf results and a real-world example of profiling a D8 module, next week!&lt;/p&gt;


    &lt;hr&gt;

    
      &lt;div class=&quot;post-comments&quot;&gt;
  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;
      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;
        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;
        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;
          &lt;div class=&quot;comment-name&quot;&gt;
            &lt;p&gt;Name&lt;/p&gt; &lt;input type=&#39;text&#39; name=&#39;name&#39; id=&#39;name&#39; required /&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-email&quot;&gt;
            &lt;p&gt;Email&lt;/p&gt; &lt;input type=&#39;email&#39; name=&#39;email&#39; id=&#39;email&#39; required /&gt;
            &lt;p class=&quot;email-disclaimer&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;p&gt;Comment&lt;/p&gt;
          &lt;textarea name=&#39;comment&#39; id=&#39;comment&#39; required&gt;&lt;/textarea&gt;
          &lt;p class=&quot;hint below-textarea&quot;&gt;Plain text format only please.&lt;/p&gt;

          &lt;input type=&#39;hidden&#39; name=&#39;slug&#39; id=&#39;slug&#39; value=&#39;/2016/05/26/installing-xhprof.html&#39; /&gt;
          &lt;input type=&#39;text&#39; name=&#39;url&#39; id=&#39;url&#39; /&gt;

          &lt;div class=&#39;are-you-human&#39;&gt;
            &lt;div class=&#39;are-you-human-owl&#39;&gt;
              &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&#39;are-you-human-field&#39;&gt;
              &lt;p&gt;What type of animal is the Savas Labs logo?&lt;/p&gt;
              &lt;input type=&#39;text&#39; name=&#39;nocaptcha&#39; id=&#39;nocaptcha&#39; class=&#39;nocaptcha&#39;&gt;
              &lt;p class=&quot;hint&quot;&gt;Hint: 3 letters long, starts with an &#39;o&#39; and ends with an &#39;l&#39;.&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&#39;submit&#39; value=&#39;Submit&#39; id=&#39;submit&#39; class=&quot;submit-comment&quot;/&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

    
    
      &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;
    &lt;h4&gt;About the author&lt;/h4&gt;
    
      &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
        &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-576by509-a08682.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-a08682.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-a08682.jpg&quot; class=&quot;image--team-post-meta&quot; itemprop=&quot;image&quot; alt=&quot;Tim Stallmann&quot; &gt;
  &lt;/picture&gt;

      &lt;/a&gt;
      &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
    
  &lt;/div&gt;
    &lt;!-- Once we have more content, change this to posts related by tag --&gt;
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas Labs&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/09/23/supercharged-seo-with-drupal-8.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Supercharged SEO with Drupal 8
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Sep 23, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;SEO trends 2017 and Drupal 8 as the best option for your long-term marketing campaign.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/08/29/internship-thoughts.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  A Savas Labs Internship
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Aug 29, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;What it’s like to learn at Savas Labs.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Usability Testing - Our Process and Favorite Practices
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 22, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;Our approach to designing, conducting, and learning from user testing and other analyses.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

    
    &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Strategies and tools for resolving Git merge conflicts&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2016/05/20/drupalcon-nola-recap.html&quot;&gt; Drupalcon New Orleans 2016: a Twitter recap &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;


  &lt;/article&gt;

&lt;/div&gt;
",
      "author": {
          "@context": "http://schema.org",
          "@type": "Person",
          "name": "Tim Stallmann",
          "affiliation": "Savas Labs",
          "worksFor": "Savas Labs"
      },
    "keywords": "php, performance, drupal, drupal-planet, module-development",
    "text": "


&lt;div class=&quot;post&quot;&gt;
  &lt;header class=&quot;post-header&quot;&gt;
    &lt;h1 class=&quot;post-title&quot;&gt;Installing XHProf to profile your Drupal module&lt;/h1&gt;
    &lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;
    &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
    &lt;p&gt;May 26, 2016 &lt;/p&gt;&lt;br&gt;
    &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/php/&quot;&gt;PHP&lt;/a&gt;, &lt;a href=&quot;/blog/tag/performance/&quot;&gt;Performance&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;, &lt;a href=&quot;/blog/tag/module-development/&quot;&gt;Module Development&lt;/a&gt;&lt;/p&gt;
    
    &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    
      &lt;div class=&quot;post-featured-image&quot;&gt;
        &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-1000by1000-c366a8.jpg&quot; media=&quot;(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-737by737-c366a8.jpg&quot; media=&quot;(min-width: 400px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-800by800-c366a8.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-400by400-c366a8.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-400by400-c366a8.jpg&quot; class=&quot;image--post-featured-image&quot; itemprop=&quot;image&quot; alt=&quot;an XHProf callgraph&quot; &gt;
  &lt;/picture&gt;

      &lt;/div&gt;
    
  &lt;/header&gt;

  

  &lt;article class=&quot;post-content&quot;&gt;
    &lt;p&gt;XHProf is a profiling tool for PHP code – it tracks the amount of time and memory your code spends in each function call, allowing you to spot bottlenecks in the code and identify where it’s worth spending resources on optimization. There are have been a &lt;a href=&quot;http://www.linuxjournal.com/article/7213&quot;&gt;number of PHP profilers over the years&lt;/a&gt;, and XDebug has &lt;a href=&quot;https://xdebug.org/docs/profiler&quot;&gt;a profiler as well&lt;/a&gt;, but XHProf is the first one I’ve successfully managed to configure correctly and interpret the output of.&lt;/p&gt;

&lt;p&gt;I had run across a number of blog posts about using XHProf + Drupal, but never actually got it to work sucessfully for a project. Because so much of the documentation online is incomplete or out-of-date, I thought it would be useful to document my process using XHProf to profile a Drupal 8 custom module here. YMMV, but please post your thoughts/experiences in the comments!&lt;/p&gt;

&lt;h3 id=&quot;how-to-find-documentation&quot;&gt;How to find documentation&lt;/h3&gt;

&lt;p&gt;I find the &lt;a href=&quot;http://php.net/manual/en/book.xhprof.php&quot;&gt;php.net XHProf manual entry&lt;/a&gt; super-confusing and circular. Part of the problem is that Facebook’s original documentation for the library has since been removed from the internet and is only accessible via &lt;a href=&quot;http://web.archive.org&quot;&gt;the WayBack Machine&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If there’s only one thing you take away from this blog post, let it be: read and bookmark the WayBack machine view of the original XHProf documentation, which is at &lt;a href=&quot;http://web.archive.org/web/20110514095512/http://mirror.facebook.net/facebook/xhprof/doc.html&quot;&gt;http://web.archive.org/web/20110514095512/http://mirror.facebook.net/facebook/xhprof/doc.html&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;install-xhprof-in-a-vm&quot;&gt;Install XHProf in a VM&lt;/h3&gt;

&lt;p&gt;If you’re not running DrupalVM, you’ll need to install XHProf manually via &lt;a href=&quot;https://pecl.php.net/&quot;&gt;PECL&lt;/a&gt;. On &lt;a href=&quot;http://docs.drupalvm.com/en/latest/&quot;&gt;DrupalVM&lt;/a&gt;, &lt;a href=&quot;http://docs.drupalvm.com/en/latest/extras/profile-code/#xhprof&quot;&gt;XHProf is already installed&lt;/a&gt; and you can skip to the next step.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo pecl install xhprof-beta&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Note that all these commands are for Ubuntu flavors of linux. If you’re on Red Hat / CentOS you’ll want to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;yum&lt;/code&gt; equivalents. I had to first install the &lt;code class=&quot;highlighter-rouge&quot;&gt;php5-dev&lt;/code&gt; package to get PECL working properly:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get install php5-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And, if you want to view nice callgraph trees like the one below you’ll need to install the graphviz package &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo apt-get install graphviz&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-callgraph.jpg&quot; alt=&quot;Image of a sample XHProf callgraph&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;configure-php-to-run-xhprof&quot;&gt;Configure PHP to run XHProf&lt;/h3&gt;

&lt;p&gt;You need to tell PHP to enable the xhprof extension via your php.ini files. Usually these are in &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/php5/apache2/php.ini&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/php5/cli/php.ini&lt;/code&gt;. Add the following lines to the bottom of each file if they’re not there already. You will also need to create the &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/tmp/xhprof&lt;/code&gt; directory if it doesn’t already exist.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;[xhprof]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;extension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;xhprof.so&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;;
; directory used by default implementation of the iXHProfRuns
; interface (namely, the XHProfRuns_Default class) for storing
; XHProf runs.
;
&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;xhprof.output_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/var/tmp/xhprof&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Lastly, restart Apache so that the PHP config changes take effect.&lt;/p&gt;

&lt;h3 id=&quot;set-up-a-path-to-view-the-xhprof-gui&quot;&gt;Set up a path to view the XHProf GUI&lt;/h3&gt;

&lt;p&gt;The XHProf GUI runs off a set of HTML files in the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory. If you’ve been following the install steps above, you should be able to find that directory at &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/php/xhprof_html&lt;/code&gt;. Now you need to set up your virtual host configuration to serve the files in the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory.&lt;/p&gt;

&lt;p&gt;I find the easiest way to do this is just to symlink the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory into the existing webroot of whatever site you’re working on locally, for example:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ln -s /usr/share/php/xhprof_html /var/www/my-website-dir/xhprof&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;If you’re using DrupalVM, a separate vhost configuration will already be set up for XHProf, and the default URL is &lt;code class=&quot;highlighter-rouge&quot;&gt;http://xhprof.drupalvm.dev/&lt;/code&gt; although it can be changed in your &lt;code class=&quot;highlighter-rouge&quot;&gt;config.yml&lt;/code&gt; file.&lt;/p&gt;

&lt;h3 id=&quot;hooking-xhprof-into-your-module-code&quot;&gt;Hooking XHProf into your module code&lt;/h3&gt;

&lt;p&gt;Generally, the process of profiling a chunk of code using XHProf goes as follows:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Call &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_enable()&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Run the code you want profiled&lt;/li&gt;
  &lt;li&gt;Once the code has finished running, call &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_disable()&lt;/code&gt;. That function will return the profiler data, which you can either display to the screen (not recommended), or…&lt;/li&gt;
  &lt;li&gt;Store the profiler data to a file by creating a new &lt;code class=&quot;highlighter-rouge&quot;&gt;XHProfRuns_Default();&lt;/code&gt; object and calling its &lt;code class=&quot;highlighter-rouge&quot;&gt;save_run&lt;/code&gt; method.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In the case below, I’m profiling a module that implements a few Drush commands from the command line which I’d like to optimize. So I created &lt;code class=&quot;highlighter-rouge&quot;&gt;_modulename_xhprof_enable()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;_modulename_xhprof_disable()&lt;/code&gt; functions – the names don’t matter here – and then added a &lt;code class=&quot;highlighter-rouge&quot;&gt;--profile&lt;/code&gt; flag to my Drush command options which, when it is set to true, calls my custom enable/disable functions before and after the Drush command runs.&lt;/p&gt;

&lt;p&gt;Here’s what those look like in full:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Helper function to enable xhprof.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_mymodule_enable_xhprof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;function_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;xhprof_enable&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Tell XHProf to track both CPU time and memory usage
&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;xhprof_enable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;XHPROF_FLAGS_CPU&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XHPROF_FLAGS_MEMORY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Don&#39;t treat these functions as separate function callss
&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;// in the results.
&lt;/span&gt;        &lt;span class=&quot;s1&quot;&gt;&#39;ignored_functions&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;call_user_func&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;s1&quot;&gt;&#39;call_user_func_array&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;/**
 * Helper function to disable xhprof and save logs.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_mymodule_disable_xhprof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;function_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;xhprof_enable&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$xhprof_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;xhprof_disable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// Saving the XHProf run
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// using the default implementation of iXHProfRuns.
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;include_once&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/xhprof_lib/utils/xhprof_lib.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;include_once&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/xhprof_lib/utils/xhprof_runs.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nv&quot;&gt;$xhprof_runs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XHProfRuns_Default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Save the run under a namespace &quot;xhprof_foo&quot;.
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// **NOTE**:
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// By default save_run() will automatically generate a unique
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// run id for you. [You can override that behavior by passing
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// a run id (optional arg) to the save_run() method instead.]
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// .
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$run_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$xhprof_runs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;save_run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$xhprof_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;xhprof_mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;---------------&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Assuming you have set up the http based UI for &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;XHProf at some address, you can view run at &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http://mywebsiteurl.dev/xhprof/index.php?run=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$run_id&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;source=xhprof_mymodule&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;---------------&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt; command here works fine for a Drush command, but for other tasks you could log the run url using watchdog.&lt;/p&gt;

&lt;p&gt;Note: Another way to run XHProf on a Drupal site is using the &lt;a href=&quot;https://www.drupal.org/project/xhprof&quot;&gt;XHProf&lt;/a&gt; module, but I haven’t had great luck with that.&lt;/p&gt;

&lt;h3 id=&quot;viewing-profiler-results&quot;&gt;Viewing profiler results&lt;/h3&gt;

&lt;p&gt;If everything is configured correctly, when you run your module you should get a run ID output either to the screen (via &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt;, as above, or however you’ve configured this logging). Visit the URL you configured above for xhprof, and you should see a list of all the stored runs. Clicking on a run will bring up the full profiler report.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-screenshot.jpg&quot; alt=&quot;Sample screenshot of an XHProf profiler report&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;now-what&quot;&gt;Now what?&lt;/h3&gt;

&lt;p&gt;Now you’ve got all this data – how to make sense of it? What to do with it? Stay tuned for more discussion of how to interpret XHProf results and a real-world example of profiling a D8 module, next week!&lt;/p&gt;


    &lt;hr&gt;

    
      &lt;div class=&quot;post-comments&quot;&gt;
  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;
      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;
        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;
        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;
          &lt;div class=&quot;comment-name&quot;&gt;
            &lt;p&gt;Name&lt;/p&gt; &lt;input type=&#39;text&#39; name=&#39;name&#39; id=&#39;name&#39; required /&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-email&quot;&gt;
            &lt;p&gt;Email&lt;/p&gt; &lt;input type=&#39;email&#39; name=&#39;email&#39; id=&#39;email&#39; required /&gt;
            &lt;p class=&quot;email-disclaimer&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;p&gt;Comment&lt;/p&gt;
          &lt;textarea name=&#39;comment&#39; id=&#39;comment&#39; required&gt;&lt;/textarea&gt;
          &lt;p class=&quot;hint below-textarea&quot;&gt;Plain text format only please.&lt;/p&gt;

          &lt;input type=&#39;hidden&#39; name=&#39;slug&#39; id=&#39;slug&#39; value=&#39;/2016/05/26/installing-xhprof.html&#39; /&gt;
          &lt;input type=&#39;text&#39; name=&#39;url&#39; id=&#39;url&#39; /&gt;

          &lt;div class=&#39;are-you-human&#39;&gt;
            &lt;div class=&#39;are-you-human-owl&#39;&gt;
              &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&#39;are-you-human-field&#39;&gt;
              &lt;p&gt;What type of animal is the Savas Labs logo?&lt;/p&gt;
              &lt;input type=&#39;text&#39; name=&#39;nocaptcha&#39; id=&#39;nocaptcha&#39; class=&#39;nocaptcha&#39;&gt;
              &lt;p class=&quot;hint&quot;&gt;Hint: 3 letters long, starts with an &#39;o&#39; and ends with an &#39;l&#39;.&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&#39;submit&#39; value=&#39;Submit&#39; id=&#39;submit&#39; class=&quot;submit-comment&quot;/&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

    
    
      &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;
    &lt;h4&gt;About the author&lt;/h4&gt;
    
      &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
        &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-576by509-a08682.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-a08682.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-a08682.jpg&quot; class=&quot;image--team-post-meta&quot; itemprop=&quot;image&quot; alt=&quot;Tim Stallmann&quot; &gt;
  &lt;/picture&gt;

      &lt;/a&gt;
      &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
    
  &lt;/div&gt;
    &lt;!-- Once we have more content, change this to posts related by tag --&gt;
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas Labs&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/09/23/supercharged-seo-with-drupal-8.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Supercharged SEO with Drupal 8
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Sep 23, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;SEO trends 2017 and Drupal 8 as the best option for your long-term marketing campaign.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/08/29/internship-thoughts.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  A Savas Labs Internship
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Aug 29, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;What it’s like to learn at Savas Labs.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Usability Testing - Our Process and Favorite Practices
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 22, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;Our approach to designing, conducting, and learning from user testing and other analyses.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

    
    &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Strategies and tools for resolving Git merge conflicts&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2016/05/20/drupalcon-nola-recap.html&quot;&gt; Drupalcon New Orleans 2016: a Twitter recap &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;


  &lt;/article&gt;

&lt;/div&gt;
",
    "sourceOrganization": "Savas Labs",
    "inLanguage": "en-US",
    "dateCreated": "2016-05-26 00:00:00 +0000",
    "datePublished": "2016-05-26 00:00:00 +0000",
    "url": "http://savaslabs.com/2016/05/26/installing-xhprof.html"
  }
</script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  <script>
    !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function l(){d.addEventListener&&d.removeEventListener("load",l),d.media=r||"all"}var a,i=e.document,d=i.createElement("link");if(n)a=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;a=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){a.parentNode.insertBefore(d,n?a:a.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",l),d.onloadcssdefined=f,f(l),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(t){}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){e.clearInterval(n)})}}}(this);
    loadCSS('/assets/styles/main.css');
    loadCSS('https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Source+Sans+Pro');
  </script>
  <style>img,legend{border:0}pre,textarea{overflow:auto}.table-minimal,table{border-spacing:0;width:100%}html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,::after,::before{box-sizing:inherit}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,optgroup,strong{font-weight:700}dfn{font-style:italic}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}svg:not(:root){overflow:hidden}figure{margin:1em 40px}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}legend{padding:0}textarea{resize:vertical}.case-studies .case-studies__case-study .case-study__description a,.case-study .case-study__header .case-study__header__text .case-study__header__link{border:2px solid #fff;border-radius:3px;color:#fff;font-family:"Roboto Condensed","Helvetica Neue",Helvetica,Arial,sans-serif;margin-top:2em;padding:.5em 1em;transition:all .2s ease-in-out}.flash-alert,.flash-alert a,.flash-alert a:focus,.flash-alert a:hover,.flash-error,.flash-error a,.flash-error a:focus,.flash-error a:hover{color:rgba(0,0,0,.2)}.flash-alert,.flash-error,.flash-notice,.flash-success{padding:.75em;text-align:center;display:block;font-weight:600;margin-bottom:.75em}.case-studies .case-studies__case-study .case-study__description a:focus,.case-studies .case-studies__case-study .case-study__description a:hover,.case-study .case-study__header .case-study__header__text .case-study__header__link:focus,.case-study .case-study__header .case-study__header__text .case-study__header__link:hover{background-color:#0f7993}.flash-alert{background-color:rgba(242,163,36,.2)}.flash-alert a{text-decoration:underline}.flash-error{background-color:rgba(158,2,59,.2)}.flash-error a{text-decoration:underline}.flash-notice{background-color:rgba(246,67,62,.2);color:rgba(2,0,0,.2)}.flash-notice a,.flash-notice a:focus,.flash-notice a:hover,.flash-success,.flash-success a,.flash-success a:focus,.flash-success a:hover{color:rgba(0,0,0,.2)}.flash-notice a{text-decoration:underline}.flash-success{background-color:rgba(5,92,43,.2)}fieldset,p{margin:0 0 .75em}dl dd,ol,ul{margin:0}td,th{padding:.75em 0}.table-minimal th,th{text-align:left}.flash-success a{text-decoration:underline}.navigation a,a{text-decoration:none}button,input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none;-webkit-font-smoothing:antialiased;background-color:#0a5365;border-radius:3px;border:none;color:#fff;cursor:pointer;display:inline-block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;font-weight:600;line-height:1;padding:.75em 1em;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;white-space:nowrap}button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{background-color:#031a1f;color:#fff}button:disabled,input[type=button]:disabled,input[type=reset]:disabled,input[type=submit]:disabled{cursor:not-allowed;opacity:.5}fieldset{background-color:#f7f7f7;border:1px solid #ddd;padding:1.5em}input,label,select{display:block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em}label{font-weight:600;margin-bottom:.375em}label.required::after{content:"*"}label abbr{display:none}input[type=color],input[type=date],input[type=datetime],input[type=datetime-local],input[type=email],input[type=month],input[type=password],input[type=tel],input[type=text],input[type=time],input[type=url],input[type=week],input[type=number],input[type=search],select[multiple=multiple],textarea{background-color:#fff;border:1px solid #ddd;border-radius:3px;box-shadow:inset 0 1px 3px rgba(0,0,0,.06);box-sizing:border-box;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;margin-bottom:.75em;padding:.5em;transition:border-color;width:100%}input[type=color]:hover,input[type=date]:hover,input[type=datetime]:hover,input[type=datetime-local]:hover,input[type=email]:hover,input[type=month]:hover,input[type=password]:hover,input[type=tel]:hover,input[type=text]:hover,input[type=time]:hover,input[type=url]:hover,input[type=week]:hover,input[type=number]:hover,input[type=search]:hover,select[multiple=multiple]:hover,textarea:hover{border-color:#c4c4c4}input[type=color]:focus,input[type=date]:focus,input[type=datetime]:focus,input[type=datetime-local]:focus,input[type=email]:focus,input[type=month]:focus,input[type=password]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=time]:focus,input[type=url]:focus,input[type=week]:focus,input[type=number]:focus,input[type=search]:focus,select[multiple=multiple]:focus,textarea:focus{border-color:#0a5365;box-shadow:inset 0 1px 3px rgba(0,0,0,.06),0 0 5px rgba(55,112,192,.7);outline:0}hr,td{border-bottom:1px solid #ddd}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none}input[type=checkbox],input[type=radio]{display:inline;margin-right:.375em}input[type=file]{padding-bottom:.75em;width:100%}select{margin-bottom:1.5em;max-width:100%;width:auto}ol,ul{padding:0}dl{margin-bottom:.75em}dl dt{font-weight:700;margin-top:.75em}table{-ms-font-feature-settings:"kern","liga","tnum";font-feature-settings:"kern","liga","tnum";border-collapse:collapse;margin:.75em 0;table-layout:fixed}th{border-bottom:1px solid #b7b7b7;font-weight:600}td .label{font-weight:700}td,th,tr{vertical-align:middle}body{-ms-font-feature-settings:"kern","liga","pnum";font-feature-settings:"kern","liga","pnum";-webkit-font-smoothing:antialiased;font-size:1em;line-height:1.5;color:#14133b;font-family:"Roboto Condensed","Helvetica Neue",Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{line-height:1.2;margin:0 0 .75em;color:#9e023b;font-family:"PT Serif","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:800}a{color:#0a5365;transition:all .1s linear}.card,.card .card-header,.card .card-image img,.team-card{transition:all .2s ease-in-out}a:active,a:focus,a:hover{color:#031a1f}a:active,a:focus{outline:0}hr{box-sizing:content-box;height:0;border-left:none;border-right:none;border-top:none}img,picture{margin:0;max-width:100%}.post,.wrapper{max-width:70em}.table-minimal{border-collapse:separate}.home__cover,.page-description,.view-all-link,.view-more-link,header{text-align:center}.table-minimal td{line-height:1.5}.table-minimal thead th{background-color:#fff;border-bottom:0;padding:.75em 1em}.table-minimal tbody{background-color:#fff}.table-minimal tbody td{border-bottom:0;border-top:1px solid #ddd;padding:.75em 1em}.table-minimal tbody td button{display:inline-block;font-size:.7em;line-height:1.5;margin-bottom:.3em;margin-right:.5em;outline:0;padding:.3em 1em;width:100%}@media screen and (min-width:40em){.table-minimal tbody td button{margin-bottom:0;width:auto}}.table-minimal tbody tr:hover>td,.table-minimal tbody tr:hover>th{background-color:#fafafa}.table-minimal tbody tr:first-child td{border-top:2px solid #ddd}.portfolio h2,.portfolio h3,.portfolio h4,.portfolio h5,.portfolio h6,.post h2,.post h3,.post h4,.post h5,.post h6{margin-top:1.5em}h1{font-size:250%}h2{font-size:200%}h3{font-size:160%}h4{font-size:140%}h5{font-size:120%}h6{font-size:100%}a:focus,a:hover{color:#0f7993}.post li a,p a{border-bottom:.1em solid rgba(10,83,101,.1)}.post li a:focus,.post li a:hover,p a:focus,p a:hover{border-bottom:.1em solid #0f7993}.name-description p,.page-description,.portfolio,.post,.services__service p,.team-member p{color:#14133b;font-size:1.2em}ul{list-style-type:square}ol{list-style-type:decimal}ol,ul{margin-bottom:1em;margin-left:2em}ol ol,ol ol li,ol ul,ol ul li,ul ol,ul ol li,ul ul,ul ul li{font-size:1em}hr{clear:both;margin:3em 0}blockquote{background-color:#f7f7f7;border-left:10px solid rgba(20,19,59,.4);border-radius:0 9px 9px 0;font-style:italic;margin:2em 0;padding:1em;quotes:'\201C' '\201D'}blockquote::before{color:rgba(20,19,59,.4);content:open-quote;font-family:'Source Sans Pro',sans-serif;font-size:4em;line-height:.1em;margin-right:.25em;vertical-align:-.4em}blockquote p{display:inline}.callout{background-color:#14133b;border-left:solid 1em #9e023b;border-radius:6px;margin:1.5em auto;padding:1em;width:100%}.callout p{color:#fff;font-size:1.5em;margin-bottom:0}.wrapper{margin-left:auto;margin-right:auto;padding:3em 1em;vertical-align:baseline}.wrapper::after{clear:both;content:"";display:table}.flex-container{float:left;display:block;margin-right:2.35765%;width:100%}.flex-container:last-child{margin-right:0}.page-description{margin-bottom:2em}@media screen and (min-width:53.75em){.wrapper{padding:3em 0}.column-8{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.column-8:last-child{margin-right:0}}.view-more-link{font-size:1.2em}.cards{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center}.card{flex-basis:15em;-ms-flex-preferred-size:15em;-moz-flex-grow:1;flex-grow:1;-ms-flex-positive:1;background-color:#f7f7f7;border:1px solid #ddd;border-radius:3px;box-shadow:0 2px 4px #e6e6e6;cursor:auto;margin:0 1em 1.5em;position:relative}.card .card-image{max-height:200px;overflow:hidden}.card .card-image img{background:#ddd;border-top-left-radius:3px;border-top-right-radius:3px;width:100%}.card .card-header{background-color:#f7f7f7;border-bottom:1px solid #ddd;border-radius:3px 3px 0 0;font-weight:700;line-height:1.5em;padding:.5em .75em}.card .fa-comment-o{margin-right:4px}.card .card-copy{color:#14133b;font-size:.9em;line-height:1.5em;padding:.75em}.card .card-copy p{margin:0 0 .75em}.card:focus,.card:hover{background-color:#fff}.card:focus .card-image img,.card:hover .card-image img{background:#eaeaea}.card:focus .card-header,.card:hover .card-header{background-color:#fff}.card:active,.card:active .card-header{background-color:#f7f7f7}.team-card{flex-basis:21em;-ms-flex-preferred-size:21em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0}.team-card .card-image{max-height:350px;overflow:hidden}.team-card .card-image img{position:relative;top:-50px}.team-card .card-header{display:inline-block;font-size:1.1em;padding:.5em .75em 0}.team-card .card-copy{border-top:1px solid #dcdcdc;font-size:1em}.team-card .card-title{display:inline-block;float:right;font-size:.8em;line-height:2em;padding:.75em .75em 0;text-transform:uppercase}.work-card{flex-basis:21em;-ms-flex-preferred-size:21em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;flex-shrink:1;-ms-flex-negative:1}.blog-card{flex-basis:20em;-ms-flex-preferred-size:20em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0}.case-studies{margin:3em 0}.case-studies .case-studies__case-study{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;background-position:top center;background-repeat:no-repeat;background-size:cover;margin:1.5em 0}.case-studies .case-studies__case-study a,.case-studies .case-studies__case-study h3,.case-studies .case-studies__case-study p{color:#fff;margin-bottom:0}.case-studies .case-studies__case-study .case-study__description,.case-studies .case-studies__case-study .case-study__title{padding:1.5em}@media screen and (min-width:40em){.case-studies .case-studies__case-study{-webkit-box-lines:single;-moz-box-lines:single;box-lines:single;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.case-studies .case-studies__case-study .case-study__description,.case-studies .case-studies__case-study .case-study__title{padding:3em 1.5em}}.case-studies .case-studies__case-study .case-study__title{padding-bottom:0;text-align:center}.case-studies .case-studies__case-study .case-study__title h3{font-size:200%}.case-studies .case-studies__case-study .case-study__description a,.case-studies .case-studies__case-study .case-study__description p{font-size:1.25em;font-weight:700;margin-bottom:0}.case-studies .case-studies__case-study .case-study__description a{display:inline-block;margin-top:1.5em}.case-studies .case-studies__case-study .case-study__description a i{margin-left:.5em}.home__cover{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;background:url(/assets/img/home-cover-image/home-cover-code-400.png) center center no-repeat #14133b;background-size:cover;height:88vh}@media only screen and (-webkit-min-device-pixel-ratio:2),only screen and (min--moz-device-pixel-ratio:2),only screen and (min-resolution:192dpi),only screen and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-800.png)}}@media screen and (min-width:25em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-640.png)}}@media only screen and (min-width:25em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:25em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:25em) and (min-resolution:192dpi),only screen and (min-width:25em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1280.png)}}@media screen and (min-width:40em){.case-studies .case-studies__case-study .case-study__title{padding-bottom:6em;width:40%}.case-studies .case-studies__case-study .case-study__description{width:60%}.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-860.png);height:78vh}}@media only screen and (min-width:40em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:40em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:40em) and (min-resolution:192dpi),only screen and (min-width:40em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1720.png)}}@media screen and (min-width:53.75em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1120.png);height:88vh}}@media only screen and (min-width:53.75em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min-resolution:192dpi),only screen and (min-width:53.75em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-2240.png)}}@media screen and (min-width:70em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1200.png)}}@media only screen and (min-width:70em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:70em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:70em) and (min-resolution:192dpi),only screen and (min-width:70em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code.png)}}.home__cover .home__cover__heading,.home__cover .home__cover__site-description{margin:0}.home__cover .home__cover__heading{font-size:2em;margin-top:30px}.home__cover hr{border:2px solid #0a5365;border-radius:.5px;margin:10px auto 15px;width:170px}.home__cover .home__cover__site-description{color:#fff;font-size:1.5em;line-height:1.3em;width:230px}.home__cover i{color:#0a5365;font-size:2.8em;padding-top:20px}.navigation{background-color:#0a5365;min-height:70px;width:100%;z-index:999}.navigation .navigation-wrapper{max-width:70em;margin-left:auto;margin-right:auto;padding:25px 0;position:relative;z-index:9999}.navigation .navigation-wrapper::after{clear:both;content:"";display:table}.navigation .logo{background-color:#14133b;border-radius:6px;display:inline-block;float:left;margin:0 0 0 1em;max-height:70px;padding-left:1em;padding-right:1em}@media screen and (min-width:40em){.navigation .logo{float:none;margin:0 auto}}@media screen and (min-width:53.75em){.navigation .logo{float:left;margin:0 0 0 1em}}.navigation .logo img{max-height:70px;padding:.8em 0}.navigation .navigation-menu-button{color:rgba(255,255,255,.7);display:block;float:right;font-weight:700;line-height:70px;margin:0;padding-right:1em;text-transform:uppercase}.navigation .navigation-menu-button:focus,.navigation .navigation-menu-button:hover{color:#fff}.navigation nav{float:none;min-height:70px;z-index:9999999}@media screen and (min-width:40em){.navigation .navigation-menu-button{display:none}.navigation nav{clear:left;margin:0 auto}}@media screen and (min-width:53.75em){.navigation nav{clear:none;float:right}}.navigation .navigation-menu{clear:both;display:none;margin:0 auto;overflow:visible;padding:0;-webkit-transform-style:preserve-3d;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .navigation-menu{display:inline;margin:0;padding:0}}.navigation .navigation-menu.show{display:block}.navigation .nav-link{background:#0a5365;display:block;line-height:70px;overflow:hidden;padding-right:.8em;text-align:right;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .nav-link{background:0 0;display:inline;line-height:70px;text-decoration:none;width:auto}.navigation .nav-link a{padding-right:.5em}}.navigation .nav-link a{color:rgba(255,255,255,.7);display:inline-block;font-size:1.1em;font-weight:400;text-transform:uppercase}@media screen and (min-width:53.75em){.navigation .nav-link a{padding-right:1em}}.navigation .active-nav-item a,.navigation .nav-link a:focus,.navigation .nav-link a:hover{color:#fff}.navigation .more.nav-link{overflow:visible;padding-right:0}@media screen and (min-width:40em){.navigation .more.nav-link{padding-right:.8em;position:relative}.navigation .more.nav-link>ul>li:first-child a{padding-top:1em}.navigation .more.nav-link>a{margin-right:1em}}.navigation .more.nav-link a{padding-right:.8em}.navigation .more.nav-link>a{padding-right:.6em;position:relative}.navigation .more.nav-link>a::after{position:absolute;top:auto;right:-.4em;bottom:auto;left:auto;color:rgba(255,255,255,.7)}@media screen and (min-width:40em){.navigation .more.nav-link>a::after{content:'\25BE'}.navigation .submenu{left:-1em;position:absolute;top:1.5em}}.portfolio::after,.post::after,.team-member::after{clear:both;content:""}.navigation .more.nav-link:focus>.submenu,.navigation .more.nav-link:hover>.submenu{display:block}.navigation .submenu{display:none;padding-left:0}.navigation .submenu li{display:block;padding-right:0}.navigation .submenu li a{background-color:#094857;display:inline-block;text-align:right;width:100%}@media screen and (min-width:40em){.navigation .submenu li{line-height:53.85px}.navigation .submenu li:first-child>a{border-top-left-radius:3px;border-top-right-radius:3px}.navigation .submenu li:last-child>a{border-bottom-left-radius:3px;border-bottom-right-radius:3px;padding-bottom:.7em}.navigation .submenu li a{background-color:#0a5365;padding-left:1em;text-align:left;width:10em}}.caption,.page-work h2,.team-member .team-links{text-align:center}.post{margin-left:auto;margin-right:auto}.post::after{display:table}@media screen and (min-width:53.75em){.post{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.post:last-child{margin-right:0}}.post .post-header{margin-bottom:1.875em}.post .post-header p{display:inline}.post .post-header i{color:#14133b;margin-right:5px}.post .post-header .centerdot{font-weight:700}.post .post-header .post-featured-image{margin:3em 0}.post .disclaimer{background-color:rgba(158,2,59,.1);border:1px solid rgba(158,2,59,.3);border-radius:5px;margin-bottom:1.875em;padding:1em}.post .disclaimer h5{margin-top:0}.post .twitter-tweet{margin:3em auto!important}.post .table-minimal{margin-bottom:3em;margin-top:3em}.post ul ul{margin-bottom:0}.blog-image,.blog-image-large,.blog-image-xl{background:#dcdcdc;box-shadow:0 2px 4px #c3c3c3;display:block;margin:1em auto;max-width:250px}@media screen and (min-width:40em){.blog-image.wrap-right,.wrap-right.blog-image-large,.wrap-right.blog-image-xl{float:left;margin-right:40px}.blog-image.wrap-left,.wrap-left.blog-image-large,.wrap-left.blog-image-xl{float:right;margin-left:40px}}.blog-image p,.blog-image-large p,.blog-image-xl p{font-size:smaller;font-weight:700;text-align:center}.blog-image-large{max-width:500px;width:100%}.blog-image-xl{height:auto;max-width:737px;width:100%}.caption{display:block;font-size:.9em;margin:0 auto 2em}.services{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap}.services .services__service{margin-bottom:3em}.services .services__service .services__service__icon{float:left}.services .services__service p{display:inline;margin:0}@media screen and (min-width:53.75em){.services--main .services__service{margin-bottom:0;padding:1.5em;width:50%}}.services--main .services__service:last-child{margin-bottom:0}.services--main .services__service .services__service__icon{margin-right:1em}.team-member{max-width:70em;margin-left:auto;margin-right:auto}.team-member::after{display:table}@media screen and (min-width:40em){.team-member{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.team-member:last-child{margin-right:0}}.team-member .team-header img{border-radius:3px;max-width:100%;width:350px}.team-member .team-links{margin:1em auto 3em}.team-member .team-links li{display:inline-block;list-style-type:none;min-width:45%;padding:0 .75em}.team-member .fa-file-text{font-size:13px}.case-study{clear:both}.case-study .case-study__header{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:distribute;-moz-justify-content:space-around;-ms-justify-content:space-around;-o-justify-content:space-around;justify-content:space-around;-ms-flex-pack:distribute;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;background-position:top center;background-repeat:no-repeat;background-size:cover;height:88vh;min-height:320px}@media screen and (min-width:40em){.team-member .team-links{width:60%}.case-study .case-study__header{height:78vh}}@media screen and (min-width:53.75em){.team-member .team-links{width:100%}.team-member .team-links li{min-width:1%}.case-study .case-study__header{height:88vh}}.case-study .case-study__header .case-study__header__text{padding:1em}.case-study .case-study__header .case-study__header__text h1{color:#fff;font-size:2em;margin-bottom:1em}@media screen and (min-width:40em){.case-study .case-study__header .case-study__header__text{width:80%}.case-study .case-study__header .case-study__header__text h1{font-size:2.5em}}.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{color:#fff;font-size:1.1em;font-weight:700}@media screen and (min-width:40em){.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{font-size:1.25em}}.case-study .case-study__header .case-study__header__text .case-study__header__link{display:inline-block;margin-top:1.5em}.case-study .wrapper{padding:0}.portfolio{max-width:70em;margin-left:auto;margin-right:auto}.portfolio::after{display:table}@media screen and (min-width:53.75em){.case-study .case-study__header .case-study__header__text{width:60%}.portfolio{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.portfolio:last-child{margin-right:0}}</style>
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">

    <!-- Savas Labs logo. -->
    <a href="/" class="logo">
        <img width="101px" height="70px" src="http://savaslabs.com/assets/img/logo.png" alt="Savas Labs logo">
    </a>

    <!-- Mobile menu button. -->
    <a href="/" id="js-mobile-menu" class="navigation-menu-button">MENU</a>

    <!-- Main menu. -->
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">

        <!-- Loop through nav items in config.yml. -->
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  more">
            <a href="javascript:void(0)">Who we are</a>

            <!-- If there are sub-links, create them. -->
            

              <ul class="submenu">
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/team">Team</a>
                  </li>
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/mission-and-values">Mission & values</a>
                  </li>
                
              </ul>
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/services">Services</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/work">Our work</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/blog">Blog</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/contact">Contact</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        


<div class="post">
  <header class="post-header">
    <h1 class="post-title">Installing XHProf to profile your Drupal module</h1>
    <p>By <a href="/team/tim-stallmann">Tim Stallmann</a></p>
    <p class="centerdot">&centerdot; </p>
    <p>May 26, 2016 </p><br>
    <i class="fa fa-tags"></i><p><a href="/blog/tag/php/">PHP</a>, <a href="/blog/tag/performance/">Performance</a>, <a href="/blog/tag/drupal/">Drupal</a>, <a href="/blog/tag/drupal-planet/">Drupal Planet</a>, <a href="/blog/tag/module-development/">Module Development</a></p>
    
    <div><p><span id="comment-count"></span></p></div>
    
    
      <div class="post-featured-image">
        <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-1000by1000-c366a8.jpg" media="(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-737by737-c366a8.jpg" media="(min-width: 400px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-800by800-c366a8.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-400by400-c366a8.jpg">
    <img src="http://savaslabs.com/assets/processed-img/blog/xhprof-callgraph-400by400-c366a8.jpg" class="image--post-featured-image" itemprop="image" alt="an XHProf callgraph" >
  </picture>

      </div>
    
  </header>

  

  <article class="post-content">
    <p>XHProf is a profiling tool for PHP code – it tracks the amount of time and memory your code spends in each function call, allowing you to spot bottlenecks in the code and identify where it’s worth spending resources on optimization. There are have been a <a href="http://www.linuxjournal.com/article/7213">number of PHP profilers over the years</a>, and XDebug has <a href="https://xdebug.org/docs/profiler">a profiler as well</a>, but XHProf is the first one I’ve successfully managed to configure correctly and interpret the output of.</p>

<p>I had run across a number of blog posts about using XHProf + Drupal, but never actually got it to work sucessfully for a project. Because so much of the documentation online is incomplete or out-of-date, I thought it would be useful to document my process using XHProf to profile a Drupal 8 custom module here. YMMV, but please post your thoughts/experiences in the comments!</p>

<h3 id="how-to-find-documentation">How to find documentation</h3>

<p>I find the <a href="http://php.net/manual/en/book.xhprof.php">php.net XHProf manual entry</a> super-confusing and circular. Part of the problem is that Facebook’s original documentation for the library has since been removed from the internet and is only accessible via <a href="http://web.archive.org">the WayBack Machine</a>.</p>

<p>If there’s only one thing you take away from this blog post, let it be: read and bookmark the WayBack machine view of the original XHProf documentation, which is at <a href="http://web.archive.org/web/20110514095512/http://mirror.facebook.net/facebook/xhprof/doc.html">http://web.archive.org/web/20110514095512/http://mirror.facebook.net/facebook/xhprof/doc.html</a>.</p>

<h3 id="install-xhprof-in-a-vm">Install XHProf in a VM</h3>

<p>If you’re not running DrupalVM, you’ll need to install XHProf manually via <a href="https://pecl.php.net/">PECL</a>. On <a href="http://docs.drupalvm.com/en/latest/">DrupalVM</a>, <a href="http://docs.drupalvm.com/en/latest/extras/profile-code/#xhprof">XHProf is already installed</a> and you can skip to the next step.</p>

<p><code class="highlighter-rouge">sudo pecl install xhprof-beta</code></p>

<p>Note that all these commands are for Ubuntu flavors of linux. If you’re on Red Hat / CentOS you’ll want to use the <code class="highlighter-rouge">yum</code> equivalents. I had to first install the <code class="highlighter-rouge">php5-dev</code> package to get PECL working properly:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install php5-dev
</code></pre>
</div>

<p>And, if you want to view nice callgraph trees like the one below you’ll need to install the graphviz package <code class="highlighter-rouge">sudo apt-get install graphviz</code></p>

<p><img src="/assets/img/blog/xhprof-callgraph.jpg" alt="Image of a sample XHProf callgraph" /></p>

<h3 id="configure-php-to-run-xhprof">Configure PHP to run XHProf</h3>

<p>You need to tell PHP to enable the xhprof extension via your php.ini files. Usually these are in <code class="highlighter-rouge">/etc/php5/apache2/php.ini</code> and <code class="highlighter-rouge">/etc/php5/cli/php.ini</code>. Add the following lines to the bottom of each file if they’re not there already. You will also need to create the <code class="highlighter-rouge">/var/tmp/xhprof</code> directory if it doesn’t already exist.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nn">[xhprof]</span>
<span class="py">extension</span><span class="p">=</span><span class="s">xhprof.so</span>
<span class="c">;
; directory used by default implementation of the iXHProfRuns
; interface (namely, the XHProfRuns_Default class) for storing
; XHProf runs.
;
</span><span class="py">xhprof.output_dir</span><span class="p">=</span><span class="s">"/var/tmp/xhprof"</span>
</code></pre>
</div>

<p>Lastly, restart Apache so that the PHP config changes take effect.</p>

<h3 id="set-up-a-path-to-view-the-xhprof-gui">Set up a path to view the XHProf GUI</h3>

<p>The XHProf GUI runs off a set of HTML files in the <code class="highlighter-rouge">xhprof_html</code> directory. If you’ve been following the install steps above, you should be able to find that directory at <code class="highlighter-rouge">/usr/share/php/xhprof_html</code>. Now you need to set up your virtual host configuration to serve the files in the <code class="highlighter-rouge">xhprof_html</code> directory.</p>

<p>I find the easiest way to do this is just to symlink the <code class="highlighter-rouge">xhprof_html</code> directory into the existing webroot of whatever site you’re working on locally, for example:</p>

<p><code class="highlighter-rouge">ln -s /usr/share/php/xhprof_html /var/www/my-website-dir/xhprof</code></p>

<p>If you’re using DrupalVM, a separate vhost configuration will already be set up for XHProf, and the default URL is <code class="highlighter-rouge">http://xhprof.drupalvm.dev/</code> although it can be changed in your <code class="highlighter-rouge">config.yml</code> file.</p>

<h3 id="hooking-xhprof-into-your-module-code">Hooking XHProf into your module code</h3>

<p>Generally, the process of profiling a chunk of code using XHProf goes as follows:</p>

<ol>
  <li>Call <code class="highlighter-rouge">xhprof_enable()</code></li>
  <li>Run the code you want profiled</li>
  <li>Once the code has finished running, call <code class="highlighter-rouge">xhprof_disable()</code>. That function will return the profiler data, which you can either display to the screen (not recommended), or…</li>
  <li>Store the profiler data to a file by creating a new <code class="highlighter-rouge">XHProfRuns_Default();</code> object and calling its <code class="highlighter-rouge">save_run</code> method.</li>
</ol>

<p>In the case below, I’m profiling a module that implements a few Drush commands from the command line which I’d like to optimize. So I created <code class="highlighter-rouge">_modulename_xhprof_enable()</code> and <code class="highlighter-rouge">_modulename_xhprof_disable()</code> functions – the names don’t matter here – and then added a <code class="highlighter-rouge">--profile</code> flag to my Drush command options which, when it is set to true, calls my custom enable/disable functions before and after the Drush command runs.</p>

<p>Here’s what those look like in full:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Helper function to enable xhprof.
 */</span>
<span class="k">function</span> <span class="nf">_mymodule_enable_xhprof</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'xhprof_enable'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Tell XHProf to track both CPU time and memory usage
</span>    <span class="nb">xhprof_enable</span><span class="p">(</span><span class="nx">XHPROF_FLAGS_CPU</span> <span class="o">+</span> <span class="nx">XHPROF_FLAGS_MEMORY</span><span class="p">,</span>
      <span class="k">array</span><span class="p">(</span>
        <span class="c1">// Don't treat these functions as separate function callss
</span>        <span class="c1">// in the results.
</span>        <span class="s1">'ignored_functions'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'call_user_func'</span><span class="p">,</span>
          <span class="s1">'call_user_func_array'</span><span class="p">,</span>
        <span class="p">),</span>
      <span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="sd">/**
 * Helper function to disable xhprof and save logs.
 */</span>
<span class="k">function</span> <span class="nf">_mymodule_disable_xhprof</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'xhprof_enable'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$xhprof_data</span> <span class="o">=</span> <span class="nb">xhprof_disable</span><span class="p">();</span>

    <span class="c1">//
</span>    <span class="c1">// Saving the XHProf run
</span>    <span class="c1">// using the default implementation of iXHProfRuns.
</span>    <span class="c1">//
</span>    <span class="k">include_once</span> <span class="s2">"/usr/share/php/xhprof_lib/utils/xhprof_lib.php"</span><span class="p">;</span>
    <span class="k">include_once</span> <span class="s2">"/usr/share/php/xhprof_lib/utils/xhprof_runs.php"</span><span class="p">;</span>

    <span class="nv">$xhprof_runs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XHProfRuns_Default</span><span class="p">();</span>

    <span class="c1">// Save the run under a namespace "xhprof_foo".
</span>    <span class="c1">//
</span>    <span class="c1">// **NOTE**:
</span>    <span class="c1">// By default save_run() will automatically generate a unique
</span>    <span class="c1">// run id for you. [You can override that behavior by passing
</span>    <span class="c1">// a run id (optional arg) to the save_run() method instead.]
</span>    <span class="c1">// .
</span>    <span class="nv">$run_id</span> <span class="o">=</span> <span class="nv">$xhprof_runs</span><span class="o">-&gt;</span><span class="na">save_run</span><span class="p">(</span><span class="nv">$xhprof_data</span><span class="p">,</span> <span class="s1">'xhprof_mymodule'</span><span class="p">);</span>

    <span class="k">echo</span> <span class="s2">"---------------</span><span class="se">\n</span><span class="s2">Assuming you have set up the http based UI for </span><span class="se">\n</span><span class="s2">XHProf at some address, you can view run at </span><span class="se">\n</span><span class="s2">http://mywebsiteurl.dev/xhprof/index.php?run=</span><span class="nv">$run_id</span><span class="s2">&amp;source=xhprof_mymodule</span><span class="se">\n</span><span class="s2">---------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">echo</code> command here works fine for a Drush command, but for other tasks you could log the run url using watchdog.</p>

<p>Note: Another way to run XHProf on a Drupal site is using the <a href="https://www.drupal.org/project/xhprof">XHProf</a> module, but I haven’t had great luck with that.</p>

<h3 id="viewing-profiler-results">Viewing profiler results</h3>

<p>If everything is configured correctly, when you run your module you should get a run ID output either to the screen (via <code class="highlighter-rouge">echo</code>, as above, or however you’ve configured this logging). Visit the URL you configured above for xhprof, and you should see a list of all the stored runs. Clicking on a run will bring up the full profiler report.</p>

<p><img src="/assets/img/blog/xhprof-screenshot.jpg" alt="Sample screenshot of an XHProf profiler report" /></p>

<h3 id="now-what">Now what?</h3>

<p>Now you’ve got all this data – how to make sense of it? What to do with it? Stay tuned for more discussion of how to interpret XHProf results and a real-world example of profiling a D8 module, next week!</p>


    <hr>

    
      <div class="post-comments">
  
    <div class="expander">
      <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander-hidden">Comments!</a>
      <div id="js-expander-content" class="expander-content">
        <!-- If there are existing comments, output them here. -->
        <div id="post-comments" class="post-comments"></div>
        <!-- New comment form -->
        <form id="comment-form">
          <h4>Leave a comment</h4>
          <div class="comment-name">
            <p>Name</p> <input type='text' name='name' id='name' required /><br>
          </div>

          <div class="comment-email">
            <p>Email</p> <input type='email' name='email' id='email' required />
            <p class="email-disclaimer">Savas Labs will never sell your email address or spam you.</p><br>
          </div>

          <p>Comment</p>
          <textarea name='comment' id='comment' required></textarea>
          <p class="hint below-textarea">Plain text format only please.</p>

          <input type='hidden' name='slug' id='slug' value='/2016/05/26/installing-xhprof.html' />
          <input type='text' name='url' id='url' />

          <div class='are-you-human'>
            <div class='are-you-human-owl'>
              <img src="/assets/img/icons-and-logos/owl.png" alt="Savas Labs logo">
            </div>
            <div class='are-you-human-field'>
              <p>What type of animal is the Savas Labs logo?</p>
              <input type='text' name='nocaptcha' id='nocaptcha' class='nocaptcha'>
              <p class="hint">Hint: 3 letters long, starts with an 'o' and ends with an 'l'.</p>
            </div>
          </div>

          <input type='submit' value='Submit' id='submit' class="submit-comment"/>
        </form>
      </div>
    </div>
  
  <hr>
</div>

    
    
      <div class="post-bottom">
  <div class="post-meta">
    <h4>About the author</h4>
    
      <a href="/team/tim-stallmann">
        <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/tim-stallmann-576by509-a08682.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-a08682.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-a08682.jpg" class="image--team-post-meta" itemprop="image" alt="Tim Stallmann" >
  </picture>

      </a>
      <p class="post-author-desc">Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.</p>
    
  </div>
    <!-- Once we have more content, change this to posts related by tag -->
  <div class="post-related flex-container">
    <h4>Recent posts by Savas Labs</h4>
    <div class="cards">
      
      
        
        
          <div class="card">
            <a href="/2016/09/23/supercharged-seo-with-drupal-8.html">
              <div class="card-header">
                  Supercharged SEO with Drupal 8
              </div>
              <div class="card-copy">
                <p>Sep 23, 2016</p>
                
                <p><p>SEO trends 2017 and Drupal 8 as the best option for your long-term marketing campaign.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2016/08/29/internship-thoughts.html">
              <div class="card-header">
                  A Savas Labs Internship
              </div>
              <div class="card-copy">
                <p>Aug 29, 2016</p>
                
                <p><p>What it’s like to learn at Savas Labs.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2016/06/22/user-testing.html">
              <div class="card-header">
                  Usability Testing - Our Process and Favorite Practices
              </div>
              <div class="card-copy">
                <p>Jun 22, 2016</p>
                
                <p><p>Our approach to designing, conducting, and learning from user testing and other analyses.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
</div>

    
    <div class="previous-next-links">
  <div class="next">
    
      <a href="/2016/06/15/git-merge-conflict-strategies.html"><i class="fa fa-long-arrow-left "></i> Strategies and tools for resolving Git merge conflicts</a>
    
  </div>
  <div class="previous">
    
      <a href="/2016/05/20/drupalcon-nola-recap.html"> Drupalcon New Orleans 2016: a Twitter recap <i class="fa fa-long-arrow-right"></i></a>
    
  </div>
</div>


  </article>

</div>

      </div>
    </div>

    <div class="contact-block">
  <div class="contact-block__items">
    <h3>Interested in working with us?</h3>
    <a href="/contact">Get in touch!</a>
  </div>
</div>
    <footer class="footer" role="contentinfo">
  <div class="footer-links">
    <ul>
      <li><h3>Location</h3></li>
      <li>Savas Labs<br />
          PMB 210<br />
          201 W Main Street, Suite 100<br />
          Durham, NC 27701<br /></li>
    </ul>
    <ul>
      <li><h3>Around the Web</h3></li>
      <ul>
        <li><a href="https://github.com/savaslabs"><span class="mega-octicon octicon-mark-github"></span></a></li>
        <li><a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a></li>
        <li><a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a></li>
        <li><a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a></li>
      </ul>
    </ul>
    <ul>
      <li><h3>Contact</h3></li>
      <li><a href="mailto:info@savaslabs.com">info@savaslabs.com</a></li>
      <li>(919) 432-4660</li>
    </ul>
  </div>

</footer>

<div class="footer-copyright">
  <p>Copyright &copy; Savas Labs 2016</p>
</div>

    <script type="text/javascript" src="http://savaslabs.com/assets/js/main.js" async></script>

<noscript>
  <link href='/assets/styles/main.css' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Source+Sans+Pro' rel='stylesheet' type='text/css'>
</noscript>

  </body>

</html>
