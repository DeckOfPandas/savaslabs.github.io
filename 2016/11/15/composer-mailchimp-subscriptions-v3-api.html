<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cache-control" content="public">
  <meta http-equiv="expires" content="86400">
  
  <title>Using MailChimp API v3.0 to subscribe users to email lists in Drupal custom modules | Savas Labs</title>
  
  <meta name="description" content="Our clients are often looking to reach their audiences via email campaigns, and MailChimp is one of the solutions we frequently recommend for this. MailChimp...">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="canonical" href="http://savaslabs.com/2016/11/15/composer-mailchimp-subscriptions-v3-api.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="http://savaslabs.com/feed.xml" />
  
  
  
  



  
  
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "about": "How to use Composer along with the ThinkShout PHP library for MailChimp API v3.0 to easily subscribe users to mailing lists without the MailChimp contributed module.",
      "articleBody": "&lt;p&gt;Our clients are often looking to reach their audiences via email campaigns, and &lt;a href=&quot;https://mailchimp.com/&quot;&gt;MailChimp&lt;/a&gt; is one of the solutions we frequently recommend for this. MailChimp makes it easy to create and manage email campaigns while also providing beneficial analytics on user behavior.&lt;/p&gt;

&lt;p&gt;Earlier this year I wrote &lt;a href=&quot;/2016/01/22/composer-mailchimp-subscriptions.html&quot;&gt;a blog post&lt;/a&gt; showing how to use &lt;a href=&quot;https://www.drupal.org/project/composer_manager&quot;&gt;Composer Manager&lt;/a&gt; along with the Mailchimp API v2.0 PHP package to subscribe users to mailing lists in a Drupal 6 or 7 custom module without the need for the Mailchimp contributed module.&lt;/p&gt;

&lt;p&gt;However, since then, MailChimp API v3.0 was released and Mailchimp announced that v2.0 (and all prior versions) will no longer be supported after 2016.&lt;/p&gt;

&lt;p&gt;So in this blog post, I’ll demonstrate how to accomplish the same objective using the new MailChimp API v3.0, and I’ll expand the tutorial to also include some Drupal 8 specifics.&lt;/p&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;To quickly summarize the key takeaways from my previous blog posts &lt;a href=&quot;/2015/10/15/composing-with-composer-manager.html&quot;&gt;on Composer Manager&lt;/a&gt; and &lt;a href=&quot;/2016/01/22/composer-mailchimp-subscriptions.html&quot;&gt;subscribing users to MailChimp lists using the old API&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Composer is a tool for managing PHP libraries that your project depends on.&lt;/li&gt;
  &lt;li&gt;Challenges arise managing project-wide dependencies when custom and contributed modules specify their own unique dependencies.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.drupal.org/project/composer_manager&quot;&gt;Composer Manager&lt;/a&gt; is a contributed module for Drupal 7 (and formerly Drupal 6) that addresses these challenges and allows contributed and custom modules to depend on PHP libraries managed via Composer.&lt;/li&gt;
  &lt;li&gt;Using a Composer managed PHP package for the MailChimp API, we can easily subscribe users to MailChimp lists in a Drupal custom module without relying on the Mailchimp module.&lt;/li&gt;
  &lt;li&gt;While the &lt;a href=&quot;https://www.drupal.org/project/mailchimp&quot;&gt;Mailchimp contributed module&lt;/a&gt; is great, sometimes all you need is a simple, lightweight method for subscribing users to mailing lists.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;One important development since my previous posts is that Composer Manager has been deprecated for Drupal 8. &lt;a href=&quot;https://www.drupal.org/project/drupal/releases/8.1.0&quot;&gt;Improvements introduced in Drupal 8.1.0&lt;/a&gt; allow modules to rely on Composer managed dependencies without the need for the Composer Manager module.&lt;/p&gt;

&lt;h2 id=&quot;implementation&quot;&gt;Implementation&lt;/h2&gt;

&lt;p&gt;There are a few steps we must take so that we can subscribe users to mailing lists in our custom module. We’ll review each of these steps in detail:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Add the MailChimp API v3.0 PHP library as a dependency of our custom module.&lt;/li&gt;
  &lt;li&gt;Ensure that the library is installed for our project.&lt;/li&gt;
  &lt;li&gt;Properly use the library in our custom module to subscribe users to mailing lists.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;specify-the-dependency&quot;&gt;Specify the dependency&lt;/h3&gt;

&lt;p&gt;ThinkShout maintains the &lt;a href=&quot;https://www.drupal.org/project/mailchimp&quot;&gt;Mailchimp contributed module&lt;/a&gt; and we were very excited to see that as part of the effort to &lt;a href=&quot;http://www.garfieldtech.com/blog/off-the-island-2013&quot;&gt;“get Drupal off the island”&lt;/a&gt; they also released &lt;a href=&quot;https://packagist.org/packages/thinkshout/mailchimp-api-php&quot;&gt;a PHP library for MailChimp API v3.0&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To use this new library, we must specify it as a dependency of our custom module. We do that in a &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; file that sits in our custom module’s root directory and requires that library via the following code:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;require&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;thinkshout/mailchimp-api-php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;gt;=1.0.3&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;install-the-library&quot;&gt;Install the library&lt;/h3&gt;

&lt;p&gt;Composer is intended for projects and therefore requires a Drupal site to have a single &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt;, so things get complicated when individual modules specify their own dependencies.&lt;/p&gt;

&lt;p&gt;For Drupal 7 sites (or still active Drupal 6 sites), the &lt;a href=&quot;https://www.drupal.org/project/composer_manager&quot;&gt;Composer Manager&lt;/a&gt; contributed module handles this by merging the requirements specified by each custom and contributed module’s &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; files into a single, consolidated, site-wide &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;So for Drupal 6/7 projects we’ll need Composer Manager installed and enabled.&lt;/p&gt;

&lt;p&gt;Once enabled, we can generate the consolidated &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; and then install all of the site’s dependencies that file specifies (including the MailChimp API v3.0 PHP library specified by our custom module) in one of two ways:&lt;/p&gt;

&lt;p&gt;From the command line, we can run the following drush commands:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;drush composer-json-rebuild
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;drush composer-manager install
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Alternatively, we could include the following lines in an update hook:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Re-build Composer Manager composer.json and run composer update.
drush_composer_manager_composer_json_rebuild&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;;
drush_composer_manager&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;update&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;For Drupal 8 sites, the process is slightly different. As mentioned previously, as of release 8.1.0, Drupal core directly uses Composer to manage dependencies and the Composer Manager module is no longer necessary. For Drupal 8 sites, we should follow the &lt;a href=&quot;https://www.drupal.org/node/2822349&quot;&gt;Drupal.org instructions for managing dependencies for a custom project&lt;/a&gt;. Following those instructions ensures that all of the site’s dependencies, including the MailChimp library specified by our custom module, are installed.&lt;/p&gt;

&lt;h3 id=&quot;use-the-library&quot;&gt;Use the library&lt;/h3&gt;

&lt;p&gt;Once we have the MailChimp API v3.0 PHP library installed, we can use it in our custom module to subscribe users to mailing lists.&lt;/p&gt;

&lt;p&gt;We suggest creating a dedicated function for subscribing users to email lists which can then be called throughout the custom module. For our purposes, we modeled that function off of the Mailchimp module (version 7.x-4.6) &lt;code class=&quot;highlighter-rouge&quot;&gt;mailchimp_subscribe_process()&lt;/code&gt; function.&lt;/p&gt;

&lt;p&gt;We implemented the following function, which can be reviewed and modified for your specific purposes:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Add an email to a MailChimp list.
 *
 * This code is based on the 7.x-4.6 version of the Mailchimp module,
 * specifically the mailchimp_subscribe_process() function. That version of
 * the Mailchimp contrib module makes use of the ThinkShout PHP library for
 * version 3.0 of the MailChimp API. See the following for more detail:
 * https://www.drupal.org/project/mailchimp
 * https://github.com/thinkshout/mailchimp-api-php.
 *
 * @see Mailchimp_Lists::subscribe()
 *
 * @param string $api_key
 *   The MailChimp API key.
 * @param string $list_id
 *   The MailChimp list id that the user should be subscribed to.
 * @param string $email
 *   The email address for the user being subscribed to the mailing list.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mymodule_subscribe_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$api_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Set the timeout to something that won&#39;t take down the Drupal site:
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Get an instance of the MailchimpLists class.
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$mailchimp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;\Mailchimp\MailchimpLists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$api_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;apikey&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Use MEMBER_STATUS_PENDING to require double opt-in for the subscriber. Otherwise, use MEMBER_STATUS_SUBSCRIBED.
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;status&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;\Mailchimp\MailchimpLists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;MEMBER_STATUS_PENDING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;email_type&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;html&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Subscribe user to the list.
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$mailchimp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addOrUpdateMember&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;watchdog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;@email was subscribed to list @list.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;@email&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;@list&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WATCHDOG_NOTICE&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;watchdog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;A problem occurred subscribing @email to list @list.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;&#39;@email&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;&#39;@list&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WATCHDOG_WARNING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// The user was not subscribed so log to watchdog.
&lt;/span&gt;    &lt;span class=&quot;nx&quot;&gt;watchdog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;An error occurred subscribing @email to list @list. Status code @code. &quot;%message&quot;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;@email&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;@list&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;%message&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;@code&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WATCHDOG_ERROR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With that function defined, we can then subscribe an email address to a specific Mailchimp mailing list through the following function call in our custom module:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mymodule_subscribe_user($api_key, $list_id, $email);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;By taking advantage of the modern PHP ecosystem built on reusable Composer managed packages, we can easily build or adapt a custom module to subscribe users to mailing lists without the MailChimp contributed module.&lt;/p&gt;

&lt;p&gt;Lastly, a special thanks to &lt;a href=&quot;https://thinkshout.com/&quot;&gt;ThinkShout&lt;/a&gt; for their hard work maintaining the MailChimp module and creating the library, on which this approach depends!&lt;/p&gt;
",
      "author": {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Dan Murphy",
        "affiliation": "Savas Labs",
        "worksFor": "Savas Labs"
      },
      "dateCreated": "2016-11-15 00:00:00 +0000",
      "dateModified": "2016-11-15 00:00:00 +0000",
      "datePublished": "2016-11-15 00:00:00 +0000",
      "headline": "Using MailChimp API v3.0 to subscribe users to email lists in Drupal custom modules",
      "image": {
        "@context": "http://schema.org",
        "@type": "ImageObject",
        "author": "Dan Murphy",
        "datePublished": "2016-11-15 00:00:00 +0000",
        "description": "sheet music",
        "height": "983px",
        "url": "http://savaslabs.com/assets/img/blog/mailchimp_3_drupal_composer_3.jpg",
        "width": "1474px"
      },
      "inLanguage": "en-US",
      "keywords": "drupal, drupal-planet, composer, module-development, mailchimp",
      "mainEntityOfPage": "http://savaslabs.com/2016/11/15/composer-mailchimp-subscriptions-v3-api.html",
      "publisher": {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Durham, North Carolina",
          "postalCode": "27701",
          "streetAddress": "201 W Main St."
        },
        "description": "We craft elegant Drupal web systems that propel organizations.
",
        "email": "info@savaslabs.com",
        "logo": {
          "@context": "http://schema.org",
          "@type": "ImageObject",
          "description": "Savas Labs logo",
          "height": "50px",
          "url": "http://savaslabs.com/assets/img/logo.png",
          "width": "114px"
        },
        "name": "Savas Labs",
        "telephone": "(919) 432-4660",
        "url": "http://savaslabs.com"
      },
      "sourceOrganization": "Savas Labs",
      "text": "&lt;p&gt;Our clients are often looking to reach their audiences via email campaigns, and &lt;a href=&quot;https://mailchimp.com/&quot;&gt;MailChimp&lt;/a&gt; is one of the solutions we frequently recommend for this. MailChimp makes it easy to create and manage email campaigns while also providing beneficial analytics on user behavior.&lt;/p&gt;

&lt;p&gt;Earlier this year I wrote &lt;a href=&quot;/2016/01/22/composer-mailchimp-subscriptions.html&quot;&gt;a blog post&lt;/a&gt; showing how to use &lt;a href=&quot;https://www.drupal.org/project/composer_manager&quot;&gt;Composer Manager&lt;/a&gt; along with the Mailchimp API v2.0 PHP package to subscribe users to mailing lists in a Drupal 6 or 7 custom module without the need for the Mailchimp contributed module.&lt;/p&gt;

&lt;p&gt;However, since then, MailChimp API v3.0 was released and Mailchimp announced that v2.0 (and all prior versions) will no longer be supported after 2016.&lt;/p&gt;

&lt;p&gt;So in this blog post, I’ll demonstrate how to accomplish the same objective using the new MailChimp API v3.0, and I’ll expand the tutorial to also include some Drupal 8 specifics.&lt;/p&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;To quickly summarize the key takeaways from my previous blog posts &lt;a href=&quot;/2015/10/15/composing-with-composer-manager.html&quot;&gt;on Composer Manager&lt;/a&gt; and &lt;a href=&quot;/2016/01/22/composer-mailchimp-subscriptions.html&quot;&gt;subscribing users to MailChimp lists using the old API&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Composer is a tool for managing PHP libraries that your project depends on.&lt;/li&gt;
  &lt;li&gt;Challenges arise managing project-wide dependencies when custom and contributed modules specify their own unique dependencies.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.drupal.org/project/composer_manager&quot;&gt;Composer Manager&lt;/a&gt; is a contributed module for Drupal 7 (and formerly Drupal 6) that addresses these challenges and allows contributed and custom modules to depend on PHP libraries managed via Composer.&lt;/li&gt;
  &lt;li&gt;Using a Composer managed PHP package for the MailChimp API, we can easily subscribe users to MailChimp lists in a Drupal custom module without relying on the Mailchimp module.&lt;/li&gt;
  &lt;li&gt;While the &lt;a href=&quot;https://www.drupal.org/project/mailchimp&quot;&gt;Mailchimp contributed module&lt;/a&gt; is great, sometimes all you need is a simple, lightweight method for subscribing users to mailing lists.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;One important development since my previous posts is that Composer Manager has been deprecated for Drupal 8. &lt;a href=&quot;https://www.drupal.org/project/drupal/releases/8.1.0&quot;&gt;Improvements introduced in Drupal 8.1.0&lt;/a&gt; allow modules to rely on Composer managed dependencies without the need for the Composer Manager module.&lt;/p&gt;

&lt;h2 id=&quot;implementation&quot;&gt;Implementation&lt;/h2&gt;

&lt;p&gt;There are a few steps we must take so that we can subscribe users to mailing lists in our custom module. We’ll review each of these steps in detail:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Add the MailChimp API v3.0 PHP library as a dependency of our custom module.&lt;/li&gt;
  &lt;li&gt;Ensure that the library is installed for our project.&lt;/li&gt;
  &lt;li&gt;Properly use the library in our custom module to subscribe users to mailing lists.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;specify-the-dependency&quot;&gt;Specify the dependency&lt;/h3&gt;

&lt;p&gt;ThinkShout maintains the &lt;a href=&quot;https://www.drupal.org/project/mailchimp&quot;&gt;Mailchimp contributed module&lt;/a&gt; and we were very excited to see that as part of the effort to &lt;a href=&quot;http://www.garfieldtech.com/blog/off-the-island-2013&quot;&gt;“get Drupal off the island”&lt;/a&gt; they also released &lt;a href=&quot;https://packagist.org/packages/thinkshout/mailchimp-api-php&quot;&gt;a PHP library for MailChimp API v3.0&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To use this new library, we must specify it as a dependency of our custom module. We do that in a &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; file that sits in our custom module’s root directory and requires that library via the following code:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;require&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;thinkshout/mailchimp-api-php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;gt;=1.0.3&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;install-the-library&quot;&gt;Install the library&lt;/h3&gt;

&lt;p&gt;Composer is intended for projects and therefore requires a Drupal site to have a single &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt;, so things get complicated when individual modules specify their own dependencies.&lt;/p&gt;

&lt;p&gt;For Drupal 7 sites (or still active Drupal 6 sites), the &lt;a href=&quot;https://www.drupal.org/project/composer_manager&quot;&gt;Composer Manager&lt;/a&gt; contributed module handles this by merging the requirements specified by each custom and contributed module’s &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; files into a single, consolidated, site-wide &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;So for Drupal 6/7 projects we’ll need Composer Manager installed and enabled.&lt;/p&gt;

&lt;p&gt;Once enabled, we can generate the consolidated &lt;code class=&quot;highlighter-rouge&quot;&gt;composer.json&lt;/code&gt; and then install all of the site’s dependencies that file specifies (including the MailChimp API v3.0 PHP library specified by our custom module) in one of two ways:&lt;/p&gt;

&lt;p&gt;From the command line, we can run the following drush commands:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;drush composer-json-rebuild
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;drush composer-manager install
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Alternatively, we could include the following lines in an update hook:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Re-build Composer Manager composer.json and run composer update.
drush_composer_manager_composer_json_rebuild&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;;
drush_composer_manager&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;update&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;For Drupal 8 sites, the process is slightly different. As mentioned previously, as of release 8.1.0, Drupal core directly uses Composer to manage dependencies and the Composer Manager module is no longer necessary. For Drupal 8 sites, we should follow the &lt;a href=&quot;https://www.drupal.org/node/2822349&quot;&gt;Drupal.org instructions for managing dependencies for a custom project&lt;/a&gt;. Following those instructions ensures that all of the site’s dependencies, including the MailChimp library specified by our custom module, are installed.&lt;/p&gt;

&lt;h3 id=&quot;use-the-library&quot;&gt;Use the library&lt;/h3&gt;

&lt;p&gt;Once we have the MailChimp API v3.0 PHP library installed, we can use it in our custom module to subscribe users to mailing lists.&lt;/p&gt;

&lt;p&gt;We suggest creating a dedicated function for subscribing users to email lists which can then be called throughout the custom module. For our purposes, we modeled that function off of the Mailchimp module (version 7.x-4.6) &lt;code class=&quot;highlighter-rouge&quot;&gt;mailchimp_subscribe_process()&lt;/code&gt; function.&lt;/p&gt;

&lt;p&gt;We implemented the following function, which can be reviewed and modified for your specific purposes:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Add an email to a MailChimp list.
 *
 * This code is based on the 7.x-4.6 version of the Mailchimp module,
 * specifically the mailchimp_subscribe_process() function. That version of
 * the Mailchimp contrib module makes use of the ThinkShout PHP library for
 * version 3.0 of the MailChimp API. See the following for more detail:
 * https://www.drupal.org/project/mailchimp
 * https://github.com/thinkshout/mailchimp-api-php.
 *
 * @see Mailchimp_Lists::subscribe()
 *
 * @param string $api_key
 *   The MailChimp API key.
 * @param string $list_id
 *   The MailChimp list id that the user should be subscribed to.
 * @param string $email
 *   The email address for the user being subscribed to the mailing list.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mymodule_subscribe_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$api_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Set the timeout to something that won&#39;t take down the Drupal site:
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Get an instance of the MailchimpLists class.
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$mailchimp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;\Mailchimp\MailchimpLists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$api_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;apikey&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Use MEMBER_STATUS_PENDING to require double opt-in for the subscriber. Otherwise, use MEMBER_STATUS_SUBSCRIBED.
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;status&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;\Mailchimp\MailchimpLists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;MEMBER_STATUS_PENDING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;email_type&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;html&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Subscribe user to the list.
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$mailchimp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addOrUpdateMember&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;watchdog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;@email was subscribed to list @list.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;@email&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;@list&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WATCHDOG_NOTICE&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;watchdog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;A problem occurred subscribing @email to list @list.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;&#39;@email&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;&#39;@list&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WATCHDOG_WARNING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// The user was not subscribed so log to watchdog.
&lt;/span&gt;    &lt;span class=&quot;nx&quot;&gt;watchdog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;mymodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;An error occurred subscribing @email to list @list. Status code @code. &quot;%message&quot;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;@email&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;@list&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;%message&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;&#39;@code&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WATCHDOG_ERROR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With that function defined, we can then subscribe an email address to a specific Mailchimp mailing list through the following function call in our custom module:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mymodule_subscribe_user($api_key, $list_id, $email);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;By taking advantage of the modern PHP ecosystem built on reusable Composer managed packages, we can easily build or adapt a custom module to subscribe users to mailing lists without the MailChimp contributed module.&lt;/p&gt;

&lt;p&gt;Lastly, a special thanks to &lt;a href=&quot;https://thinkshout.com/&quot;&gt;ThinkShout&lt;/a&gt; for their hard work maintaining the MailChimp module and creating the library, on which this approach depends!&lt;/p&gt;
",
      "url": "http://savaslabs.com/2016/11/15/composer-mailchimp-subscriptions-v3-api.html"
    }
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  <script>
    !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function l(){d.addEventListener&&d.removeEventListener("load",l),d.media=r||"all"}var a,i=e.document,d=i.createElement("link");if(n)a=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;a=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){a.parentNode.insertBefore(d,n?a:a.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",l),d.onloadcssdefined=f,f(l),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(t){}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){e.clearInterval(n)})}}}(this);
    loadCSS('/assets/styles/main.css');
    loadCSS('https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700|Roboto+Slab:300,400');
  </script>
  
  <style>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.bg-magenta{background-color:#9e023b}.bg-orange{background-color:#d3281b}.bg-eggshell{background-color:#fff8f3}.bg-teal{background-color:#0a5365}.bg-dark-teal{background-color:#06282d}.bg-grey{background-color:#565d5e}.bg-light-grey{background-color:#bdc2c3}.bg-light-teal{background-color:#f3f6f7}.bg-light-orange{background-color:#f29c96}.bg-purple{background-color:#501888}.bg-pink{background-color:#d33682}.bg-yellow{background-color:#f2a324}.bg-green{background-color:#055c2b}.c-magenta{color:#9e023b}.c-orange{color:#d3281b}.c-eggshell{color:#fff8f3}.c-teal{color:#0a5365}.c-dark-teal{color:#06282d}.c-grey{color:#565d5e}.c-light-grey{color:#bdc2c3}.c-light-teal{color:#f3f6f7}.c-light-orange{color:#f29c96}.c-purple{color:#501888}.c-pink{color:#d33682}.c-yellow{color:#f2a324}.c-green{color:#055c2b}[type=button],[type=reset],[type=submit],button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#0a5365;border:0;border-radius:3px;color:#fff;cursor:pointer;display:inline-block;font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1em;-webkit-font-smoothing:antialiased;font-weight:600;line-height:1;padding:.75em 1em;text-align:center;text-decoration:none;transition:background-color 150ms ease;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;white-space:nowrap}[type=button]:focus,[type=button]:hover,[type=reset]:focus,[type=reset]:hover,[type=submit]:focus,[type=submit]:hover,button:focus,button:hover{background-color:#084251;color:#fff}[type=button]:disabled,[type=reset]:disabled,[type=submit]:disabled,button:disabled{cursor:not-allowed;opacity:.5}[type=button]:disabled:hover,[type=reset]:disabled:hover,[type=submit]:disabled:hover,button:disabled:hover{background-color:#0a5365}fieldset{background-color:transparent;border:0;margin:0;padding:0}legend{font-weight:600;margin-bottom:.375em;padding:0}label{display:block;font-weight:600;margin-bottom:.375em}input,select,textarea{display:block;font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1em}[type=color],[type=date],[type=datetime-local],[type=datetime],[type=email],[type=month],[type=number],[type=password],[type=search],[type=tel],[type=text],[type=time],[type=url],[type=week],input:not([type]),textarea{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#fff;border:1px solid #ddd;border-radius:3px;box-shadow:inset 0 1px 3px rgba(0,0,0,.06);box-sizing:border-box;margin-bottom:.75em;padding:.33333em;transition:border-color 150ms ease;width:100%}[type=color]:hover,[type=date]:hover,[type=datetime-local]:hover,[type=datetime]:hover,[type=email]:hover,[type=month]:hover,[type=number]:hover,[type=password]:hover,[type=search]:hover,[type=tel]:hover,[type=text]:hover,[type=time]:hover,[type=url]:hover,[type=week]:hover,input:not([type]):hover,textarea:hover{border-color:#b1b1b1}[type=color]:focus,[type=date]:focus,[type=datetime-local]:focus,[type=datetime]:focus,[type=email]:focus,[type=month]:focus,[type=number]:focus,[type=password]:focus,[type=search]:focus,[type=tel]:focus,[type=text]:focus,[type=time]:focus,[type=url]:focus,[type=week]:focus,input:not([type]):focus,textarea:focus{border-color:#0a5365;box-shadow:inset 0 1px 3px rgba(0,0,0,.06),0 0 5px rgba(18,89,169,.7);outline:0}[type=color]:disabled,[type=date]:disabled,[type=datetime-local]:disabled,[type=datetime]:disabled,[type=email]:disabled,[type=month]:disabled,[type=number]:disabled,[type=password]:disabled,[type=search]:disabled,[type=tel]:disabled,[type=text]:disabled,[type=time]:disabled,[type=url]:disabled,[type=week]:disabled,input:not([type]):disabled,textarea:disabled{background-color:#f2f2f2;cursor:not-allowed}[type=color]:disabled:hover,[type=date]:disabled:hover,[type=datetime-local]:disabled:hover,[type=datetime]:disabled:hover,[type=email]:disabled:hover,[type=month]:disabled:hover,[type=number]:disabled:hover,[type=password]:disabled:hover,[type=search]:disabled:hover,[type=tel]:disabled:hover,[type=text]:disabled:hover,[type=time]:disabled:hover,[type=url]:disabled:hover,[type=week]:disabled:hover,input:not([type]):disabled:hover,textarea:disabled:hover{border:1px solid #ddd}[type=color]::-webkit-input-placeholder,[type=date]::-webkit-input-placeholder,[type=datetime-local]::-webkit-input-placeholder,[type=datetime]::-webkit-input-placeholder,[type=email]::-webkit-input-placeholder,[type=month]::-webkit-input-placeholder,[type=number]::-webkit-input-placeholder,[type=password]::-webkit-input-placeholder,[type=search]::-webkit-input-placeholder,[type=tel]::-webkit-input-placeholder,[type=text]::-webkit-input-placeholder,[type=time]::-webkit-input-placeholder,[type=url]::-webkit-input-placeholder,[type=week]::-webkit-input-placeholder,input:not([type])::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#858585}[type=color]:-ms-input-placeholder,[type=date]:-ms-input-placeholder,[type=datetime-local]:-ms-input-placeholder,[type=datetime]:-ms-input-placeholder,[type=email]:-ms-input-placeholder,[type=month]:-ms-input-placeholder,[type=number]:-ms-input-placeholder,[type=password]:-ms-input-placeholder,[type=search]:-ms-input-placeholder,[type=tel]:-ms-input-placeholder,[type=text]:-ms-input-placeholder,[type=time]:-ms-input-placeholder,[type=url]:-ms-input-placeholder,[type=week]:-ms-input-placeholder,input:not([type]):-ms-input-placeholder,textarea:-ms-input-placeholder{color:#858585}[type=color]::placeholder,[type=date]::placeholder,[type=datetime-local]::placeholder,[type=datetime]::placeholder,[type=email]::placeholder,[type=month]::placeholder,[type=number]::placeholder,[type=password]::placeholder,[type=search]::placeholder,[type=tel]::placeholder,[type=text]::placeholder,[type=time]::placeholder,[type=url]::placeholder,[type=week]::placeholder,input:not([type])::placeholder,textarea::placeholder{color:#858585}textarea{resize:vertical}[type=checkbox],[type=radio]{display:inline;margin-right:.375em}[type=file]{margin-bottom:.75em;width:100%}select{margin-bottom:.75em;width:100%}html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}body,html{height:100%}ol,ul{list-style-type:none;margin:0;padding:0}dl{margin:0}dt{font-weight:600;margin:0}dd{margin:0}figure{margin:0}img,picture{margin:0;max-width:100%}table{border-collapse:collapse;margin:.75em 0;table-layout:fixed;width:100%}th{border-bottom:1px solid #a6a6a6;font-weight:600;padding:.75em 0;text-align:left}td{border-bottom:1px solid #ddd;padding:.75em 0}td,th,tr{vertical-align:middle}body{color:#333;font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1em;line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1.25em;line-height:1.2;margin:0 0 .75em}p{margin:0 0 .75em}a{color:#0a5365;text-decoration:none;transition:color 150ms ease}a:active,a:focus,a:hover{color:#083e4c}hr{border-bottom:1px solid #ddd;border-left:0;border-right:0;border-top:0;margin:1em 0}.nowrap{white-space:nowrap}.region{max-width:1440px;margin-left:auto;margin-right:auto;clear:both;max-width:1400px;padding:1.5em 1em;vertical-align:baseline}.region::after{clear:both;content:"";display:block}@media only screen and (min-width:640px){.region{padding:3em 1em}}@media only screen and (min-width:1440px){.region{padding:3em 0}}.region--full-width{clear:both;margin:1.5em 0}@media only screen and (min-width:640px){.region--full-width{margin:3em 0}}.region--full-width .region--full-width__wrapper{max-width:1440px;margin-left:auto;margin-right:auto;margin:0 auto;max-width:1400px;vertical-align:baseline}.region--full-width .region--full-width__wrapper::after{clear:both;content:"";display:block}.outer-container{max-width:1440px;margin-left:auto;margin-right:auto;width:100%}.outer-container::after{clear:both;content:"";display:block}.flex-center{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}h1,h2,h3,h4,h5,h6{color:#0a5365;font-family:"Roboto Slab",Verdana,sans-serif;font-weight:300}.h1,h1{font-size:2.074em}@media only screen and (min-width:640px){.h1,h1{font-size:2.441em}}.h2,h2{font-size:1.728em}@media only screen and (min-width:640px){.h2,h2{font-size:1.953em}}.h3,h3{font-size:1.44em}@media only screen and (min-width:640px){.h3,h3{font-size:1.563em}}.h4,h4{font-size:1.2em}@media only screen and (min-width:640px){.h4,h4{font-size:1.25em}}.h5,h5{font-size:1.1em}.h6,h6{font-size:1em}.heading--bold{font-weight:700}.heading--sans-serif{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}article h2,article h3,article h4,article h5,article h6{margin-top:1.5em}article h2::after{background:#0a5365;content:'';display:block;height:1px;margin:10px 0 .5em;width:30px}.page--post__main h1,.page--post__main h2,.page--post__main h3,.page--post__main h4,.page--post__main h5,.page--post__main h6{color:#9e023b}a{color:#0a5365;transition:all .1s linear}a:focus,a:hover{color:#0f7993}.link--light{color:#fff8f3}.link--light:focus,.link--light:hover{color:#d3281b}.link--light--no-hover{color:#fff8f3}.link--light--no-hover:focus,.link--light--no-hover:hover{color:#fff8f3}ul{list-style-type:square}ol{list-style-type:decimal}ol,ul{margin-bottom:1em;margin-left:2em}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}ol ol,ol ol li,ol ul,ol ul li,ul ol,ul ol li,ul ul,ul ul li{font-size:1em!important}body{color:#565d5e;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}.paragraph--loud{font-size:1.25em}.paragraph--louder{font-size:1.563em}.paragraph--loud--responsive{font-size:1.25em}@media only screen and (min-width:860px){.paragraph--loud--responsive{font-size:1.563em}}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-angle-double-down:before{content:""}.fa-angle-right:before{content:""}.fa-building-o:before{content:""}.fa-circle:before{content:""}.fa-comment:before{content:""}.fa-comment-o:before{content:""}.fa-drupal:before{content:""}.fa-envelope-o:before{content:""}.fa-file-text:before{content:""}.fa-github:before{content:""}.fa-globe:before{content:""}.fa-linkedin:before{content:""}.fa-long-arrow-right:before{content:""}.fa-phone:before{content:""}.fa-stack-exchange:before{content:""}.fa-tags:before{content:""}.fa-twitter:before{content:""}.header-navigation{float:none;z-index:9999999}@media only screen and (min-width:640px){.header-navigation{clear:none;float:right;padding-bottom:0;padding-right:.75em}}.header-navigation__menu{clear:both;display:none;margin:0 auto;overflow:visible;padding:0;-webkit-transform-style:preserve-3d;width:100%;z-index:9999}@media only screen and (min-width:640px){.header-navigation__menu{display:inline;margin:0;padding:0}}.header-navigation__menu.show{display:block}.header-navigation__mobile-menu-link{color:#06282d;display:block;float:right;font-weight:700;line-height:5.25em;margin:0;padding-right:1em;text-transform:uppercase}@media only screen and (min-width:640px){.header-navigation__mobile-menu-link{display:none}}.header-navigation__mobile-menu-link:focus,.header-navigation__mobile-menu-link:hover{color:#9e023b}.header-navigation__menu-link{display:block;line-height:2.625em;overflow:hidden;padding-right:.8em;text-align:right;width:100%;z-index:9999}@media only screen and (min-width:640px){.header-navigation__menu-link{display:inline;line-height:5.25em;margin-right:-5px;padding-right:0;width:auto}.header-navigation__menu-link:last-child{margin-right:0}}.header-navigation__menu-link:last-child:not(.header-navigation__active-nav-item):not(:hover):not(:focus) a{color:#9e023b}.header-navigation__menu-link:last-child a{font-weight:700}.header-navigation__menu-link a{color:#06282d;display:inline-block;font-weight:400;text-transform:uppercase;transition:background-color ease .2s}.header-navigation__menu-link a:focus,.header-navigation__menu-link a:hover{color:#9e023b}@media only screen and (min-width:640px){.header-navigation__menu-link a{padding-left:.75em;padding-right:.75em}.header-navigation__menu-link a:focus,.header-navigation__menu-link a:hover{background-color:rgba(158,2,59,.9);color:#fff}}.header-navigation__active-nav-item{background-color:rgba(158,2,59,.9)}@media only screen and (min-width:640px){.header-navigation__active-nav-item{background-color:rgba(255,255,255,.9);color:#06282d}}.header-navigation__active-nav-item a{color:#fff}@media only screen and (min-width:640px){.header-navigation__active-nav-item a{background-color:rgba(158,2,59,.9)}}.savas-logo{display:block;height:5.25em;padding:1.5em 0}.savas-logo--main{display:block;height:2.25em;margin:1.5em 0;padding:0;width:5.125em}.tile{position:relative}.tile .tile__hover{-ms-flex-align:center;align-items:center;color:#fff8f3;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;left:0;opacity:0;padding:1em;position:absolute;text-align:center;top:0;transition:all .3s ease;width:100%;z-index:1}.tile .tile__hover p:first-child{margin-bottom:1.5em;max-width:15em}.tile .tile__hover .link--cta{margin-bottom:0;transition:all .2s ease-in-out}.tile:focus .tile__hover,.tile:hover .tile__hover{opacity:1}.tile:focus .tile--blog--detailed__primary-tag,.tile:hover .tile--blog--detailed__primary-tag{margin-left:1em}.tile:focus .tile--blog__post-title .tile--blog--detailed__author-bg,.tile:hover .tile--blog__post-title .tile--blog--detailed__author-bg{bottom:0;right:0}@media only screen and (min-width:1120px){.tile p{font-size:1.1em}}.tile--title--blog{padding:2em}.tile--blog .tile--blog__content{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;position:relative;z-index:0}.tile--blog .tile--blog__content>div{height:150px}@media only screen and (min-width:450px){.tile--blog .tile--blog__content>div{height:200px}}@media only screen and (min-width:640px){.tile--blog .tile--blog__content>div{height:150px}}@media only screen and (min-width:1120px){.tile--blog .tile--blog__content>div{height:175px}}@media only screen and (min-width:1440px){.tile--blog .tile--blog__content>div{height:200px}}.tile--blog .tile--blog__content .tile--blog__image{background-position:center center;background-repeat:no-repeat;background-size:cover;width:100%}.tile--blog .tile--blog__content .tile--blog__post-title{-ms-flex-align:center;align-items:center;color:#06282d;display:-ms-flexbox;display:flex;padding:1em;width:100%}.tile--blog .tile--blog__content .tile--blog__post-title p::before{background:#9e023b;content:'';display:block;height:1px;margin:10px 0 .5em;width:30px}.tile--blog .tile--blog__hover{height:300px}@media only screen and (min-width:450px){.tile--blog .tile--blog__hover{height:400px}}@media only screen and (min-width:640px){.tile--blog .tile--blog__hover{height:300px}}@media only screen and (min-width:1120px){.tile--blog .tile--blog__hover{height:350px}}@media only screen and (min-width:1440px){.tile--blog .tile--blog__hover{height:400px}}.tile--blog--detailed{-ms-flex-preferred-size:auto;flex-basis:auto;-ms-flex-positive:0;flex-grow:0}.tile--blog--detailed .tile--blog__image{position:relative}.tile--blog--detailed .tile--blog__image .tile--blog--detailed__primary-tag{background-color:#0a5365;bottom:1em;color:#fff8f3;font-size:.9em;font-style:italic;left:-1em;margin-bottom:0;padding:.25em 1em;position:absolute;text-transform:uppercase;transition:all .3s ease-in-out}.tile--blog--detailed .tile--blog__post-title{position:relative;z-index:99}.tile--blog--detailed .tile--blog__post-title p{padding-right:44px}.tile--blog--detailed .tile--blog__post-title .tile--blog--detailed__author{bottom:0;position:absolute;right:0;z-index:999}.tile--blog--detailed .tile--blog__post-title .tile--blog--detailed__author img{display:block;filter:grayscale(100%);height:60px;width:60px}.tile--blog--detailed .tile--blog__post-title .tile--blog--detailed__author-bg{background-color:rgba(10,83,101,.2);bottom:-8px;height:60px;position:absolute;right:-8px;transition:all .3s ease-in-out;width:60px}.tile--blog--detailed.tile--blog .tile--blog__hover{margin:1em;width:calc(100% - 2em)}.region--header{background-color:rgba(255,255,255,.9);min-height:5.25em;width:100%;z-index:999}.region--header a{text-decoration:none}.region--header .region--header__wrapper{max-width:1440px;margin-left:auto;margin-right:auto;position:relative;z-index:9999}.region--header .region--header__wrapper::after{clear:both;content:"";display:block}.region--header .region--header__logo{display:inline-block;float:left;height:5.25em;margin:0;padding-left:1em}@media only screen and (min-width:640px){.region--header .region--header__logo{padding-left:1.5em;padding-right:1em}}.region--post-aside{margin-top:3em}@media only screen and (min-width:860px){.region--post-aside{float:left;margin-top:0;width:33.333%}}.region--post-aside .region--post-aside__section{padding:3em 1em}@media only screen and (min-width:860px){.region--post-aside .region--post-aside__section{padding:3em 1.5em}}@media only screen and (min-width:1120px){.region--post-aside .region--post-aside__section{padding:3em 2em}}.region--post-aside .region--post-aside__section__wrapper--posts{border-bottom:solid 1px #bdc2c3}.region--post-aside .region--post-aside__section__wrapper--posts .tile--blog__hover{margin:0;width:100%}@media only screen and (min-width:640px){.region--post-aside .region--post-aside__section__items{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}}@media only screen and (min-width:860px){.region--post-aside .region--post-aside__section__items{display:block}}.region--post-aside .region--post-aside__section__items>div{margin-bottom:1em}@media only screen and (min-width:640px){.region--post-aside .region--post-aside__section__items>div{-ms-flex-positive:0;flex-grow:0;margin-bottom:0;width:48.5%}}@media only screen and (min-width:860px){.region--post-aside .region--post-aside__section__items>div{margin-bottom:1em;width:100%}}.region--post-aside h2{font-weight:400}.region--post-aside .region--post-aside__section--case-studies .case-study-block__title{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif;font-weight:400}.region--post-aside .region--post-aside__section--case-studies__cta{margin-top:3em}.page--post .region--header{border-bottom:solid 1px #bdc2c3}@media only screen and (min-width:860px){.page--post .page--post__main{border-right:solid 1px #bdc2c3;float:left;padding-bottom:3em;width:66.666%}}.page--post .page--post__main .region--post-content,.page--post .page--post__main .region--post-header{padding:0 1em}@media only screen and (min-width:640px){.page--post .page--post__main .region--post-content,.page--post .page--post__main .region--post-header{padding:0 1.5em}}@media only screen and (min-width:1120px){.page--post .page--post__main .region--post-content,.page--post .page--post__main .region--post-header{padding-right:2em}}.page--post .page--post__main .region--post-header h1{font-weight:400}.page--post .page--post__main .region--post-content{color:#06282d}.page--post .page--post__main .region--post-content h2,.page--post .page--post__main .region--post-content h3,.page--post .page--post__main .region--post-content h4,.page--post .page--post__main .region--post-content h5,.page--post .page--post__main .region--post-content h6{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif;font-weight:400}.page--post .page--post__main .region--post-content .caption{color:#565d5e;font-style:italic}.page--post .page--post__aside{border-bottom:solid 1px #bdc2c3;margin-top:0}@media only screen and (min-width:860px){.page--post .page--post__aside{border-bottom:0;border-top:0}}.page--post .region--prev-next-links--post{clear:both;display:none}@media only screen and (min-width:860px){.page--post .region--prev-next-links--post{display:-ms-flexbox;display:flex}}.page--post .region--prev-next-links--mobile{display:-ms-flexbox;display:flex;margin-top:3em}@media only screen and (min-width:860px){.page--post .region--prev-next-links--mobile{display:none}}.page--post .region--footer{margin-top:0}.region--post-header{margin:3em 0}.region--post-header .region--post-header__title{margin-bottom:1.5em}@media only screen and (min-width:640px){.region--post-header__post-info{display:-ms-flexbox;display:flex}.region--post-header__post-info>div{width:50%}}.region--post-header__post-info p{font-style:italic;margin-bottom:.25em}.region--post-header__post-info i{margin-right:.5em}.region--post-header__post-info .post-author:not(:first-child){clear:left;margin-top:1em}.region--post-header__post-info .post-author picture{float:left;margin-right:1em}.region--post-header__post-info .post-author picture img{display:block;height:60px;width:60px}.region--post-header__post-info .region--post-header__post-info__stats{clear:both;margin-top:1.5em}@media only screen and (min-width:640px){.region--post-header__post-info .region--post-header__post-info__stats{clear:none;margin-top:0}}.region--post-header__post-info .region--post-header__post-info__stats p{display:inline-block;margin-right:1em}@media only screen and (min-width:640px){.region--post-header__post-info .region--post-header__post-info__stats p{display:block;margin-right:0}}</style>
  
</head>


  <body class="page--post">

    <header class="region--header" role="banner">
  <div class="region--header__wrapper">

    <a href="/" class="region--header__logo">
      <img src="http://savaslabs.com/assets/img/logo.svg" alt="Savas Labs logo" class="savas-logo savas-logo--main">
    </a>

    <!-- Mobile menu button. -->
<a href="/" id="js-mobile-menu" class="header-navigation__mobile-menu-link">MENU</a>

<!-- Main menu. -->
<nav role="navigation" class="header-navigation">
  <ul id="js-navigation-menu" class="header-navigation__menu show">
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/company">Company</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/results">Results</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/services">Services</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/blog">Blog</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/contact">Contact</a>
      </li>
    
  </ul>
</nav>

  </div>
</header>

    <div class="page-content">
      







<div class="outer-container">
  <div class="page--post__main">
    <div class="region--featured-image">
      
      <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-1600by771-c321f8.jpg" media="(min-width: 1120px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 1120px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-1000by482-c321f8.jpg" media="(min-width: 1120px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-1492by719-c321f8.jpg" media="(min-width: 860px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 860px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-746by359-c321f8.jpg" media="(min-width: 860px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-1600by771-c321f8.jpg" media="(min-width: 640px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 640px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-860by414-c321f8.jpg" media="(min-width: 640px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-1280by617-c321f8.jpg" media="(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-640by308-c321f8.jpg" media="(min-width: 400px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-800by385-c321f8.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-400by193-c321f8.jpg">
    <img src="http://savaslabs.com/assets/processed-img/blog/mailchimp_3_drupal_composer_3-400by193-c321f8.jpg" class="image--post-featured-image" itemprop="image" alt="sheet music" >
  </picture>

      
      
    </div>
    <div class="region--post-header">
      <h1 class="region--post-header__title">Using MailChimp API v3.0 to subscribe users to email lists in Drupal custom modules</h1>
      <div class="region--post-header__post-info">
        <div class="region--post-header__post-info__authors">
          
<div class="post-author">
  <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-120by120-370cd4.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg" class="image--team-blog-tile" itemprop="image" alt="Dan Murphy" >
  </picture>

  <p class="post-author__name">By <a href="/team/dan-murphy">Dan Murphy</a></p>
  <p class="post-author__title">Web Developer</p>
</div>

        </div>
        <div class="region--post-header__post-info__stats">
          <p><i class="fa fa-calendar"></i>Nov 15, 2016 </p>
          <p><i class="fa fa-tags"></i><a href="/blog/tag/drupal/">Drupal</a>, <a href="/blog/tag/drupal-planet/">Drupal Planet</a>, <a href="/blog/tag/composer/">Composer</a>, <a href="/blog/tag/module-development/">Module Development</a>, <a href="/blog/tag/mailchimp/">MailChimp</a></p>
          
          <p><span id="comment-count"></span></p>
          
        </div>
      </div>
      
    </div>
    <article class="region--post-content">
      <p>Our clients are often looking to reach their audiences via email campaigns, and <a href="https://mailchimp.com/">MailChimp</a> is one of the solutions we frequently recommend for this. MailChimp makes it easy to create and manage email campaigns while also providing beneficial analytics on user behavior.</p>

<p>Earlier this year I wrote <a href="/2016/01/22/composer-mailchimp-subscriptions.html">a blog post</a> showing how to use <a href="https://www.drupal.org/project/composer_manager">Composer Manager</a> along with the Mailchimp API v2.0 PHP package to subscribe users to mailing lists in a Drupal 6 or 7 custom module without the need for the Mailchimp contributed module.</p>

<p>However, since then, MailChimp API v3.0 was released and Mailchimp announced that v2.0 (and all prior versions) will no longer be supported after 2016.</p>

<p>So in this blog post, I’ll demonstrate how to accomplish the same objective using the new MailChimp API v3.0, and I’ll expand the tutorial to also include some Drupal 8 specifics.</p>

<h2 id="background">Background</h2>

<p>To quickly summarize the key takeaways from my previous blog posts <a href="/2015/10/15/composing-with-composer-manager.html">on Composer Manager</a> and <a href="/2016/01/22/composer-mailchimp-subscriptions.html">subscribing users to MailChimp lists using the old API</a>:</p>

<ul>
  <li>Composer is a tool for managing PHP libraries that your project depends on.</li>
  <li>Challenges arise managing project-wide dependencies when custom and contributed modules specify their own unique dependencies.</li>
  <li><a href="https://www.drupal.org/project/composer_manager">Composer Manager</a> is a contributed module for Drupal 7 (and formerly Drupal 6) that addresses these challenges and allows contributed and custom modules to depend on PHP libraries managed via Composer.</li>
  <li>Using a Composer managed PHP package for the MailChimp API, we can easily subscribe users to MailChimp lists in a Drupal custom module without relying on the Mailchimp module.</li>
  <li>While the <a href="https://www.drupal.org/project/mailchimp">Mailchimp contributed module</a> is great, sometimes all you need is a simple, lightweight method for subscribing users to mailing lists.</li>
</ul>

<p>One important development since my previous posts is that Composer Manager has been deprecated for Drupal 8. <a href="https://www.drupal.org/project/drupal/releases/8.1.0">Improvements introduced in Drupal 8.1.0</a> allow modules to rely on Composer managed dependencies without the need for the Composer Manager module.</p>

<h2 id="implementation">Implementation</h2>

<p>There are a few steps we must take so that we can subscribe users to mailing lists in our custom module. We’ll review each of these steps in detail:</p>

<ul>
  <li>Add the MailChimp API v3.0 PHP library as a dependency of our custom module.</li>
  <li>Ensure that the library is installed for our project.</li>
  <li>Properly use the library in our custom module to subscribe users to mailing lists.</li>
</ul>

<h3 id="specify-the-dependency">Specify the dependency</h3>

<p>ThinkShout maintains the <a href="https://www.drupal.org/project/mailchimp">Mailchimp contributed module</a> and we were very excited to see that as part of the effort to <a href="http://www.garfieldtech.com/blog/off-the-island-2013">“get Drupal off the island”</a> they also released <a href="https://packagist.org/packages/thinkshout/mailchimp-api-php">a PHP library for MailChimp API v3.0</a>.</p>

<p>To use this new library, we must specify it as a dependency of our custom module. We do that in a <code class="highlighter-rouge">composer.json</code> file that sits in our custom module’s root directory and requires that library via the following code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"require"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"thinkshout/mailchimp-api-php"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&gt;=1.0.3"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="install-the-library">Install the library</h3>

<p>Composer is intended for projects and therefore requires a Drupal site to have a single <code class="highlighter-rouge">composer.json</code>, so things get complicated when individual modules specify their own dependencies.</p>

<p>For Drupal 7 sites (or still active Drupal 6 sites), the <a href="https://www.drupal.org/project/composer_manager">Composer Manager</a> contributed module handles this by merging the requirements specified by each custom and contributed module’s <code class="highlighter-rouge">composer.json</code> files into a single, consolidated, site-wide <code class="highlighter-rouge">composer.json</code> file.</p>

<p>So for Drupal 6/7 projects we’ll need Composer Manager installed and enabled.</p>

<p>Once enabled, we can generate the consolidated <code class="highlighter-rouge">composer.json</code> and then install all of the site’s dependencies that file specifies (including the MailChimp API v3.0 PHP library specified by our custom module) in one of two ways:</p>

<p>From the command line, we can run the following drush commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>drush composer-json-rebuild
<span class="gp">$ </span>drush composer-manager install
</code></pre>
</div>

<p>Alternatively, we could include the following lines in an update hook:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// Re-build Composer Manager composer.json and run composer update.
drush_composer_manager_composer_json_rebuild<span class="o">()</span>;
drush_composer_manager<span class="o">(</span><span class="s1">'update'</span><span class="o">)</span>;
</code></pre>
</div>

<p>For Drupal 8 sites, the process is slightly different. As mentioned previously, as of release 8.1.0, Drupal core directly uses Composer to manage dependencies and the Composer Manager module is no longer necessary. For Drupal 8 sites, we should follow the <a href="https://www.drupal.org/node/2822349">Drupal.org instructions for managing dependencies for a custom project</a>. Following those instructions ensures that all of the site’s dependencies, including the MailChimp library specified by our custom module, are installed.</p>

<h3 id="use-the-library">Use the library</h3>

<p>Once we have the MailChimp API v3.0 PHP library installed, we can use it in our custom module to subscribe users to mailing lists.</p>

<p>We suggest creating a dedicated function for subscribing users to email lists which can then be called throughout the custom module. For our purposes, we modeled that function off of the Mailchimp module (version 7.x-4.6) <code class="highlighter-rouge">mailchimp_subscribe_process()</code> function.</p>

<p>We implemented the following function, which can be reviewed and modified for your specific purposes:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Add an email to a MailChimp list.
 *
 * This code is based on the 7.x-4.6 version of the Mailchimp module,
 * specifically the mailchimp_subscribe_process() function. That version of
 * the Mailchimp contrib module makes use of the ThinkShout PHP library for
 * version 3.0 of the MailChimp API. See the following for more detail:
 * https://www.drupal.org/project/mailchimp
 * https://github.com/thinkshout/mailchimp-api-php.
 *
 * @see Mailchimp_Lists::subscribe()
 *
 * @param string $api_key
 *   The MailChimp API key.
 * @param string $list_id
 *   The MailChimp list id that the user should be subscribed to.
 * @param string $email
 *   The email address for the user being subscribed to the mailing list.
 */</span>
<span class="k">function</span> <span class="nf">mymodule_subscribe_user</span><span class="p">(</span><span class="nv">$api_key</span><span class="p">,</span> <span class="nv">$list_id</span><span class="p">,</span> <span class="nv">$email</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Set the timeout to something that won't take down the Drupal site:
</span>    <span class="nv">$timeout</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="c1">// Get an instance of the MailchimpLists class.
</span>    <span class="nv">$mailchimp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Mailchimp\MailchimpLists</span><span class="p">(</span><span class="nv">$api_key</span><span class="p">,</span> <span class="s1">'apikey'</span><span class="p">,</span> <span class="nv">$timeout</span><span class="p">);</span>

    <span class="c1">// Use MEMBER_STATUS_PENDING to require double opt-in for the subscriber. Otherwise, use MEMBER_STATUS_SUBSCRIBED.
</span>    <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
      <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="nx">\Mailchimp\MailchimpLists</span><span class="o">::</span><span class="na">MEMBER_STATUS_PENDING</span><span class="p">,</span>
      <span class="s1">'email_type'</span> <span class="o">=&gt;</span> <span class="s1">'html'</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1">// Subscribe user to the list.
</span>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$mailchimp</span><span class="o">-&gt;</span><span class="na">addOrUpdateMember</span><span class="p">(</span><span class="nv">$list_id</span><span class="p">,</span> <span class="nv">$email</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">watchdog</span><span class="p">(</span><span class="s1">'mymodule'</span><span class="p">,</span> <span class="s1">'@email was subscribed to list @list.'</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">'@email'</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">,</span> <span class="s1">'@list'</span> <span class="o">=&gt;</span> <span class="nv">$list_id</span><span class="p">),</span> <span class="nx">WATCHDOG_NOTICE</span>
      <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">watchdog</span><span class="p">(</span><span class="s1">'mymodule'</span><span class="p">,</span> <span class="s1">'A problem occurred subscribing @email to list @list.'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'@email'</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">,</span>
        <span class="s1">'@list'</span> <span class="o">=&gt;</span> <span class="nv">$list_id</span><span class="p">,</span>
      <span class="p">),</span> <span class="nx">WATCHDOG_WARNING</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The user was not subscribed so log to watchdog.
</span>    <span class="nx">watchdog</span><span class="p">(</span><span class="s1">'mymodule'</span><span class="p">,</span> <span class="s1">'An error occurred subscribing @email to list @list. Status code @code. "%message"'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
      <span class="s1">'@email'</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">,</span>
      <span class="s1">'@list'</span> <span class="o">=&gt;</span> <span class="nv">$list_id</span><span class="p">,</span>
      <span class="s1">'%message'</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
      <span class="s1">'@code'</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">(),</span>
    <span class="p">),</span> <span class="nx">WATCHDOG_ERROR</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>With that function defined, we can then subscribe an email address to a specific Mailchimp mailing list through the following function call in our custom module:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mymodule_subscribe_user($api_key, $list_id, $email);
</code></pre>
</div>

<h2 id="conclusion">Conclusion</h2>

<p>By taking advantage of the modern PHP ecosystem built on reusable Composer managed packages, we can easily build or adapt a custom module to subscribe users to mailing lists without the MailChimp contributed module.</p>

<p>Lastly, a special thanks to <a href="https://thinkshout.com/">ThinkShout</a> for their hard work maintaining the MailChimp module and creating the library, on which this approach depends!</p>

    </article>
  </div>
  <div class="region--prev-next-links region--prev-next-links--mobile pagination">
    <div class="outer-container">
  
  <a href="/2016/10/25/deploy-jekyll-with-travis.html" class="pagination__previous"><i class="fa fa-angle-left "></i> Prev</a>
  
  <a href="/blog" class="pagination__view-all">View All Blog Posts</a>
  
  <a href="/2017/02/15/docker-mysql-performance.html" class="pagination__next"> Next <i class="fa fa-angle-right"></i></a>
  
</div>
  </div>
  <div class="page--post__aside region--post-aside">
    <div class="region--post-aside__section__wrapper--posts">
      <div class="region--post-aside__section region--post-aside__section--posts">
        <h2 class="heading--sans-serif c-grey h3">Related Blog Posts</h2>
        <div class="region--post-aside__section__items region--post-aside__section--posts__items">
          





























<div class="tile--blog tile--blog--detailed tile">
  <a href="/2017/03/06/five-drupal-8-tips-to-empower-content-authors.html" class="tile--blog__link">
    <div class="tile--blog__content tile__content bg-light-teal">
      
      <div class="tile--blog__image" style="background-image: url(/assets/img/blog/content-authoring-d8.jpg);">
        
        
        
        <p class="tile--blog--detailed__primary-tag">Drupal</p>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
      <div class="tile--blog__post-title">
        <p>Five Drupal 8 Tips to Empower Content Authors</p>

        <div class="tile--blog--detailed__author">
          
          
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-120by122-82a418.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg" class="image--team-blog-tile" itemprop="image" alt="Oksana Cyrwus" >
  </picture>

          
          
        </div>
        <div class="tile--blog--detailed__author-bg"></div>
      </div>
    </div>
    <div class="tile--blog__hover tile__hover bg-orange">
      <p>Five Drupal 8 tips to make the content authoring experience more enjoyable and productive!</p>

      <p class="link--cta link--cta--inverse">Read more</p>
    </div>
  </a>
</div>































<div class="tile--blog tile--blog--detailed tile">
  <a href="/2017/02/20/drupal-docker-pattern-lab.html" class="tile--blog__link">
    <div class="tile--blog__content tile__content bg-light-teal">
      
      <div class="tile--blog__image" style="background-image: url(/assets/img/blog/docker-drupal-pattern-lab.jpg);">
        
        
        
        <p class="tile--blog--detailed__primary-tag">Drupal</p>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
      <div class="tile--blog__post-title">
        <p>Docker and the Drupal Pattern Lab Starter Theme</p>

        <div class="tile--blog--detailed__author">
          
          
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-120by120-370cd4.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg" class="image--team-blog-tile" itemprop="image" alt="Dan Murphy" >
  </picture>

          
          
        </div>
        <div class="tile--blog--detailed__author-bg"></div>
      </div>
    </div>
    <div class="tile--blog__hover tile__hover bg-orange">
      <p>This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern Lab Starter theme and/or with other common front-end applications such as npm, Gulp, and Bower.</p>

      <p class="link--cta link--cta--inverse">Read more</p>
    </div>
  </a>
</div>






















































































































































































































































































































































































































































































































































































        </div>
      </div>
    </div>
    <div class="region--post-aside__section__wrapper--case-studies">
      <div class="region--post-aside__section region--post-aside__section--case-studies">
        <h2 class="heading--sans-serif c-grey h3">Related Case Studies</h2>
        <div class="region--post-aside__section__items region--post-aside__section--posts__items">
          







<div class="case-study-block">
  <a class="case-study-block__link" href="/results/case-studies/duke-today/">
    <div class="case-study-block__image" style="background-image: url(/assets/img/work/logos/duke-today-logo-eggshell.png);">
      <img src="/assets/img/work/duke-today/duke-today-block.jpg" alt="Duke Today Redesign">
    </div>
    
    <h3 class="case-study-block__title">Duke Today Redesign</h3>
    
    <div class="case-study-block__tags">
      
      
      <p>Drupal </p>
      
      <p>&bull; </p>
      
      
      
      <p>Content Migration </p>
      
      <p>&bull; </p>
      
      
      
      <p>UX </p>
      
      <p>&bull; </p>
      
      
      
      <p>Docker </p>
      
      
      
    </div>
  </a>
</div>




















<div class="case-study-block">
  <a class="case-study-block__link" href="/results/case-studies/hptn/">
    <div class="case-study-block__image" style="background-image: url(/assets/img/work/logos/hptn-logo-eggshell.png);">
      <img src="/assets/img/work/hptn/hptn-block.jpg" alt="HIV Prevention Trials Network (HPTN) Site Redesign">
    </div>
    
    <h3 class="case-study-block__title">HIV Prevention Trials Network (HPTN) Site Redesign</h3>
    
    <div class="case-study-block__tags">
      
      
      <p>Drupal 8 </p>
      
      <p>&bull; </p>
      
      
      
      <p>Responsive Design </p>
      
      <p>&bull; </p>
      
      
      
      <p>UX </p>
      
      <p>&bull; </p>
      
      
      
      <p>Client Server Integration </p>
      
      
      
    </div>
  </a>
</div>











































































        </div>
        <div class="region--post-aside__section--case-studies__cta flex-center">
          <a href="/results" class="button--arrow--orange">Our work</a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="region--prev-next-links region--prev-next-links--post pagination">
  <div class="outer-container">
  
  <a href="/2016/10/25/deploy-jekyll-with-travis.html" class="pagination__previous"><i class="fa fa-angle-left "></i> Prev</a>
  
  <a href="/blog" class="pagination__view-all">View All Blog Posts</a>
  
  <a href="/2017/02/15/docker-mysql-performance.html" class="pagination__next"> Next <i class="fa fa-angle-right"></i></a>
  
</div>
</div>

<div class="region--comments">
  
  <div class="expander">
    <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander--hidden">
      <p id="comments-trigger">Comments</p>
    </a>
    <div id="js-expander-content" class="expander-content region">

      <!-- If there are existing comments, output them here. -->
      <div id="region--comments__comments" class="region--comments__comments"></div>
      <form id="form--comment" class="form--comment">
  <div class="form--comment__row">
    <div class="form--comment__row__item">
      <div class="form--comment__field form--comment__field--name">
        <label for="name">Name</label>
        <input type="text" name="name" id="name" required>
      </div>
      <div class="form--comment__field form--comment__field--email">
        <label for="email">Email</label>
        <input type="email" name="email" id="email" required>
        <p class="form--comment__helptext">Savas Labs will never sell your email address or spam you.</p>
      </div>
    </div>
    <div class="form--comment__field form--comment__field--comment form--comment__row__item">
      <label for="comment">Comment</label>
      <textarea name="comment" id="comment" rows="4" required></textarea>
      <p class="form--comment__helptext">Plain text format only please.</p>
    </div>
  </div>

  <input type="hidden" name="slug" id="slug" value="/2016/11/15/composer-mailchimp-subscriptions-v3-api.html">
  <input type="text" name="url" id="url">

  <div class="form--comment__row">
    <div class="form--comment__field form--comment__field--nocaptcha form--comment__row__item">
      <div class="form--comment__field--nocaptcha__image">
        <img src="/assets/img/icons-and-logos/owl.png" alt="Savas Labs logo">
      </div>
      <div class="form--comment__field--nocaptcha__input">
        <label for="nocaptcha">What type of animal is the Savas Labs logo?</label>
        <p class="form--comment__helptext">Hint: 3 letters long, starts with an "o" and ends with an "l".</p>
        <input type="text" name="nocaptcha" id="nocaptcha" required>
      </div>
    </div>
    <div class="form--comment__row__item">
      <input type="submit" value="Post comment" id="submit" class="form--comment__submit">
    </div>
  </div>
</form>
    </div>
  </div>
  
</div>

    </div>

    <footer class="region--footer" role="contentinfo">
  <div class="region--footer__main">
    <div class="region--footer__main__menu">
      <a href="/" class="region--footer__logo">
        <img src="http://savaslabs.com/assets/img/logo-light.svg" alt="Savas Labs" class="savas-logo savas-logo--light">
      </a>
      <nav role="navigation" class="footer-navigation">
  <ul class="footer-navigation__menu">
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/company">Company</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/results">Results</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/services">Services</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/blog">Blog</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/contact">Contact</a>
      </li>
    
  </ul>
</nav>
    </div>
    <div class="region--footer__main__contact">
      <h4 class="region--footer__main__contact__title h5">Connect with us</h4>
      <a href="mailto:info@savaslabs.com">info@savaslabs.com</a>
      <p>(919) 432-4660</p>
      <address>
        SAVAS LABS<br>
        PMB 210<br>
        201 W Main Street, Suite 100<br>
        Durham, NC 27701
      </address>
    </div>
    <div class="region--footer__main__social">
      <div class="region--footer__main__social__icons">
        <a href="https://github.com/savaslabs"><span class="fa fa-github fa-lg fa-2x"></span></a>
        <a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a>
        <a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a>
        <a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a>
      </div>
      <div class="region--footer__main__social__twitter">
        <a class="twitter-timeline"  href="https://twitter.com/Savas_Labs" data-widget-id="720223236315815936">Tweets by @Savas_Labs</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>
    </div>
  </div>
  <div class="region--footer__bottom">
    <div class="region--footer__bottom__wrapper">
      <p class="region--footer__bottom__copyright">
        Copyright &copy; Savas Labs 2017
      </p>
    </div>
  </div>
</footer>

    <script type="text/javascript" src="http://savaslabs.com/assets/js/main.js" async></script>

<noscript>
  <link href='/assets/styles/main.css' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Source+Sans+Pro' rel='stylesheet' type='text/css'>
</noscript>

  </body>

</html>
