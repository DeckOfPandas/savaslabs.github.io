<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Using XHProf to profile your Drupal module | Savas Labs</title>
  
  <meta name="description" content="This is part 2 of a series on using XHProf for profiling Drupal modules.">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="canonical" href="http://savaslabs.com/2016/06/16/using-xhprof.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="http://savaslabs.com/feed.xml" />
  
  
  
  



<script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "about": "A case study of using XHProf to profile a Drupal module.",
      "articleBody": "


&lt;div class=&quot;post&quot;&gt;
  &lt;div class=&quot;post__body&quot;&gt;
    &lt;header class=&quot;post-header&quot;&gt;
      &lt;h1 class=&quot;post-title&quot;&gt;Using XHProf to profile your Drupal module&lt;/h1&gt;

      

&lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;

      &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
      &lt;p&gt;Jun 16, 2016 &lt;/p&gt;&lt;br&gt;
      &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/php/&quot;&gt;PHP&lt;/a&gt;, &lt;a href=&quot;/blog/tag/performance/&quot;&gt;Performance&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;, &lt;a href=&quot;/blog/tag/module-development/&quot;&gt;Module Development&lt;/a&gt;&lt;/p&gt;
      
      &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
      
      
    &lt;/header&gt;

    

    &lt;article class=&quot;post-content&quot;&gt;
      &lt;p&gt;This is part 2 of a series on using XHProf for profiling Drupal modules.&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;/2016/05/26/installing-xhprof.html&quot;&gt;Part 1: Installing XHProf&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Part 2: Using XHProf&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;After you’ve &lt;a href=&quot;/2016/05/26/installing-xhprof.html&quot;&gt;installed XHProf&lt;/a&gt;, what’s next? How can you make use of its recommendations to tune a module or a website? Unfortunately there are no hard-and-fast rules for optimizing code to run more efficiently. What I can offer here is my own experience trying to optimize a D8 module using XHProf.&lt;/p&gt;

&lt;h3 id=&quot;understanding-an-xhprof-run-report&quot;&gt;Understanding an XHProf run report&lt;/h3&gt;

&lt;p&gt;The XHProf GUI displays the result of a given profiler run, or a group of runs. It can even compare 2 runs, but we’ll get to that in a minute. If you followed &lt;a href=&quot;/2016/05/26/installing-xhprof.html&quot;&gt;my previous post&lt;/a&gt;, you should have the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory symlinked into the root web directory for your Drupal site; so visiting &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;my-local-site&amp;gt;/xhprof/&lt;/code&gt; should give you a list of all available stored run IDs, and you can click through one of those to view a specific run report.&lt;/p&gt;

&lt;p&gt;You can also go directly to a specific run report via the URL &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;my-local-site&amp;gt;/xhprof/index.php?run=&amp;lt;run-id&amp;gt;&amp;amp;source=&amp;lt;source-id&amp;gt;&lt;/code&gt; (which you should have been logging already via an &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt; statement or &lt;code class=&quot;highlighter-rouge&quot;&gt;dblog&lt;/code&gt; if you followed the last post).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-page-screenshot.jpg&quot; alt=&quot;Header of an XHProf run report&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The core of the run report is a table of each function or method which your code called while it was being profiled, along with a set of statistics about that function. This allows you to understand which parts of your code are most resource-intensive, and which are being called frequently in the use case that you’re profiling. Clicking on any one of the column headers will sort the list by that metric. To understand this report, it’s helpful to have some terminology:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Incl. Wall Time&lt;/strong&gt; - The total clock time elapsed between when a function call started and when the function exited. Note that this number is not a great basis for comparisons, since it can include other processes which were taking up CPU time on your machine while the PHP code was running, from streaming music in the background to PHPStorm’s code indexing, to random web browsing.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Incl. CPU Time&lt;/strong&gt; - In contrast to wall time, CPU time tracks only the time which the CPU actually spent executing your code (or related system calls). This is a more reliable metric for comparing different runs.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Excl. Wall/CPU Time&lt;/strong&gt; - Exclusive time measurements only count time actually spent within the given method itself. They exclude the time spent in any method/function called &lt;em&gt;from&lt;/em&gt; the given function (since that time will be tracked separately).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In general, the inclusive metrics (for CPU time and memory usage) will give you a sense of what your expensive methods/functions are – these are the methods or functions that you should avoid calling if possible. In contrast, the exclusive metrics will tell you where you can potentially improve the way a given method/function is implemented. For methods which belong to Drupal Core or other contrib modules, inclusive and exclusive metrics are basically equivalent, since you don’t usually have the option of impacting the implementation details of a function unless you’re working on its code directly. Note also that because your overall parent method and any other high-level methods in your code will &lt;em&gt;always&lt;/em&gt; show up at the top of the inclusive time chart, you may have better luck really understanding where your performance hits come from by sorting by exclusive CPU time.&lt;/p&gt;

&lt;h3 id=&quot;take-a-step-back-and-plan-your-test-scenarios&quot;&gt;Take a step back and plan your test scenarios&lt;/h3&gt;

&lt;p&gt;Before digging in to optimizing your module code, you need to take a step back and think about the big picture. First, what are you optimizing for? Many optimizations involve a tradeoff between time and memory usage. Are you trying to reduce overall run-time at the expense of more memory? Is keeping the memory footprint of a given function down more important? In order to answer these questions you need to think about the overall context in which your code is running. In my case, I was optimizing a background import module which was run via cron, so the top priority was that the memory usage and number of database optimizations were low enough not to impact the user-facing site performance.&lt;/p&gt;

&lt;p&gt;Second, what use case for your code are you profiling? If this is a single method call, what arguments will be passed? If you’re profiling page loads on a website, which pages are you profiling? In order to successfully track whether the changes you’re making are having an impact on the metrics you’re concerned about, you need to be able to narrow down the possible use cases for your code into a handful of most-likely real world scenarios which you’ll actually choose to track via the profiler.&lt;/p&gt;

&lt;h3 id=&quot;keep-things-organized&quot;&gt;Keep things organized&lt;/h3&gt;

&lt;p&gt;Now it’s time to get organized. Write a simple test script so that you can easily run through all your use cases in an automated way – this is not strictly necessary, but it will save you a lot of work and potential error as you move through the process. In my case, I was testing a drush command hook, so I just wrote a bash shell script which executed the command three times in each of two different ways. For profiling page loads, I would recommend using &lt;a href=&quot;https://jmeter.apache.org/&quot;&gt;Apache JMeter&lt;/a&gt; - and you’ll need to consider whether you want to force an uncached page load by passing a random dummy query parameter. Ideally, you should be running each scenario a few times so that you can then average the results to account for any small variations in run-time.&lt;/p&gt;

&lt;p&gt;Keeping your different runs organized is probably the most important part of successfully profiling module code using XHProf! Each run has a unique run ID, but &lt;strong&gt;you&lt;/strong&gt; are solely responsible for knowing which use case scenario and which version of the codebase that run ID corresponds to. I set up a basic spreadsheet in OpenOffice where I could paste in run numbers and basic run stats to compare (but there’s almost certainly a nicer automated way to do this than what I used).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-spreadsheet.jpg&quot; alt=&quot;Screenshot of an OpenOffice spreadsheet summarizing XHProf results for various runs&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once you have a set of run IDs for a given use case + codebase version, you can generate a &lt;em&gt;composite&lt;/em&gt; xhprof report using the query string syntax &lt;code class=&quot;highlighter-rouge&quot;&gt;http://&amp;lt;your-local-site&amp;gt;/xhprof/index.php?run=&amp;lt;first-run-id&amp;gt;,&amp;lt;second-run-id&amp;gt;,&amp;lt;third-run-id&amp;gt;&amp;amp;source=&amp;lt;source-string&amp;gt;&lt;/code&gt; Averaging out across a few runs should give you more &lt;a href=&quot;https://en.wikipedia.org/wiki/Accuracy_and_precision&quot;&gt;precise&lt;/a&gt; measurements for CPU time and memory usage, but beware that if parts of your code involve caching you may want to either throw out the first run’s results in each version of the code base, since that’s where the cache will be generated, or clear the cache between runs.&lt;/p&gt;

&lt;p&gt;Go ahead and test your run scripts to make sure that you can get a consistent baseline result at this point – if you’re seeing large differences in average total CPU times or average memory usage across different runs of the same codebase, you likely won’t be able to compare run times across &lt;em&gt;different&lt;/em&gt; versions of the code.&lt;/p&gt;

&lt;h3 id=&quot;actually-getting-to-work&quot;&gt;Actually getting to work!&lt;/h3&gt;

&lt;p&gt;After all this set-up, you should be ready to experiment and see what the impact of changes in your code base are on the metrics that you want to shift. In my case, the code I was working on used a &lt;a href=&quot;https://github.com/squix78/jsonstreamingparser&quot;&gt;streaming JSON parser class&lt;/a&gt;, and I noticed that one of the top function calls in the inital profiler report was the &lt;code class=&quot;highlighter-rouge&quot;&gt;consumeChar&lt;/code&gt; method of the parser.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-page.jpg&quot; alt=&quot;Image of XHProf profiler report with the method consumeChar highlighted in yellow&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It turns out that the JSON files I was importing were pretty-printed, thus containing more whitespace than they needed to. Sine the &lt;code class=&quot;highlighter-rouge&quot;&gt;consumeChar&lt;/code&gt; method gets called on each incoming character of the input stream, that added up to a lot of unnecessary method calls in the original code. By tweaking the JSON file export code to remove the pretty print flag, I cut down the number of times this method was called from 729,099 to 499,809, saving .2 seconds of run time right off the bat.&lt;/p&gt;

&lt;p&gt;That was the major place where the XHProf profiler report gave me insights I would not have had otherwise. The rest of my optimizing experience was mostly testing out some of the common-sense optimizations I had already thought of while looking at the code – caching a table of known Entity IDs rather than querying the DB to check if an entity existed each time, using an associative array and &lt;code class=&quot;highlighter-rouge&quot;&gt;is_empty()&lt;/code&gt; &lt;a href=&quot;http://www.w3programmers.com/phps-in_array-function-is-really-slow/&quot;&gt;to replace &lt;code class=&quot;highlighter-rouge&quot;&gt;in_array()&lt;/code&gt; calls&lt;/a&gt;, cutting down on unnecessary &lt;code class=&quot;highlighter-rouge&quot;&gt;$entity-&amp;gt;save()&lt;/code&gt; operations where possible.&lt;/p&gt;

&lt;p&gt;It’s useful to mention that across the board the biggest performance hit in your Drupal code will probably be database calls, so cutting down on those wherever possible will save run-time (sometimes at the expense of memory, if you’re caching large amounts of data). Remember, also, that if DB log is enabled each logging call is a separate database operation, so use the log sparingly – or just log to &lt;code class=&quot;highlighter-rouge&quot;&gt;syslog&lt;/code&gt; and use service like &lt;a href=&quot;https://papertrailapp.com/&quot;&gt;Papertrail&lt;/a&gt; or &lt;a href=&quot;https://www.loggly.com/&quot;&gt;Loggly&lt;/a&gt; on production sites.&lt;/p&gt;

&lt;h3 id=&quot;the-final-results&quot;&gt;The final results&lt;/h3&gt;

&lt;p&gt;As the results below show, using XHProf and some thoughtful optimizations I was able to cut total run time significantly in one use case (Case 2) and slightly in another use case (Case 1). Case 1 was already running in a reasonable amount of time, so here I was mostly interested in the Case 2 numbers (assuming I didn’t make anything too much worse).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-graph.jpg&quot; alt=&quot;Bar chart comparing the run time of various runs&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;think-of-the-big-picture-part-2&quot;&gt;Think of the big picture, part 2&lt;/h3&gt;

&lt;p&gt;Remember that controlled experimental metrics are just a means to understanding and improving real-world performance (which you can also measure directly using tools like &lt;a href=&quot;https://blackfire.io/&quot;&gt;blackfire&lt;/a&gt;, but that’s another blog post). In my case, at the end of the day we decided that the most important thing was to ensure that there wasn’t a performance impact on the production site while this background import code was running; so one of the optimizations we actually ended up implementing was to force this code to run &lt;strong&gt;slower&lt;/strong&gt; by throttling &lt;code class=&quot;highlighter-rouge&quot;&gt;$entity-&amp;gt;save()&lt;/code&gt; operations to maximally 1 every 1/2 second or so, as a way to minimize the number of requests MySQL was having to respond to from the importer. XHProf is a powerful tool, but don’t lose the forest for the trees when it comes to optimization.&lt;/p&gt;

      &lt;hr&gt;

      
        &lt;div class=&quot;post-comments&quot;&gt;

  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;

      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;

        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;

        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot; class=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--name&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;name&quot;&gt;Name&lt;/label&gt;
            &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; required&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--email&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;email&quot;&gt;Email&lt;/label&gt;
            &lt;input type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot; required&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--comment&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;comment&quot;&gt;Comment&lt;/label&gt;
            &lt;textarea name=&quot;comment&quot; id=&quot;comment&quot; required&gt;&lt;/textarea&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Plain text format only please.&lt;/p&gt;
          &lt;/div&gt;

          &lt;input type=&quot;hidden&quot; name=&quot;slug&quot; id=&quot;slug&quot; value=&quot;/2016/06/16/using-xhprof.html&quot;&gt;
          &lt;input type=&quot;text&quot; name=&quot;url&quot; id=&quot;url&quot;&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--nocaptcha&quot;&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__image&quot;&gt;
              &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__input&quot;&gt;
              &lt;label class=&quot;comment-form__field__label&quot; for=&quot;nocaptcha&quot;&gt;What type of animal is the Savas Labs logo?&lt;/label&gt;
              &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Hint: 3 letters long, starts with an &quot;o&quot; and ends with an &quot;l&quot;.&lt;/p&gt;
              &lt;input type=&quot;text&quot; name=&quot;nocaptcha&quot; id=&quot;nocaptcha&quot; required&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&quot;submit&quot; value=&quot;Post comment&quot; id=&quot;submit&quot; class=&quot;comment-form__submit&quot;&gt;
        &lt;/form&gt;

      &lt;/div&gt;&lt;!-- comments and comment form --&gt;
    &lt;/div&gt;&lt;!-- expander --&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

      
    &lt;/article&gt;
  &lt;/div&gt;&lt;!-- post__body --&gt;

  
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;

    
    
    
    
    

    
      &lt;h4&gt;About the author&lt;/h4&gt;
    

    

      
      
        &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-576by509-576790.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-576790.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-576790.jpg&quot; class=&quot;image--team-post-meta&quot; itemprop=&quot;image&quot; alt=&quot;Tim Stallmann&quot; &gt;
  &lt;/picture&gt;

        &lt;/a&gt;
        &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
      

      
      

    
  &lt;/div&gt;

  
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas Labs&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/20/drupal-docker-pattern-lab.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Docker and the Drupal Pattern Lab Starter Theme
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 20, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern...&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/15/docker-mysql-performance.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Dramatically Improve MySQL Import Performance with Docker
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 15, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;How to dramatically improve MySQL database import performance on Drupal with Docker stacks&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/11/15/composer-mailchimp-subscriptions-v3-api.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Using MailChimp API v3.0 to subscribe users to email lists in Drupal custom modules
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Nov 15, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;How to use Composer along with the ThinkShout PHP library for MailChimp API v3.0 to easily subscribe users to mailing...&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

  

  &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Usability Testing - Our Process and Favorite Practices&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt; Strategies and tools for resolving Git merge conflicts &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;!-- post --&gt;
",
      "author": {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Tim Stallmann",
        "affiliation": "Savas Labs",
        "worksFor": "Savas Labs"
      },
      "dateCreated": "2016-06-16 00:00:00 +0000",
      "dateModified": "2016-06-16 00:00:00 +0000",
      "datePublished": "2016-06-16 00:00:00 +0000",
      "headline": "Using XHProf to profile your Drupal module",
      "inLanguage": "en-US",
      "keywords": "php, performance, drupal, drupal-planet, module-development",
      "mainEntityOfPage": "http://savaslabs.com/2016/06/16/using-xhprof.html",
      "publisher": {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "Savas Labs",
        "logo": {
          "@context": "http://schema.org",
          "@type": "ImageObject",
          "description": "Savas Labs logo",
          "height": "50px",
          "url": "http://savaslabs.com/assets/img/logo.png",
          "width": "114px"
        }
      },
      "sourceOrganization": "Savas Labs",
      "text": "


&lt;div class=&quot;post&quot;&gt;
  &lt;div class=&quot;post__body&quot;&gt;
    &lt;header class=&quot;post-header&quot;&gt;
      &lt;h1 class=&quot;post-title&quot;&gt;Using XHProf to profile your Drupal module&lt;/h1&gt;

      

&lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;

      &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
      &lt;p&gt;Jun 16, 2016 &lt;/p&gt;&lt;br&gt;
      &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/php/&quot;&gt;PHP&lt;/a&gt;, &lt;a href=&quot;/blog/tag/performance/&quot;&gt;Performance&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;, &lt;a href=&quot;/blog/tag/module-development/&quot;&gt;Module Development&lt;/a&gt;&lt;/p&gt;
      
      &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
      
      
    &lt;/header&gt;

    

    &lt;article class=&quot;post-content&quot;&gt;
      &lt;p&gt;This is part 2 of a series on using XHProf for profiling Drupal modules.&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;/2016/05/26/installing-xhprof.html&quot;&gt;Part 1: Installing XHProf&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Part 2: Using XHProf&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;After you’ve &lt;a href=&quot;/2016/05/26/installing-xhprof.html&quot;&gt;installed XHProf&lt;/a&gt;, what’s next? How can you make use of its recommendations to tune a module or a website? Unfortunately there are no hard-and-fast rules for optimizing code to run more efficiently. What I can offer here is my own experience trying to optimize a D8 module using XHProf.&lt;/p&gt;

&lt;h3 id=&quot;understanding-an-xhprof-run-report&quot;&gt;Understanding an XHProf run report&lt;/h3&gt;

&lt;p&gt;The XHProf GUI displays the result of a given profiler run, or a group of runs. It can even compare 2 runs, but we’ll get to that in a minute. If you followed &lt;a href=&quot;/2016/05/26/installing-xhprof.html&quot;&gt;my previous post&lt;/a&gt;, you should have the &lt;code class=&quot;highlighter-rouge&quot;&gt;xhprof_html&lt;/code&gt; directory symlinked into the root web directory for your Drupal site; so visiting &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;my-local-site&amp;gt;/xhprof/&lt;/code&gt; should give you a list of all available stored run IDs, and you can click through one of those to view a specific run report.&lt;/p&gt;

&lt;p&gt;You can also go directly to a specific run report via the URL &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;my-local-site&amp;gt;/xhprof/index.php?run=&amp;lt;run-id&amp;gt;&amp;amp;source=&amp;lt;source-id&amp;gt;&lt;/code&gt; (which you should have been logging already via an &lt;code class=&quot;highlighter-rouge&quot;&gt;echo&lt;/code&gt; statement or &lt;code class=&quot;highlighter-rouge&quot;&gt;dblog&lt;/code&gt; if you followed the last post).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-page-screenshot.jpg&quot; alt=&quot;Header of an XHProf run report&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The core of the run report is a table of each function or method which your code called while it was being profiled, along with a set of statistics about that function. This allows you to understand which parts of your code are most resource-intensive, and which are being called frequently in the use case that you’re profiling. Clicking on any one of the column headers will sort the list by that metric. To understand this report, it’s helpful to have some terminology:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Incl. Wall Time&lt;/strong&gt; - The total clock time elapsed between when a function call started and when the function exited. Note that this number is not a great basis for comparisons, since it can include other processes which were taking up CPU time on your machine while the PHP code was running, from streaming music in the background to PHPStorm’s code indexing, to random web browsing.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Incl. CPU Time&lt;/strong&gt; - In contrast to wall time, CPU time tracks only the time which the CPU actually spent executing your code (or related system calls). This is a more reliable metric for comparing different runs.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Excl. Wall/CPU Time&lt;/strong&gt; - Exclusive time measurements only count time actually spent within the given method itself. They exclude the time spent in any method/function called &lt;em&gt;from&lt;/em&gt; the given function (since that time will be tracked separately).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In general, the inclusive metrics (for CPU time and memory usage) will give you a sense of what your expensive methods/functions are – these are the methods or functions that you should avoid calling if possible. In contrast, the exclusive metrics will tell you where you can potentially improve the way a given method/function is implemented. For methods which belong to Drupal Core or other contrib modules, inclusive and exclusive metrics are basically equivalent, since you don’t usually have the option of impacting the implementation details of a function unless you’re working on its code directly. Note also that because your overall parent method and any other high-level methods in your code will &lt;em&gt;always&lt;/em&gt; show up at the top of the inclusive time chart, you may have better luck really understanding where your performance hits come from by sorting by exclusive CPU time.&lt;/p&gt;

&lt;h3 id=&quot;take-a-step-back-and-plan-your-test-scenarios&quot;&gt;Take a step back and plan your test scenarios&lt;/h3&gt;

&lt;p&gt;Before digging in to optimizing your module code, you need to take a step back and think about the big picture. First, what are you optimizing for? Many optimizations involve a tradeoff between time and memory usage. Are you trying to reduce overall run-time at the expense of more memory? Is keeping the memory footprint of a given function down more important? In order to answer these questions you need to think about the overall context in which your code is running. In my case, I was optimizing a background import module which was run via cron, so the top priority was that the memory usage and number of database optimizations were low enough not to impact the user-facing site performance.&lt;/p&gt;

&lt;p&gt;Second, what use case for your code are you profiling? If this is a single method call, what arguments will be passed? If you’re profiling page loads on a website, which pages are you profiling? In order to successfully track whether the changes you’re making are having an impact on the metrics you’re concerned about, you need to be able to narrow down the possible use cases for your code into a handful of most-likely real world scenarios which you’ll actually choose to track via the profiler.&lt;/p&gt;

&lt;h3 id=&quot;keep-things-organized&quot;&gt;Keep things organized&lt;/h3&gt;

&lt;p&gt;Now it’s time to get organized. Write a simple test script so that you can easily run through all your use cases in an automated way – this is not strictly necessary, but it will save you a lot of work and potential error as you move through the process. In my case, I was testing a drush command hook, so I just wrote a bash shell script which executed the command three times in each of two different ways. For profiling page loads, I would recommend using &lt;a href=&quot;https://jmeter.apache.org/&quot;&gt;Apache JMeter&lt;/a&gt; - and you’ll need to consider whether you want to force an uncached page load by passing a random dummy query parameter. Ideally, you should be running each scenario a few times so that you can then average the results to account for any small variations in run-time.&lt;/p&gt;

&lt;p&gt;Keeping your different runs organized is probably the most important part of successfully profiling module code using XHProf! Each run has a unique run ID, but &lt;strong&gt;you&lt;/strong&gt; are solely responsible for knowing which use case scenario and which version of the codebase that run ID corresponds to. I set up a basic spreadsheet in OpenOffice where I could paste in run numbers and basic run stats to compare (but there’s almost certainly a nicer automated way to do this than what I used).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-spreadsheet.jpg&quot; alt=&quot;Screenshot of an OpenOffice spreadsheet summarizing XHProf results for various runs&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once you have a set of run IDs for a given use case + codebase version, you can generate a &lt;em&gt;composite&lt;/em&gt; xhprof report using the query string syntax &lt;code class=&quot;highlighter-rouge&quot;&gt;http://&amp;lt;your-local-site&amp;gt;/xhprof/index.php?run=&amp;lt;first-run-id&amp;gt;,&amp;lt;second-run-id&amp;gt;,&amp;lt;third-run-id&amp;gt;&amp;amp;source=&amp;lt;source-string&amp;gt;&lt;/code&gt; Averaging out across a few runs should give you more &lt;a href=&quot;https://en.wikipedia.org/wiki/Accuracy_and_precision&quot;&gt;precise&lt;/a&gt; measurements for CPU time and memory usage, but beware that if parts of your code involve caching you may want to either throw out the first run’s results in each version of the code base, since that’s where the cache will be generated, or clear the cache between runs.&lt;/p&gt;

&lt;p&gt;Go ahead and test your run scripts to make sure that you can get a consistent baseline result at this point – if you’re seeing large differences in average total CPU times or average memory usage across different runs of the same codebase, you likely won’t be able to compare run times across &lt;em&gt;different&lt;/em&gt; versions of the code.&lt;/p&gt;

&lt;h3 id=&quot;actually-getting-to-work&quot;&gt;Actually getting to work!&lt;/h3&gt;

&lt;p&gt;After all this set-up, you should be ready to experiment and see what the impact of changes in your code base are on the metrics that you want to shift. In my case, the code I was working on used a &lt;a href=&quot;https://github.com/squix78/jsonstreamingparser&quot;&gt;streaming JSON parser class&lt;/a&gt;, and I noticed that one of the top function calls in the inital profiler report was the &lt;code class=&quot;highlighter-rouge&quot;&gt;consumeChar&lt;/code&gt; method of the parser.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-page.jpg&quot; alt=&quot;Image of XHProf profiler report with the method consumeChar highlighted in yellow&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It turns out that the JSON files I was importing were pretty-printed, thus containing more whitespace than they needed to. Sine the &lt;code class=&quot;highlighter-rouge&quot;&gt;consumeChar&lt;/code&gt; method gets called on each incoming character of the input stream, that added up to a lot of unnecessary method calls in the original code. By tweaking the JSON file export code to remove the pretty print flag, I cut down the number of times this method was called from 729,099 to 499,809, saving .2 seconds of run time right off the bat.&lt;/p&gt;

&lt;p&gt;That was the major place where the XHProf profiler report gave me insights I would not have had otherwise. The rest of my optimizing experience was mostly testing out some of the common-sense optimizations I had already thought of while looking at the code – caching a table of known Entity IDs rather than querying the DB to check if an entity existed each time, using an associative array and &lt;code class=&quot;highlighter-rouge&quot;&gt;is_empty()&lt;/code&gt; &lt;a href=&quot;http://www.w3programmers.com/phps-in_array-function-is-really-slow/&quot;&gt;to replace &lt;code class=&quot;highlighter-rouge&quot;&gt;in_array()&lt;/code&gt; calls&lt;/a&gt;, cutting down on unnecessary &lt;code class=&quot;highlighter-rouge&quot;&gt;$entity-&amp;gt;save()&lt;/code&gt; operations where possible.&lt;/p&gt;

&lt;p&gt;It’s useful to mention that across the board the biggest performance hit in your Drupal code will probably be database calls, so cutting down on those wherever possible will save run-time (sometimes at the expense of memory, if you’re caching large amounts of data). Remember, also, that if DB log is enabled each logging call is a separate database operation, so use the log sparingly – or just log to &lt;code class=&quot;highlighter-rouge&quot;&gt;syslog&lt;/code&gt; and use service like &lt;a href=&quot;https://papertrailapp.com/&quot;&gt;Papertrail&lt;/a&gt; or &lt;a href=&quot;https://www.loggly.com/&quot;&gt;Loggly&lt;/a&gt; on production sites.&lt;/p&gt;

&lt;h3 id=&quot;the-final-results&quot;&gt;The final results&lt;/h3&gt;

&lt;p&gt;As the results below show, using XHProf and some thoughtful optimizations I was able to cut total run time significantly in one use case (Case 2) and slightly in another use case (Case 1). Case 1 was already running in a reasonable amount of time, so here I was mostly interested in the Case 2 numbers (assuming I didn’t make anything too much worse).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/xhprof-results-graph.jpg&quot; alt=&quot;Bar chart comparing the run time of various runs&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;think-of-the-big-picture-part-2&quot;&gt;Think of the big picture, part 2&lt;/h3&gt;

&lt;p&gt;Remember that controlled experimental metrics are just a means to understanding and improving real-world performance (which you can also measure directly using tools like &lt;a href=&quot;https://blackfire.io/&quot;&gt;blackfire&lt;/a&gt;, but that’s another blog post). In my case, at the end of the day we decided that the most important thing was to ensure that there wasn’t a performance impact on the production site while this background import code was running; so one of the optimizations we actually ended up implementing was to force this code to run &lt;strong&gt;slower&lt;/strong&gt; by throttling &lt;code class=&quot;highlighter-rouge&quot;&gt;$entity-&amp;gt;save()&lt;/code&gt; operations to maximally 1 every 1/2 second or so, as a way to minimize the number of requests MySQL was having to respond to from the importer. XHProf is a powerful tool, but don’t lose the forest for the trees when it comes to optimization.&lt;/p&gt;

      &lt;hr&gt;

      
        &lt;div class=&quot;post-comments&quot;&gt;

  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;

      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;

        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;

        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot; class=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--name&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;name&quot;&gt;Name&lt;/label&gt;
            &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; required&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--email&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;email&quot;&gt;Email&lt;/label&gt;
            &lt;input type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot; required&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--comment&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;comment&quot;&gt;Comment&lt;/label&gt;
            &lt;textarea name=&quot;comment&quot; id=&quot;comment&quot; required&gt;&lt;/textarea&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Plain text format only please.&lt;/p&gt;
          &lt;/div&gt;

          &lt;input type=&quot;hidden&quot; name=&quot;slug&quot; id=&quot;slug&quot; value=&quot;/2016/06/16/using-xhprof.html&quot;&gt;
          &lt;input type=&quot;text&quot; name=&quot;url&quot; id=&quot;url&quot;&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--nocaptcha&quot;&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__image&quot;&gt;
              &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__input&quot;&gt;
              &lt;label class=&quot;comment-form__field__label&quot; for=&quot;nocaptcha&quot;&gt;What type of animal is the Savas Labs logo?&lt;/label&gt;
              &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Hint: 3 letters long, starts with an &quot;o&quot; and ends with an &quot;l&quot;.&lt;/p&gt;
              &lt;input type=&quot;text&quot; name=&quot;nocaptcha&quot; id=&quot;nocaptcha&quot; required&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&quot;submit&quot; value=&quot;Post comment&quot; id=&quot;submit&quot; class=&quot;comment-form__submit&quot;&gt;
        &lt;/form&gt;

      &lt;/div&gt;&lt;!-- comments and comment form --&gt;
    &lt;/div&gt;&lt;!-- expander --&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

      
    &lt;/article&gt;
  &lt;/div&gt;&lt;!-- post__body --&gt;

  
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;

    
    
    
    
    

    
      &lt;h4&gt;About the author&lt;/h4&gt;
    

    

      
      
        &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-576by509-576790.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-576790.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-576790.jpg&quot; class=&quot;image--team-post-meta&quot; itemprop=&quot;image&quot; alt=&quot;Tim Stallmann&quot; &gt;
  &lt;/picture&gt;

        &lt;/a&gt;
        &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
      

      
      

    
  &lt;/div&gt;

  
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas Labs&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/20/drupal-docker-pattern-lab.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Docker and the Drupal Pattern Lab Starter Theme
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 20, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern...&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/15/docker-mysql-performance.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Dramatically Improve MySQL Import Performance with Docker
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 15, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;How to dramatically improve MySQL database import performance on Drupal with Docker stacks&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/11/15/composer-mailchimp-subscriptions-v3-api.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Using MailChimp API v3.0 to subscribe users to email lists in Drupal custom modules
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Nov 15, 2016&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;How to use Composer along with the ThinkShout PHP library for MailChimp API v3.0 to easily subscribe users to mailing...&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

  

  &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Usability Testing - Our Process and Favorite Practices&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt; Strategies and tools for resolving Git merge conflicts &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;!-- post --&gt;
",
      "url": "http://savaslabs.com/2016/06/16/using-xhprof.html"
    }
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  <script>
    !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function l(){d.addEventListener&&d.removeEventListener("load",l),d.media=r||"all"}var a,i=e.document,d=i.createElement("link");if(n)a=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;a=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){a.parentNode.insertBefore(d,n?a:a.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",l),d.onloadcssdefined=f,f(l),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(t){}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){e.clearInterval(n)})}}}(this);
    loadCSS('/assets/styles/main.css');
    loadCSS('https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|Roboto+Slab:300,400|Source+Sans+Pro');
  </script>
  <style>html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.case-studies__case-study .case-study__description a,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link{border:2px solid #fff;border-radius:3px;color:#fff;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif;margin-top:2em;padding:.5em 1em;transition:all .2s ease-in-out}.case-studies__case-study .case-study__description a:focus,.case-studies__case-study .case-study__description a:hover,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link:focus,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link:hover{background-color:#0f7993}.flash-alert{background-color:rgba(242,163,36,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-alert a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-alert a:focus,.flash-alert a:hover{color:rgba(0,0,0,.2)}.flash-error{background-color:rgba(158,2,59,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-error a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-error a:focus,.flash-error a:hover{color:rgba(0,0,0,.2)}.flash-notice{background-color:rgba(246,67,62,.2);color:rgba(2,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-notice a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-notice a:focus,.flash-notice a:hover{color:rgba(0,0,0,.2)}.flash-success{background-color:rgba(5,92,43,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-success a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-success a:focus,.flash-success a:hover{color:rgba(0,0,0,.2)}button,input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none;-webkit-font-smoothing:antialiased;background-color:#0a5365;border-radius:3px;border:none;color:#fff;cursor:pointer;display:inline-block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;font-weight:600;line-height:1;padding:.75em 1em;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;white-space:nowrap}button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{background-color:#031a1f;color:#fff}button:disabled,input[type=button]:disabled,input[type=reset]:disabled,input[type=submit]:disabled{cursor:not-allowed;opacity:.5}fieldset{background-color:#f7f7f7;border:1px solid #ddd;margin:0 0 .75em;padding:1.5em}input,label,select{display:block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em}label{font-weight:600;margin-bottom:.375em}label.required::after{content:"*"}label abbr{display:none}input[type=color],input[type=date],input[type=datetime-local],input[type=datetime],input[type=email],input[type=month],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=time],input[type=url],input[type=week],select[multiple=multiple],textarea{background-color:#fff;border:1px solid #ddd;border-radius:3px;box-shadow:inset 0 1px 3px rgba(0,0,0,.06);box-sizing:border-box;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;margin-bottom:.75em;padding:.5em;transition:border-color;width:100%}input[type=color]:hover,input[type=date]:hover,input[type=datetime-local]:hover,input[type=datetime]:hover,input[type=email]:hover,input[type=month]:hover,input[type=number]:hover,input[type=password]:hover,input[type=search]:hover,input[type=tel]:hover,input[type=text]:hover,input[type=time]:hover,input[type=url]:hover,input[type=week]:hover,select[multiple=multiple]:hover,textarea:hover{border-color:#c4c4c4}input[type=color]:focus,input[type=date]:focus,input[type=datetime-local]:focus,input[type=datetime]:focus,input[type=email]:focus,input[type=month]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=time]:focus,input[type=url]:focus,input[type=week]:focus,select[multiple=multiple]:focus,textarea:focus{border-color:#0a5365;box-shadow:inset 0 1px 3px rgba(0,0,0,.06),0 0 5px rgba(55,112,192,.7);outline:0}textarea{resize:vertical}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none}input[type=checkbox],input[type=radio]{display:inline;margin-right:.375em}input[type=file]{padding-bottom:.75em;width:100%}select{margin-bottom:1.5em;max-width:100%;width:auto}ol,ul{list-style-type:none;margin:0;padding:0}dl{margin-bottom:.75em}dl dt{font-weight:700;margin-top:.75em}dl dd{margin:0}table{-ms-font-feature-settings:"kern","liga","tnum";font-feature-settings:"kern","liga","tnum";border-collapse:collapse;margin:.75em 0;table-layout:fixed;width:100%}th{border-bottom:1px solid #b7b7b7;font-weight:600;padding:.75em 0;text-align:left}td{border-bottom:1px solid #ddd;padding:.75em 0}td .label{font-weight:700}td,th,tr{vertical-align:middle}body{-ms-font-feature-settings:"kern","liga","pnum";font-feature-settings:"kern","liga","pnum";-webkit-font-smoothing:antialiased;color:#333;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;line-height:1.5}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;line-height:1.2;margin:0 0 .75em}p{margin:0 0 .75em}a{color:#0a5365;text-decoration:none;transition:color .1s linear}a:active,a:focus,a:hover{color:#031a1f}a:active,a:focus{outline:0}hr{border-bottom:1px solid #ddd;border-left:none;border-right:none;border-top:none;margin:1.5em 0}img,picture{margin:0;max-width:100%}.table-minimal{border-collapse:separate;border-spacing:0;width:100%}.table-minimal th{text-align:left}.table-minimal td{line-height:1.5}.table-minimal thead th{background-color:#fff;border-bottom:0;padding:.75em 1em}.table-minimal tbody{background-color:#fff}.table-minimal tbody td{border-bottom:0;border-top:1px solid #ddd;padding:.75em 1em}.table-minimal tbody td button{display:inline-block;font-size:.7em;line-height:1.5;margin-bottom:.3em;margin-right:.5em;outline:0;padding:.3em 1em;width:100%}@media screen and (min-width:40em){.table-minimal tbody td button{margin-bottom:0;width:auto}}.table-minimal tbody tr:hover>td,.table-minimal tbody tr:hover>th{background-color:#fafafa}.table-minimal tbody tr:first-child td{border-top:2px solid #ddd}.table-minimal--contact p{display:none}@media screen and (min-width:28.125em){.table-minimal--contact p{display:inline}}.table-minimal--contact .table-minimal--contact__label{width:30%}@media screen and (min-width:28.125em){.table-minimal--contact .table-minimal--contact__label{width:50%}}body{color:#14133b;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}h1,h2,h3,h4,h5,h6{color:#9e023b;font-family:"Roboto Slab",Verdana,sans-serif;font-weight:300}.portfolio h2,.portfolio h3,.portfolio h4,.portfolio h5,.portfolio h6,.post h2,.post h3,.post h4,.post h5,.post h6{margin-top:1.5em}h1{font-size:250%}h2{font-size:200%}h3{font-size:160%}h4{font-size:140%}h5{font-size:120%}h6{font-size:100%}a{color:#0a5365;transition:all .1s linear}a:focus,a:hover{color:#0f7993}.post li a,p a{border-bottom:.1em solid rgba(10,83,101,.1)}.post li a:focus,.post li a:hover,p a:focus,p a:hover{border-bottom:.1em solid #0f7993}.name-description p,.page-description,.post li,.post p,.services__service p,.team-member p{color:#14133b;font-size:1.2em}ul{list-style-type:square}ol{list-style-type:decimal}ol,ul{margin-bottom:1em;margin-left:2em}ol ol,ol ol li,ol ul,ol ul li,ul ol,ul ol li,ul ul,ul ul li{font-size:1em!important}hr{clear:both;margin:3em 0}blockquote{background-color:#f7f7f7;border-left:10px solid rgba(20,19,59,.4);border-radius:0 9px 9px 0;font-style:italic;margin:2em 0;padding:1em;quotes:'\201C' '\201D'}blockquote::before{color:rgba(20,19,59,.4);content:open-quote;font-family:'Source Sans Pro',sans-serif;font-size:4em;line-height:.1em;margin-right:.25em;vertical-align:-.4em}blockquote p{display:inline}.callout{background-color:#14133b;border-left:solid 1em #9e023b;border-radius:6px;margin:1.5em auto;padding:1em;width:100%}.callout p{color:#fff;font-size:1.5em;margin-bottom:0}label{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}.wrapper{max-width:70em;margin-left:auto;margin-right:auto;max-width:70em;padding:3em 1em;vertical-align:baseline}.wrapper::after{clear:both;content:"";display:table}@media screen and (min-width:70em){.wrapper{padding:3em 0}}.flex-container{float:left;display:block;margin-right:2.35765%;width:100%}.flex-container:last-child{margin-right:0}.page-description,.view-all-link,header{text-align:center}.page-description{margin-bottom:2em}@media screen and (min-width:53.75em){.column-8{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.column-8:last-child{margin-right:0}}.view-more-link{font-size:1.2em;text-align:center}.cards{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center}.card{flex-basis:15em;-ms-flex-preferred-size:15em;-moz-flex-grow:1;flex-grow:1;-ms-flex-positive:1;transition:all .2s ease-in-out;background-color:#f7f7f7;border:1px solid #ddd;border-radius:3px;box-shadow:0 2px 4px #e6e6e6;cursor:auto;margin:0 1em 1.5em;position:relative}.card .card-image{max-height:200px;overflow:hidden}.card .card-image img{transition:all .2s ease-in-out;background:#ddd;border-top-left-radius:3px;border-top-right-radius:3px;width:100%}.card .card-header{transition:all .2s ease-in-out;background-color:#f7f7f7;border-bottom:1px solid #ddd;border-radius:3px 3px 0 0;font-family:"Roboto Slab",Verdana,sans-serif;line-height:1.5em;padding:.5em .75em}.card .fa-comment-o{margin-right:4px}.card .card-copy{color:#14133b;font-size:.9em;line-height:1.5em;padding:.75em}.card .card-copy p{margin:0 0 .75em}.card:focus,.card:hover{background-color:#fff}.card:focus .card-image img,.card:hover .card-image img{background:#eaeaea}.card:focus .card-header,.card:hover .card-header{background-color:#fff}.card:active{background-color:#f7f7f7}.card:active .card-header{background-color:#f7f7f7}.team-card{flex-basis:21em;-ms-flex-preferred-size:21em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;transition:all .2s ease-in-out}.team-card .card-image{max-height:350px;overflow:hidden}.team-card .card-image img{position:relative;top:-50px}.team-card .card-header{display:inline-block;font-size:1.1em;padding:.5em .75em 0}.team-card .card-copy{border-top:1px solid #dcdcdc;font-size:1em}.team-card .card-title{display:inline-block;float:right;font-size:.8em;line-height:2em;padding:.75em .75em 0;text-transform:uppercase}.blog-card{flex-basis:20em;-ms-flex-preferred-size:20em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0}.case-studies{margin:3em 0}.case-studies__case-study{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;background-position:top center;background-repeat:no-repeat;background-size:cover;margin:1.5em 0}@media screen and (min-width:40em){.case-studies__case-study{-webkit-box-lines:single;-moz-box-lines:single;box-lines:single;-ms-flex-wrap:nowrap;flex-wrap:nowrap}}.case-studies__case-study a,.case-studies__case-study h3,.case-studies__case-study p{color:#fff;margin-bottom:0}.case-studies__case-study .case-study__description,.case-studies__case-study .case-study__title{padding:1.5em}@media screen and (min-width:40em){.case-studies__case-study .case-study__description,.case-studies__case-study .case-study__title{padding:3em 1.5em}}.case-studies__case-study .case-study__title{padding-bottom:0;text-align:center}@media screen and (min-width:40em){.case-studies__case-study .case-study__title{padding-bottom:6em;width:40%}}.case-studies__case-study .case-study__title h3{font-size:200%}@media screen and (min-width:40em){.case-studies__case-study .case-study__description{width:60%}}.case-studies__case-study .case-study__description a,.case-studies__case-study .case-study__description p{font-size:1.25em;margin-bottom:0}.case-studies__case-study .case-study__description a{display:inline-block;margin-top:1.5em}.case-studies__case-study .case-study__description a i{margin-left:.5em}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-angle-double-down:before{content:""}.fa-building-o:before{content:""}.fa-circle:before{content:""}.fa-comment:before{content:""}.fa-comment-o:before{content:""}.fa-drupal:before{content:""}.fa-envelope-o:before{content:""}.fa-file-text:before{content:""}.fa-github:before{content:""}.fa-globe:before{content:""}.fa-linkedin:before{content:""}.fa-long-arrow-right:before{content:""}.fa-phone:before{content:""}.fa-stack-exchange:before{content:""}.fa-tags:before{content:""}.fa-twitter:before{content:""}.home__cover{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;background:url(/assets/img/home-cover-image/home-cover-code-400.png) #14133b center center no-repeat;background-size:cover;height:88vh;text-align:center}@media only screen and (-webkit-min-device-pixel-ratio:2),only screen and (min--moz-device-pixel-ratio:2),only screen and (min-resolution:192dpi),only screen and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-800.png)}}@media screen and (min-width:25em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-640.png)}}@media only screen and (min-width:25em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:25em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:25em) and (min-resolution:192dpi),only screen and (min-width:25em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1280.png)}}@media screen and (min-width:40em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-860.png);height:78vh}}@media only screen and (min-width:40em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:40em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:40em) and (min-resolution:192dpi),only screen and (min-width:40em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1720.png)}}@media screen and (min-width:53.75em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1120.png);height:88vh}}@media only screen and (min-width:53.75em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min-resolution:192dpi),only screen and (min-width:53.75em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-2240.png)}}@media screen and (min-width:70em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1200.png)}}@media only screen and (min-width:70em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:70em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:70em) and (min-resolution:192dpi),only screen and (min-width:70em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code.png)}}.home__cover .home__cover__heading,.home__cover .home__cover__site-description{margin:0}.home__cover .home__cover__heading{font-size:2em;font-weight:400;margin-top:30px}.home__cover hr{border:solid 2px #0a5365;border-radius:.5px;margin:10px auto 15px;width:170px}.home__cover .home__cover__site-description{color:#fff;font-size:1.5em;line-height:1.3em;width:230px}.home__cover i{color:#0a5365;font-size:2.8em;padding-top:20px}.navigation{background-color:#0a5365;min-height:70px;width:100%;z-index:999}.navigation a{text-decoration:none}.navigation .navigation-wrapper{max-width:70em;margin-left:auto;margin-right:auto;padding:25px 0;position:relative;z-index:9999}.navigation .navigation-wrapper::after{clear:both;content:"";display:table}.navigation .navigation-wrapper::after{clear:both;content:"";display:table}.navigation .logo{background-color:#14133b;border-radius:6px;display:inline-block;float:left;margin:0 0 0 1em;max-height:70px;padding-left:1em;padding-right:1em}@media screen and (min-width:40em){.navigation .logo{float:none;margin:0 auto}}@media screen and (min-width:53.75em){.navigation .logo{float:left;margin:0 0 0 1em}}.navigation .logo img{max-height:70px;padding:.8em 0}.navigation .navigation-menu-button{color:rgba(255,255,255,.7);display:block;float:right;font-weight:700;line-height:70px;margin:0;padding-right:1em;text-transform:uppercase}@media screen and (min-width:40em){.navigation .navigation-menu-button{display:none}}.navigation .navigation-menu-button:focus,.navigation .navigation-menu-button:hover{color:#fff}.navigation nav{float:none;min-height:70px;z-index:9999999}@media screen and (min-width:40em){.navigation nav{clear:left;margin:0 auto}}@media screen and (min-width:53.75em){.navigation nav{clear:none;float:right}}.navigation .navigation-menu{clear:both;display:none;margin:0 auto;overflow:visible;padding:0;-webkit-transform-style:preserve-3d;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .navigation-menu{display:inline;margin:0;padding:0}}.navigation .navigation-menu.show{display:block}.navigation .nav-link{background:#0a5365;display:block;line-height:70px;overflow:hidden;padding-right:.8em;text-align:right;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .nav-link{background:0 0;display:inline;line-height:70px;text-decoration:none;width:auto}}.navigation .nav-link a{color:rgba(255,255,255,.7);display:inline-block;font-size:1.1em;font-weight:400;text-transform:uppercase}@media screen and (min-width:40em){.navigation .nav-link a{padding-right:.5em}}@media screen and (min-width:53.75em){.navigation .nav-link a{padding-right:1em}}.navigation .nav-link a:focus,.navigation .nav-link a:hover{color:#fff}.navigation .active-nav-item a{color:#fff}.navigation .more.nav-link{overflow:visible;padding-right:0}@media screen and (min-width:40em){.navigation .more.nav-link{padding-right:.8em;position:relative}.navigation .more.nav-link>ul>li:first-child a{padding-top:1em}}.navigation .more.nav-link a{padding-right:.8em}.navigation .more.nav-link>a{padding-right:.6em;position:relative}@media screen and (min-width:40em){.navigation .more.nav-link>a{margin-right:1em}}.navigation .more.nav-link>a::after{position:absolute;top:auto;right:-.4em;bottom:auto;left:auto;color:rgba(255,255,255,.7)}@media screen and (min-width:40em){.navigation .more.nav-link>a::after{content:'\25BE'}}.navigation .more.nav-link:focus>.submenu,.navigation .more.nav-link:hover>.submenu{display:block}.navigation .submenu{display:none;padding-left:0}@media screen and (min-width:40em){.navigation .submenu{left:-1em;position:absolute;top:1.5em}}.navigation .submenu li{display:block;padding-right:0}@media screen and (min-width:40em){.navigation .submenu li{line-height:53.84615px}.navigation .submenu li:first-child>a{border-top-left-radius:3px;border-top-right-radius:3px}.navigation .submenu li:last-child>a{border-bottom-left-radius:3px;border-bottom-right-radius:3px;padding-bottom:.7em}}.navigation .submenu li a{background-color:#094857;display:inline-block;text-align:right;width:100%}@media screen and (min-width:40em){.navigation .submenu li a{background-color:#0a5365;padding-left:1em;text-align:left;width:10em}}.post .post__body{max-width:70em;margin-left:auto;margin-right:auto}.post .post__body::after{clear:both;content:"";display:table}@media screen and (min-width:53.75em){.post .post__body{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.post .post__body:last-child{margin-right:0}}.post .post__body .post-header{margin-bottom:1.875em}.post .post__body .post-header p{display:inline}.post .post__body .post-header i{color:#14133b;margin-right:5px}.post .post__body .post-header .centerdot{font-weight:700}.post .post__body .post-header .post-featured-image{margin:3em 0}.post .post__body .disclaimer{background-color:rgba(158,2,59,.1);border:solid 1px rgba(158,2,59,.3);border-radius:5px;margin-bottom:1.875em;padding:1em}.post .post__body .disclaimer h5{margin-top:0}@media screen and (min-width:53.75em){.post .post-bottom{float:left;display:block;margin-right:2.35765%;width:82.94039%;margin-left:8.5298%}.post .post-bottom:last-child{margin-right:0}}@media screen and (min-width:70em){.post .post-bottom{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.post .post-bottom:last-child{margin-right:0}}.previous-next-links .next{float:left;display:block;margin-right:2.35765%;width:48.82117%;float:left}.previous-next-links .next:last-child{margin-right:0}.previous-next-links .previous{float:left;display:block;margin-right:2.35765%;width:48.82117%;float:right;text-align:right}.previous-next-links .previous:last-child{margin-right:0}.services{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap}.services .services__service{margin-bottom:3em}.services .services__service .services__service__icon{float:left}.services .services__service p{display:inline;margin:0}@media screen and (min-width:53.75em){.services--main .services__service{margin-bottom:0;padding:1.5em;width:50%}}.services--main .services__service:last-child{margin-bottom:0}.services--main .services__service .services__service__icon{margin-right:1em}.tag h2{margin-bottom:1em;text-align:center}.tag .view-more-link{margin-top:1.5em}.tag .view-more-link .fa-arrow-right{margin-left:.25em}.tag__related-case-studies{overflow:hidden}.tag__related-case-studies .tag__related-case-studies__content{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study{flex-basis:20em;-ms-flex-preferred-size:20em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;margin:0 .75em 1.5em;text-align:center}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study h3{margin:0 auto;padding:3em 1.5em}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a,.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a:focus,.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a:hover{color:#fff}.tag__related-posts{margin-top:3em;overflow:hidden}.team-member{max-width:70em;margin-left:auto;margin-right:auto}.team-member::after{clear:both;content:"";display:table}@media screen and (min-width:40em){.team-member{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.team-member:last-child{margin-right:0}}.team-member .team-header img{border-radius:3px;max-width:100%;width:350px}.team-member .team-links{margin:1em auto 3em;text-align:center}@media screen and (min-width:40em){.team-member .team-links{width:60%}}@media screen and (min-width:53.75em){.team-member .team-links{width:100%}}.team-member .team-links li{display:inline-block;list-style-type:none;min-width:45%;padding:0 .75em}@media screen and (min-width:53.75em){.team-member .team-links li{min-width:1%}}.team-member .fa-file-text{font-size:13px}.associations{clear:both}.page-work h2{text-align:center}.page-work .case-studies{clear:both}.page-work .client-logos{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:3em}.page-work .client-logos .client-logos__logo{flex-basis:15em;-ms-flex-preferred-size:15em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;margin:0 0 2em;padding:.5em;text-align:center}@media screen and (min-width:30em){.page-work .client-logos .client-logos__logo{margin:0 1em 2em}}.case-study{clear:both}.case-study .case-study__header{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:distribute;-moz-justify-content:space-around;-ms-justify-content:space-around;-o-justify-content:space-around;justify-content:space-around;-ms-flex-pack:distribute;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;background-position:top center;background-repeat:no-repeat;background-size:cover;height:88vh;min-height:320px}@media screen and (min-width:40em){.case-study .case-study__header{height:78vh}}@media screen and (min-width:53.75em){.case-study .case-study__header{height:88vh}}.case-study .case-study__header .case-study__header__text{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;padding:1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text{box-orient:horizontal;-moz-flex-direction:row;flex-direction:row;-ms-flex-direction:row;width:90%}}@media screen and (min-width:53.75em){.case-study .case-study__header .case-study__header__text{width:80%}}.case-study .case-study__header .case-study__header__text h1,.case-study .case-study__header .case-study__header__text h3,.case-study .case-study__header .case-study__header__text li,.case-study .case-study__header .case-study__header__text p{color:#fff}.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{font-size:1.1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{font-size:1.25em}}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--left{border-right:solid 2px #fff;padding-right:1.5em}}.case-study .case-study__header .case-study__header__text .case-study__header__text--left h1{font-size:2em;margin-bottom:1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--left h1{font-size:2.5em}}.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link{display:inline-block;margin-top:1.5em}.case-study .case-study__header .case-study__header__text .case-study__header__text--right{display:none}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--right{flex-basis:280px;-ms-flex-preferred-size:280px;flex-shrink:0;-ms-flex-negative:0;display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;padding:0 0 0 1.5em}.case-study .case-study__header .case-study__header__text .case-study__header__text--right ul{font-style:italic}}.case-study .wrapper{padding:0}</style>
  
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">

    <!-- Savas Labs logo. -->
    <a href="/" class="logo">
        <img width="101px" height="70px" src="http://savaslabs.com/assets/img/logo.png" alt="Savas Labs logo">
    </a>

    <!-- Mobile menu button. -->
    <a href="/" id="js-mobile-menu" class="navigation-menu-button">MENU</a>

    <!-- Main menu. -->
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">

        <!-- Loop through nav items in config.yml. -->
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  more">
            <a href="javascript:void(0)">Who we are</a>

            <!-- If there are sub-links, create them. -->
            

              <ul class="submenu">
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/team">Team</a>
                  </li>
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/mission-and-values">Mission & values</a>
                  </li>
                
              </ul>
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/services">Services</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/work">Our work</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/blog">Blog</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/contact">Contact</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        


<div class="post">
  <div class="post__body">
    <header class="post-header">
      <h1 class="post-title">Using XHProf to profile your Drupal module</h1>

      

<p>By <a href="/team/tim-stallmann">Tim Stallmann</a></p>

      <p class="centerdot">&centerdot; </p>
      <p>Jun 16, 2016 </p><br>
      <i class="fa fa-tags"></i><p><a href="/blog/tag/php/">PHP</a>, <a href="/blog/tag/performance/">Performance</a>, <a href="/blog/tag/drupal/">Drupal</a>, <a href="/blog/tag/drupal-planet/">Drupal Planet</a>, <a href="/blog/tag/module-development/">Module Development</a></p>
      
      <div><p><span id="comment-count"></span></p></div>
      
      
    </header>

    

    <article class="post-content">
      <p>This is part 2 of a series on using XHProf for profiling Drupal modules.</p>

<table>
  <tbody>
    <tr>
      <td><a href="/2016/05/26/installing-xhprof.html">Part 1: Installing XHProf</a></td>
      <td><strong>Part 2: Using XHProf</strong></td>
    </tr>
  </tbody>
</table>

<p>After you’ve <a href="/2016/05/26/installing-xhprof.html">installed XHProf</a>, what’s next? How can you make use of its recommendations to tune a module or a website? Unfortunately there are no hard-and-fast rules for optimizing code to run more efficiently. What I can offer here is my own experience trying to optimize a D8 module using XHProf.</p>

<h3 id="understanding-an-xhprof-run-report">Understanding an XHProf run report</h3>

<p>The XHProf GUI displays the result of a given profiler run, or a group of runs. It can even compare 2 runs, but we’ll get to that in a minute. If you followed <a href="/2016/05/26/installing-xhprof.html">my previous post</a>, you should have the <code class="highlighter-rouge">xhprof_html</code> directory symlinked into the root web directory for your Drupal site; so visiting <code class="highlighter-rouge">&lt;my-local-site&gt;/xhprof/</code> should give you a list of all available stored run IDs, and you can click through one of those to view a specific run report.</p>

<p>You can also go directly to a specific run report via the URL <code class="highlighter-rouge">&lt;my-local-site&gt;/xhprof/index.php?run=&lt;run-id&gt;&amp;source=&lt;source-id&gt;</code> (which you should have been logging already via an <code class="highlighter-rouge">echo</code> statement or <code class="highlighter-rouge">dblog</code> if you followed the last post).</p>

<p><img src="/assets/img/blog/xhprof-results-page-screenshot.jpg" alt="Header of an XHProf run report" /></p>

<p>The core of the run report is a table of each function or method which your code called while it was being profiled, along with a set of statistics about that function. This allows you to understand which parts of your code are most resource-intensive, and which are being called frequently in the use case that you’re profiling. Clicking on any one of the column headers will sort the list by that metric. To understand this report, it’s helpful to have some terminology:</p>

<ul>
  <li><strong>Incl. Wall Time</strong> - The total clock time elapsed between when a function call started and when the function exited. Note that this number is not a great basis for comparisons, since it can include other processes which were taking up CPU time on your machine while the PHP code was running, from streaming music in the background to PHPStorm’s code indexing, to random web browsing.</li>
  <li><strong>Incl. CPU Time</strong> - In contrast to wall time, CPU time tracks only the time which the CPU actually spent executing your code (or related system calls). This is a more reliable metric for comparing different runs.</li>
  <li><strong>Excl. Wall/CPU Time</strong> - Exclusive time measurements only count time actually spent within the given method itself. They exclude the time spent in any method/function called <em>from</em> the given function (since that time will be tracked separately).</li>
</ul>

<p>In general, the inclusive metrics (for CPU time and memory usage) will give you a sense of what your expensive methods/functions are – these are the methods or functions that you should avoid calling if possible. In contrast, the exclusive metrics will tell you where you can potentially improve the way a given method/function is implemented. For methods which belong to Drupal Core or other contrib modules, inclusive and exclusive metrics are basically equivalent, since you don’t usually have the option of impacting the implementation details of a function unless you’re working on its code directly. Note also that because your overall parent method and any other high-level methods in your code will <em>always</em> show up at the top of the inclusive time chart, you may have better luck really understanding where your performance hits come from by sorting by exclusive CPU time.</p>

<h3 id="take-a-step-back-and-plan-your-test-scenarios">Take a step back and plan your test scenarios</h3>

<p>Before digging in to optimizing your module code, you need to take a step back and think about the big picture. First, what are you optimizing for? Many optimizations involve a tradeoff between time and memory usage. Are you trying to reduce overall run-time at the expense of more memory? Is keeping the memory footprint of a given function down more important? In order to answer these questions you need to think about the overall context in which your code is running. In my case, I was optimizing a background import module which was run via cron, so the top priority was that the memory usage and number of database optimizations were low enough not to impact the user-facing site performance.</p>

<p>Second, what use case for your code are you profiling? If this is a single method call, what arguments will be passed? If you’re profiling page loads on a website, which pages are you profiling? In order to successfully track whether the changes you’re making are having an impact on the metrics you’re concerned about, you need to be able to narrow down the possible use cases for your code into a handful of most-likely real world scenarios which you’ll actually choose to track via the profiler.</p>

<h3 id="keep-things-organized">Keep things organized</h3>

<p>Now it’s time to get organized. Write a simple test script so that you can easily run through all your use cases in an automated way – this is not strictly necessary, but it will save you a lot of work and potential error as you move through the process. In my case, I was testing a drush command hook, so I just wrote a bash shell script which executed the command three times in each of two different ways. For profiling page loads, I would recommend using <a href="https://jmeter.apache.org/">Apache JMeter</a> - and you’ll need to consider whether you want to force an uncached page load by passing a random dummy query parameter. Ideally, you should be running each scenario a few times so that you can then average the results to account for any small variations in run-time.</p>

<p>Keeping your different runs organized is probably the most important part of successfully profiling module code using XHProf! Each run has a unique run ID, but <strong>you</strong> are solely responsible for knowing which use case scenario and which version of the codebase that run ID corresponds to. I set up a basic spreadsheet in OpenOffice where I could paste in run numbers and basic run stats to compare (but there’s almost certainly a nicer automated way to do this than what I used).</p>

<p><img src="/assets/img/blog/xhprof-results-spreadsheet.jpg" alt="Screenshot of an OpenOffice spreadsheet summarizing XHProf results for various runs" /></p>

<p>Once you have a set of run IDs for a given use case + codebase version, you can generate a <em>composite</em> xhprof report using the query string syntax <code class="highlighter-rouge">http://&lt;your-local-site&gt;/xhprof/index.php?run=&lt;first-run-id&gt;,&lt;second-run-id&gt;,&lt;third-run-id&gt;&amp;source=&lt;source-string&gt;</code> Averaging out across a few runs should give you more <a href="https://en.wikipedia.org/wiki/Accuracy_and_precision">precise</a> measurements for CPU time and memory usage, but beware that if parts of your code involve caching you may want to either throw out the first run’s results in each version of the code base, since that’s where the cache will be generated, or clear the cache between runs.</p>

<p>Go ahead and test your run scripts to make sure that you can get a consistent baseline result at this point – if you’re seeing large differences in average total CPU times or average memory usage across different runs of the same codebase, you likely won’t be able to compare run times across <em>different</em> versions of the code.</p>

<h3 id="actually-getting-to-work">Actually getting to work!</h3>

<p>After all this set-up, you should be ready to experiment and see what the impact of changes in your code base are on the metrics that you want to shift. In my case, the code I was working on used a <a href="https://github.com/squix78/jsonstreamingparser">streaming JSON parser class</a>, and I noticed that one of the top function calls in the inital profiler report was the <code class="highlighter-rouge">consumeChar</code> method of the parser.</p>

<p><img src="/assets/img/blog/xhprof-results-page.jpg" alt="Image of XHProf profiler report with the method consumeChar highlighted in yellow" /></p>

<p>It turns out that the JSON files I was importing were pretty-printed, thus containing more whitespace than they needed to. Sine the <code class="highlighter-rouge">consumeChar</code> method gets called on each incoming character of the input stream, that added up to a lot of unnecessary method calls in the original code. By tweaking the JSON file export code to remove the pretty print flag, I cut down the number of times this method was called from 729,099 to 499,809, saving .2 seconds of run time right off the bat.</p>

<p>That was the major place where the XHProf profiler report gave me insights I would not have had otherwise. The rest of my optimizing experience was mostly testing out some of the common-sense optimizations I had already thought of while looking at the code – caching a table of known Entity IDs rather than querying the DB to check if an entity existed each time, using an associative array and <code class="highlighter-rouge">is_empty()</code> <a href="http://www.w3programmers.com/phps-in_array-function-is-really-slow/">to replace <code class="highlighter-rouge">in_array()</code> calls</a>, cutting down on unnecessary <code class="highlighter-rouge">$entity-&gt;save()</code> operations where possible.</p>

<p>It’s useful to mention that across the board the biggest performance hit in your Drupal code will probably be database calls, so cutting down on those wherever possible will save run-time (sometimes at the expense of memory, if you’re caching large amounts of data). Remember, also, that if DB log is enabled each logging call is a separate database operation, so use the log sparingly – or just log to <code class="highlighter-rouge">syslog</code> and use service like <a href="https://papertrailapp.com/">Papertrail</a> or <a href="https://www.loggly.com/">Loggly</a> on production sites.</p>

<h3 id="the-final-results">The final results</h3>

<p>As the results below show, using XHProf and some thoughtful optimizations I was able to cut total run time significantly in one use case (Case 2) and slightly in another use case (Case 1). Case 1 was already running in a reasonable amount of time, so here I was mostly interested in the Case 2 numbers (assuming I didn’t make anything too much worse).</p>

<p><img src="/assets/img/blog/xhprof-results-graph.jpg" alt="Bar chart comparing the run time of various runs" /></p>

<h3 id="think-of-the-big-picture-part-2">Think of the big picture, part 2</h3>

<p>Remember that controlled experimental metrics are just a means to understanding and improving real-world performance (which you can also measure directly using tools like <a href="https://blackfire.io/">blackfire</a>, but that’s another blog post). In my case, at the end of the day we decided that the most important thing was to ensure that there wasn’t a performance impact on the production site while this background import code was running; so one of the optimizations we actually ended up implementing was to force this code to run <strong>slower</strong> by throttling <code class="highlighter-rouge">$entity-&gt;save()</code> operations to maximally 1 every 1/2 second or so, as a way to minimize the number of requests MySQL was having to respond to from the importer. XHProf is a powerful tool, but don’t lose the forest for the trees when it comes to optimization.</p>

      <hr>

      
        <div class="post-comments">

  
    <div class="expander">
      <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander-hidden">Comments!</a>

      <div id="js-expander-content" class="expander-content">

        <!-- If there are existing comments, output them here. -->
        <div id="post-comments" class="post-comments"></div>

        <!-- New comment form -->
        <form id="comment-form" class="comment-form">
          <h4>Leave a comment</h4>

          <div class="comment-form__field comment-form__field--name">
            <label class="comment-form__field__label" for="name">Name</label>
            <input type="text" name="name" id="name" required>
          </div>

          <div class="comment-form__field comment-form__field--email">
            <label class="comment-form__field__label" for="email">Email</label>
            <input type="email" name="email" id="email" required>
            <p class="comment-form__field__helptext">Savas Labs will never sell your email address or spam you.</p>
          </div>

          <div class="comment-form__field comment-form__field--comment">
            <label class="comment-form__field__label" for="comment">Comment</label>
            <textarea name="comment" id="comment" required></textarea>
            <p class="comment-form__field__helptext">Plain text format only please.</p>
          </div>

          <input type="hidden" name="slug" id="slug" value="/2016/06/16/using-xhprof.html">
          <input type="text" name="url" id="url">

          <div class="comment-form__field comment-form__field--nocaptcha">
            <div class="comment-form__field--nocaptcha__image">
              <img src="/assets/img/icons-and-logos/owl.png" alt="Savas Labs logo">
            </div>
            <div class="comment-form__field--nocaptcha__input">
              <label class="comment-form__field__label" for="nocaptcha">What type of animal is the Savas Labs logo?</label>
              <p class="comment-form__field__helptext">Hint: 3 letters long, starts with an "o" and ends with an "l".</p>
              <input type="text" name="nocaptcha" id="nocaptcha" required>
            </div>
          </div>

          <input type="submit" value="Post comment" id="submit" class="comment-form__submit">
        </form>

      </div><!-- comments and comment form -->
    </div><!-- expander -->
  
  <hr>
</div>

      
    </article>
  </div><!-- post__body -->

  
    <div class="post-bottom">
  <div class="post-meta">

    
    
    
    
    

    
      <h4>About the author</h4>
    

    

      
      
        <a href="/team/tim-stallmann">
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/tim-stallmann-576by509-576790.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-576790.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/tim-stallmann-288by254-576790.jpg" class="image--team-post-meta" itemprop="image" alt="Tim Stallmann" >
  </picture>

        </a>
        <p class="post-author-desc">Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.</p>
      

      
      

    
  </div>

  
  <div class="post-related flex-container">
    <h4>Recent posts by Savas Labs</h4>
    <div class="cards">
      
      
        
        
          <div class="card">
            <a href="/2017/02/20/drupal-docker-pattern-lab.html">
              <div class="card-header">
                Docker and the Drupal Pattern Lab Starter Theme
              </div>
              <div class="card-copy">
                <p>Feb 20, 2017</p>
                
                <p><p>This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern...</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2017/02/15/docker-mysql-performance.html">
              <div class="card-header">
                Dramatically Improve MySQL Import Performance with Docker
              </div>
              <div class="card-copy">
                <p>Feb 15, 2017</p>
                
                <p><p>How to dramatically improve MySQL database import performance on Drupal with Docker stacks</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2016/11/15/composer-mailchimp-subscriptions-v3-api.html">
              <div class="card-header">
                Using MailChimp API v3.0 to subscribe users to email lists in Drupal custom modules
              </div>
              <div class="card-copy">
                <p>Nov 15, 2016</p>
                
                <p><p>How to use Composer along with the ThinkShout PHP library for MailChimp API v3.0 to easily subscribe users to mailing...</p>
              </div>
            </a>
          </div>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
</div>

  

  <div class="previous-next-links">
  <div class="next">
    
      <a href="/2016/06/22/user-testing.html"><i class="fa fa-long-arrow-left "></i> Usability Testing - Our Process and Favorite Practices</a>
    
  </div>
  <div class="previous">
    
      <a href="/2016/06/15/git-merge-conflict-strategies.html"> Strategies and tools for resolving Git merge conflicts <i class="fa fa-long-arrow-right"></i></a>
    
  </div>
</div>

</div><!-- post -->

      </div>
    </div>

    
    
      <div class="contact-block">
  <div class="contact-block__items">
    <h3>Interested in working with us?</h3>
    <a href="/contact">Get in touch!</a>
  </div>
</div>
    

    <footer class="footer" role="contentinfo">
  <div class="footer-links">
    <ul>
      <li><h3>Location</h3></li>
      <li>Savas Labs<br />
          PMB 210<br />
          201 W Main Street, Suite 100<br />
          Durham, NC 27701<br /></li>
    </ul>
    <ul>
      <li><h3>Around the Web</h3></li>
      <ul>
        <li><a href="https://github.com/savaslabs"><span class="fa fa-github fa-lg fa-2x"></span></a></li>
        <li><a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a></li>
        <li><a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a></li>
        <li><a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a></li>
      </ul>
    </ul>
    <ul>
      <li><h3>Contact</h3></li>
      <li><a href="mailto:info@savaslabs.com">info@savaslabs.com</a></li>
      <li>(919) 432-4660</li>
    </ul>
  </div>

</footer>

<div class="footer-copyright">
  <p>Copyright &copy; Savas Labs 2017</p>
</div>

    <script type="text/javascript" src="http://savaslabs.com/assets/js/main.js" async></script>

<noscript>
  <link href='/assets/styles/main.css' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Source+Sans+Pro' rel='stylesheet' type='text/css'>
</noscript>

  </body>

</html>
