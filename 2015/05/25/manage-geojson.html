<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Managing GeoJSON data using GDAL | Savas Labs</title>
  
  <meta name="description" content="In my last tutorial, we used USGS earthquake data to make a simple web map using leaflet. Today, we’ll explore how to use GDAL tools to explore and manipulat...">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Bitter|Source+Sans+Pro' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/styles/main.css">
  <link rel="stylesheet" href="/assets/icons/octicons/octicons.css">
  <link rel="canonical" href="/2015/05/25/manage-geojson.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="/feed.xml" />
  <script type="text/javascript" src="/assets/js/main.js"></script>
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Durham, North Carolina",
        "postalCode": "27701",
        "streetAddress": "201 W Main St."
      },
      "description": "A full-service web agency leveraging the power of Drupal.
",
      "email": "info@savaslabs.com",
      "name": "Savas",
      "telephone": "(919) 432-4660",
      "url": "http://savaslabs.com",
      "logo": "http://savaslabs.com/assets/img/logo.png"
    }
</script>

  
  
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Managing GeoJSON data using GDAL",
    "about": "Sometimes the data you want isn't exactly the data you have. This post examines how to clean, filter and convert data using free and open-source tools.",
    "articleBody": "


&lt;div class=&quot;post&quot;&gt;
  &lt;header class=&quot;post-header&quot;&gt;
    &lt;h1 class=&quot;post-title&quot;&gt;Managing GeoJSON data using GDAL&lt;/h1&gt;
    &lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;
    &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
    &lt;p&gt;May 25, 2015 &lt;/p&gt;&lt;br&gt;
    &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/cartography/&quot;&gt;Cartography&lt;/a&gt;, &lt;a href=&quot;/blog/tag/leaflet/&quot;&gt;Leaflet.js&lt;/a&gt;&lt;/p&gt;
    
    &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    
  &lt;/header&gt;

  

  &lt;article class=&quot;post-content&quot;&gt;
    &lt;p&gt;In my &lt;a href=&quot;/2015/05/18/mapping-geojson.html&quot;&gt;last tutorial&lt;/a&gt;, we used USGS earthquake data to make a simple web map using leaflet. Today, we’ll explore how to use GDAL tools to explore and manipulate GeoJSON data.
Why might this be useful?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Removing un-needed properties to optimize filesize&lt;/li&gt;
  &lt;li&gt;Filtering data by location for mapping purposes&lt;/li&gt;
  &lt;li&gt;Cleaning data by removing invalid features&lt;/li&gt;
  &lt;li&gt;Converting other geo-data formats into GeoJSON, or vice versa.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;installing-gdal-and-downloading-sample-data&quot;&gt;Installing GDAL and Downloading Sample Data&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.gdal.org&quot;&gt;GDAL (Geospatial Data Abstraction Library)&lt;/a&gt; is a free and open-source translator library for both raster and vector data formats. It provides a number of core functionalities for data processing and conversion which are used across the suite of &lt;a href=&quot;http://www.osgeo.org&quot;&gt;OSGeo applications&lt;/a&gt;. More importantly for our purposes, GDAL provides a bunch of command-line tools for processing geospatial data.&lt;/p&gt;

&lt;p&gt;If you’re on a Mac and using homebrew, you can easily install GDAL by running &lt;code class=&quot;highlighter-rouge&quot;&gt;brew install gdal&lt;/code&gt; from the command line. Otherwise, you can download &lt;a href=&quot;http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries&quot;&gt;binaries from GDAL&lt;/a&gt; or &lt;a href=&quot;http://trac.osgeo.org/gdal/wiki/BuildHints&quot;&gt;compile the source code yourself&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Just like the last tutorial, we’re going to be using the USGS earthquake data. Navigate to &lt;a href=&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson&quot;&gt;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson&lt;/a&gt;, and save the resulting file to your computer as a &lt;code class=&quot;highlighter-rouge&quot;&gt;.geojson&lt;/code&gt; file.&lt;/p&gt;

&lt;h2 id=&quot;using-ogrinfo-to-look-inside-your-dataset&quot;&gt;Using OGRInfo to look inside your dataset&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.gdal.org/ogrinfo.html&quot;&gt;OGRInfo&lt;/a&gt; lets us look inside geospatial datasets, viewing both summary info and lists of individual features. It’s useful to see what attributes are available for a given dataset or how many features it contains, as well as testing out attribute filters and examining individual features.&lt;/p&gt;

&lt;p&gt;Let’s try some basic commands. Just running ogrinfo on a dataset will give you a list of all the layers it contains. In the case of GeoJSON, this is usually just a single layer.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.
Had to open data source read-only.
INFO: Open of `all_month.geojson&#39;&lt;/span&gt;
      using driver &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;GeoJSON&lt;span class=&quot;s1&quot;&gt;&#39; successful.
1: OGRGeoJSON (3D Point)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;That’s not very helpful, so let’s try peeking inside the (only) layer. ogrinfo syntax has you pass the layer name as the second argument. By default, it will print every feature in this dataset (7.5 Mb worth!) to the console, so instead let’s add the &lt;code class=&quot;highlighter-rouge&quot;&gt;-so&lt;/code&gt; argument, which displays a summary of the layer. Note that the GeoJSON driver for OGR has assigned the layer name &lt;code class=&quot;highlighter-rouge&quot;&gt;OGRGeoJSON&lt;/code&gt;, which we’re passing in:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson OGRGeoJSON -so
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.
Had to open data source read-only.
INFO: Open of `all_month.geojson&#39;&lt;/span&gt;
      using driver &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;GeoJSON&lt;span class=&quot;s1&quot;&gt;&#39; successful.

Layer name: OGRGeoJSON
Geometry: 3D Point
Feature Count: 10082
Extent: (-179.924400, -62.035900) - (179.989800, 68.959900)
Layer SRS WKT:
GEOGCS[&quot;WGS 84&quot;,
    DATUM[&quot;WGS_1984&quot;,
        SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,
            AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],
        AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],
    PRIMEM[&quot;Greenwich&quot;,0,
        AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],
    UNIT[&quot;degree&quot;,0.0174532925199433,
        AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],
    AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]
mag: Real (0.0)
place: String (0.0)
...
magType: String (0.0)
type: String (0.0)
title: String (0.0)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now this is getting somewhere! We’ve got info about the number of features, the extent of the data (apparently there aren’t earthquakes at the poles, or USGS isn’t monitoring them), the coordinate system of the data, and a full list of attributes.&lt;/p&gt;

&lt;p&gt;What might that &lt;code class=&quot;highlighter-rouge&quot;&gt;type&lt;/code&gt; attribute be telling us? We can use ogrinfo to run basic SQL queries on the data as well, for example:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT DISTINCT type FROM OGRGeoJSON -q&quot;&lt;/span&gt;
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.

Layer name: OGRGeoJSON
OGRFeature(OGRGeoJSON):0
  type (String) = earthquake

OGRFeature(OGRGeoJSON):1
  type (String) = quarry blast

...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Note: I’m using the &lt;code class=&quot;highlighter-rouge&quot;&gt;-q&lt;/code&gt; flag to suppress some of the more verbose output. Also, ogrinfo unfortunately doesn’t support &lt;code class=&quot;highlighter-rouge&quot;&gt;GROUP BY&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;LIMIT&lt;/code&gt; clauses on SQL queries for GeoJSON files.&lt;/p&gt;

&lt;p&gt;We can also use this to answer some basic questions about the data. Like, how many earthquakes were recorded with magnitude of 5 or greater?&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT COUNT(*) FROM OGRGeoJSON WHERE mag&amp;gt;=5&quot;&lt;/span&gt; -q
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.

Layer name: OGRGeoJSON
OGRFeature(OGRGeoJSON):0
  COUNT_* (Integer) = 176
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;optimizing-your-data&quot;&gt;Optimizing your data&lt;/h2&gt;

&lt;p&gt;Check the filesize of the &lt;code class=&quot;highlighter-rouge&quot;&gt;all_month.geojson&lt;/code&gt; file you downloaded. It probably weighs in at around 7-8 Mb, which is really unwieldy for a client to download before viewing a web map. Can we trim the file down a bit?&lt;/p&gt;

&lt;p&gt;First pass: if you remember the output from &lt;code class=&quot;highlighter-rouge&quot;&gt;ogrinfo -so&lt;/code&gt;, you’ll remember that there are a &lt;em&gt;lot&lt;/em&gt; of attributes in this data-set! For a web map, we usually just use a few attributes to populate pop-up text. In this case, we’re just going to use the place, mag, and url properties.&lt;/p&gt;

&lt;p&gt;Ogr2Ogr is another tool designed for converting to and from a variety of geospatial data formats, but it also allows us to filter the data as we’re copying it and only copy over specific attributes. So we can use it to “convert” the dataset from GeoJSON into a new GeoJSON with fewer columns.&lt;/p&gt;

&lt;p&gt;The basic syntax is:
&lt;code class=&quot;highlighter-rouge&quot;&gt;ogr2ogr -f &quot;Output format specifier&quot; output_filename input_filename&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We want to cherry-pick only a few attribute fields, which we can to using the &lt;code class=&quot;highlighter-rouge&quot;&gt;-select&lt;/code&gt; flag:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_optimized.geojson all_month.geojson -select mag,place,url
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;If you look at the filesize on the new geojson we just created, you’ll see we managed to strip it down to a much smaller 2-3 Mb.&lt;/p&gt;

&lt;p&gt;ogr2ogr also accepts the &lt;code class=&quot;highlighter-rouge&quot;&gt;-sql&lt;/code&gt; flag, so we could also have written:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_optimized.geojson all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT mag,place,url FROM OGRGeoJSON&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;filtering-data-by-attributes&quot;&gt;Filtering data by attributes&lt;/h2&gt;

&lt;p&gt;With this syntax, it’s easy to select out a subset of the features (since who will really be able to navigate 10,000+ points if we were to map the full dataset, anyway?):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_mag_over_5.geojson all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT mag,place,url FROM OGRGeoJSON WHERE mag&amp;gt;=5&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now we’re just down to 44 kb, a totally reasonable size for mapping.&lt;/p&gt;

&lt;p&gt;Here’s what the dataset we just made looks like (via &lt;a href=&quot;http://geojson.io&quot;&gt;geojson.io&lt;/a&gt;):
&lt;img src=&quot;/assets/img/blog/earthquakes-mag-5-geojson-io.jpg&quot; width=&quot;500px&quot; height=&quot;250px&quot; alt=&quot;Screenshot of GeoJSON.io map showing earthquakes distributed across the world&quot; class=&quot;blog-image-large&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;filtering-by-location&quot;&gt;Filtering by location&lt;/h2&gt;

&lt;p&gt;What if we just want to map earthquakes that have taken place in a specific area?&lt;/p&gt;

&lt;p&gt;The simplest way to approach this it to filter the data by a bounding box – a rectangular area defined by latitude and longitude coordinates. &lt;a href=&quot;http://geojson.io&quot;&gt;Geojson.io&lt;/a&gt; has a rectangle-drawing tool which will give you latitude and longitude coordinates of the corners pretty easily. I tried drawing a rectangle over the rough area of the US East of the Mississippi, and passed those arguments into ogr2ogr’s &lt;code class=&quot;highlighter-rouge&quot;&gt;-clipsrc xmin ymin xmax ymax&lt;/code&gt; argument (that’s South-East corner longitude, SE corner latitude, NW longitude, NW latitude):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_us_east.geojson all_month.geojson -clipsrc -86.835 24.206 -69.609 46.800
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here’s the result. Florida turns out to be a good place to live if you want to avoid minor tremors! Also notice that because of using a simple latitude-longitude rectangle to filter the data, we also pulled in those parts of Canada which are south of Maine.
&lt;img src=&quot;/assets/img/blog/earthquakes-us-east-geojson-io.jpg&quot; width=&quot;400px&quot; height=&quot;400px&quot; alt=&quot;Screenshot of GeoJSON.io map showing earthquakes in the past month in the United States, with one point in Canada&quot; class=&quot;blog-image-large&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;filtering-by-location-2-clipping-to-another-dataset&quot;&gt;Filtering by location 2: Clipping to another dataset&lt;/h2&gt;

&lt;p&gt;But what if we want all the earthquakes in, say, North Dakota? For more complicated area queries, we’ll have to supply the clipping area as a separate datasource.&lt;/p&gt;

&lt;p&gt;We can download a shapefile of all 50 US States from the Census Bureau, then select out North Dakota and pass that as a clipping argument to ogr2ogr. First, download the &lt;code class=&quot;highlighter-rouge&quot;&gt;tl_2014_us_state.zip&lt;/code&gt; file from the &lt;a href=&quot;ftp://ftp2.census.gov/geo/tiger/TIGER2014/STATE/&quot;&gt;Census Bureau FTP site&lt;/a&gt;, and unzip it to the same directory as your geojson file.&lt;/p&gt;

&lt;p&gt;Let’s use ogrinfo to examine this file and see how we could select out North Dakota&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo tl_2014_us_state.shp tl_2014_us_state -so
INFO: Open of &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;tl_2014_us_state.shp&lt;span class=&quot;s1&quot;&gt;&#39;
      using driver `ESRI Shapefile&#39;&lt;/span&gt; successful.

Layer name: tl_2014_us_state
Geometry: Polygon
Feature Count: 56
Extent: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;-179.231086, -14.601813&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;179.859681, 71.441059&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Layer SRS WKT:
GEOGCS[&lt;span class=&quot;s2&quot;&gt;&quot;GCS_North_American_1983&quot;&lt;/span&gt;,
    DATUM[&lt;span class=&quot;s2&quot;&gt;&quot;North_American_Datum_1983&quot;&lt;/span&gt;,
        SPHEROID[&lt;span class=&quot;s2&quot;&gt;&quot;GRS_1980&quot;&lt;/span&gt;,6378137,298.257222101]],
    PRIMEM[&lt;span class=&quot;s2&quot;&gt;&quot;Greenwich&quot;&lt;/span&gt;,0],
    UNIT[&lt;span class=&quot;s2&quot;&gt;&quot;Degree&quot;&lt;/span&gt;,0.017453292519943295]]
REGION: String &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
...
NAME: String &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;100.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Looks like we can just select by name. Try it first in ogrinfo:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo tl_2014_us_state.shp -SQL &lt;span class=&quot;s2&quot;&gt;&quot;SELECT * FROM tl_2014_us_state WHERE NAME=&#39;Georgia&#39;&quot;&lt;/span&gt; -GEOM&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO
INFO: Open of &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;tl_2014_us_state.shp&lt;span class=&quot;s1&quot;&gt;&#39;
      using driver `ESRI Shapefile&#39;&lt;/span&gt; successful.

Layer name: tl_2014_us_state
Geometry: Polygon
Feature Count: 1
Extent: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;-179.231086, -14.601813&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;179.859681, 71.441059&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;That worked, so now we can format the whole ogr2ogr string, using &lt;code class=&quot;highlighter-rouge&quot;&gt;-clipsrc&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;-clipsrcsql&lt;/code&gt; options. Note that because we’re using a very detailed shapefile for the state outlines, this command takes a long time to process. On my MacBook Pro it clocks in at around 3 minutes.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_georgia.geojson all_month.geojson -clipsrc tl_2014_us_state.shp -clipsrcsql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT * FROM tl_2014_us_state WHERE NAME=&#39;Georgia&#39;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And here’s the GeoJSON dataset we just created, viewed on geojson.io – all two earthquakes in Georgia last month!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/earthquakes-georgia-geojson-io.jpg&quot; width=&quot;500px&quot; height=&quot;164px&quot; alt=&quot;Screenshot of GeoJSON.io map showing two earthquakes in Georgia&quot; class=&quot;blog-image-large&quot; /&gt;&lt;/p&gt;

    &lt;hr&gt;

    
      &lt;div class=&quot;post-comments&quot;&gt;
  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;
      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;
        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;
        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;
          &lt;div class=&quot;comment-name&quot;&gt;
            &lt;p&gt;Name&lt;/p&gt; &lt;input type=&#39;text&#39; name=&#39;name&#39; id=&#39;name&#39; required /&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-email&quot;&gt;
            &lt;p&gt;Email&lt;/p&gt; &lt;input type=&#39;email&#39; name=&#39;email&#39; id=&#39;email&#39; required /&gt;
            &lt;p class=&quot;email-disclaimer&quot;&gt;Savas will never sell your email address or spam you.&lt;/p&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;p&gt;Comment&lt;/p&gt;
          &lt;textarea name=&#39;comment&#39; id=&#39;comment&#39; required&gt;&lt;/textarea&gt;
          &lt;p class=&quot;hint below-textarea&quot;&gt;Plain text format only please.&lt;/p&gt;

          &lt;input type=&#39;hidden&#39; name=&#39;slug&#39; id=&#39;slug&#39; value=&#39;/2015/05/25/manage-geojson.html&#39; /&gt;
          &lt;input type=&#39;text&#39; name=&#39;url&#39; id=&#39;url&#39; /&gt;

          &lt;div class=&#39;are-you-human&#39;&gt;
            &lt;div class=&#39;are-you-human-owl&#39;&gt;
              &lt;img src=&quot;/assets/img/owl.png&quot; alt=&quot;Savas logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&#39;are-you-human-field&#39;&gt;
              &lt;p&gt;What type of animal is the Savas logo?&lt;/p&gt;
              &lt;input type=&#39;text&#39; name=&#39;nocaptcha&#39; id=&#39;nocaptcha&#39; class=&#39;nocaptcha&#39;&gt;
              &lt;p class=&quot;hint&quot;&gt;Hint: 3 letters long, starts with an &#39;o&#39; and ends with an &#39;l&#39;.&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&#39;submit&#39; value=&#39;Submit&#39; id=&#39;submit&#39; class=&quot;submit-comment&quot;/&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

    
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;
    &lt;h4&gt;About the author&lt;/h4&gt;
    
      &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
        &lt;img src=&quot;/assets/img/team/tim-stallmann.jpg&quot; alt=&quot;Tim Stallmann&quot;&gt;
      &lt;/a&gt;
      &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
    
  &lt;/div&gt;
    &lt;!-- Once we have more content, change this to posts related by tag --&gt;
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Usability Testing - Our Process and Favorite Practices
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 22, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;Our approach to designing, conducting, and learning from user testing and other analyses.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/16/using-xhprof.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Using XHProf to profile your Drupal module
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 16, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;A case study of using XHProf to profile a Drupal module.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Strategies and tools for resolving Git merge conflicts
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 15, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;An overview of strategies and tools I like to use when I encounter conflicts during merges.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

    &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2015/06/10/d8-theming-basics.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Drupal 8 Theming Basics&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2015/05/22/durham-living-wage.html&quot;&gt; A Durham Living Wage &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;


  &lt;/article&gt;

&lt;/div&gt;
",
      "author": {
          "@context": "http://schema.org",
          "@type": "Person",
          "name": "Tim Stallmann",
          "affiliation": "Savas",
          "worksFor": "Savas"
      },
    "keywords": "cartography, leaflet",
    "text": "


&lt;div class=&quot;post&quot;&gt;
  &lt;header class=&quot;post-header&quot;&gt;
    &lt;h1 class=&quot;post-title&quot;&gt;Managing GeoJSON data using GDAL&lt;/h1&gt;
    &lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;
    &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
    &lt;p&gt;May 25, 2015 &lt;/p&gt;&lt;br&gt;
    &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/cartography/&quot;&gt;Cartography&lt;/a&gt;, &lt;a href=&quot;/blog/tag/leaflet/&quot;&gt;Leaflet.js&lt;/a&gt;&lt;/p&gt;
    
    &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    
  &lt;/header&gt;

  

  &lt;article class=&quot;post-content&quot;&gt;
    &lt;p&gt;In my &lt;a href=&quot;/2015/05/18/mapping-geojson.html&quot;&gt;last tutorial&lt;/a&gt;, we used USGS earthquake data to make a simple web map using leaflet. Today, we’ll explore how to use GDAL tools to explore and manipulate GeoJSON data.
Why might this be useful?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Removing un-needed properties to optimize filesize&lt;/li&gt;
  &lt;li&gt;Filtering data by location for mapping purposes&lt;/li&gt;
  &lt;li&gt;Cleaning data by removing invalid features&lt;/li&gt;
  &lt;li&gt;Converting other geo-data formats into GeoJSON, or vice versa.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;installing-gdal-and-downloading-sample-data&quot;&gt;Installing GDAL and Downloading Sample Data&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.gdal.org&quot;&gt;GDAL (Geospatial Data Abstraction Library)&lt;/a&gt; is a free and open-source translator library for both raster and vector data formats. It provides a number of core functionalities for data processing and conversion which are used across the suite of &lt;a href=&quot;http://www.osgeo.org&quot;&gt;OSGeo applications&lt;/a&gt;. More importantly for our purposes, GDAL provides a bunch of command-line tools for processing geospatial data.&lt;/p&gt;

&lt;p&gt;If you’re on a Mac and using homebrew, you can easily install GDAL by running &lt;code class=&quot;highlighter-rouge&quot;&gt;brew install gdal&lt;/code&gt; from the command line. Otherwise, you can download &lt;a href=&quot;http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries&quot;&gt;binaries from GDAL&lt;/a&gt; or &lt;a href=&quot;http://trac.osgeo.org/gdal/wiki/BuildHints&quot;&gt;compile the source code yourself&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Just like the last tutorial, we’re going to be using the USGS earthquake data. Navigate to &lt;a href=&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson&quot;&gt;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson&lt;/a&gt;, and save the resulting file to your computer as a &lt;code class=&quot;highlighter-rouge&quot;&gt;.geojson&lt;/code&gt; file.&lt;/p&gt;

&lt;h2 id=&quot;using-ogrinfo-to-look-inside-your-dataset&quot;&gt;Using OGRInfo to look inside your dataset&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.gdal.org/ogrinfo.html&quot;&gt;OGRInfo&lt;/a&gt; lets us look inside geospatial datasets, viewing both summary info and lists of individual features. It’s useful to see what attributes are available for a given dataset or how many features it contains, as well as testing out attribute filters and examining individual features.&lt;/p&gt;

&lt;p&gt;Let’s try some basic commands. Just running ogrinfo on a dataset will give you a list of all the layers it contains. In the case of GeoJSON, this is usually just a single layer.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.
Had to open data source read-only.
INFO: Open of `all_month.geojson&#39;&lt;/span&gt;
      using driver &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;GeoJSON&lt;span class=&quot;s1&quot;&gt;&#39; successful.
1: OGRGeoJSON (3D Point)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;That’s not very helpful, so let’s try peeking inside the (only) layer. ogrinfo syntax has you pass the layer name as the second argument. By default, it will print every feature in this dataset (7.5 Mb worth!) to the console, so instead let’s add the &lt;code class=&quot;highlighter-rouge&quot;&gt;-so&lt;/code&gt; argument, which displays a summary of the layer. Note that the GeoJSON driver for OGR has assigned the layer name &lt;code class=&quot;highlighter-rouge&quot;&gt;OGRGeoJSON&lt;/code&gt;, which we’re passing in:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson OGRGeoJSON -so
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.
Had to open data source read-only.
INFO: Open of `all_month.geojson&#39;&lt;/span&gt;
      using driver &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;GeoJSON&lt;span class=&quot;s1&quot;&gt;&#39; successful.

Layer name: OGRGeoJSON
Geometry: 3D Point
Feature Count: 10082
Extent: (-179.924400, -62.035900) - (179.989800, 68.959900)
Layer SRS WKT:
GEOGCS[&quot;WGS 84&quot;,
    DATUM[&quot;WGS_1984&quot;,
        SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,
            AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],
        AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],
    PRIMEM[&quot;Greenwich&quot;,0,
        AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],
    UNIT[&quot;degree&quot;,0.0174532925199433,
        AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],
    AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]
mag: Real (0.0)
place: String (0.0)
...
magType: String (0.0)
type: String (0.0)
title: String (0.0)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now this is getting somewhere! We’ve got info about the number of features, the extent of the data (apparently there aren’t earthquakes at the poles, or USGS isn’t monitoring them), the coordinate system of the data, and a full list of attributes.&lt;/p&gt;

&lt;p&gt;What might that &lt;code class=&quot;highlighter-rouge&quot;&gt;type&lt;/code&gt; attribute be telling us? We can use ogrinfo to run basic SQL queries on the data as well, for example:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT DISTINCT type FROM OGRGeoJSON -q&quot;&lt;/span&gt;
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.

Layer name: OGRGeoJSON
OGRFeature(OGRGeoJSON):0
  type (String) = earthquake

OGRFeature(OGRGeoJSON):1
  type (String) = quarry blast

...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Note: I’m using the &lt;code class=&quot;highlighter-rouge&quot;&gt;-q&lt;/code&gt; flag to suppress some of the more verbose output. Also, ogrinfo unfortunately doesn’t support &lt;code class=&quot;highlighter-rouge&quot;&gt;GROUP BY&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;LIMIT&lt;/code&gt; clauses on SQL queries for GeoJSON files.&lt;/p&gt;

&lt;p&gt;We can also use this to answer some basic questions about the data. Like, how many earthquakes were recorded with magnitude of 5 or greater?&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT COUNT(*) FROM OGRGeoJSON WHERE mag&amp;gt;=5&quot;&lt;/span&gt; -q
ERROR 4: GeoJSON Driver doesn&lt;span class=&quot;s1&quot;&gt;&#39;t support update.

Layer name: OGRGeoJSON
OGRFeature(OGRGeoJSON):0
  COUNT_* (Integer) = 176
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;optimizing-your-data&quot;&gt;Optimizing your data&lt;/h2&gt;

&lt;p&gt;Check the filesize of the &lt;code class=&quot;highlighter-rouge&quot;&gt;all_month.geojson&lt;/code&gt; file you downloaded. It probably weighs in at around 7-8 Mb, which is really unwieldy for a client to download before viewing a web map. Can we trim the file down a bit?&lt;/p&gt;

&lt;p&gt;First pass: if you remember the output from &lt;code class=&quot;highlighter-rouge&quot;&gt;ogrinfo -so&lt;/code&gt;, you’ll remember that there are a &lt;em&gt;lot&lt;/em&gt; of attributes in this data-set! For a web map, we usually just use a few attributes to populate pop-up text. In this case, we’re just going to use the place, mag, and url properties.&lt;/p&gt;

&lt;p&gt;Ogr2Ogr is another tool designed for converting to and from a variety of geospatial data formats, but it also allows us to filter the data as we’re copying it and only copy over specific attributes. So we can use it to “convert” the dataset from GeoJSON into a new GeoJSON with fewer columns.&lt;/p&gt;

&lt;p&gt;The basic syntax is:
&lt;code class=&quot;highlighter-rouge&quot;&gt;ogr2ogr -f &quot;Output format specifier&quot; output_filename input_filename&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We want to cherry-pick only a few attribute fields, which we can to using the &lt;code class=&quot;highlighter-rouge&quot;&gt;-select&lt;/code&gt; flag:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_optimized.geojson all_month.geojson -select mag,place,url
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;If you look at the filesize on the new geojson we just created, you’ll see we managed to strip it down to a much smaller 2-3 Mb.&lt;/p&gt;

&lt;p&gt;ogr2ogr also accepts the &lt;code class=&quot;highlighter-rouge&quot;&gt;-sql&lt;/code&gt; flag, so we could also have written:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_optimized.geojson all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT mag,place,url FROM OGRGeoJSON&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;filtering-data-by-attributes&quot;&gt;Filtering data by attributes&lt;/h2&gt;

&lt;p&gt;With this syntax, it’s easy to select out a subset of the features (since who will really be able to navigate 10,000+ points if we were to map the full dataset, anyway?):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_mag_over_5.geojson all_month.geojson -sql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT mag,place,url FROM OGRGeoJSON WHERE mag&amp;gt;=5&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now we’re just down to 44 kb, a totally reasonable size for mapping.&lt;/p&gt;

&lt;p&gt;Here’s what the dataset we just made looks like (via &lt;a href=&quot;http://geojson.io&quot;&gt;geojson.io&lt;/a&gt;):
&lt;img src=&quot;/assets/img/blog/earthquakes-mag-5-geojson-io.jpg&quot; width=&quot;500px&quot; height=&quot;250px&quot; alt=&quot;Screenshot of GeoJSON.io map showing earthquakes distributed across the world&quot; class=&quot;blog-image-large&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;filtering-by-location&quot;&gt;Filtering by location&lt;/h2&gt;

&lt;p&gt;What if we just want to map earthquakes that have taken place in a specific area?&lt;/p&gt;

&lt;p&gt;The simplest way to approach this it to filter the data by a bounding box – a rectangular area defined by latitude and longitude coordinates. &lt;a href=&quot;http://geojson.io&quot;&gt;Geojson.io&lt;/a&gt; has a rectangle-drawing tool which will give you latitude and longitude coordinates of the corners pretty easily. I tried drawing a rectangle over the rough area of the US East of the Mississippi, and passed those arguments into ogr2ogr’s &lt;code class=&quot;highlighter-rouge&quot;&gt;-clipsrc xmin ymin xmax ymax&lt;/code&gt; argument (that’s South-East corner longitude, SE corner latitude, NW longitude, NW latitude):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_us_east.geojson all_month.geojson -clipsrc -86.835 24.206 -69.609 46.800
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here’s the result. Florida turns out to be a good place to live if you want to avoid minor tremors! Also notice that because of using a simple latitude-longitude rectangle to filter the data, we also pulled in those parts of Canada which are south of Maine.
&lt;img src=&quot;/assets/img/blog/earthquakes-us-east-geojson-io.jpg&quot; width=&quot;400px&quot; height=&quot;400px&quot; alt=&quot;Screenshot of GeoJSON.io map showing earthquakes in the past month in the United States, with one point in Canada&quot; class=&quot;blog-image-large&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;filtering-by-location-2-clipping-to-another-dataset&quot;&gt;Filtering by location 2: Clipping to another dataset&lt;/h2&gt;

&lt;p&gt;But what if we want all the earthquakes in, say, North Dakota? For more complicated area queries, we’ll have to supply the clipping area as a separate datasource.&lt;/p&gt;

&lt;p&gt;We can download a shapefile of all 50 US States from the Census Bureau, then select out North Dakota and pass that as a clipping argument to ogr2ogr. First, download the &lt;code class=&quot;highlighter-rouge&quot;&gt;tl_2014_us_state.zip&lt;/code&gt; file from the &lt;a href=&quot;ftp://ftp2.census.gov/geo/tiger/TIGER2014/STATE/&quot;&gt;Census Bureau FTP site&lt;/a&gt;, and unzip it to the same directory as your geojson file.&lt;/p&gt;

&lt;p&gt;Let’s use ogrinfo to examine this file and see how we could select out North Dakota&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo tl_2014_us_state.shp tl_2014_us_state -so
INFO: Open of &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;tl_2014_us_state.shp&lt;span class=&quot;s1&quot;&gt;&#39;
      using driver `ESRI Shapefile&#39;&lt;/span&gt; successful.

Layer name: tl_2014_us_state
Geometry: Polygon
Feature Count: 56
Extent: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;-179.231086, -14.601813&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;179.859681, 71.441059&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Layer SRS WKT:
GEOGCS[&lt;span class=&quot;s2&quot;&gt;&quot;GCS_North_American_1983&quot;&lt;/span&gt;,
    DATUM[&lt;span class=&quot;s2&quot;&gt;&quot;North_American_Datum_1983&quot;&lt;/span&gt;,
        SPHEROID[&lt;span class=&quot;s2&quot;&gt;&quot;GRS_1980&quot;&lt;/span&gt;,6378137,298.257222101]],
    PRIMEM[&lt;span class=&quot;s2&quot;&gt;&quot;Greenwich&quot;&lt;/span&gt;,0],
    UNIT[&lt;span class=&quot;s2&quot;&gt;&quot;Degree&quot;&lt;/span&gt;,0.017453292519943295]]
REGION: String &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
...
NAME: String &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;100.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Looks like we can just select by name. Try it first in ogrinfo:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogrinfo tl_2014_us_state.shp -SQL &lt;span class=&quot;s2&quot;&gt;&quot;SELECT * FROM tl_2014_us_state WHERE NAME=&#39;Georgia&#39;&quot;&lt;/span&gt; -GEOM&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO
INFO: Open of &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;tl_2014_us_state.shp&lt;span class=&quot;s1&quot;&gt;&#39;
      using driver `ESRI Shapefile&#39;&lt;/span&gt; successful.

Layer name: tl_2014_us_state
Geometry: Polygon
Feature Count: 1
Extent: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;-179.231086, -14.601813&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;179.859681, 71.441059&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;That worked, so now we can format the whole ogr2ogr string, using &lt;code class=&quot;highlighter-rouge&quot;&gt;-clipsrc&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;-clipsrcsql&lt;/code&gt; options. Note that because we’re using a very detailed shapefile for the state outlines, this command takes a long time to process. On my MacBook Pro it clocks in at around 3 minutes.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ogr2ogr -f GeoJSON all_month_georgia.geojson all_month.geojson -clipsrc tl_2014_us_state.shp -clipsrcsql &lt;span class=&quot;s2&quot;&gt;&quot;SELECT * FROM tl_2014_us_state WHERE NAME=&#39;Georgia&#39;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And here’s the GeoJSON dataset we just created, viewed on geojson.io – all two earthquakes in Georgia last month!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/earthquakes-georgia-geojson-io.jpg&quot; width=&quot;500px&quot; height=&quot;164px&quot; alt=&quot;Screenshot of GeoJSON.io map showing two earthquakes in Georgia&quot; class=&quot;blog-image-large&quot; /&gt;&lt;/p&gt;

    &lt;hr&gt;

    
      &lt;div class=&quot;post-comments&quot;&gt;
  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;
      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;
        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;
        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;
          &lt;div class=&quot;comment-name&quot;&gt;
            &lt;p&gt;Name&lt;/p&gt; &lt;input type=&#39;text&#39; name=&#39;name&#39; id=&#39;name&#39; required /&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-email&quot;&gt;
            &lt;p&gt;Email&lt;/p&gt; &lt;input type=&#39;email&#39; name=&#39;email&#39; id=&#39;email&#39; required /&gt;
            &lt;p class=&quot;email-disclaimer&quot;&gt;Savas will never sell your email address or spam you.&lt;/p&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;p&gt;Comment&lt;/p&gt;
          &lt;textarea name=&#39;comment&#39; id=&#39;comment&#39; required&gt;&lt;/textarea&gt;
          &lt;p class=&quot;hint below-textarea&quot;&gt;Plain text format only please.&lt;/p&gt;

          &lt;input type=&#39;hidden&#39; name=&#39;slug&#39; id=&#39;slug&#39; value=&#39;/2015/05/25/manage-geojson.html&#39; /&gt;
          &lt;input type=&#39;text&#39; name=&#39;url&#39; id=&#39;url&#39; /&gt;

          &lt;div class=&#39;are-you-human&#39;&gt;
            &lt;div class=&#39;are-you-human-owl&#39;&gt;
              &lt;img src=&quot;/assets/img/owl.png&quot; alt=&quot;Savas logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&#39;are-you-human-field&#39;&gt;
              &lt;p&gt;What type of animal is the Savas logo?&lt;/p&gt;
              &lt;input type=&#39;text&#39; name=&#39;nocaptcha&#39; id=&#39;nocaptcha&#39; class=&#39;nocaptcha&#39;&gt;
              &lt;p class=&quot;hint&quot;&gt;Hint: 3 letters long, starts with an &#39;o&#39; and ends with an &#39;l&#39;.&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&#39;submit&#39; value=&#39;Submit&#39; id=&#39;submit&#39; class=&quot;submit-comment&quot;/&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

    
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;
    &lt;h4&gt;About the author&lt;/h4&gt;
    
      &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
        &lt;img src=&quot;/assets/img/team/tim-stallmann.jpg&quot; alt=&quot;Tim Stallmann&quot;&gt;
      &lt;/a&gt;
      &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
    
  &lt;/div&gt;
    &lt;!-- Once we have more content, change this to posts related by tag --&gt;
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Usability Testing - Our Process and Favorite Practices
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 22, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;Our approach to designing, conducting, and learning from user testing and other analyses.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/16/using-xhprof.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Using XHProf to profile your Drupal module
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 16, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;A case study of using XHProf to profile a Drupal module.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Strategies and tools for resolving Git merge conflicts
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 15, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;An overview of strategies and tools I like to use when I encounter conflicts during merges.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

    &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2015/06/10/d8-theming-basics.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Drupal 8 Theming Basics&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2015/05/22/durham-living-wage.html&quot;&gt; A Durham Living Wage &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;


  &lt;/article&gt;

&lt;/div&gt;
",
    "sourceOrganization": "Savas",
    "inLanguage": "en-US",
    "dateCreated": "2015-05-25 00:00:00 +0000",
    "datePublished": "2015-05-25 00:00:00 +0000",
    "url": "/2015/05/25/manage-geojson.html"
  }
</script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  

  
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">

    <!-- Savas logo. -->
    <a href="/" class="logo">
        <img src="/assets/img/logo.png" alt="Savas logo">
    </a>

    <!-- Mobile menu button. -->
    <a href="/" id="js-mobile-menu" class="navigation-menu-button">MENU</a>

    <!-- Main menu. -->
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">

        <!-- Loop through nav items in config.yml. -->
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  more">
            <a href="javascript:void(0)">Who we are</a>

            <!-- If there are sub-links, create them. -->
            

              <ul class="submenu">
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/team">Team</a>
                  </li>
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/mission-and-values">Mission & values</a>
                  </li>
                
              </ul>
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/services">Services</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/work">Our work</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/blog">Blog</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/contact">Contact</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        


<div class="post">
  <header class="post-header">
    <h1 class="post-title">Managing GeoJSON data using GDAL</h1>
    <p>By <a href="/team/tim-stallmann">Tim Stallmann</a></p>
    <p class="centerdot">&centerdot; </p>
    <p>May 25, 2015 </p><br>
    <i class="fa fa-tags"></i><p><a href="/blog/tag/cartography/">Cartography</a>, <a href="/blog/tag/leaflet/">Leaflet.js</a></p>
    
    <div><p><span id="comment-count"></span></p></div>
    
    
  </header>

  

  <article class="post-content">
    <p>In my <a href="/2015/05/18/mapping-geojson.html">last tutorial</a>, we used USGS earthquake data to make a simple web map using leaflet. Today, we’ll explore how to use GDAL tools to explore and manipulate GeoJSON data.
Why might this be useful?</p>

<ul>
  <li>Removing un-needed properties to optimize filesize</li>
  <li>Filtering data by location for mapping purposes</li>
  <li>Cleaning data by removing invalid features</li>
  <li>Converting other geo-data formats into GeoJSON, or vice versa.</li>
</ul>

<h2 id="installing-gdal-and-downloading-sample-data">Installing GDAL and Downloading Sample Data</h2>

<p><a href="http://www.gdal.org">GDAL (Geospatial Data Abstraction Library)</a> is a free and open-source translator library for both raster and vector data formats. It provides a number of core functionalities for data processing and conversion which are used across the suite of <a href="http://www.osgeo.org">OSGeo applications</a>. More importantly for our purposes, GDAL provides a bunch of command-line tools for processing geospatial data.</p>

<p>If you’re on a Mac and using homebrew, you can easily install GDAL by running <code class="highlighter-rouge">brew install gdal</code> from the command line. Otherwise, you can download <a href="http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries">binaries from GDAL</a> or <a href="http://trac.osgeo.org/gdal/wiki/BuildHints">compile the source code yourself</a>.</p>

<p>Just like the last tutorial, we’re going to be using the USGS earthquake data. Navigate to <a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson">http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson</a>, and save the resulting file to your computer as a <code class="highlighter-rouge">.geojson</code> file.</p>

<h2 id="using-ogrinfo-to-look-inside-your-dataset">Using OGRInfo to look inside your dataset</h2>

<p><a href="http://www.gdal.org/ogrinfo.html">OGRInfo</a> lets us look inside geospatial datasets, viewing both summary info and lists of individual features. It’s useful to see what attributes are available for a given dataset or how many features it contains, as well as testing out attribute filters and examining individual features.</p>

<p>Let’s try some basic commands. Just running ogrinfo on a dataset will give you a list of all the layers it contains. In the case of GeoJSON, this is usually just a single layer.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogrinfo all_month.geojson
ERROR 4: GeoJSON Driver doesn<span class="s1">'t support update.
Had to open data source read-only.
INFO: Open of `all_month.geojson'</span>
      using driver <span class="sb">`</span>GeoJSON<span class="s1">' successful.
1: OGRGeoJSON (3D Point)
</span></code></pre>
</div>

<p>That’s not very helpful, so let’s try peeking inside the (only) layer. ogrinfo syntax has you pass the layer name as the second argument. By default, it will print every feature in this dataset (7.5 Mb worth!) to the console, so instead let’s add the <code class="highlighter-rouge">-so</code> argument, which displays a summary of the layer. Note that the GeoJSON driver for OGR has assigned the layer name <code class="highlighter-rouge">OGRGeoJSON</code>, which we’re passing in:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogrinfo all_month.geojson OGRGeoJSON -so
ERROR 4: GeoJSON Driver doesn<span class="s1">'t support update.
Had to open data source read-only.
INFO: Open of `all_month.geojson'</span>
      using driver <span class="sb">`</span>GeoJSON<span class="s1">' successful.

Layer name: OGRGeoJSON
Geometry: 3D Point
Feature Count: 10082
Extent: (-179.924400, -62.035900) - (179.989800, 68.959900)
Layer SRS WKT:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.257223563,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0,
        AUTHORITY["EPSG","8901"]],
    UNIT["degree",0.0174532925199433,
        AUTHORITY["EPSG","9122"]],
    AUTHORITY["EPSG","4326"]]
mag: Real (0.0)
place: String (0.0)
...
magType: String (0.0)
type: String (0.0)
title: String (0.0)
</span></code></pre>
</div>

<p>Now this is getting somewhere! We’ve got info about the number of features, the extent of the data (apparently there aren’t earthquakes at the poles, or USGS isn’t monitoring them), the coordinate system of the data, and a full list of attributes.</p>

<p>What might that <code class="highlighter-rouge">type</code> attribute be telling us? We can use ogrinfo to run basic SQL queries on the data as well, for example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogrinfo all_month.geojson -sql <span class="s2">"SELECT DISTINCT type FROM OGRGeoJSON -q"</span>
ERROR 4: GeoJSON Driver doesn<span class="s1">'t support update.

Layer name: OGRGeoJSON
OGRFeature(OGRGeoJSON):0
  type (String) = earthquake

OGRFeature(OGRGeoJSON):1
  type (String) = quarry blast

...
</span></code></pre>
</div>

<p>Note: I’m using the <code class="highlighter-rouge">-q</code> flag to suppress some of the more verbose output. Also, ogrinfo unfortunately doesn’t support <code class="highlighter-rouge">GROUP BY</code> or <code class="highlighter-rouge">LIMIT</code> clauses on SQL queries for GeoJSON files.</p>

<p>We can also use this to answer some basic questions about the data. Like, how many earthquakes were recorded with magnitude of 5 or greater?</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogrinfo all_month.geojson -sql <span class="s2">"SELECT COUNT(*) FROM OGRGeoJSON WHERE mag&gt;=5"</span> -q
ERROR 4: GeoJSON Driver doesn<span class="s1">'t support update.

Layer name: OGRGeoJSON
OGRFeature(OGRGeoJSON):0
  COUNT_* (Integer) = 176
</span></code></pre>
</div>

<h2 id="optimizing-your-data">Optimizing your data</h2>

<p>Check the filesize of the <code class="highlighter-rouge">all_month.geojson</code> file you downloaded. It probably weighs in at around 7-8 Mb, which is really unwieldy for a client to download before viewing a web map. Can we trim the file down a bit?</p>

<p>First pass: if you remember the output from <code class="highlighter-rouge">ogrinfo -so</code>, you’ll remember that there are a <em>lot</em> of attributes in this data-set! For a web map, we usually just use a few attributes to populate pop-up text. In this case, we’re just going to use the place, mag, and url properties.</p>

<p>Ogr2Ogr is another tool designed for converting to and from a variety of geospatial data formats, but it also allows us to filter the data as we’re copying it and only copy over specific attributes. So we can use it to “convert” the dataset from GeoJSON into a new GeoJSON with fewer columns.</p>

<p>The basic syntax is:
<code class="highlighter-rouge">ogr2ogr -f "Output format specifier" output_filename input_filename</code></p>

<p>We want to cherry-pick only a few attribute fields, which we can to using the <code class="highlighter-rouge">-select</code> flag:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogr2ogr -f GeoJSON all_month_optimized.geojson all_month.geojson -select mag,place,url
</code></pre>
</div>

<p>If you look at the filesize on the new geojson we just created, you’ll see we managed to strip it down to a much smaller 2-3 Mb.</p>

<p>ogr2ogr also accepts the <code class="highlighter-rouge">-sql</code> flag, so we could also have written:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogr2ogr -f GeoJSON all_month_optimized.geojson all_month.geojson -sql <span class="s2">"SELECT mag,place,url FROM OGRGeoJSON"</span>
</code></pre>
</div>

<h2 id="filtering-data-by-attributes">Filtering data by attributes</h2>

<p>With this syntax, it’s easy to select out a subset of the features (since who will really be able to navigate 10,000+ points if we were to map the full dataset, anyway?):</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogr2ogr -f GeoJSON all_month_mag_over_5.geojson all_month.geojson -sql <span class="s2">"SELECT mag,place,url FROM OGRGeoJSON WHERE mag&gt;=5"</span>
</code></pre>
</div>

<p>Now we’re just down to 44 kb, a totally reasonable size for mapping.</p>

<p>Here’s what the dataset we just made looks like (via <a href="http://geojson.io">geojson.io</a>):
<img src="/assets/img/blog/earthquakes-mag-5-geojson-io.jpg" width="500px" height="250px" alt="Screenshot of GeoJSON.io map showing earthquakes distributed across the world" class="blog-image-large" /></p>

<h2 id="filtering-by-location">Filtering by location</h2>

<p>What if we just want to map earthquakes that have taken place in a specific area?</p>

<p>The simplest way to approach this it to filter the data by a bounding box – a rectangular area defined by latitude and longitude coordinates. <a href="http://geojson.io">Geojson.io</a> has a rectangle-drawing tool which will give you latitude and longitude coordinates of the corners pretty easily. I tried drawing a rectangle over the rough area of the US East of the Mississippi, and passed those arguments into ogr2ogr’s <code class="highlighter-rouge">-clipsrc xmin ymin xmax ymax</code> argument (that’s South-East corner longitude, SE corner latitude, NW longitude, NW latitude):</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogr2ogr -f GeoJSON all_month_us_east.geojson all_month.geojson -clipsrc -86.835 24.206 -69.609 46.800
</code></pre>
</div>

<p>Here’s the result. Florida turns out to be a good place to live if you want to avoid minor tremors! Also notice that because of using a simple latitude-longitude rectangle to filter the data, we also pulled in those parts of Canada which are south of Maine.
<img src="/assets/img/blog/earthquakes-us-east-geojson-io.jpg" width="400px" height="400px" alt="Screenshot of GeoJSON.io map showing earthquakes in the past month in the United States, with one point in Canada" class="blog-image-large" /></p>

<h2 id="filtering-by-location-2-clipping-to-another-dataset">Filtering by location 2: Clipping to another dataset</h2>

<p>But what if we want all the earthquakes in, say, North Dakota? For more complicated area queries, we’ll have to supply the clipping area as a separate datasource.</p>

<p>We can download a shapefile of all 50 US States from the Census Bureau, then select out North Dakota and pass that as a clipping argument to ogr2ogr. First, download the <code class="highlighter-rouge">tl_2014_us_state.zip</code> file from the <a href="ftp://ftp2.census.gov/geo/tiger/TIGER2014/STATE/">Census Bureau FTP site</a>, and unzip it to the same directory as your geojson file.</p>

<p>Let’s use ogrinfo to examine this file and see how we could select out North Dakota</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogrinfo tl_2014_us_state.shp tl_2014_us_state -so
INFO: Open of <span class="sb">`</span>tl_2014_us_state.shp<span class="s1">'
      using driver `ESRI Shapefile'</span> successful.

Layer name: tl_2014_us_state
Geometry: Polygon
Feature Count: 56
Extent: <span class="o">(</span>-179.231086, -14.601813<span class="o">)</span> - <span class="o">(</span>179.859681, 71.441059<span class="o">)</span>
Layer SRS WKT:
GEOGCS[<span class="s2">"GCS_North_American_1983"</span>,
    DATUM[<span class="s2">"North_American_Datum_1983"</span>,
        SPHEROID[<span class="s2">"GRS_1980"</span>,6378137,298.257222101]],
    PRIMEM[<span class="s2">"Greenwich"</span>,0],
    UNIT[<span class="s2">"Degree"</span>,0.017453292519943295]]
REGION: String <span class="o">(</span>2.0<span class="o">)</span>
...
NAME: String <span class="o">(</span>100.0<span class="o">)</span>
...
</code></pre>
</div>

<p>Looks like we can just select by name. Try it first in ogrinfo:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogrinfo tl_2014_us_state.shp -SQL <span class="s2">"SELECT * FROM tl_2014_us_state WHERE NAME='Georgia'"</span> -GEOM<span class="o">=</span>NO
INFO: Open of <span class="sb">`</span>tl_2014_us_state.shp<span class="s1">'
      using driver `ESRI Shapefile'</span> successful.

Layer name: tl_2014_us_state
Geometry: Polygon
Feature Count: 1
Extent: <span class="o">(</span>-179.231086, -14.601813<span class="o">)</span> - <span class="o">(</span>179.859681, 71.441059<span class="o">)</span>
...
</code></pre>
</div>

<p>That worked, so now we can format the whole ogr2ogr string, using <code class="highlighter-rouge">-clipsrc</code> and <code class="highlighter-rouge">-clipsrcsql</code> options. Note that because we’re using a very detailed shapefile for the state outlines, this command takes a long time to process. On my MacBook Pro it clocks in at around 3 minutes.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ogr2ogr -f GeoJSON all_month_georgia.geojson all_month.geojson -clipsrc tl_2014_us_state.shp -clipsrcsql <span class="s2">"SELECT * FROM tl_2014_us_state WHERE NAME='Georgia'"</span>
</code></pre>
</div>

<p>And here’s the GeoJSON dataset we just created, viewed on geojson.io – all two earthquakes in Georgia last month!</p>

<p><img src="/assets/img/blog/earthquakes-georgia-geojson-io.jpg" width="500px" height="164px" alt="Screenshot of GeoJSON.io map showing two earthquakes in Georgia" class="blog-image-large" /></p>

    <hr>

    
      <div class="post-comments">
  
    <div class="expander">
      <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander-hidden">Comments!</a>
      <div id="js-expander-content" class="expander-content">
        <!-- If there are existing comments, output them here. -->
        <div id="post-comments" class="post-comments"></div>
        <!-- New comment form -->
        <form id="comment-form">
          <h4>Leave a comment</h4>
          <div class="comment-name">
            <p>Name</p> <input type='text' name='name' id='name' required /><br>
          </div>

          <div class="comment-email">
            <p>Email</p> <input type='email' name='email' id='email' required />
            <p class="email-disclaimer">Savas will never sell your email address or spam you.</p><br>
          </div>

          <p>Comment</p>
          <textarea name='comment' id='comment' required></textarea>
          <p class="hint below-textarea">Plain text format only please.</p>

          <input type='hidden' name='slug' id='slug' value='/2015/05/25/manage-geojson.html' />
          <input type='text' name='url' id='url' />

          <div class='are-you-human'>
            <div class='are-you-human-owl'>
              <img src="/assets/img/owl.png" alt="Savas logo">
            </div>
            <div class='are-you-human-field'>
              <p>What type of animal is the Savas logo?</p>
              <input type='text' name='nocaptcha' id='nocaptcha' class='nocaptcha'>
              <p class="hint">Hint: 3 letters long, starts with an 'o' and ends with an 'l'.</p>
            </div>
          </div>

          <input type='submit' value='Submit' id='submit' class="submit-comment"/>
        </form>
      </div>
    </div>
  
  <hr>
</div>

    
    <div class="post-bottom">
  <div class="post-meta">
    <h4>About the author</h4>
    
      <a href="/team/tim-stallmann">
        <img src="/assets/img/team/tim-stallmann.jpg" alt="Tim Stallmann">
      </a>
      <p class="post-author-desc">Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.</p>
    
  </div>
    <!-- Once we have more content, change this to posts related by tag -->
  <div class="post-related flex-container">
    <h4>Recent posts by Savas</h4>
    <div class="cards">
      
      
        
        
          <div class="card">
            <a href="/2016/06/22/user-testing.html">
              <div class="card-header">
                  Usability Testing - Our Process and Favorite Practices
              </div>
              <div class="card-copy">
                <p>Jun 22, 2016</p>
                <p><p>Our approach to designing, conducting, and learning from user testing and other analyses.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2016/06/16/using-xhprof.html">
              <div class="card-header">
                  Using XHProf to profile your Drupal module
              </div>
              <div class="card-copy">
                <p>Jun 16, 2016</p>
                <p><p>A case study of using XHProf to profile a Drupal module.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2016/06/15/git-merge-conflict-strategies.html">
              <div class="card-header">
                  Strategies and tools for resolving Git merge conflicts
              </div>
              <div class="card-copy">
                <p>Jun 15, 2016</p>
                <p><p>An overview of strategies and tools I like to use when I encounter conflicts during merges.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
</div>

    <div class="previous-next-links">
  <div class="next">
    
      <a href="/2015/06/10/d8-theming-basics.html"><i class="fa fa-long-arrow-left "></i> Drupal 8 Theming Basics</a>
    
  </div>
  <div class="previous">
    
      <a href="/2015/05/22/durham-living-wage.html"> A Durham Living Wage <i class="fa fa-long-arrow-right"></i></a>
    
  </div>
</div>


  </article>

</div>

      </div>
    </div>

    <div class="contact-block">
  <div class="contact-block__items">
    <h3>Interested in working with us?</h3>
    <a href="/contact">Get in touch!</a>
  </div>
</div>
    <footer class="footer" role="contentinfo">
  <div class="footer-links">
    <ul>
      <li><h3>Location</h3></li>
      <li>Savas Labs<br />
          PMB 114<br />
          201 W Main Street, Suite 100<br />
          Durham, NC 27701<br /></li>
    </ul>
    <ul>
      <li><h3>Around the Web</h3></li>
      <ul>
        <li><a href="https://github.com/savaslabs"><span class="mega-octicon octicon-mark-github"></span></a></li>
        <li><a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a></li>
        <li><a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a></li>
        <li><a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a></li>
      </ul>
    </ul>
    <ul>
      <li><h3>Contact</h3></li>
      <li><a href="mailto:info@savaslabs.com">info@savaslabs.com</a></li>
      <li>(919) 432-4660</li>
    </ul>
  </div>

</footer>

<div class="footer-copyright">
  <p>Copyright &copy; Savas Labs 2016</p>
</div>


  </body>

</html>
