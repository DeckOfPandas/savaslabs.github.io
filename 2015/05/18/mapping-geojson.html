<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Mapping external GeoJSON data | Savas Labs</title>
  
  <meta name="description" content="Leaflet.js is a powerful, light-weight javascript API for mapping. In this post, I’ll walk through how to use Leaflet to map GeoJSON data. By the end, we’ll ...">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Bitter|Source+Sans+Pro' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/styles/main.css">
  <link rel="stylesheet" href="/assets/icons/octicons/octicons.css">
  <link rel="canonical" href="/2015/05/18/mapping-geojson.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="/feed.xml" />
  <script type="text/javascript" src="/assets/js/main.js"></script>
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Durham, North Carolina",
        "postalCode": "27701",
        "streetAddress": "201 W Main St."
      },
      "description": "A full-service web agency leveraging the power of Drupal.
",
      "email": "info@savaslabs.com",
      "name": "Savas",
      "telephone": "(919) 432-4660",
      "url": "http://savaslabs.com",
      "logo": "http://savaslabs.com/assets/img/logo.png"
    }
</script>

  
  
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Mapping external GeoJSON data",
    "about": "Leaflet.js is a powerful, light-weight javascript API for mapping. In this post, I'll walk through how to use Leaflet to map GeoJSON data.",
    "articleBody": "


&lt;div class=&quot;post&quot;&gt;
  &lt;header class=&quot;post-header&quot;&gt;
    &lt;h1 class=&quot;post-title&quot;&gt;Mapping external GeoJSON data&lt;/h1&gt;
    &lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;
    &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
    &lt;p&gt;May 18, 2015 &lt;/p&gt;&lt;br&gt;
    &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/cartography/&quot;&gt;Cartography&lt;/a&gt;, &lt;a href=&quot;/blog/tag/leaflet/&quot;&gt;Leaflet.js&lt;/a&gt;&lt;/p&gt;
    
    &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    
  &lt;/header&gt;

  

  &lt;article class=&quot;post-content&quot;&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.leafletjs.com&quot;&gt;Leaflet.js&lt;/a&gt; is a powerful, light-weight javascript API for mapping. In this post, I’ll walk through how to use Leaflet to map GeoJSON data. By the end, we’ll have a map of earthquakes in the past 24 hours (using live USGS data) which looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;blog-image-large&quot; src=&quot;/assets/img/blog/earthquakes-map.jpg&quot; alt=&quot;Screenshot of the map of earthquakes which we&#39;ll create in this tutorial.&quot; width=&quot;500&quot; height=&quot;202&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;basic-leaflet-set-up&quot;&gt;Basic Leaflet Set-up&lt;/h2&gt;

&lt;p&gt;This section largely duplicates the basic Leaflet set-up at &lt;a href=&quot;http://leafletjs.com/examples/quick-start.html&quot;&gt;this tutorial&lt;/a&gt;, except for we also add a Leaflet-providers plugin to get easy access to additional tilesets.&lt;/p&gt;

&lt;p&gt;The first step in any mapping project using Leaflet is to add a basic div to your page with &lt;code class=&quot;highlighter-rouge&quot;&gt;id=map&lt;/code&gt;. Leaflet will grab onto this div and insert the map content dynamically. You’ll need to fix the div size using CSS:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;#map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;300px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Or&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;whatever&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;like&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, we need to add Leaflet javascript and CSS and jQuery javscript to the page. jQuery is needed here to load external GeoJSON through an AJAX call. In a production site, you might want to host these libraries locally.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://code.jquery.com/jquery-1.11.3.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The bulk of the mapping work will take place in custom javascript, which we can either place inline in the HTML file, or in a separate source file. We’ll create a leaflet map object:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;map&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, we need to add a background layer, or basemap. I like to do this using the &lt;a href=&quot;https://github.com/leaflet-extras/leaflet-providers&quot;&gt;leaflet-providers&lt;/a&gt; plug-in, which gives an easier way to add basemaps from multiple providers without having to manually specify the &lt;a href=&quot;http://leafletjs.com/reference.html#tilelayer&quot;&gt;URL template strings&lt;/a&gt; for each layer.&lt;/p&gt;

&lt;p&gt;Download the &lt;code class=&quot;highlighter-rouge&quot;&gt;leaflet-providers.js&lt;/code&gt; file, and save it in the same directory as your working HTML file. In a real site, I would be using &lt;a href=&quot;http://www.bower.io&quot;&gt;bower&lt;/a&gt; and &lt;a href=&quot;http://browserify.org/&quot;&gt;browserify&lt;/a&gt; to manage packages, but that’s a topic for another post entirely. Place this code &lt;em&gt;after&lt;/em&gt; the previous script tags.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;leaflet-providers.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With leaflet-providers included, we can add a number of different basemaps. Here we’re using free &lt;a href=&quot;http://opentopomap.org/about&quot;&gt;OpenTopoMap&lt;/a&gt; tiles.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;terrainTiles&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;tileLayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;OpenTopoMap&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;terrainTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Set the initial viewport of the map. Here we&#39;re centering on Savas&#39; hometown and zooming out a bit.&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;35.9908385&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;78.9005222&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;bringing-in-geojson&quot;&gt;Bringing in GeoJSON&lt;/h2&gt;

&lt;p&gt;Whether you’re pulling in GeoJSON from external data source or hosting it locally, you’ll need to load the data using AJAX. jQuery provides a standard &lt;code class=&quot;highlighter-rouge&quot;&gt;getJSON&lt;/code&gt; function, which will load JSON from an external source and then fire a callback once the data has loaded. In this example, I’m using the &lt;a href=&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php&quot;&gt;USGS geoJSON feed&lt;/a&gt; of all recorded earthquakes in the past 24 hours.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;addDataToMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geoJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getJSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;addDataToMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The callback creates a new Leaflet layer object by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;L.geoJson&lt;/code&gt;, and then adds that layer to the map.&lt;/p&gt;

&lt;p&gt;Note that within jQuery, JSON is in all caps, whereas Leaflet uses strict camelCase (geoJson).&lt;/p&gt;

&lt;p&gt;We need to access the map variable inside &lt;code class=&quot;highlighter-rouge&quot;&gt;addDataToMap&lt;/code&gt;, so I’m using a closure here to pass that along with the data. This is usually not strictly necessary, since depending on how your javascript is written, &lt;code class=&quot;highlighter-rouge&quot;&gt;map&lt;/code&gt; is probably already available within the scope of &lt;code class=&quot;highlighter-rouge&quot;&gt;addDataToMap&lt;/code&gt;. But let’s explicitly pass it here, to avoid being confusing.&lt;/p&gt;

&lt;p&gt;Here’s what your map should look like at this point:&lt;/p&gt;

&lt;div id=&quot;map&quot; style=&quot;width: 100%; height: 300px;&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
L.Icon.Default.imagePath = &quot;/assets/img&quot;;
var map = L.map(&#39;map&#39;);
var terrainTiles = L.tileLayer.provider(&#39;OpenTopoMap&#39;);
terrainTiles.addTo(map);
map.setView([35.9908385, -78.9005222], 3);

function addDataToMap(data, map) {
    var dataLayer = L.geoJson(data);
    dataLayer.addTo(map);
}

$.getJSON(&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson&quot;, function(data) { addDataToMap(data, map); });
&lt;/script&gt;

&lt;h2 id=&quot;adding-popups&quot;&gt;Adding Popups&lt;/h2&gt;

&lt;p&gt;Wouldn’t it be nice to be able to click on some of those points and find out more details about the earthquake? So far we haven’t made use of any, but Leaflet allows you to pass a variety of &lt;a href=&quot;http://leafletjs.com/reference.html#geojson&quot;&gt;callbacks as options to &lt;code class=&quot;highlighter-rouge&quot;&gt;L.geoJson&lt;/code&gt;&lt;/a&gt;. These include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;pointToLayer( GeoJSON featureData, LatLng latlng )
    &lt;ul&gt;
      &lt;li&gt;Called once for each point feature in the geoJSON. Use this to create a custom marker when data points are added to the map. Returns &lt;a href=&quot;http://leafletjs.com/reference.html#marker&quot;&gt;L.Marker&lt;/a&gt; object.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;onEachFeature( GeoJSON featureData, ILayer layer )
    &lt;ul&gt;
      &lt;li&gt;Called after each feature is created and on the map. Use this to add event listeners to the feature.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;filter( GeoJSON featureData, ILayer layer )
    &lt;ul&gt;
      &lt;li&gt;Called once for each feature in the dataset to determine whether it should be displayed on the map or not. Returns a boolean true if the feature should be displayed, false otherwise.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;coordsToLatLng( Array coords )
    &lt;ul&gt;
      &lt;li&gt;Translates whatever coordinates are in the geoJSON file into latitude and longitude coordinates in WGS 84. Necessary if your GeoJSON data is in a different coordinate system. Returns a &lt;a href=&quot;http://leafletjs.com/reference.html#latlng&quot;&gt;LatLng&lt;/a&gt; object.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;style( GeoJSON featureData )
    &lt;ul&gt;
      &lt;li&gt;Generates CSS which applies to the marker for the feature with data &lt;code class=&quot;highlighter-rouge&quot;&gt;featureData&lt;/code&gt;. Returns CSS in the form of a Javascript object.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here, we’ll modify &lt;code class=&quot;highlighter-rouge&quot;&gt;addDataToMap&lt;/code&gt; to use &lt;code class=&quot;highlighter-rouge&quot;&gt;onEachFeature&lt;/code&gt; to bind a popup to each feature as it is added. In general with GeoJSON you’ll find additional data associated with each point in &lt;code class=&quot;highlighter-rouge&quot;&gt;feature.properties&lt;/code&gt;. I’m using the USGS properties to add a popup giving the precise location, magnitude, and link to more info for each earthquake.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;addDataToMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geoJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;onEachFeature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;popupText&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Magnitude: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mag&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br&amp;gt;Location: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;place&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br&amp;gt;&amp;lt;a href=&#39;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&#39;&amp;gt;More info&amp;lt;/a&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bindPopup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;popupText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And here’s the “finished” map! Stay tuned for more GeoJSON + Leaflet tutorials from &lt;a href=&quot;http://www.savaslabs.com&quot;&gt;Savas&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The final HTML file with inline javascript is also posted &lt;a href=&quot;https://gist.github.com/chrisarusso/d7d54a4149830a8baa6d&quot;&gt;as a gist here&lt;/a&gt;.&lt;/p&gt;

&lt;div id=&quot;map2&quot; style=&quot;width: 100%; height: 300px;&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var map2 = L.map(&#39;map2&#39;);
var terrainTiles2 = L.tileLayer.provider(&#39;OpenTopoMap&#39;);
terrainTiles2.addTo(map2);
map2.setView([35.9908385, -78.9005222], 3);

function addDataToMap2(data, map) {
    var dataLayer = L.geoJson(data, {
        onEachFeature: function(feature, layer) {
            var popupText = &quot;Magnitude: &quot; + feature.properties.mag
                + &quot;&lt;br&gt;Location: &quot; + feature.properties.place
                + &quot;&lt;br&gt;&lt;a href=&#39;&quot; + feature.properties.url + &quot;&#39;&gt;More info&lt;/a&gt;&quot;;
            layer.bindPopup(popupText); }
        });
    dataLayer.addTo(map);
}

$.getJSON(&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson&quot;, function(data) { addDataToMap2(data, map2); });
&lt;/script&gt;


    &lt;hr&gt;

    
      &lt;div class=&quot;post-comments&quot;&gt;
  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;
      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;
        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;
        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;
          &lt;div class=&quot;comment-name&quot;&gt;
            &lt;p&gt;Name&lt;/p&gt; &lt;input type=&#39;text&#39; name=&#39;name&#39; id=&#39;name&#39; required /&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-email&quot;&gt;
            &lt;p&gt;Email&lt;/p&gt; &lt;input type=&#39;email&#39; name=&#39;email&#39; id=&#39;email&#39; required /&gt;
            &lt;p class=&quot;email-disclaimer&quot;&gt;Savas will never sell your email address or spam you.&lt;/p&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;p&gt;Comment&lt;/p&gt;
          &lt;textarea name=&#39;comment&#39; id=&#39;comment&#39; required&gt;&lt;/textarea&gt;
          &lt;p class=&quot;hint below-textarea&quot;&gt;Plain text format only please.&lt;/p&gt;

          &lt;input type=&#39;hidden&#39; name=&#39;slug&#39; id=&#39;slug&#39; value=&#39;/2015/05/18/mapping-geojson.html&#39; /&gt;
          &lt;input type=&#39;text&#39; name=&#39;url&#39; id=&#39;url&#39; /&gt;

          &lt;div class=&#39;are-you-human&#39;&gt;
            &lt;div class=&#39;are-you-human-owl&#39;&gt;
              &lt;img src=&quot;/assets/img/owl.png&quot; alt=&quot;Savas logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&#39;are-you-human-field&#39;&gt;
              &lt;p&gt;What type of animal is the Savas logo?&lt;/p&gt;
              &lt;input type=&#39;text&#39; name=&#39;nocaptcha&#39; id=&#39;nocaptcha&#39; class=&#39;nocaptcha&#39;&gt;
              &lt;p class=&quot;hint&quot;&gt;Hint: 3 letters long, starts with an &#39;o&#39; and ends with an &#39;l&#39;.&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&#39;submit&#39; value=&#39;Submit&#39; id=&#39;submit&#39; class=&quot;submit-comment&quot;/&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

    
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;
    &lt;h4&gt;About the author&lt;/h4&gt;
    
      &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
        &lt;img src=&quot;/assets/img/team/tim-stallmann.jpg&quot; alt=&quot;Tim Stallmann&quot;&gt;
      &lt;/a&gt;
      &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
    
  &lt;/div&gt;
    &lt;!-- Once we have more content, change this to posts related by tag --&gt;
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Usability Testing - Our Process and Favorite Practices
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 22, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;Our approach to designing, conducting, and learning from user testing and other analyses.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/16/using-xhprof.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Using XHProf to profile your Drupal module
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 16, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;A case study of using XHProf to profile a Drupal module.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Strategies and tools for resolving Git merge conflicts
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 15, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;An overview of strategies and tools I like to use when I encounter conflicts during merges.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

    &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2015/05/22/durham-living-wage.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; A Durham Living Wage&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2015/04/27/durham-restaurant-time-machine.html&quot;&gt; Building a time machine for Durham&#39;s food landscape &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;


  &lt;/article&gt;

&lt;/div&gt;
",
      "author": {
          "@context": "http://schema.org",
          "@type": "Person",
          "name": "Tim Stallmann",
          "affiliation": "Savas",
          "worksFor": "Savas"
      },
    "keywords": "cartography, leaflet",
    "text": "


&lt;div class=&quot;post&quot;&gt;
  &lt;header class=&quot;post-header&quot;&gt;
    &lt;h1 class=&quot;post-title&quot;&gt;Mapping external GeoJSON data&lt;/h1&gt;
    &lt;p&gt;By &lt;a href=&quot;/team/tim-stallmann&quot;&gt;Tim Stallmann&lt;/a&gt;&lt;/p&gt;
    &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
    &lt;p&gt;May 18, 2015 &lt;/p&gt;&lt;br&gt;
    &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/cartography/&quot;&gt;Cartography&lt;/a&gt;, &lt;a href=&quot;/blog/tag/leaflet/&quot;&gt;Leaflet.js&lt;/a&gt;&lt;/p&gt;
    
    &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    
  &lt;/header&gt;

  

  &lt;article class=&quot;post-content&quot;&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.leafletjs.com&quot;&gt;Leaflet.js&lt;/a&gt; is a powerful, light-weight javascript API for mapping. In this post, I’ll walk through how to use Leaflet to map GeoJSON data. By the end, we’ll have a map of earthquakes in the past 24 hours (using live USGS data) which looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;blog-image-large&quot; src=&quot;/assets/img/blog/earthquakes-map.jpg&quot; alt=&quot;Screenshot of the map of earthquakes which we&#39;ll create in this tutorial.&quot; width=&quot;500&quot; height=&quot;202&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;basic-leaflet-set-up&quot;&gt;Basic Leaflet Set-up&lt;/h2&gt;

&lt;p&gt;This section largely duplicates the basic Leaflet set-up at &lt;a href=&quot;http://leafletjs.com/examples/quick-start.html&quot;&gt;this tutorial&lt;/a&gt;, except for we also add a Leaflet-providers plugin to get easy access to additional tilesets.&lt;/p&gt;

&lt;p&gt;The first step in any mapping project using Leaflet is to add a basic div to your page with &lt;code class=&quot;highlighter-rouge&quot;&gt;id=map&lt;/code&gt;. Leaflet will grab onto this div and insert the map content dynamically. You’ll need to fix the div size using CSS:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;#map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;300px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Or&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;whatever&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;like&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, we need to add Leaflet javascript and CSS and jQuery javscript to the page. jQuery is needed here to load external GeoJSON through an AJAX call. In a production site, you might want to host these libraries locally.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://code.jquery.com/jquery-1.11.3.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The bulk of the mapping work will take place in custom javascript, which we can either place inline in the HTML file, or in a separate source file. We’ll create a leaflet map object:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;map&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, we need to add a background layer, or basemap. I like to do this using the &lt;a href=&quot;https://github.com/leaflet-extras/leaflet-providers&quot;&gt;leaflet-providers&lt;/a&gt; plug-in, which gives an easier way to add basemaps from multiple providers without having to manually specify the &lt;a href=&quot;http://leafletjs.com/reference.html#tilelayer&quot;&gt;URL template strings&lt;/a&gt; for each layer.&lt;/p&gt;

&lt;p&gt;Download the &lt;code class=&quot;highlighter-rouge&quot;&gt;leaflet-providers.js&lt;/code&gt; file, and save it in the same directory as your working HTML file. In a real site, I would be using &lt;a href=&quot;http://www.bower.io&quot;&gt;bower&lt;/a&gt; and &lt;a href=&quot;http://browserify.org/&quot;&gt;browserify&lt;/a&gt; to manage packages, but that’s a topic for another post entirely. Place this code &lt;em&gt;after&lt;/em&gt; the previous script tags.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;leaflet-providers.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With leaflet-providers included, we can add a number of different basemaps. Here we’re using free &lt;a href=&quot;http://opentopomap.org/about&quot;&gt;OpenTopoMap&lt;/a&gt; tiles.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;terrainTiles&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;tileLayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;OpenTopoMap&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;terrainTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Set the initial viewport of the map. Here we&#39;re centering on Savas&#39; hometown and zooming out a bit.&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;35.9908385&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;78.9005222&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;bringing-in-geojson&quot;&gt;Bringing in GeoJSON&lt;/h2&gt;

&lt;p&gt;Whether you’re pulling in GeoJSON from external data source or hosting it locally, you’ll need to load the data using AJAX. jQuery provides a standard &lt;code class=&quot;highlighter-rouge&quot;&gt;getJSON&lt;/code&gt; function, which will load JSON from an external source and then fire a callback once the data has loaded. In this example, I’m using the &lt;a href=&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php&quot;&gt;USGS geoJSON feed&lt;/a&gt; of all recorded earthquakes in the past 24 hours.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;addDataToMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geoJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getJSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;addDataToMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The callback creates a new Leaflet layer object by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;L.geoJson&lt;/code&gt;, and then adds that layer to the map.&lt;/p&gt;

&lt;p&gt;Note that within jQuery, JSON is in all caps, whereas Leaflet uses strict camelCase (geoJson).&lt;/p&gt;

&lt;p&gt;We need to access the map variable inside &lt;code class=&quot;highlighter-rouge&quot;&gt;addDataToMap&lt;/code&gt;, so I’m using a closure here to pass that along with the data. This is usually not strictly necessary, since depending on how your javascript is written, &lt;code class=&quot;highlighter-rouge&quot;&gt;map&lt;/code&gt; is probably already available within the scope of &lt;code class=&quot;highlighter-rouge&quot;&gt;addDataToMap&lt;/code&gt;. But let’s explicitly pass it here, to avoid being confusing.&lt;/p&gt;

&lt;p&gt;Here’s what your map should look like at this point:&lt;/p&gt;

&lt;div id=&quot;map&quot; style=&quot;width: 100%; height: 300px;&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
L.Icon.Default.imagePath = &quot;/assets/img&quot;;
var map = L.map(&#39;map&#39;);
var terrainTiles = L.tileLayer.provider(&#39;OpenTopoMap&#39;);
terrainTiles.addTo(map);
map.setView([35.9908385, -78.9005222], 3);

function addDataToMap(data, map) {
    var dataLayer = L.geoJson(data);
    dataLayer.addTo(map);
}

$.getJSON(&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson&quot;, function(data) { addDataToMap(data, map); });
&lt;/script&gt;

&lt;h2 id=&quot;adding-popups&quot;&gt;Adding Popups&lt;/h2&gt;

&lt;p&gt;Wouldn’t it be nice to be able to click on some of those points and find out more details about the earthquake? So far we haven’t made use of any, but Leaflet allows you to pass a variety of &lt;a href=&quot;http://leafletjs.com/reference.html#geojson&quot;&gt;callbacks as options to &lt;code class=&quot;highlighter-rouge&quot;&gt;L.geoJson&lt;/code&gt;&lt;/a&gt;. These include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;pointToLayer( GeoJSON featureData, LatLng latlng )
    &lt;ul&gt;
      &lt;li&gt;Called once for each point feature in the geoJSON. Use this to create a custom marker when data points are added to the map. Returns &lt;a href=&quot;http://leafletjs.com/reference.html#marker&quot;&gt;L.Marker&lt;/a&gt; object.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;onEachFeature( GeoJSON featureData, ILayer layer )
    &lt;ul&gt;
      &lt;li&gt;Called after each feature is created and on the map. Use this to add event listeners to the feature.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;filter( GeoJSON featureData, ILayer layer )
    &lt;ul&gt;
      &lt;li&gt;Called once for each feature in the dataset to determine whether it should be displayed on the map or not. Returns a boolean true if the feature should be displayed, false otherwise.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;coordsToLatLng( Array coords )
    &lt;ul&gt;
      &lt;li&gt;Translates whatever coordinates are in the geoJSON file into latitude and longitude coordinates in WGS 84. Necessary if your GeoJSON data is in a different coordinate system. Returns a &lt;a href=&quot;http://leafletjs.com/reference.html#latlng&quot;&gt;LatLng&lt;/a&gt; object.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;style( GeoJSON featureData )
    &lt;ul&gt;
      &lt;li&gt;Generates CSS which applies to the marker for the feature with data &lt;code class=&quot;highlighter-rouge&quot;&gt;featureData&lt;/code&gt;. Returns CSS in the form of a Javascript object.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here, we’ll modify &lt;code class=&quot;highlighter-rouge&quot;&gt;addDataToMap&lt;/code&gt; to use &lt;code class=&quot;highlighter-rouge&quot;&gt;onEachFeature&lt;/code&gt; to bind a popup to each feature as it is added. In general with GeoJSON you’ll find additional data associated with each point in &lt;code class=&quot;highlighter-rouge&quot;&gt;feature.properties&lt;/code&gt;. I’m using the USGS properties to add a popup giving the precise location, magnitude, and link to more info for each earthquake.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;addDataToMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geoJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;onEachFeature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;popupText&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Magnitude: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mag&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br&amp;gt;Location: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;place&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br&amp;gt;&amp;lt;a href=&#39;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;feature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&#39;&amp;gt;More info&amp;lt;/a&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bindPopup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;popupText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;dataLayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And here’s the “finished” map! Stay tuned for more GeoJSON + Leaflet tutorials from &lt;a href=&quot;http://www.savaslabs.com&quot;&gt;Savas&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The final HTML file with inline javascript is also posted &lt;a href=&quot;https://gist.github.com/chrisarusso/d7d54a4149830a8baa6d&quot;&gt;as a gist here&lt;/a&gt;.&lt;/p&gt;

&lt;div id=&quot;map2&quot; style=&quot;width: 100%; height: 300px;&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var map2 = L.map(&#39;map2&#39;);
var terrainTiles2 = L.tileLayer.provider(&#39;OpenTopoMap&#39;);
terrainTiles2.addTo(map2);
map2.setView([35.9908385, -78.9005222], 3);

function addDataToMap2(data, map) {
    var dataLayer = L.geoJson(data, {
        onEachFeature: function(feature, layer) {
            var popupText = &quot;Magnitude: &quot; + feature.properties.mag
                + &quot;&lt;br&gt;Location: &quot; + feature.properties.place
                + &quot;&lt;br&gt;&lt;a href=&#39;&quot; + feature.properties.url + &quot;&#39;&gt;More info&lt;/a&gt;&quot;;
            layer.bindPopup(popupText); }
        });
    dataLayer.addTo(map);
}

$.getJSON(&quot;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson&quot;, function(data) { addDataToMap2(data, map2); });
&lt;/script&gt;


    &lt;hr&gt;

    
      &lt;div class=&quot;post-comments&quot;&gt;
  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;
      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;
        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;
        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;
          &lt;div class=&quot;comment-name&quot;&gt;
            &lt;p&gt;Name&lt;/p&gt; &lt;input type=&#39;text&#39; name=&#39;name&#39; id=&#39;name&#39; required /&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-email&quot;&gt;
            &lt;p&gt;Email&lt;/p&gt; &lt;input type=&#39;email&#39; name=&#39;email&#39; id=&#39;email&#39; required /&gt;
            &lt;p class=&quot;email-disclaimer&quot;&gt;Savas will never sell your email address or spam you.&lt;/p&gt;&lt;br&gt;
          &lt;/div&gt;

          &lt;p&gt;Comment&lt;/p&gt;
          &lt;textarea name=&#39;comment&#39; id=&#39;comment&#39; required&gt;&lt;/textarea&gt;
          &lt;p class=&quot;hint below-textarea&quot;&gt;Plain text format only please.&lt;/p&gt;

          &lt;input type=&#39;hidden&#39; name=&#39;slug&#39; id=&#39;slug&#39; value=&#39;/2015/05/18/mapping-geojson.html&#39; /&gt;
          &lt;input type=&#39;text&#39; name=&#39;url&#39; id=&#39;url&#39; /&gt;

          &lt;div class=&#39;are-you-human&#39;&gt;
            &lt;div class=&#39;are-you-human-owl&#39;&gt;
              &lt;img src=&quot;/assets/img/owl.png&quot; alt=&quot;Savas logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&#39;are-you-human-field&#39;&gt;
              &lt;p&gt;What type of animal is the Savas logo?&lt;/p&gt;
              &lt;input type=&#39;text&#39; name=&#39;nocaptcha&#39; id=&#39;nocaptcha&#39; class=&#39;nocaptcha&#39;&gt;
              &lt;p class=&quot;hint&quot;&gt;Hint: 3 letters long, starts with an &#39;o&#39; and ends with an &#39;l&#39;.&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&#39;submit&#39; value=&#39;Submit&#39; id=&#39;submit&#39; class=&quot;submit-comment&quot;/&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

    
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;
    &lt;h4&gt;About the author&lt;/h4&gt;
    
      &lt;a href=&quot;/team/tim-stallmann&quot;&gt;
        &lt;img src=&quot;/assets/img/team/tim-stallmann.jpg&quot; alt=&quot;Tim Stallmann&quot;&gt;
      &lt;/a&gt;
      &lt;p class=&quot;post-author-desc&quot;&gt;Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.&lt;/p&gt;
    
  &lt;/div&gt;
    &lt;!-- Once we have more content, change this to posts related by tag --&gt;
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/22/user-testing.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Usability Testing - Our Process and Favorite Practices
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 22, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;Our approach to designing, conducting, and learning from user testing and other analyses.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/16/using-xhprof.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Using XHProf to profile your Drupal module
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 16, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;A case study of using XHProf to profile a Drupal module.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2016/06/15/git-merge-conflict-strategies.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                  Strategies and tools for resolving Git merge conflicts
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Jun 15, 2016&lt;/p&gt;
                &lt;p&gt;&lt;p&gt;An overview of strategies and tools I like to use when I encounter conflicts during merges.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

    &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2015/05/22/durham-living-wage.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; A Durham Living Wage&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2015/04/27/durham-restaurant-time-machine.html&quot;&gt; Building a time machine for Durham&#39;s food landscape &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;


  &lt;/article&gt;

&lt;/div&gt;
",
    "sourceOrganization": "Savas",
    "inLanguage": "en-US",
    "dateCreated": "2015-05-18 00:00:00 +0000",
    "datePublished": "2015-05-18 00:00:00 +0000",
    "url": "/2015/05/18/mapping-geojson.html"
  }
</script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  
      
          <link rel="stylesheet" href="/assets/styles/leaflet.css" media="screen" type="text/css">
      
  

  
      
          <script src='/assets/js/leaflet.js' type="text/javascript"></script>
      
          <script src='/assets/js/leaflet-providers.js' type="text/javascript"></script>
      
  
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">

    <!-- Savas logo. -->
    <a href="/" class="logo">
        <img src="/assets/img/logo.png" alt="Savas logo">
    </a>

    <!-- Mobile menu button. -->
    <a href="/" id="js-mobile-menu" class="navigation-menu-button">MENU</a>

    <!-- Main menu. -->
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">

        <!-- Loop through nav items in config.yml. -->
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  more">
            <a href="javascript:void(0)">Who we are</a>

            <!-- If there are sub-links, create them. -->
            

              <ul class="submenu">
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/team">Team</a>
                  </li>
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/mission-and-values">Mission & values</a>
                  </li>
                
              </ul>
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/services">Services</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/work">Our work</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/blog">Blog</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/contact">Contact</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        


<div class="post">
  <header class="post-header">
    <h1 class="post-title">Mapping external GeoJSON data</h1>
    <p>By <a href="/team/tim-stallmann">Tim Stallmann</a></p>
    <p class="centerdot">&centerdot; </p>
    <p>May 18, 2015 </p><br>
    <i class="fa fa-tags"></i><p><a href="/blog/tag/cartography/">Cartography</a>, <a href="/blog/tag/leaflet/">Leaflet.js</a></p>
    
    <div><p><span id="comment-count"></span></p></div>
    
    
  </header>

  

  <article class="post-content">
    <p><a href="http://www.leafletjs.com">Leaflet.js</a> is a powerful, light-weight javascript API for mapping. In this post, I’ll walk through how to use Leaflet to map GeoJSON data. By the end, we’ll have a map of earthquakes in the past 24 hours (using live USGS data) which looks like this:</p>

<p><img class="blog-image-large" src="/assets/img/blog/earthquakes-map.jpg" alt="Screenshot of the map of earthquakes which we'll create in this tutorial." width="500" height="202" /></p>

<h2 id="basic-leaflet-set-up">Basic Leaflet Set-up</h2>

<p>This section largely duplicates the basic Leaflet set-up at <a href="http://leafletjs.com/examples/quick-start.html">this tutorial</a>, except for we also add a Leaflet-providers plugin to get easy access to additional tilesets.</p>

<p>The first step in any mapping project using Leaflet is to add a basic div to your page with <code class="highlighter-rouge">id=map</code>. Leaflet will grab onto this div and insert the map content dynamically. You’ll need to fix the div size using CSS:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nf">#map</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">300px</span><span class="p">;</span> <span class="err">//</span> <span class="err">Or</span> <span class="err">whatever</span> <span class="err">height</span> <span class="err">you</span> <span class="err">like</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Next, we need to add Leaflet javascript and CSS and jQuery javscript to the page. jQuery is needed here to load external GeoJSON through an AJAX call. In a production site, you might want to host these libraries locally.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.11.3.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>

<p>The bulk of the mapping work will take place in custom javascript, which we can either place inline in the HTML file, or in a separate source file. We’ll create a leaflet map object:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s1">'map'</span><span class="p">);</span>
</code></pre>
</div>

<p>Next, we need to add a background layer, or basemap. I like to do this using the <a href="https://github.com/leaflet-extras/leaflet-providers">leaflet-providers</a> plug-in, which gives an easier way to add basemaps from multiple providers without having to manually specify the <a href="http://leafletjs.com/reference.html#tilelayer">URL template strings</a> for each layer.</p>

<p>Download the <code class="highlighter-rouge">leaflet-providers.js</code> file, and save it in the same directory as your working HTML file. In a real site, I would be using <a href="http://www.bower.io">bower</a> and <a href="http://browserify.org/">browserify</a> to manage packages, but that’s a topic for another post entirely. Place this code <em>after</em> the previous script tags.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"leaflet-providers.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>

<p>With leaflet-providers included, we can add a number of different basemaps. Here we’re using free <a href="http://opentopomap.org/about">OpenTopoMap</a> tiles.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">terrainTiles</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">'OpenTopoMap'</span><span class="p">);</span>
<span class="nx">terrainTiles</span><span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Set the initial viewport of the map. Here we're centering on Savas' hometown and zooming out a bit.</span>
<span class="nx">map</span><span class="p">.</span><span class="nx">setView</span><span class="p">([</span><span class="mf">35.9908385</span><span class="p">,</span> <span class="o">-</span><span class="mf">78.9005222</span><span class="p">],</span> <span class="mi">8</span><span class="p">);</span>
</code></pre>
</div>

<h2 id="bringing-in-geojson">Bringing in GeoJSON</h2>

<p>Whether you’re pulling in GeoJSON from external data source or hosting it locally, you’ll need to load the data using AJAX. jQuery provides a standard <code class="highlighter-rouge">getJSON</code> function, which will load JSON from an external source and then fire a callback once the data has loaded. In this example, I’m using the <a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php">USGS geoJSON feed</a> of all recorded earthquakes in the past 24 hours.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">addDataToMap</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dataLayer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">geoJson</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">dataLayer</span><span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">"http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">addDataToMap</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">map</span><span class="p">);</span> <span class="p">});</span>
</code></pre>
</div>

<p>The callback creates a new Leaflet layer object by calling <code class="highlighter-rouge">L.geoJson</code>, and then adds that layer to the map.</p>

<p>Note that within jQuery, JSON is in all caps, whereas Leaflet uses strict camelCase (geoJson).</p>

<p>We need to access the map variable inside <code class="highlighter-rouge">addDataToMap</code>, so I’m using a closure here to pass that along with the data. This is usually not strictly necessary, since depending on how your javascript is written, <code class="highlighter-rouge">map</code> is probably already available within the scope of <code class="highlighter-rouge">addDataToMap</code>. But let’s explicitly pass it here, to avoid being confusing.</p>

<p>Here’s what your map should look like at this point:</p>

<div id="map" style="width: 100%; height: 300px;"></div>
<script type="text/javascript">
L.Icon.Default.imagePath = "/assets/img";
var map = L.map('map');
var terrainTiles = L.tileLayer.provider('OpenTopoMap');
terrainTiles.addTo(map);
map.setView([35.9908385, -78.9005222], 3);

function addDataToMap(data, map) {
    var dataLayer = L.geoJson(data);
    dataLayer.addTo(map);
}

$.getJSON("http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson", function(data) { addDataToMap(data, map); });
</script>

<h2 id="adding-popups">Adding Popups</h2>

<p>Wouldn’t it be nice to be able to click on some of those points and find out more details about the earthquake? So far we haven’t made use of any, but Leaflet allows you to pass a variety of <a href="http://leafletjs.com/reference.html#geojson">callbacks as options to <code class="highlighter-rouge">L.geoJson</code></a>. These include:</p>

<ul>
  <li>pointToLayer( GeoJSON featureData, LatLng latlng )
    <ul>
      <li>Called once for each point feature in the geoJSON. Use this to create a custom marker when data points are added to the map. Returns <a href="http://leafletjs.com/reference.html#marker">L.Marker</a> object.</li>
    </ul>
  </li>
  <li>onEachFeature( GeoJSON featureData, ILayer layer )
    <ul>
      <li>Called after each feature is created and on the map. Use this to add event listeners to the feature.</li>
    </ul>
  </li>
  <li>filter( GeoJSON featureData, ILayer layer )
    <ul>
      <li>Called once for each feature in the dataset to determine whether it should be displayed on the map or not. Returns a boolean true if the feature should be displayed, false otherwise.</li>
    </ul>
  </li>
  <li>coordsToLatLng( Array coords )
    <ul>
      <li>Translates whatever coordinates are in the geoJSON file into latitude and longitude coordinates in WGS 84. Necessary if your GeoJSON data is in a different coordinate system. Returns a <a href="http://leafletjs.com/reference.html#latlng">LatLng</a> object.</li>
    </ul>
  </li>
  <li>style( GeoJSON featureData )
    <ul>
      <li>Generates CSS which applies to the marker for the feature with data <code class="highlighter-rouge">featureData</code>. Returns CSS in the form of a Javascript object.</li>
    </ul>
  </li>
</ul>

<p>Here, we’ll modify <code class="highlighter-rouge">addDataToMap</code> to use <code class="highlighter-rouge">onEachFeature</code> to bind a popup to each feature as it is added. In general with GeoJSON you’ll find additional data associated with each point in <code class="highlighter-rouge">feature.properties</code>. I’m using the USGS properties to add a popup giving the precise location, magnitude, and link to more info for each earthquake.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">addDataToMap</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dataLayer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">geoJson</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">onEachFeature</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">,</span> <span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">popupText</span> <span class="o">=</span> <span class="s2">"Magnitude: "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">mag</span>
                <span class="o">+</span> <span class="s2">"&lt;br&gt;Location: "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">place</span>
                <span class="o">+</span> <span class="s2">"&lt;br&gt;&lt;a href='"</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s2">"'&gt;More info&lt;/a&gt;"</span><span class="p">;</span>
            <span class="nx">layer</span><span class="p">.</span><span class="nx">bindPopup</span><span class="p">(</span><span class="nx">popupText</span><span class="p">);</span> <span class="p">}</span>
        <span class="p">});</span>
    <span class="nx">dataLayer</span><span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>And here’s the “finished” map! Stay tuned for more GeoJSON + Leaflet tutorials from <a href="http://www.savaslabs.com">Savas</a></p>

<p>The final HTML file with inline javascript is also posted <a href="https://gist.github.com/chrisarusso/d7d54a4149830a8baa6d">as a gist here</a>.</p>

<div id="map2" style="width: 100%; height: 300px;"></div>
<script type="text/javascript">
var map2 = L.map('map2');
var terrainTiles2 = L.tileLayer.provider('OpenTopoMap');
terrainTiles2.addTo(map2);
map2.setView([35.9908385, -78.9005222], 3);

function addDataToMap2(data, map) {
    var dataLayer = L.geoJson(data, {
        onEachFeature: function(feature, layer) {
            var popupText = "Magnitude: " + feature.properties.mag
                + "<br>Location: " + feature.properties.place
                + "<br><a href='" + feature.properties.url + "'>More info</a>";
            layer.bindPopup(popupText); }
        });
    dataLayer.addTo(map);
}

$.getJSON("http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson", function(data) { addDataToMap2(data, map2); });
</script>


    <hr>

    
      <div class="post-comments">
  
    <div class="expander">
      <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander-hidden">Comments!</a>
      <div id="js-expander-content" class="expander-content">
        <!-- If there are existing comments, output them here. -->
        <div id="post-comments" class="post-comments"></div>
        <!-- New comment form -->
        <form id="comment-form">
          <h4>Leave a comment</h4>
          <div class="comment-name">
            <p>Name</p> <input type='text' name='name' id='name' required /><br>
          </div>

          <div class="comment-email">
            <p>Email</p> <input type='email' name='email' id='email' required />
            <p class="email-disclaimer">Savas will never sell your email address or spam you.</p><br>
          </div>

          <p>Comment</p>
          <textarea name='comment' id='comment' required></textarea>
          <p class="hint below-textarea">Plain text format only please.</p>

          <input type='hidden' name='slug' id='slug' value='/2015/05/18/mapping-geojson.html' />
          <input type='text' name='url' id='url' />

          <div class='are-you-human'>
            <div class='are-you-human-owl'>
              <img src="/assets/img/owl.png" alt="Savas logo">
            </div>
            <div class='are-you-human-field'>
              <p>What type of animal is the Savas logo?</p>
              <input type='text' name='nocaptcha' id='nocaptcha' class='nocaptcha'>
              <p class="hint">Hint: 3 letters long, starts with an 'o' and ends with an 'l'.</p>
            </div>
          </div>

          <input type='submit' value='Submit' id='submit' class="submit-comment"/>
        </form>
      </div>
    </div>
  
  <hr>
</div>

    
    <div class="post-bottom">
  <div class="post-meta">
    <h4>About the author</h4>
    
      <a href="/team/tim-stallmann">
        <img src="/assets/img/team/tim-stallmann.jpg" alt="Tim Stallmann">
      </a>
      <p class="post-author-desc">Tim is a cartographer and developer at Savas Labs, implementing complex web applications for our clients.</p>
    
  </div>
    <!-- Once we have more content, change this to posts related by tag -->
  <div class="post-related flex-container">
    <h4>Recent posts by Savas</h4>
    <div class="cards">
      
      
        
        
          <div class="card">
            <a href="/2016/06/22/user-testing.html">
              <div class="card-header">
                  Usability Testing - Our Process and Favorite Practices
              </div>
              <div class="card-copy">
                <p>Jun 22, 2016</p>
                <p><p>Our approach to designing, conducting, and learning from user testing and other analyses.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2016/06/16/using-xhprof.html">
              <div class="card-header">
                  Using XHProf to profile your Drupal module
              </div>
              <div class="card-copy">
                <p>Jun 16, 2016</p>
                <p><p>A case study of using XHProf to profile a Drupal module.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2016/06/15/git-merge-conflict-strategies.html">
              <div class="card-header">
                  Strategies and tools for resolving Git merge conflicts
              </div>
              <div class="card-copy">
                <p>Jun 15, 2016</p>
                <p><p>An overview of strategies and tools I like to use when I encounter conflicts during merges.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
</div>

    <div class="previous-next-links">
  <div class="next">
    
      <a href="/2015/05/22/durham-living-wage.html"><i class="fa fa-long-arrow-left "></i> A Durham Living Wage</a>
    
  </div>
  <div class="previous">
    
      <a href="/2015/04/27/durham-restaurant-time-machine.html"> Building a time machine for Durham's food landscape <i class="fa fa-long-arrow-right"></i></a>
    
  </div>
</div>


  </article>

</div>

      </div>
    </div>

    <div class="contact-block">
  <div class="contact-block__items">
    <h3>Interested in working with us?</h3>
    <a href="/contact">Get in touch!</a>
  </div>
</div>
    <footer class="footer" role="contentinfo">
  <div class="footer-links">
    <ul>
      <li><h3>Location</h3></li>
      <li>Savas Labs<br />
          PMB 114<br />
          201 W Main Street, Suite 100<br />
          Durham, NC 27701<br /></li>
    </ul>
    <ul>
      <li><h3>Around the Web</h3></li>
      <ul>
        <li><a href="https://github.com/savaslabs"><span class="mega-octicon octicon-mark-github"></span></a></li>
        <li><a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a></li>
        <li><a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a></li>
        <li><a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a></li>
      </ul>
    </ul>
    <ul>
      <li><h3>Contact</h3></li>
      <li><a href="mailto:info@savaslabs.com">info@savaslabs.com</a></li>
      <li>(919) 432-4660</li>
    </ul>
  </div>

</footer>

<div class="footer-copyright">
  <p>Copyright &copy; Savas Labs 2016</p>
</div>


  </body>

</html>
