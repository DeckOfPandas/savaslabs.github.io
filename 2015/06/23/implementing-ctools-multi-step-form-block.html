<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Implementing a CTools multi-step form in a block | Savas Labs</title>
  
  <meta name="description" content="No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make yo...">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="canonical" href="http://savaslabs.com/2015/06/23/implementing-ctools-multi-step-form-block.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="http://savaslabs.com/feed.xml" />
  
  
  
  



<script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "about": "Some tips on how to implement a Drupal CTools multi-step form entirely in a block.",
      "articleBody": "


&lt;div class=&quot;post&quot;&gt;
  &lt;div class=&quot;post__body&quot;&gt;
    &lt;header class=&quot;post-header&quot;&gt;
      &lt;h1 class=&quot;post-title&quot;&gt;Implementing a CTools multi-step form in a block&lt;/h1&gt;

      

&lt;p&gt;By &lt;a href=&quot;/team/kosta-harlan&quot;&gt;Kosta Harlan&lt;/a&gt;&lt;/p&gt;

      &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
      &lt;p&gt;Jun 23, 2015 &lt;/p&gt;&lt;br&gt;
      &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;&lt;/p&gt;
      
      &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
      
      
    &lt;/header&gt;

    

    &lt;article class=&quot;post-content&quot;&gt;
      &lt;p&gt;No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make your users’ lives easier.&lt;/p&gt;

&lt;p&gt;Drupal’s Form API combined with the CTools module provide a solid platform for building a multi-step form. There are &lt;a href=&quot;https://duckduckgo.com/?q=ctools+multistep+form&quot;&gt;many wonderful guides&lt;/a&gt; on how to build a CTools multi-step form in Drupal. But as far as I can tell, all of the guides assume that the form will live on a page — which makes sense, as that’s the most common use case.&lt;/p&gt;

&lt;p&gt;On a recent project, though, a client asked us to create a multi-step form using only a block, so it could be placed on a page using Panels. It turns out this is pretty straightforward but as it’s not well documented elsewhere, here’s a quick guide to what you need to do. (Note: I created &lt;a href=&quot;git@github.com:savaslabs/ctools_multistep_form_block.git&quot;&gt;an example module on GitHub&lt;/a&gt;, so please reference that as needed. This post is just covering the highlights.)&lt;/p&gt;

&lt;h2 id=&quot;update-your-ctools-form-definition&quot;&gt;Update your CTools form definition&lt;/h2&gt;

&lt;p&gt;In the main CTools form definition, which looks something like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$form_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;quote-form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;ajax&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;path&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example-form/%step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show trail&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show back&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show return&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We need to change path to use query parameters for advancing the form. So let’s change &lt;code class=&quot;highlighter-rouge&quot;&gt;path&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt;. The path &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form&lt;/code&gt; could be generated by a View, a node page, a Panel page, etc.&lt;/p&gt;

&lt;h2 id=&quot;define-the-block&quot;&gt;Define the block&lt;/h2&gt;

&lt;p&gt;Next, we need an implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; is pretty unremarkable so I’m not including it here, other than to say you should consider setting &lt;code class=&quot;highlighter-rouge&quot;&gt;cache&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;DRUPAL_NO_CACHE&lt;/code&gt; when declaring your block. Now, on to &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Implements hook_block_view().
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_block_view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example_form&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;subject&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Our example form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;drupal_get_query_parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;step-one&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;content&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_ctools_wizard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s take a closer look at this. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_get_query_parameters()&lt;/code&gt; is checking to see if there’s a query parameter for &lt;code class=&quot;highlighter-rouge&quot;&gt;step&lt;/code&gt; in the current URL (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;). If so, we set the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to that value; if not, we default to &lt;code class=&quot;highlighter-rouge&quot;&gt;step-one&lt;/code&gt; as the starting point for the form. We then pass in the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to our &lt;code class=&quot;highlighter-rouge&quot;&gt;example_ctools_wizard()&lt;/code&gt; function, which generates the multi-step form.&lt;/p&gt;

&lt;h2 id=&quot;send-the-user-on-their-way&quot;&gt;Send the user on their way&lt;/h2&gt;

&lt;p&gt;So far, so good. But there’s one problem at this stage. If we try to use the form now, we’ll get errors: clicking “Continue” on the form will take you to a 404 page of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost/example-form%3Fstep%3Dstep-two&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;. That’s because CTools runs the path we declared in &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt; through an encoding function.&lt;/p&gt;

&lt;p&gt;The workaround is to use our &lt;code class=&quot;highlighter-rouge&quot;&gt;subtask_next&lt;/code&gt; callback to redirect our user where we want them to go using &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Callback executed when the &#39;next&#39; button is clicked.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_subtask_next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_get_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;example_set_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;array_merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;values&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]));&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// Because we are using query parameters to advance/rewind the form, and
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// Ctools doesn&#39;t like query parameters (URL encoding fails), we&#39;ll use
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// drupal_goto() to take the user where they need to go.
&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;redirect&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;));
  drupal_goto(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;, array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39; =&amp;gt; array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The first two lines are caching form values so that as the user goes back and forth between steps on the form, their data is cached. Moving on: remember how CTools is sending us to a 404 page with the encoded value of the path we want to go to? It turns out the un-encoded value is in &lt;code class=&quot;highlighter-rouge&quot;&gt;$form_state[&#39;redirect&#39;][0]&lt;/code&gt;, in the form of &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form?step=step-two&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Since we know the base path, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;substr()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;strlen()&lt;/code&gt; to extract the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;step=&lt;/code&gt; and then pass that along to &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt; bypasses CTools’ own redirection, and thus we are able to avoid the unwanted encoding of the path, and can send our users happily along their way.&lt;/p&gt;

      &lt;hr&gt;

      
        &lt;div class=&quot;post-comments&quot;&gt;

  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;

      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;

        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;

        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot; class=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--name&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;name&quot;&gt;Name&lt;/label&gt;
            &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; required&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--email&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;email&quot;&gt;Email&lt;/label&gt;
            &lt;input type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot; required&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--comment&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;comment&quot;&gt;Comment&lt;/label&gt;
            &lt;textarea name=&quot;comment&quot; id=&quot;comment&quot; required&gt;&lt;/textarea&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Plain text format only please.&lt;/p&gt;
          &lt;/div&gt;

          &lt;input type=&quot;hidden&quot; name=&quot;slug&quot; id=&quot;slug&quot; value=&quot;/2015/06/23/implementing-ctools-multi-step-form-block.html&quot;&gt;
          &lt;input type=&quot;text&quot; name=&quot;url&quot; id=&quot;url&quot;&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--nocaptcha&quot;&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__image&quot;&gt;
              &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__input&quot;&gt;
              &lt;label class=&quot;comment-form__field__label&quot; for=&quot;nocaptcha&quot;&gt;What type of animal is the Savas Labs logo?&lt;/label&gt;
              &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Hint: 3 letters long, starts with an &quot;o&quot; and ends with an &quot;l&quot;.&lt;/p&gt;
              &lt;input type=&quot;text&quot; name=&quot;nocaptcha&quot; id=&quot;nocaptcha&quot; required&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&quot;submit&quot; value=&quot;Post comment&quot; id=&quot;submit&quot; class=&quot;comment-form__submit&quot;&gt;
        &lt;/form&gt;

      &lt;/div&gt;&lt;!-- comments and comment form --&gt;
    &lt;/div&gt;&lt;!-- expander --&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

      
    &lt;/article&gt;
  &lt;/div&gt;&lt;!-- post__body --&gt;

  
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;

    
    
    
    
    

    
      &lt;h4&gt;About the author&lt;/h4&gt;
    

    

      
      
        &lt;a href=&quot;/team/kosta-harlan&quot;&gt;
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta-harlan-576by546-447515.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg&quot; class=&quot;image--team-post-meta&quot; itemprop=&quot;image&quot; alt=&quot;Kosta Harlan&quot; &gt;
  &lt;/picture&gt;

        &lt;/a&gt;
        &lt;p class=&quot;post-author-desc&quot;&gt;Kosta is responsible for code quality at Savas Labs, keeping up to date with emerging technologies and ensuring our team follows best practices.&lt;/p&gt;
      

      
      

    
  &lt;/div&gt;

  
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas Labs&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/27/on-web-typography-review.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                On Web Typography - a Book Review
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 27, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;A review of Jason Santa Maria’s &lt;em&gt;On Web Typography&lt;/em&gt;, and how we applied the
lessons learned to our workflow.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/20/drupal-docker-pattern-lab.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Docker and the Drupal Pattern Lab Starter Theme
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 20, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern...&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/15/docker-mysql-performance.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Dramatically Improve MySQL Import Performance with Docker
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 15, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;How to dramatically improve MySQL database import performance on Drupal with Docker stacks&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

  

  &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2015/07/06/map-in-drupal-8.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Building a map in Drupal 8&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2015/06/23/a-man-a-plan-a-canal-a-savas.html&quot;&gt; A man a plan a canal a... Savas! &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;!-- post --&gt;
",
      "author": {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Kosta Harlan",
        "affiliation": "Savas Labs",
        "worksFor": "Savas Labs"
      },
      "dateCreated": "2015-06-23 00:00:00 +0000",
      "dateModified": "2015-06-23 00:00:00 +0000",
      "datePublished": "2015-06-23 00:00:00 +0000",
      "headline": "Implementing a CTools multi-step form in a block",
      "inLanguage": "en-US",
      "keywords": "drupal, drupal-planet",
      "mainEntityOfPage": "http://savaslabs.com/2015/06/23/implementing-ctools-multi-step-form-block.html",
      "publisher": {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "Savas Labs",
        "logo": {
          "@context": "http://schema.org",
          "@type": "ImageObject",
          "description": "Savas Labs logo",
          "height": "50px",
          "url": "http://savaslabs.com/assets/img/logo.png",
          "width": "114px"
        }
      },
      "sourceOrganization": "Savas Labs",
      "text": "


&lt;div class=&quot;post&quot;&gt;
  &lt;div class=&quot;post__body&quot;&gt;
    &lt;header class=&quot;post-header&quot;&gt;
      &lt;h1 class=&quot;post-title&quot;&gt;Implementing a CTools multi-step form in a block&lt;/h1&gt;

      

&lt;p&gt;By &lt;a href=&quot;/team/kosta-harlan&quot;&gt;Kosta Harlan&lt;/a&gt;&lt;/p&gt;

      &lt;p class=&quot;centerdot&quot;&gt;&amp;centerdot; &lt;/p&gt;
      &lt;p&gt;Jun 23, 2015 &lt;/p&gt;&lt;br&gt;
      &lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;p&gt;&lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;&lt;/p&gt;
      
      &lt;div&gt;&lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
      
      
    &lt;/header&gt;

    

    &lt;article class=&quot;post-content&quot;&gt;
      &lt;p&gt;No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make your users’ lives easier.&lt;/p&gt;

&lt;p&gt;Drupal’s Form API combined with the CTools module provide a solid platform for building a multi-step form. There are &lt;a href=&quot;https://duckduckgo.com/?q=ctools+multistep+form&quot;&gt;many wonderful guides&lt;/a&gt; on how to build a CTools multi-step form in Drupal. But as far as I can tell, all of the guides assume that the form will live on a page — which makes sense, as that’s the most common use case.&lt;/p&gt;

&lt;p&gt;On a recent project, though, a client asked us to create a multi-step form using only a block, so it could be placed on a page using Panels. It turns out this is pretty straightforward but as it’s not well documented elsewhere, here’s a quick guide to what you need to do. (Note: I created &lt;a href=&quot;git@github.com:savaslabs/ctools_multistep_form_block.git&quot;&gt;an example module on GitHub&lt;/a&gt;, so please reference that as needed. This post is just covering the highlights.)&lt;/p&gt;

&lt;h2 id=&quot;update-your-ctools-form-definition&quot;&gt;Update your CTools form definition&lt;/h2&gt;

&lt;p&gt;In the main CTools form definition, which looks something like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$form_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;quote-form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;ajax&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;path&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example-form/%step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show trail&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show back&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show return&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We need to change path to use query parameters for advancing the form. So let’s change &lt;code class=&quot;highlighter-rouge&quot;&gt;path&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt;. The path &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form&lt;/code&gt; could be generated by a View, a node page, a Panel page, etc.&lt;/p&gt;

&lt;h2 id=&quot;define-the-block&quot;&gt;Define the block&lt;/h2&gt;

&lt;p&gt;Next, we need an implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; is pretty unremarkable so I’m not including it here, other than to say you should consider setting &lt;code class=&quot;highlighter-rouge&quot;&gt;cache&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;DRUPAL_NO_CACHE&lt;/code&gt; when declaring your block. Now, on to &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Implements hook_block_view().
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_block_view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example_form&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;subject&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Our example form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;drupal_get_query_parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;step-one&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;content&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_ctools_wizard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s take a closer look at this. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_get_query_parameters()&lt;/code&gt; is checking to see if there’s a query parameter for &lt;code class=&quot;highlighter-rouge&quot;&gt;step&lt;/code&gt; in the current URL (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;). If so, we set the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to that value; if not, we default to &lt;code class=&quot;highlighter-rouge&quot;&gt;step-one&lt;/code&gt; as the starting point for the form. We then pass in the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to our &lt;code class=&quot;highlighter-rouge&quot;&gt;example_ctools_wizard()&lt;/code&gt; function, which generates the multi-step form.&lt;/p&gt;

&lt;h2 id=&quot;send-the-user-on-their-way&quot;&gt;Send the user on their way&lt;/h2&gt;

&lt;p&gt;So far, so good. But there’s one problem at this stage. If we try to use the form now, we’ll get errors: clicking “Continue” on the form will take you to a 404 page of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost/example-form%3Fstep%3Dstep-two&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;. That’s because CTools runs the path we declared in &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt; through an encoding function.&lt;/p&gt;

&lt;p&gt;The workaround is to use our &lt;code class=&quot;highlighter-rouge&quot;&gt;subtask_next&lt;/code&gt; callback to redirect our user where we want them to go using &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Callback executed when the &#39;next&#39; button is clicked.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_subtask_next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_get_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;example_set_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;array_merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;values&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]));&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// Because we are using query parameters to advance/rewind the form, and
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// Ctools doesn&#39;t like query parameters (URL encoding fails), we&#39;ll use
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// drupal_goto() to take the user where they need to go.
&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;redirect&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;));
  drupal_goto(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;, array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39; =&amp;gt; array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The first two lines are caching form values so that as the user goes back and forth between steps on the form, their data is cached. Moving on: remember how CTools is sending us to a 404 page with the encoded value of the path we want to go to? It turns out the un-encoded value is in &lt;code class=&quot;highlighter-rouge&quot;&gt;$form_state[&#39;redirect&#39;][0]&lt;/code&gt;, in the form of &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form?step=step-two&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Since we know the base path, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;substr()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;strlen()&lt;/code&gt; to extract the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;step=&lt;/code&gt; and then pass that along to &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt; bypasses CTools’ own redirection, and thus we are able to avoid the unwanted encoding of the path, and can send our users happily along their way.&lt;/p&gt;

      &lt;hr&gt;

      
        &lt;div class=&quot;post-comments&quot;&gt;

  
    &lt;div class=&quot;expander&quot;&gt;
      &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander-hidden&quot;&gt;Comments!&lt;/a&gt;

      &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content&quot;&gt;

        &lt;!-- If there are existing comments, output them here. --&gt;
        &lt;div id=&quot;post-comments&quot; class=&quot;post-comments&quot;&gt;&lt;/div&gt;

        &lt;!-- New comment form --&gt;
        &lt;form id=&quot;comment-form&quot; class=&quot;comment-form&quot;&gt;
          &lt;h4&gt;Leave a comment&lt;/h4&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--name&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;name&quot;&gt;Name&lt;/label&gt;
            &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; required&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--email&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;email&quot;&gt;Email&lt;/label&gt;
            &lt;input type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot; required&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;
          &lt;/div&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--comment&quot;&gt;
            &lt;label class=&quot;comment-form__field__label&quot; for=&quot;comment&quot;&gt;Comment&lt;/label&gt;
            &lt;textarea name=&quot;comment&quot; id=&quot;comment&quot; required&gt;&lt;/textarea&gt;
            &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Plain text format only please.&lt;/p&gt;
          &lt;/div&gt;

          &lt;input type=&quot;hidden&quot; name=&quot;slug&quot; id=&quot;slug&quot; value=&quot;/2015/06/23/implementing-ctools-multi-step-form-block.html&quot;&gt;
          &lt;input type=&quot;text&quot; name=&quot;url&quot; id=&quot;url&quot;&gt;

          &lt;div class=&quot;comment-form__field comment-form__field--nocaptcha&quot;&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__image&quot;&gt;
              &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;comment-form__field--nocaptcha__input&quot;&gt;
              &lt;label class=&quot;comment-form__field__label&quot; for=&quot;nocaptcha&quot;&gt;What type of animal is the Savas Labs logo?&lt;/label&gt;
              &lt;p class=&quot;comment-form__field__helptext&quot;&gt;Hint: 3 letters long, starts with an &quot;o&quot; and ends with an &quot;l&quot;.&lt;/p&gt;
              &lt;input type=&quot;text&quot; name=&quot;nocaptcha&quot; id=&quot;nocaptcha&quot; required&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;input type=&quot;submit&quot; value=&quot;Post comment&quot; id=&quot;submit&quot; class=&quot;comment-form__submit&quot;&gt;
        &lt;/form&gt;

      &lt;/div&gt;&lt;!-- comments and comment form --&gt;
    &lt;/div&gt;&lt;!-- expander --&gt;
  
  &lt;hr&gt;
&lt;/div&gt;

      
    &lt;/article&gt;
  &lt;/div&gt;&lt;!-- post__body --&gt;

  
    &lt;div class=&quot;post-bottom&quot;&gt;
  &lt;div class=&quot;post-meta&quot;&gt;

    
    
    
    
    

    
      &lt;h4&gt;About the author&lt;/h4&gt;
    

    

      
      
        &lt;a href=&quot;/team/kosta-harlan&quot;&gt;
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta-harlan-576by546-447515.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg&quot; class=&quot;image--team-post-meta&quot; itemprop=&quot;image&quot; alt=&quot;Kosta Harlan&quot; &gt;
  &lt;/picture&gt;

        &lt;/a&gt;
        &lt;p class=&quot;post-author-desc&quot;&gt;Kosta is responsible for code quality at Savas Labs, keeping up to date with emerging technologies and ensuring our team follows best practices.&lt;/p&gt;
      

      
      

    
  &lt;/div&gt;

  
  &lt;div class=&quot;post-related flex-container&quot;&gt;
    &lt;h4&gt;Recent posts by Savas Labs&lt;/h4&gt;
    &lt;div class=&quot;cards&quot;&gt;
      
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/27/on-web-typography-review.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                On Web Typography - a Book Review
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 27, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;A review of Jason Santa Maria’s &lt;em&gt;On Web Typography&lt;/em&gt;, and how we applied the
lessons learned to our workflow.&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/20/drupal-docker-pattern-lab.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Docker and the Drupal Pattern Lab Starter Theme
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 20, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern...&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
        
          &lt;div class=&quot;card&quot;&gt;
            &lt;a href=&quot;/2017/02/15/docker-mysql-performance.html&quot;&gt;
              &lt;div class=&quot;card-header&quot;&gt;
                Dramatically Improve MySQL Import Performance with Docker
              &lt;/div&gt;
              &lt;div class=&quot;card-copy&quot;&gt;
                &lt;p&gt;Feb 15, 2017&lt;/p&gt;
                
                &lt;p&gt;&lt;p&gt;How to dramatically improve MySQL database import performance on Drupal with Docker stacks&lt;/p&gt;
&lt;/p&gt;
              &lt;/div&gt;
            &lt;/a&gt;
          &lt;/div&gt;
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

  

  &lt;div class=&quot;previous-next-links&quot;&gt;
  &lt;div class=&quot;next&quot;&gt;
    
      &lt;a href=&quot;/2015/07/06/map-in-drupal-8.html&quot;&gt;&lt;i class=&quot;fa fa-long-arrow-left &quot;&gt;&lt;/i&gt; Building a map in Drupal 8&lt;/a&gt;
    
  &lt;/div&gt;
  &lt;div class=&quot;previous&quot;&gt;
    
      &lt;a href=&quot;/2015/06/23/a-man-a-plan-a-canal-a-savas.html&quot;&gt; A man a plan a canal a... Savas! &lt;i class=&quot;fa fa-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    
  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;!-- post --&gt;
",
      "url": "http://savaslabs.com/2015/06/23/implementing-ctools-multi-step-form-block.html"
    }
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  <script>
    !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function l(){d.addEventListener&&d.removeEventListener("load",l),d.media=r||"all"}var a,i=e.document,d=i.createElement("link");if(n)a=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;a=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){a.parentNode.insertBefore(d,n?a:a.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",l),d.onloadcssdefined=f,f(l),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(t){}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){e.clearInterval(n)})}}}(this);
    loadCSS('/assets/styles/main.css');
    loadCSS('https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|Roboto+Slab:300,400|Source+Sans+Pro');
  </script>
  <style>html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.case-studies__case-study .case-study__description a,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link{border:2px solid #fff;border-radius:3px;color:#fff;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif;margin-top:2em;padding:.5em 1em;transition:all .2s ease-in-out}.case-studies__case-study .case-study__description a:focus,.case-studies__case-study .case-study__description a:hover,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link:focus,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link:hover{background-color:#0f7993}.flash-alert{background-color:rgba(242,163,36,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-alert a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-alert a:focus,.flash-alert a:hover{color:rgba(0,0,0,.2)}.flash-error{background-color:rgba(158,2,59,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-error a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-error a:focus,.flash-error a:hover{color:rgba(0,0,0,.2)}.flash-notice{background-color:rgba(246,67,62,.2);color:rgba(2,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-notice a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-notice a:focus,.flash-notice a:hover{color:rgba(0,0,0,.2)}.flash-success{background-color:rgba(5,92,43,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-success a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-success a:focus,.flash-success a:hover{color:rgba(0,0,0,.2)}button,input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none;-webkit-font-smoothing:antialiased;background-color:#0a5365;border-radius:3px;border:none;color:#fff;cursor:pointer;display:inline-block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;font-weight:600;line-height:1;padding:.75em 1em;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;white-space:nowrap}button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{background-color:#031a1f;color:#fff}button:disabled,input[type=button]:disabled,input[type=reset]:disabled,input[type=submit]:disabled{cursor:not-allowed;opacity:.5}fieldset{background-color:#f7f7f7;border:1px solid #ddd;margin:0 0 .75em;padding:1.5em}input,label,select{display:block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em}label{font-weight:600;margin-bottom:.375em}label.required::after{content:"*"}label abbr{display:none}input[type=color],input[type=date],input[type=datetime-local],input[type=datetime],input[type=email],input[type=month],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=time],input[type=url],input[type=week],select[multiple=multiple],textarea{background-color:#fff;border:1px solid #ddd;border-radius:3px;box-shadow:inset 0 1px 3px rgba(0,0,0,.06);box-sizing:border-box;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;margin-bottom:.75em;padding:.5em;transition:border-color;width:100%}input[type=color]:hover,input[type=date]:hover,input[type=datetime-local]:hover,input[type=datetime]:hover,input[type=email]:hover,input[type=month]:hover,input[type=number]:hover,input[type=password]:hover,input[type=search]:hover,input[type=tel]:hover,input[type=text]:hover,input[type=time]:hover,input[type=url]:hover,input[type=week]:hover,select[multiple=multiple]:hover,textarea:hover{border-color:#c4c4c4}input[type=color]:focus,input[type=date]:focus,input[type=datetime-local]:focus,input[type=datetime]:focus,input[type=email]:focus,input[type=month]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=time]:focus,input[type=url]:focus,input[type=week]:focus,select[multiple=multiple]:focus,textarea:focus{border-color:#0a5365;box-shadow:inset 0 1px 3px rgba(0,0,0,.06),0 0 5px rgba(55,112,192,.7);outline:0}textarea{resize:vertical}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none}input[type=checkbox],input[type=radio]{display:inline;margin-right:.375em}input[type=file]{padding-bottom:.75em;width:100%}select{margin-bottom:1.5em;max-width:100%;width:auto}ol,ul{list-style-type:none;margin:0;padding:0}dl{margin-bottom:.75em}dl dt{font-weight:700;margin-top:.75em}dl dd{margin:0}table{-ms-font-feature-settings:"kern","liga","tnum";font-feature-settings:"kern","liga","tnum";border-collapse:collapse;margin:.75em 0;table-layout:fixed;width:100%}th{border-bottom:1px solid #b7b7b7;font-weight:600;padding:.75em 0;text-align:left}td{border-bottom:1px solid #ddd;padding:.75em 0}td .label{font-weight:700}td,th,tr{vertical-align:middle}body{-ms-font-feature-settings:"kern","liga","pnum";font-feature-settings:"kern","liga","pnum";-webkit-font-smoothing:antialiased;color:#333;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;line-height:1.5}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;line-height:1.2;margin:0 0 .75em}p{margin:0 0 .75em}a{color:#0a5365;text-decoration:none;transition:color .1s linear}a:active,a:focus,a:hover{color:#031a1f}a:active,a:focus{outline:0}hr{border-bottom:1px solid #ddd;border-left:none;border-right:none;border-top:none;margin:1.5em 0}img,picture{margin:0;max-width:100%}.table-minimal{border-collapse:separate;border-spacing:0;width:100%}.table-minimal th{text-align:left}.table-minimal td{line-height:1.5}.table-minimal thead th{background-color:#fff;border-bottom:0;padding:.75em 1em}.table-minimal tbody{background-color:#fff}.table-minimal tbody td{border-bottom:0;border-top:1px solid #ddd;padding:.75em 1em}.table-minimal tbody td button{display:inline-block;font-size:.7em;line-height:1.5;margin-bottom:.3em;margin-right:.5em;outline:0;padding:.3em 1em;width:100%}@media screen and (min-width:40em){.table-minimal tbody td button{margin-bottom:0;width:auto}}.table-minimal tbody tr:hover>td,.table-minimal tbody tr:hover>th{background-color:#fafafa}.table-minimal tbody tr:first-child td{border-top:2px solid #ddd}.table-minimal--contact p{display:none}@media screen and (min-width:28.125em){.table-minimal--contact p{display:inline}}.table-minimal--contact .table-minimal--contact__label{width:30%}@media screen and (min-width:28.125em){.table-minimal--contact .table-minimal--contact__label{width:50%}}body{color:#14133b;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}h1,h2,h3,h4,h5,h6{color:#9e023b;font-family:"Roboto Slab",Verdana,sans-serif;font-weight:300}.portfolio h2,.portfolio h3,.portfolio h4,.portfolio h5,.portfolio h6,.post h2,.post h3,.post h4,.post h5,.post h6{margin-top:1.5em}h1{font-size:250%}h2{font-size:200%}h3{font-size:160%}h4{font-size:140%}h5{font-size:120%}h6{font-size:100%}a{color:#0a5365;transition:all .1s linear}a:focus,a:hover{color:#0f7993}.post li a,p a{border-bottom:.1em solid rgba(10,83,101,.1)}.post li a:focus,.post li a:hover,p a:focus,p a:hover{border-bottom:.1em solid #0f7993}.name-description p,.page-description,.post li,.post p,.services__service p,.team-member p{color:#14133b;font-size:1.2em}ul{list-style-type:square}ol{list-style-type:decimal}ol,ul{margin-bottom:1em;margin-left:2em}ol ol,ol ol li,ol ul,ol ul li,ul ol,ul ol li,ul ul,ul ul li{font-size:1em!important}hr{clear:both;margin:3em 0}blockquote{background-color:#f7f7f7;border-left:10px solid rgba(20,19,59,.4);border-radius:0 9px 9px 0;font-style:italic;margin:2em 0;padding:1em;quotes:'\201C' '\201D'}blockquote::before{color:rgba(20,19,59,.4);content:open-quote;font-family:'Source Sans Pro',sans-serif;font-size:4em;line-height:.1em;margin-right:.25em;vertical-align:-.4em}blockquote p{display:inline}.callout{background-color:#14133b;border-left:solid 1em #9e023b;border-radius:6px;margin:1.5em auto;padding:1em;width:100%}.callout p{color:#fff;font-size:1.5em;margin-bottom:0}label{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}.wrapper{max-width:70em;margin-left:auto;margin-right:auto;max-width:70em;padding:3em 1em;vertical-align:baseline}.wrapper::after{clear:both;content:"";display:table}@media screen and (min-width:70em){.wrapper{padding:3em 0}}.flex-container{float:left;display:block;margin-right:2.35765%;width:100%}.flex-container:last-child{margin-right:0}.page-description,.view-all-link,header{text-align:center}.page-description{margin-bottom:2em}@media screen and (min-width:53.75em){.column-8{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.column-8:last-child{margin-right:0}}.view-more-link{font-size:1.2em;text-align:center}.cards{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center}.card{flex-basis:15em;-ms-flex-preferred-size:15em;-moz-flex-grow:1;flex-grow:1;-ms-flex-positive:1;transition:all .2s ease-in-out;background-color:#f7f7f7;border:1px solid #ddd;border-radius:3px;box-shadow:0 2px 4px #e6e6e6;cursor:auto;margin:0 1em 1.5em;position:relative}.card .card-image{max-height:200px;overflow:hidden}.card .card-image img{transition:all .2s ease-in-out;background:#ddd;border-top-left-radius:3px;border-top-right-radius:3px;width:100%}.card .card-header{transition:all .2s ease-in-out;background-color:#f7f7f7;border-bottom:1px solid #ddd;border-radius:3px 3px 0 0;font-family:"Roboto Slab",Verdana,sans-serif;line-height:1.5em;padding:.5em .75em}.card .fa-comment-o{margin-right:4px}.card .card-copy{color:#14133b;font-size:.9em;line-height:1.5em;padding:.75em}.card .card-copy p{margin:0 0 .75em}.card:focus,.card:hover{background-color:#fff}.card:focus .card-image img,.card:hover .card-image img{background:#eaeaea}.card:focus .card-header,.card:hover .card-header{background-color:#fff}.card:active{background-color:#f7f7f7}.card:active .card-header{background-color:#f7f7f7}.team-card{flex-basis:21em;-ms-flex-preferred-size:21em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;transition:all .2s ease-in-out}.team-card .card-image{max-height:350px;overflow:hidden}.team-card .card-image img{position:relative;top:-50px}.team-card .card-header{display:inline-block;font-size:1.1em;padding:.5em .75em 0}.team-card .card-copy{border-top:1px solid #dcdcdc;font-size:1em}.team-card .card-title{display:inline-block;float:right;font-size:.8em;line-height:2em;padding:.75em .75em 0;text-transform:uppercase}.blog-card{flex-basis:20em;-ms-flex-preferred-size:20em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0}.case-studies{margin:3em 0}.case-studies__case-study{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;background-position:top center;background-repeat:no-repeat;background-size:cover;margin:1.5em 0}@media screen and (min-width:40em){.case-studies__case-study{-webkit-box-lines:single;-moz-box-lines:single;box-lines:single;-ms-flex-wrap:nowrap;flex-wrap:nowrap}}.case-studies__case-study a,.case-studies__case-study h3,.case-studies__case-study p{color:#fff;margin-bottom:0}.case-studies__case-study .case-study__description,.case-studies__case-study .case-study__title{padding:1.5em}@media screen and (min-width:40em){.case-studies__case-study .case-study__description,.case-studies__case-study .case-study__title{padding:3em 1.5em}}.case-studies__case-study .case-study__title{padding-bottom:0;text-align:center}@media screen and (min-width:40em){.case-studies__case-study .case-study__title{padding-bottom:6em;width:40%}}.case-studies__case-study .case-study__title h3{font-size:200%}@media screen and (min-width:40em){.case-studies__case-study .case-study__description{width:60%}}.case-studies__case-study .case-study__description a,.case-studies__case-study .case-study__description p{font-size:1.25em;margin-bottom:0}.case-studies__case-study .case-study__description a{display:inline-block;margin-top:1.5em}.case-studies__case-study .case-study__description a i{margin-left:.5em}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-angle-double-down:before{content:""}.fa-building-o:before{content:""}.fa-circle:before{content:""}.fa-comment:before{content:""}.fa-comment-o:before{content:""}.fa-drupal:before{content:""}.fa-envelope-o:before{content:""}.fa-file-text:before{content:""}.fa-github:before{content:""}.fa-globe:before{content:""}.fa-linkedin:before{content:""}.fa-long-arrow-right:before{content:""}.fa-phone:before{content:""}.fa-stack-exchange:before{content:""}.fa-tags:before{content:""}.fa-twitter:before{content:""}.home__cover{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;background:url(/assets/img/home-cover-image/home-cover-code-400.png) #14133b center center no-repeat;background-size:cover;height:88vh;text-align:center}@media only screen and (-webkit-min-device-pixel-ratio:2),only screen and (min--moz-device-pixel-ratio:2),only screen and (min-resolution:192dpi),only screen and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-800.png)}}@media screen and (min-width:25em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-640.png)}}@media only screen and (min-width:25em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:25em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:25em) and (min-resolution:192dpi),only screen and (min-width:25em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1280.png)}}@media screen and (min-width:40em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-860.png);height:78vh}}@media only screen and (min-width:40em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:40em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:40em) and (min-resolution:192dpi),only screen and (min-width:40em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1720.png)}}@media screen and (min-width:53.75em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1120.png);height:88vh}}@media only screen and (min-width:53.75em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min-resolution:192dpi),only screen and (min-width:53.75em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-2240.png)}}@media screen and (min-width:70em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1200.png)}}@media only screen and (min-width:70em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:70em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:70em) and (min-resolution:192dpi),only screen and (min-width:70em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code.png)}}.home__cover .home__cover__heading,.home__cover .home__cover__site-description{margin:0}.home__cover .home__cover__heading{font-size:2em;font-weight:400;margin-top:30px}.home__cover hr{border:solid 2px #0a5365;border-radius:.5px;margin:10px auto 15px;width:170px}.home__cover .home__cover__site-description{color:#fff;font-size:1.5em;line-height:1.3em;width:230px}.home__cover i{color:#0a5365;font-size:2.8em;padding-top:20px}.navigation{background-color:#0a5365;min-height:70px;width:100%;z-index:999}.navigation a{text-decoration:none}.navigation .navigation-wrapper{max-width:70em;margin-left:auto;margin-right:auto;padding:25px 0;position:relative;z-index:9999}.navigation .navigation-wrapper::after{clear:both;content:"";display:table}.navigation .navigation-wrapper::after{clear:both;content:"";display:table}.navigation .logo{background-color:#14133b;border-radius:6px;display:inline-block;float:left;margin:0 0 0 1em;max-height:70px;padding-left:1em;padding-right:1em}@media screen and (min-width:40em){.navigation .logo{float:none;margin:0 auto}}@media screen and (min-width:53.75em){.navigation .logo{float:left;margin:0 0 0 1em}}.navigation .logo img{max-height:70px;padding:.8em 0}.navigation .navigation-menu-button{color:rgba(255,255,255,.7);display:block;float:right;font-weight:700;line-height:70px;margin:0;padding-right:1em;text-transform:uppercase}@media screen and (min-width:40em){.navigation .navigation-menu-button{display:none}}.navigation .navigation-menu-button:focus,.navigation .navigation-menu-button:hover{color:#fff}.navigation nav{float:none;min-height:70px;z-index:9999999}@media screen and (min-width:40em){.navigation nav{clear:left;margin:0 auto}}@media screen and (min-width:53.75em){.navigation nav{clear:none;float:right}}.navigation .navigation-menu{clear:both;display:none;margin:0 auto;overflow:visible;padding:0;-webkit-transform-style:preserve-3d;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .navigation-menu{display:inline;margin:0;padding:0}}.navigation .navigation-menu.show{display:block}.navigation .nav-link{background:#0a5365;display:block;line-height:70px;overflow:hidden;padding-right:.8em;text-align:right;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .nav-link{background:0 0;display:inline;line-height:70px;text-decoration:none;width:auto}}.navigation .nav-link a{color:rgba(255,255,255,.7);display:inline-block;font-size:1.1em;font-weight:400;text-transform:uppercase}@media screen and (min-width:40em){.navigation .nav-link a{padding-right:.5em}}@media screen and (min-width:53.75em){.navigation .nav-link a{padding-right:1em}}.navigation .nav-link a:focus,.navigation .nav-link a:hover{color:#fff}.navigation .active-nav-item a{color:#fff}.navigation .more.nav-link{overflow:visible;padding-right:0}@media screen and (min-width:40em){.navigation .more.nav-link{padding-right:.8em;position:relative}.navigation .more.nav-link>ul>li:first-child a{padding-top:1em}}.navigation .more.nav-link a{padding-right:.8em}.navigation .more.nav-link>a{padding-right:.6em;position:relative}@media screen and (min-width:40em){.navigation .more.nav-link>a{margin-right:1em}}.navigation .more.nav-link>a::after{position:absolute;top:auto;right:-.4em;bottom:auto;left:auto;color:rgba(255,255,255,.7)}@media screen and (min-width:40em){.navigation .more.nav-link>a::after{content:'\25BE'}}.navigation .more.nav-link:focus>.submenu,.navigation .more.nav-link:hover>.submenu{display:block}.navigation .submenu{display:none;padding-left:0}@media screen and (min-width:40em){.navigation .submenu{left:-1em;position:absolute;top:1.5em}}.navigation .submenu li{display:block;padding-right:0}@media screen and (min-width:40em){.navigation .submenu li{line-height:53.84615px}.navigation .submenu li:first-child>a{border-top-left-radius:3px;border-top-right-radius:3px}.navigation .submenu li:last-child>a{border-bottom-left-radius:3px;border-bottom-right-radius:3px;padding-bottom:.7em}}.navigation .submenu li a{background-color:#094857;display:inline-block;text-align:right;width:100%}@media screen and (min-width:40em){.navigation .submenu li a{background-color:#0a5365;padding-left:1em;text-align:left;width:10em}}.post .post__body{max-width:70em;margin-left:auto;margin-right:auto}.post .post__body::after{clear:both;content:"";display:table}@media screen and (min-width:53.75em){.post .post__body{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.post .post__body:last-child{margin-right:0}}.post .post__body .post-header{margin-bottom:1.875em}.post .post__body .post-header p{display:inline}.post .post__body .post-header i{color:#14133b;margin-right:5px}.post .post__body .post-header .centerdot{font-weight:700}.post .post__body .post-header .post-featured-image{margin:3em 0}.post .post__body .disclaimer{background-color:rgba(158,2,59,.1);border:solid 1px rgba(158,2,59,.3);border-radius:5px;margin-bottom:1.875em;padding:1em}.post .post__body .disclaimer h5{margin-top:0}@media screen and (min-width:53.75em){.post .post-bottom{float:left;display:block;margin-right:2.35765%;width:82.94039%;margin-left:8.5298%}.post .post-bottom:last-child{margin-right:0}}@media screen and (min-width:70em){.post .post-bottom{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.post .post-bottom:last-child{margin-right:0}}.previous-next-links .next{float:left;display:block;margin-right:2.35765%;width:48.82117%;float:left}.previous-next-links .next:last-child{margin-right:0}.previous-next-links .previous{float:left;display:block;margin-right:2.35765%;width:48.82117%;float:right;text-align:right}.previous-next-links .previous:last-child{margin-right:0}.services{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap}.services .services__service{margin-bottom:3em}.services .services__service .services__service__icon{float:left}.services .services__service p{display:inline;margin:0}@media screen and (min-width:53.75em){.services--main .services__service{margin-bottom:0;padding:1.5em;width:50%}}.services--main .services__service:last-child{margin-bottom:0}.services--main .services__service .services__service__icon{margin-right:1em}.tag h2{margin-bottom:1em;text-align:center}.tag .view-more-link{margin-top:1.5em}.tag .view-more-link .fa-arrow-right{margin-left:.25em}.tag__related-case-studies{overflow:hidden}.tag__related-case-studies .tag__related-case-studies__content{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study{flex-basis:20em;-ms-flex-preferred-size:20em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;margin:0 .75em 1.5em;text-align:center}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study h3{margin:0 auto;padding:3em 1.5em}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a,.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a:focus,.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a:hover{color:#fff}.tag__related-posts{margin-top:3em;overflow:hidden}.team-member{max-width:70em;margin-left:auto;margin-right:auto}.team-member::after{clear:both;content:"";display:table}@media screen and (min-width:40em){.team-member{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.team-member:last-child{margin-right:0}}.team-member .team-header img{border-radius:3px;max-width:100%;width:350px}.team-member .team-links{margin:1em auto 3em;text-align:center}@media screen and (min-width:40em){.team-member .team-links{width:60%}}@media screen and (min-width:53.75em){.team-member .team-links{width:100%}}.team-member .team-links li{display:inline-block;list-style-type:none;min-width:45%;padding:0 .75em}@media screen and (min-width:53.75em){.team-member .team-links li{min-width:1%}}.team-member .fa-file-text{font-size:13px}.associations{clear:both}.page-work h2{text-align:center}.page-work .case-studies{clear:both}.page-work .client-logos{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:3em}.page-work .client-logos .client-logos__logo{flex-basis:15em;-ms-flex-preferred-size:15em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;margin:0 0 2em;padding:.5em;text-align:center}@media screen and (min-width:30em){.page-work .client-logos .client-logos__logo{margin:0 1em 2em}}.case-study{clear:both}.case-study .case-study__header{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:distribute;-moz-justify-content:space-around;-ms-justify-content:space-around;-o-justify-content:space-around;justify-content:space-around;-ms-flex-pack:distribute;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;background-position:top center;background-repeat:no-repeat;background-size:cover;height:88vh;min-height:320px}@media screen and (min-width:40em){.case-study .case-study__header{height:78vh}}@media screen and (min-width:53.75em){.case-study .case-study__header{height:88vh}}.case-study .case-study__header .case-study__header__text{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;padding:1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text{box-orient:horizontal;-moz-flex-direction:row;flex-direction:row;-ms-flex-direction:row;width:90%}}@media screen and (min-width:53.75em){.case-study .case-study__header .case-study__header__text{width:80%}}.case-study .case-study__header .case-study__header__text h1,.case-study .case-study__header .case-study__header__text h3,.case-study .case-study__header .case-study__header__text li,.case-study .case-study__header .case-study__header__text p{color:#fff}.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{font-size:1.1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{font-size:1.25em}}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--left{border-right:solid 2px #fff;padding-right:1.5em}}.case-study .case-study__header .case-study__header__text .case-study__header__text--left h1{font-size:2em;margin-bottom:1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--left h1{font-size:2.5em}}.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link{display:inline-block;margin-top:1.5em}.case-study .case-study__header .case-study__header__text .case-study__header__text--right{display:none}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--right{flex-basis:280px;-ms-flex-preferred-size:280px;flex-shrink:0;-ms-flex-negative:0;display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;padding:0 0 0 1.5em}.case-study .case-study__header .case-study__header__text .case-study__header__text--right ul{font-style:italic}}.case-study .wrapper{padding:0}</style>
  
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">

    <!-- Savas Labs logo. -->
    <a href="/" class="logo">
        <img width="101px" height="70px" src="http://savaslabs.com/assets/img/logo.png" alt="Savas Labs logo">
    </a>

    <!-- Mobile menu button. -->
    <a href="/" id="js-mobile-menu" class="navigation-menu-button">MENU</a>

    <!-- Main menu. -->
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">

        <!-- Loop through nav items in config.yml. -->
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  more">
            <a href="javascript:void(0)">Who we are</a>

            <!-- If there are sub-links, create them. -->
            

              <ul class="submenu">
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/team">Team</a>
                  </li>
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/mission-and-values">Mission & values</a>
                  </li>
                
              </ul>
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/services">Services</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/work">Our work</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/blog">Blog</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/contact">Contact</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        


<div class="post">
  <div class="post__body">
    <header class="post-header">
      <h1 class="post-title">Implementing a CTools multi-step form in a block</h1>

      

<p>By <a href="/team/kosta-harlan">Kosta Harlan</a></p>

      <p class="centerdot">&centerdot; </p>
      <p>Jun 23, 2015 </p><br>
      <i class="fa fa-tags"></i><p><a href="/blog/tag/drupal/">Drupal</a>, <a href="/blog/tag/drupal-planet/">Drupal Planet</a></p>
      
      <div><p><span id="comment-count"></span></p></div>
      
      
    </header>

    

    <article class="post-content">
      <p>No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make your users’ lives easier.</p>

<p>Drupal’s Form API combined with the CTools module provide a solid platform for building a multi-step form. There are <a href="https://duckduckgo.com/?q=ctools+multistep+form">many wonderful guides</a> on how to build a CTools multi-step form in Drupal. But as far as I can tell, all of the guides assume that the form will live on a page — which makes sense, as that’s the most common use case.</p>

<p>On a recent project, though, a client asked us to create a multi-step form using only a block, so it could be placed on a page using Panels. It turns out this is pretty straightforward but as it’s not well documented elsewhere, here’s a quick guide to what you need to do. (Note: I created <a href="git@github.com:savaslabs/ctools_multistep_form_block.git">an example module on GitHub</a>, so please reference that as needed. This post is just covering the highlights.)</p>

<h2 id="update-your-ctools-form-definition">Update your CTools form definition</h2>

<p>In the main CTools form definition, which looks something like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$form_info</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="s1">'quote-form'</span><span class="p">,</span>
  <span class="s1">'ajax'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="s1">'path'</span> <span class="o">=&gt;</span> <span class="s1">'example-form/%step'</span><span class="p">,</span>
  <span class="s1">'show trail'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="s1">'show back'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="s1">'show return'</span> <span class="o">=&gt;</span> <span class="k">FALSE</span><span class="p">,</span>
<span class="p">);</span>
</code></pre>
</div>

<p>We need to change path to use query parameters for advancing the form. So let’s change <code class="highlighter-rouge">path</code> to <code class="highlighter-rouge">'path' =&gt; 'example-form?step=%step'</code>. The path <code class="highlighter-rouge">example-form</code> could be generated by a View, a node page, a Panel page, etc.</p>

<h2 id="define-the-block">Define the block</h2>

<p>Next, we need an implementation of <code class="highlighter-rouge">hook_block_info()</code> and <code class="highlighter-rouge">hook_block_view()</code>. <code class="highlighter-rouge">hook_block_info()</code> is pretty unremarkable so I’m not including it here, other than to say you should consider setting <code class="highlighter-rouge">cache</code> to <code class="highlighter-rouge">DRUPAL_NO_CACHE</code> when declaring your block. Now, on to <code class="highlighter-rouge">hook_block_view()</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Implements hook_block_view().
 */</span>
<span class="k">function</span> <span class="nf">example_block_view</span><span class="p">(</span><span class="nv">$delta</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$block</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$delta</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'example_form'</span><span class="o">:</span>
      <span class="nv">$block</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Our example form'</span><span class="p">);</span>
      <span class="nv">$parameters</span> <span class="o">=</span> <span class="nx">drupal_get_query_parameters</span><span class="p">();</span>
      <span class="nv">$next_step</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">[</span><span class="s1">'step'</span><span class="p">])</span> <span class="o">?</span> <span class="s1">'step-one'</span> <span class="o">:</span> <span class="nv">$parameters</span><span class="p">[</span><span class="s1">'step'</span><span class="p">];</span>
      <span class="nv">$block</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">example_ctools_wizard</span><span class="p">(</span><span class="nv">$next_step</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Let’s take a closer look at this. <code class="highlighter-rouge">drupal_get_query_parameters()</code> is checking to see if there’s a query parameter for <code class="highlighter-rouge">step</code> in the current URL (e.g. <code class="highlighter-rouge">http://localhost?step=step-two</code>). If so, we set the <code class="highlighter-rouge">$next_step</code> variable to that value; if not, we default to <code class="highlighter-rouge">step-one</code> as the starting point for the form. We then pass in the <code class="highlighter-rouge">$next_step</code> variable to our <code class="highlighter-rouge">example_ctools_wizard()</code> function, which generates the multi-step form.</p>

<h2 id="send-the-user-on-their-way">Send the user on their way</h2>

<p>So far, so good. But there’s one problem at this stage. If we try to use the form now, we’ll get errors: clicking “Continue” on the form will take you to a 404 page of <code class="highlighter-rouge">http://localhost/example-form%3Fstep%3Dstep-two</code> instead of <code class="highlighter-rouge">http://localhost?step=step-two</code>. That’s because CTools runs the path we declared in <code class="highlighter-rouge">'path' =&gt; 'example-form?step=%step'</code> through an encoding function.</p>

<p>The workaround is to use our <code class="highlighter-rouge">subtask_next</code> callback to redirect our user where we want them to go using <code class="highlighter-rouge">drupal_goto()</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Callback executed when the 'next' button is clicked.
 */</span>
<span class="k">function</span> <span class="nf">example_subtask_next</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$values</span> <span class="o">=</span> <span class="p">(</span><span class="k">array</span><span class="p">)</span> <span class="nx">example_get_page_cache</span><span class="p">(</span><span class="s1">'quote'</span><span class="p">);</span>
  <span class="nx">example_set_page_cache</span><span class="p">(</span><span class="s1">'quote'</span><span class="p">,</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$values</span><span class="p">,</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">]));</span>
  <span class="c1">// Because we are using query parameters to advance/rewind the form, and
</span>  <span class="c1">// Ctools doesn't like query parameters (URL encoding fails), we'll use
</span>  <span class="c1">// drupal_goto() to take the user where they need to go.
</span>  <span class="nv">$destination</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$form_state</span><span class="p">[</span><span class="s1">'redirect'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">strlen</span><span class="p">(</span><span class="nx">example</span><span class="o">-</span><span class="nx">form</span><span class="o">?</span><span class="nx">step</span><span class="o">=</span><span class="s1">'));
  drupal_goto('</span><span class="nx">example</span><span class="o">-</span><span class="nx">form</span><span class="s1">', array('</span><span class="nx">query</span><span class="s1">' =&gt; array('</span><span class="nx">step</span><span class="err">'</span> <span class="o">=&gt;</span> <span class="nv">$destination</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The first two lines are caching form values so that as the user goes back and forth between steps on the form, their data is cached. Moving on: remember how CTools is sending us to a 404 page with the encoded value of the path we want to go to? It turns out the un-encoded value is in <code class="highlighter-rouge">$form_state['redirect'][0]</code>, in the form of <code class="highlighter-rouge">example-form?step=step-two</code>.</p>

<p>Since we know the base path, we can use <code class="highlighter-rouge">substr()</code> and <code class="highlighter-rouge">strlen()</code> to extract the value of <code class="highlighter-rouge">step=</code> and then pass that along to <code class="highlighter-rouge">drupal_goto()</code>. <code class="highlighter-rouge">drupal_goto()</code> bypasses CTools’ own redirection, and thus we are able to avoid the unwanted encoding of the path, and can send our users happily along their way.</p>

      <hr>

      
        <div class="post-comments">

  
    <div class="expander">
      <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander-hidden">Comments!</a>

      <div id="js-expander-content" class="expander-content">

        <!-- If there are existing comments, output them here. -->
        <div id="post-comments" class="post-comments"></div>

        <!-- New comment form -->
        <form id="comment-form" class="comment-form">
          <h4>Leave a comment</h4>

          <div class="comment-form__field comment-form__field--name">
            <label class="comment-form__field__label" for="name">Name</label>
            <input type="text" name="name" id="name" required>
          </div>

          <div class="comment-form__field comment-form__field--email">
            <label class="comment-form__field__label" for="email">Email</label>
            <input type="email" name="email" id="email" required>
            <p class="comment-form__field__helptext">Savas Labs will never sell your email address or spam you.</p>
          </div>

          <div class="comment-form__field comment-form__field--comment">
            <label class="comment-form__field__label" for="comment">Comment</label>
            <textarea name="comment" id="comment" required></textarea>
            <p class="comment-form__field__helptext">Plain text format only please.</p>
          </div>

          <input type="hidden" name="slug" id="slug" value="/2015/06/23/implementing-ctools-multi-step-form-block.html">
          <input type="text" name="url" id="url">

          <div class="comment-form__field comment-form__field--nocaptcha">
            <div class="comment-form__field--nocaptcha__image">
              <img src="/assets/img/icons-and-logos/owl.png" alt="Savas Labs logo">
            </div>
            <div class="comment-form__field--nocaptcha__input">
              <label class="comment-form__field__label" for="nocaptcha">What type of animal is the Savas Labs logo?</label>
              <p class="comment-form__field__helptext">Hint: 3 letters long, starts with an "o" and ends with an "l".</p>
              <input type="text" name="nocaptcha" id="nocaptcha" required>
            </div>
          </div>

          <input type="submit" value="Post comment" id="submit" class="comment-form__submit">
        </form>

      </div><!-- comments and comment form -->
    </div><!-- expander -->
  
  <hr>
</div>

      
    </article>
  </div><!-- post__body -->

  
    <div class="post-bottom">
  <div class="post-meta">

    
    
    
    
    

    
      <h4>About the author</h4>
    

    

      
      
        <a href="/team/kosta-harlan">
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/kosta-harlan-576by546-447515.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg" class="image--team-post-meta" itemprop="image" alt="Kosta Harlan" >
  </picture>

        </a>
        <p class="post-author-desc">Kosta is responsible for code quality at Savas Labs, keeping up to date with emerging technologies and ensuring our team follows best practices.</p>
      

      
      

    
  </div>

  
  <div class="post-related flex-container">
    <h4>Recent posts by Savas Labs</h4>
    <div class="cards">
      
      
        
        
          <div class="card">
            <a href="/2017/02/27/on-web-typography-review.html">
              <div class="card-header">
                On Web Typography - a Book Review
              </div>
              <div class="card-copy">
                <p>Feb 27, 2017</p>
                
                <p><p>A review of Jason Santa Maria’s <em>On Web Typography</em>, and how we applied the
lessons learned to our workflow.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2017/02/20/drupal-docker-pattern-lab.html">
              <div class="card-header">
                Docker and the Drupal Pattern Lab Starter Theme
              </div>
              <div class="card-copy">
                <p>Feb 20, 2017</p>
                
                <p><p>This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern...</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2017/02/15/docker-mysql-performance.html">
              <div class="card-header">
                Dramatically Improve MySQL Import Performance with Docker
              </div>
              <div class="card-copy">
                <p>Feb 15, 2017</p>
                
                <p><p>How to dramatically improve MySQL database import performance on Drupal with Docker stacks</p>
</p>
              </div>
            </a>
          </div>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
</div>

  

  <div class="previous-next-links">
  <div class="next">
    
      <a href="/2015/07/06/map-in-drupal-8.html"><i class="fa fa-long-arrow-left "></i> Building a map in Drupal 8</a>
    
  </div>
  <div class="previous">
    
      <a href="/2015/06/23/a-man-a-plan-a-canal-a-savas.html"> A man a plan a canal a... Savas! <i class="fa fa-long-arrow-right"></i></a>
    
  </div>
</div>

</div><!-- post -->

      </div>
    </div>

    
    
      <div class="contact-block">
  <div class="contact-block__items">
    <h3>Interested in working with us?</h3>
    <a href="/contact">Get in touch!</a>
  </div>
</div>
    

    <footer class="footer" role="contentinfo">
  <div class="footer-links">
    <ul>
      <li><h3>Location</h3></li>
      <li>Savas Labs<br />
          PMB 210<br />
          201 W Main Street, Suite 100<br />
          Durham, NC 27701<br /></li>
    </ul>
    <ul>
      <li><h3>Around the Web</h3></li>
      <ul>
        <li><a href="https://github.com/savaslabs"><span class="fa fa-github fa-lg fa-2x"></span></a></li>
        <li><a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a></li>
        <li><a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a></li>
        <li><a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a></li>
      </ul>
    </ul>
    <ul>
      <li><h3>Contact</h3></li>
      <li><a href="mailto:info@savaslabs.com">info@savaslabs.com</a></li>
      <li>(919) 432-4660</li>
    </ul>
  </div>

</footer>

<div class="footer-copyright">
  <p>Copyright &copy; Savas Labs 2017</p>
</div>

    <script type="text/javascript" src="http://savaslabs.com/assets/js/main.js" async></script>

<noscript>
  <link href='/assets/styles/main.css' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Source+Sans+Pro' rel='stylesheet' type='text/css'>
</noscript>

  </body>

</html>
