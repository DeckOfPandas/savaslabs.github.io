<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cache-control" content="public">
  <meta http-equiv="expires" content="86400">
  
  <title>Implementing a CTools multi-step form in a block | Savas Labs</title>
  
  <meta name="description" content="No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make yo...">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="canonical" href="http://savaslabs.com/2015/06/23/implementing-ctools-multi-step-form-block.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="http://savaslabs.com/feed.xml" />
  
  
  
  



<script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "about": "Some tips on how to implement a Drupal CTools multi-step form entirely in a block.",
      "articleBody": "







&lt;div class=&quot;outer-container&quot;&gt;
  &lt;div class=&quot;page--post__main&quot;&gt;
    &lt;div class=&quot;region--featured-image&quot;&gt;
      
      &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1245by700-89f5b6.jpg&quot; media=&quot;(min-width: 1120px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 1120px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-959by539-89f5b6.jpg&quot; media=&quot;(min-width: 1120px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1246by700-89f5b6.jpg&quot; media=&quot;(min-width: 860px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 860px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-746by419-89f5b6.jpg&quot; media=&quot;(min-width: 860px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1244by700-89f5b6.jpg&quot; media=&quot;(min-width: 640px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 640px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-860by484-89f5b6.jpg&quot; media=&quot;(min-width: 640px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1244by700-89f5b6.jpg&quot; media=&quot;(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-640by360-89f5b6.jpg&quot; media=&quot;(min-width: 400px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-800by450-89f5b6.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-400by225-89f5b6.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/blog/default-400by225-89f5b6.jpg&quot; class=&quot;image--post-featured-image&quot; itemprop=&quot;image&quot; alt=&quot;Savas Labs blog&quot; &gt;
  &lt;/picture&gt;

      
    &lt;/div&gt;
    &lt;div class=&quot;region--post-header&quot;&gt;
      &lt;h1 class=&quot;region--post-header__title&quot;&gt;Implementing a CTools multi-step form in a block&lt;/h1&gt;
      &lt;div class=&quot;region--post-header__post-info&quot;&gt;
        &lt;div class=&quot;region--post-header__post-info__authors&quot;&gt;
          
&lt;div class=&quot;post-author&quot;&gt;
  &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-120by120-c7115d.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-60by60-c7115d.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-60by60-c7115d.jpg&quot; class=&quot;image--team-blog-tile&quot; itemprop=&quot;image&quot; alt=&quot;Kosta Harlan&quot; &gt;
  &lt;/picture&gt;

  &lt;p class=&quot;post-author__name&quot;&gt;By &lt;a href=&quot;/team/kosta-harlan&quot;&gt;Kosta Harlan&lt;/a&gt;&lt;/p&gt;
  &lt;p class=&quot;post-author__title&quot;&gt;Director of Technology&lt;/p&gt;
&lt;/div&gt;

        &lt;/div&gt;
        &lt;div class=&quot;region--post-header__post-info__stats&quot;&gt;
          &lt;p&gt;&lt;i class=&quot;fa fa-calendar&quot;&gt;&lt;/i&gt;Jun 23, 2015 &lt;/p&gt;
          &lt;p&gt;&lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;&lt;/p&gt;
          
          &lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;
          
        &lt;/div&gt;
      &lt;/div&gt;
      
    &lt;/div&gt;
    &lt;article class=&quot;region--post-content&quot;&gt;
      &lt;p&gt;No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make your users’ lives easier.&lt;/p&gt;

&lt;p&gt;Drupal’s Form API combined with the CTools module provide a solid platform for building a multi-step form. There are &lt;a href=&quot;https://duckduckgo.com/?q=ctools+multistep+form&quot;&gt;many wonderful guides&lt;/a&gt; on how to build a CTools multi-step form in Drupal. But as far as I can tell, all of the guides assume that the form will live on a page — which makes sense, as that’s the most common use case.&lt;/p&gt;

&lt;p&gt;On a recent project, though, a client asked us to create a multi-step form using only a block, so it could be placed on a page using Panels. It turns out this is pretty straightforward but as it’s not well documented elsewhere, here’s a quick guide to what you need to do. (Note: I created &lt;a href=&quot;git@github.com:savaslabs/ctools_multistep_form_block.git&quot;&gt;an example module on GitHub&lt;/a&gt;, so please reference that as needed. This post is just covering the highlights.)&lt;/p&gt;

&lt;h2 id=&quot;update-your-ctools-form-definition&quot;&gt;Update your CTools form definition&lt;/h2&gt;

&lt;p&gt;In the main CTools form definition, which looks something like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$form_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;quote-form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;ajax&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;path&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example-form/%step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show trail&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show back&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show return&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We need to change path to use query parameters for advancing the form. So let’s change &lt;code class=&quot;highlighter-rouge&quot;&gt;path&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt;. The path &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form&lt;/code&gt; could be generated by a View, a node page, a Panel page, etc.&lt;/p&gt;

&lt;h2 id=&quot;define-the-block&quot;&gt;Define the block&lt;/h2&gt;

&lt;p&gt;Next, we need an implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; is pretty unremarkable so I’m not including it here, other than to say you should consider setting &lt;code class=&quot;highlighter-rouge&quot;&gt;cache&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;DRUPAL_NO_CACHE&lt;/code&gt; when declaring your block. Now, on to &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Implements hook_block_view().
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_block_view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example_form&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;subject&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Our example form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;drupal_get_query_parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;step-one&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;content&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_ctools_wizard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s take a closer look at this. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_get_query_parameters()&lt;/code&gt; is checking to see if there’s a query parameter for &lt;code class=&quot;highlighter-rouge&quot;&gt;step&lt;/code&gt; in the current URL (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;). If so, we set the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to that value; if not, we default to &lt;code class=&quot;highlighter-rouge&quot;&gt;step-one&lt;/code&gt; as the starting point for the form. We then pass in the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to our &lt;code class=&quot;highlighter-rouge&quot;&gt;example_ctools_wizard()&lt;/code&gt; function, which generates the multi-step form.&lt;/p&gt;

&lt;h2 id=&quot;send-the-user-on-their-way&quot;&gt;Send the user on their way&lt;/h2&gt;

&lt;p&gt;So far, so good. But there’s one problem at this stage. If we try to use the form now, we’ll get errors: clicking “Continue” on the form will take you to a 404 page of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost/example-form%3Fstep%3Dstep-two&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;. That’s because CTools runs the path we declared in &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt; through an encoding function.&lt;/p&gt;

&lt;p&gt;The workaround is to use our &lt;code class=&quot;highlighter-rouge&quot;&gt;subtask_next&lt;/code&gt; callback to redirect our user where we want them to go using &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Callback executed when the &#39;next&#39; button is clicked.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_subtask_next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_get_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;example_set_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;array_merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;values&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]));&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// Because we are using query parameters to advance/rewind the form, and
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// Ctools doesn&#39;t like query parameters (URL encoding fails), we&#39;ll use
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// drupal_goto() to take the user where they need to go.
&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;redirect&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;));
  drupal_goto(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;, array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39; =&amp;gt; array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The first two lines are caching form values so that as the user goes back and forth between steps on the form, their data is cached. Moving on: remember how CTools is sending us to a 404 page with the encoded value of the path we want to go to? It turns out the un-encoded value is in &lt;code class=&quot;highlighter-rouge&quot;&gt;$form_state[&#39;redirect&#39;][0]&lt;/code&gt;, in the form of &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form?step=step-two&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Since we know the base path, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;substr()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;strlen()&lt;/code&gt; to extract the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;step=&lt;/code&gt; and then pass that along to &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt; bypasses CTools’ own redirection, and thus we are able to avoid the unwanted encoding of the path, and can send our users happily along their way.&lt;/p&gt;

    &lt;/article&gt;
  &lt;/div&gt;
  &lt;div class=&quot;region--prev-next-links region--prev-next-links--mobile pagination&quot;&gt;
    &lt;div class=&quot;outer-container&quot;&gt;
  
  &lt;a href=&quot;/2015/06/23/a-man-a-plan-a-canal-a-savas.html&quot; class=&quot;pagination__previous&quot;&gt;&lt;i class=&quot;fa fa-angle-left &quot;&gt;&lt;/i&gt; Prev&lt;/a&gt;
  
  &lt;a href=&quot;/blog&quot; class=&quot;pagination__view-all&quot;&gt;View All Blog Posts&lt;/a&gt;
  
  &lt;a href=&quot;/2015/07/06/map-in-drupal-8.html&quot; class=&quot;pagination__next&quot;&gt; Next &lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
  
&lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;page--post__aside region--post-aside&quot;&gt;
    &lt;div class=&quot;region--post-aside__section__wrapper--posts&quot;&gt;
      &lt;div class=&quot;region--post-aside__section region--post-aside__section--posts&quot;&gt;
        &lt;h2 class=&quot;heading--sans-serif c-grey h3&quot;&gt;Related Blog Posts&lt;/h2&gt;
        &lt;div class=&quot;region--post-aside__section__items region--post-aside__section--posts__items&quot;&gt;
          

















&lt;div class=&quot;tile--blog tile--blog--detailed tile&quot;&gt;
  &lt;a href=&quot;/2017/03/06/five-drupal-8-tips-to-empower-content-authors.html&quot; class=&quot;tile--blog__link&quot;&gt;
    &lt;div class=&quot;tile--blog__content tile__content bg-light-teal&quot;&gt;
      
      &lt;div class=&quot;tile--blog__image&quot; style=&quot;background-image: url(/assets/img/blog/content-authoring-d8.jpg);&quot;&gt;
        
        
        
        &lt;p class=&quot;tile--blog--detailed__primary-tag&quot;&gt;Drupal&lt;/p&gt;
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      &lt;/div&gt;
      &lt;div class=&quot;tile--blog__post-title&quot;&gt;
        &lt;p&gt;Five Drupal 8 Tips to Empower Content Authors&lt;/p&gt;

        &lt;div class=&quot;tile--blog--detailed__author&quot;&gt;
          
          
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-120by122-82a418.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg&quot; class=&quot;image--team-blog-tile&quot; itemprop=&quot;image&quot; alt=&quot;Oksana Cyrwus&quot; &gt;
  &lt;/picture&gt;

          
          
        &lt;/div&gt;
        &lt;div class=&quot;tile--blog--detailed__author-bg&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;tile--blog__hover tile__hover bg-orange&quot;&gt;
      &lt;p&gt;Five Drupal 8 tips to make the content authoring experience more enjoyable and productive!&lt;/p&gt;

      &lt;p class=&quot;link--cta link--cta--inverse&quot;&gt;Read more&lt;/p&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;



















&lt;div class=&quot;tile--blog tile--blog--detailed tile&quot;&gt;
  &lt;a href=&quot;/2017/02/20/drupal-docker-pattern-lab.html&quot; class=&quot;tile--blog__link&quot;&gt;
    &lt;div class=&quot;tile--blog__content tile__content bg-light-teal&quot;&gt;
      
      &lt;div class=&quot;tile--blog__image&quot; style=&quot;background-image: url(/assets/img/blog/docker-drupal-pattern-lab.jpg);&quot;&gt;
        
        
        
        &lt;p class=&quot;tile--blog--detailed__primary-tag&quot;&gt;Drupal&lt;/p&gt;
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      &lt;/div&gt;
      &lt;div class=&quot;tile--blog__post-title&quot;&gt;
        &lt;p&gt;Docker and the Drupal Pattern Lab Starter Theme&lt;/p&gt;

        &lt;div class=&quot;tile--blog--detailed__author&quot;&gt;
          
          
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-120by120-370cd4.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg&quot; class=&quot;image--team-blog-tile&quot; itemprop=&quot;image&quot; alt=&quot;Dan Murphy&quot; &gt;
  &lt;/picture&gt;

          
          
        &lt;/div&gt;
        &lt;div class=&quot;tile--blog--detailed__author-bg&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;tile--blog__hover tile__hover bg-orange&quot;&gt;
      &lt;p&gt;This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern Lab Starter theme and/or with other common front-end applications such as npm, Gulp, and Bower.&lt;/p&gt;

      &lt;p class=&quot;link--cta link--cta--inverse&quot;&gt;Read more&lt;/p&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;




























































































































































































































































































        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;region--post-aside__section__wrapper--case-studies&quot;&gt;
      &lt;div class=&quot;region--post-aside__section region--post-aside__section--case-studies&quot;&gt;
        &lt;h2 class=&quot;heading--sans-serif c-grey h3&quot;&gt;Related Case Studies&lt;/h2&gt;
        &lt;div class=&quot;region--post-aside__section__items region--post-aside__section--posts__items&quot;&gt;
          







&lt;div class=&quot;case-study-block&quot;&gt;
  &lt;a class=&quot;case-study-block__link&quot; href=&quot;/results/case-studies/duke-today/&quot;&gt;
    &lt;div class=&quot;case-study-block__image&quot; style=&quot;background-image: url(/assets/img/work/logos/duke-today-logo-eggshell.png);&quot;&gt;
      &lt;img src=&quot;/assets/img/work/duke-today/duke-today-block.jpg&quot; alt=&quot;Duke Today Redesign&quot;&gt;
    &lt;/div&gt;
    
    &lt;h3 class=&quot;case-study-block__title&quot;&gt;Duke Today Redesign&lt;/h3&gt;
    
    &lt;div class=&quot;case-study-block__tags&quot;&gt;
      
      
      &lt;p&gt;Drupal &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Content Migration &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;UX &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Docker &lt;/p&gt;
      
      
      
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;












&lt;div class=&quot;case-study-block&quot;&gt;
  &lt;a class=&quot;case-study-block__link&quot; href=&quot;/results/case-studies/hptn/&quot;&gt;
    &lt;div class=&quot;case-study-block__image&quot; style=&quot;background-image: url(/assets/img/work/logos/hptn-logo-eggshell.png);&quot;&gt;
      &lt;img src=&quot;/assets/img/work/hptn/hptn-block.jpg&quot; alt=&quot;HIV Prevention Trials Network (HPTN) Site Redesign&quot;&gt;
    &lt;/div&gt;
    
    &lt;h3 class=&quot;case-study-block__title&quot;&gt;HIV Prevention Trials Network (HPTN) Site Redesign&lt;/h3&gt;
    
    &lt;div class=&quot;case-study-block__tags&quot;&gt;
      
      
      &lt;p&gt;Drupal 8 &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Responsive Design &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;UX &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Client Server Integration &lt;/p&gt;
      
      
      
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;







































        &lt;/div&gt;
        &lt;div class=&quot;region--post-aside__section--case-studies__cta flex-center&quot;&gt;
          &lt;a href=&quot;/results&quot; class=&quot;button--arrow--orange&quot;&gt;Our work&lt;/a&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;region--prev-next-links region--prev-next-links--post pagination&quot;&gt;
  &lt;div class=&quot;outer-container&quot;&gt;
  
  &lt;a href=&quot;/2015/06/23/a-man-a-plan-a-canal-a-savas.html&quot; class=&quot;pagination__previous&quot;&gt;&lt;i class=&quot;fa fa-angle-left &quot;&gt;&lt;/i&gt; Prev&lt;/a&gt;
  
  &lt;a href=&quot;/blog&quot; class=&quot;pagination__view-all&quot;&gt;View All Blog Posts&lt;/a&gt;
  
  &lt;a href=&quot;/2015/07/06/map-in-drupal-8.html&quot; class=&quot;pagination__next&quot;&gt; Next &lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
  
&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;region--comments&quot;&gt;
  
  &lt;div class=&quot;expander&quot;&gt;
    &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander--hidden&quot;&gt;
      &lt;p id=&quot;comments-trigger&quot;&gt;Comments&lt;/p&gt;
    &lt;/a&gt;
    &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content region&quot;&gt;

      &lt;!-- If there are existing comments, output them here. --&gt;
      &lt;div id=&quot;region--comments__comments&quot; class=&quot;region--comments__comments&quot;&gt;&lt;/div&gt;
      &lt;form id=&quot;form--comment&quot; class=&quot;form--comment&quot;&gt;
  &lt;div class=&quot;form--comment__row&quot;&gt;
    &lt;div class=&quot;form--comment__row__item&quot;&gt;
      &lt;div class=&quot;form--comment__field form--comment__field--name&quot;&gt;
        &lt;label for=&quot;name&quot;&gt;Name&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; required&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form--comment__field form--comment__field--email&quot;&gt;
        &lt;label for=&quot;email&quot;&gt;Email&lt;/label&gt;
        &lt;input type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot; required&gt;
        &lt;p class=&quot;form--comment__helptext&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form--comment__field form--comment__field--comment form--comment__row__item&quot;&gt;
      &lt;label for=&quot;comment&quot;&gt;Comment&lt;/label&gt;
      &lt;textarea name=&quot;comment&quot; id=&quot;comment&quot; rows=&quot;4&quot; required&gt;&lt;/textarea&gt;
      &lt;p class=&quot;form--comment__helptext&quot;&gt;Plain text format only please.&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;input type=&quot;hidden&quot; name=&quot;slug&quot; id=&quot;slug&quot; value=&quot;/2015/06/23/implementing-ctools-multi-step-form-block.html&quot;&gt;
  &lt;input type=&quot;text&quot; name=&quot;url&quot; id=&quot;url&quot;&gt;

  &lt;div class=&quot;form--comment__row&quot;&gt;
    &lt;div class=&quot;form--comment__field form--comment__field--nocaptcha form--comment__row__item&quot;&gt;
      &lt;div class=&quot;form--comment__field--nocaptcha__image&quot;&gt;
        &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form--comment__field--nocaptcha__input&quot;&gt;
        &lt;label for=&quot;nocaptcha&quot;&gt;What type of animal is the Savas Labs logo?&lt;/label&gt;
        &lt;p class=&quot;form--comment__helptext&quot;&gt;Hint: 3 letters long, starts with an &quot;o&quot; and ends with an &quot;l&quot;.&lt;/p&gt;
        &lt;input type=&quot;text&quot; name=&quot;nocaptcha&quot; id=&quot;nocaptcha&quot; required&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form--comment__row__item&quot;&gt;
      &lt;input type=&quot;submit&quot; value=&quot;Post comment&quot; id=&quot;submit&quot; class=&quot;form--comment__submit&quot;&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/form&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  
&lt;/div&gt;
",
      "author": {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Kosta Harlan",
        "affiliation": "Savas Labs",
        "worksFor": "Savas Labs"
      },
      "dateCreated": "2015-06-23 00:00:00 +0000",
      "dateModified": "2015-06-23 00:00:00 +0000",
      "datePublished": "2015-06-23 00:00:00 +0000",
      "headline": "Implementing a CTools multi-step form in a block",
      "inLanguage": "en-US",
      "keywords": "drupal, drupal-planet",
      "mainEntityOfPage": "http://savaslabs.com/2015/06/23/implementing-ctools-multi-step-form-block.html",
      "publisher": {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "Savas Labs",
        "logo": {
          "@context": "http://schema.org",
          "@type": "ImageObject",
          "description": "Savas Labs logo",
          "height": "50px",
          "url": "http://savaslabs.com/assets/img/logo.png",
          "width": "114px"
        }
      },
      "sourceOrganization": "Savas Labs",
      "text": "







&lt;div class=&quot;outer-container&quot;&gt;
  &lt;div class=&quot;page--post__main&quot;&gt;
    &lt;div class=&quot;region--featured-image&quot;&gt;
      
      &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1245by700-89f5b6.jpg&quot; media=&quot;(min-width: 1120px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 1120px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-959by539-89f5b6.jpg&quot; media=&quot;(min-width: 1120px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1246by700-89f5b6.jpg&quot; media=&quot;(min-width: 860px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 860px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-746by419-89f5b6.jpg&quot; media=&quot;(min-width: 860px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1244by700-89f5b6.jpg&quot; media=&quot;(min-width: 640px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 640px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-860by484-89f5b6.jpg&quot; media=&quot;(min-width: 640px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-1244by700-89f5b6.jpg&quot; media=&quot;(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-640by360-89f5b6.jpg&quot; media=&quot;(min-width: 400px)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-800by450-89f5b6.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/blog/default-400by225-89f5b6.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/blog/default-400by225-89f5b6.jpg&quot; class=&quot;image--post-featured-image&quot; itemprop=&quot;image&quot; alt=&quot;Savas Labs blog&quot; &gt;
  &lt;/picture&gt;

      
    &lt;/div&gt;
    &lt;div class=&quot;region--post-header&quot;&gt;
      &lt;h1 class=&quot;region--post-header__title&quot;&gt;Implementing a CTools multi-step form in a block&lt;/h1&gt;
      &lt;div class=&quot;region--post-header__post-info&quot;&gt;
        &lt;div class=&quot;region--post-header__post-info__authors&quot;&gt;
          
&lt;div class=&quot;post-author&quot;&gt;
  &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-120by120-c7115d.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-60by60-c7115d.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-60by60-c7115d.jpg&quot; class=&quot;image--team-blog-tile&quot; itemprop=&quot;image&quot; alt=&quot;Kosta Harlan&quot; &gt;
  &lt;/picture&gt;

  &lt;p class=&quot;post-author__name&quot;&gt;By &lt;a href=&quot;/team/kosta-harlan&quot;&gt;Kosta Harlan&lt;/a&gt;&lt;/p&gt;
  &lt;p class=&quot;post-author__title&quot;&gt;Director of Technology&lt;/p&gt;
&lt;/div&gt;

        &lt;/div&gt;
        &lt;div class=&quot;region--post-header__post-info__stats&quot;&gt;
          &lt;p&gt;&lt;i class=&quot;fa fa-calendar&quot;&gt;&lt;/i&gt;Jun 23, 2015 &lt;/p&gt;
          &lt;p&gt;&lt;i class=&quot;fa fa-tags&quot;&gt;&lt;/i&gt;&lt;a href=&quot;/blog/tag/drupal/&quot;&gt;Drupal&lt;/a&gt;, &lt;a href=&quot;/blog/tag/drupal-planet/&quot;&gt;Drupal Planet&lt;/a&gt;&lt;/p&gt;
          
          &lt;p&gt;&lt;span id=&quot;comment-count&quot;&gt;&lt;/span&gt;&lt;/p&gt;
          
        &lt;/div&gt;
      &lt;/div&gt;
      
    &lt;/div&gt;
    &lt;article class=&quot;region--post-content&quot;&gt;
      &lt;p&gt;No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make your users’ lives easier.&lt;/p&gt;

&lt;p&gt;Drupal’s Form API combined with the CTools module provide a solid platform for building a multi-step form. There are &lt;a href=&quot;https://duckduckgo.com/?q=ctools+multistep+form&quot;&gt;many wonderful guides&lt;/a&gt; on how to build a CTools multi-step form in Drupal. But as far as I can tell, all of the guides assume that the form will live on a page — which makes sense, as that’s the most common use case.&lt;/p&gt;

&lt;p&gt;On a recent project, though, a client asked us to create a multi-step form using only a block, so it could be placed on a page using Panels. It turns out this is pretty straightforward but as it’s not well documented elsewhere, here’s a quick guide to what you need to do. (Note: I created &lt;a href=&quot;git@github.com:savaslabs/ctools_multistep_form_block.git&quot;&gt;an example module on GitHub&lt;/a&gt;, so please reference that as needed. This post is just covering the highlights.)&lt;/p&gt;

&lt;h2 id=&quot;update-your-ctools-form-definition&quot;&gt;Update your CTools form definition&lt;/h2&gt;

&lt;p&gt;In the main CTools form definition, which looks something like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$form_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;id&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;quote-form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;ajax&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;path&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example-form/%step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show trail&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show back&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;&#39;show return&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We need to change path to use query parameters for advancing the form. So let’s change &lt;code class=&quot;highlighter-rouge&quot;&gt;path&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt;. The path &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form&lt;/code&gt; could be generated by a View, a node page, a Panel page, etc.&lt;/p&gt;

&lt;h2 id=&quot;define-the-block&quot;&gt;Define the block&lt;/h2&gt;

&lt;p&gt;Next, we need an implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_info()&lt;/code&gt; is pretty unremarkable so I’m not including it here, other than to say you should consider setting &lt;code class=&quot;highlighter-rouge&quot;&gt;cache&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;DRUPAL_NO_CACHE&lt;/code&gt; when declaring your block. Now, on to &lt;code class=&quot;highlighter-rouge&quot;&gt;hook_block_view()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Implements hook_block_view().
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_block_view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$delta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;example_form&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;subject&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Our example form&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;drupal_get_query_parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;step-one&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;step&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;content&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_ctools_wizard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$next_step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s take a closer look at this. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_get_query_parameters()&lt;/code&gt; is checking to see if there’s a query parameter for &lt;code class=&quot;highlighter-rouge&quot;&gt;step&lt;/code&gt; in the current URL (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;). If so, we set the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to that value; if not, we default to &lt;code class=&quot;highlighter-rouge&quot;&gt;step-one&lt;/code&gt; as the starting point for the form. We then pass in the &lt;code class=&quot;highlighter-rouge&quot;&gt;$next_step&lt;/code&gt; variable to our &lt;code class=&quot;highlighter-rouge&quot;&gt;example_ctools_wizard()&lt;/code&gt; function, which generates the multi-step form.&lt;/p&gt;

&lt;h2 id=&quot;send-the-user-on-their-way&quot;&gt;Send the user on their way&lt;/h2&gt;

&lt;p&gt;So far, so good. But there’s one problem at this stage. If we try to use the form now, we’ll get errors: clicking “Continue” on the form will take you to a 404 page of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost/example-form%3Fstep%3Dstep-two&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost?step=step-two&lt;/code&gt;. That’s because CTools runs the path we declared in &lt;code class=&quot;highlighter-rouge&quot;&gt;&#39;path&#39; =&amp;gt; &#39;example-form?step=%step&#39;&lt;/code&gt; through an encoding function.&lt;/p&gt;

&lt;p&gt;The workaround is to use our &lt;code class=&quot;highlighter-rouge&quot;&gt;subtask_next&lt;/code&gt; callback to redirect our user where we want them to go using &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * Callback executed when the &#39;next&#39; button is clicked.
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;example_subtask_next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;example_get_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;example_set_page_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;quote&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;array_merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;values&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]));&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// Because we are using query parameters to advance/rewind the form, and
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// Ctools doesn&#39;t like query parameters (URL encoding fails), we&#39;ll use
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// drupal_goto() to take the user where they need to go.
&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$form_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;redirect&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;));
  drupal_goto(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;, array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39; =&amp;gt; array(&#39;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$destination&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The first two lines are caching form values so that as the user goes back and forth between steps on the form, their data is cached. Moving on: remember how CTools is sending us to a 404 page with the encoded value of the path we want to go to? It turns out the un-encoded value is in &lt;code class=&quot;highlighter-rouge&quot;&gt;$form_state[&#39;redirect&#39;][0]&lt;/code&gt;, in the form of &lt;code class=&quot;highlighter-rouge&quot;&gt;example-form?step=step-two&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Since we know the base path, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;substr()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;strlen()&lt;/code&gt; to extract the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;step=&lt;/code&gt; and then pass that along to &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_goto()&lt;/code&gt; bypasses CTools’ own redirection, and thus we are able to avoid the unwanted encoding of the path, and can send our users happily along their way.&lt;/p&gt;

    &lt;/article&gt;
  &lt;/div&gt;
  &lt;div class=&quot;region--prev-next-links region--prev-next-links--mobile pagination&quot;&gt;
    &lt;div class=&quot;outer-container&quot;&gt;
  
  &lt;a href=&quot;/2015/06/23/a-man-a-plan-a-canal-a-savas.html&quot; class=&quot;pagination__previous&quot;&gt;&lt;i class=&quot;fa fa-angle-left &quot;&gt;&lt;/i&gt; Prev&lt;/a&gt;
  
  &lt;a href=&quot;/blog&quot; class=&quot;pagination__view-all&quot;&gt;View All Blog Posts&lt;/a&gt;
  
  &lt;a href=&quot;/2015/07/06/map-in-drupal-8.html&quot; class=&quot;pagination__next&quot;&gt; Next &lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
  
&lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;page--post__aside region--post-aside&quot;&gt;
    &lt;div class=&quot;region--post-aside__section__wrapper--posts&quot;&gt;
      &lt;div class=&quot;region--post-aside__section region--post-aside__section--posts&quot;&gt;
        &lt;h2 class=&quot;heading--sans-serif c-grey h3&quot;&gt;Related Blog Posts&lt;/h2&gt;
        &lt;div class=&quot;region--post-aside__section__items region--post-aside__section--posts__items&quot;&gt;
          

















&lt;div class=&quot;tile--blog tile--blog--detailed tile&quot;&gt;
  &lt;a href=&quot;/2017/03/06/five-drupal-8-tips-to-empower-content-authors.html&quot; class=&quot;tile--blog__link&quot;&gt;
    &lt;div class=&quot;tile--blog__content tile__content bg-light-teal&quot;&gt;
      
      &lt;div class=&quot;tile--blog__image&quot; style=&quot;background-image: url(/assets/img/blog/content-authoring-d8.jpg);&quot;&gt;
        
        
        
        &lt;p class=&quot;tile--blog--detailed__primary-tag&quot;&gt;Drupal&lt;/p&gt;
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      &lt;/div&gt;
      &lt;div class=&quot;tile--blog__post-title&quot;&gt;
        &lt;p&gt;Five Drupal 8 Tips to Empower Content Authors&lt;/p&gt;

        &lt;div class=&quot;tile--blog--detailed__author&quot;&gt;
          
          
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-120by122-82a418.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg&quot; class=&quot;image--team-blog-tile&quot; itemprop=&quot;image&quot; alt=&quot;Oksana Cyrwus&quot; &gt;
  &lt;/picture&gt;

          
          
        &lt;/div&gt;
        &lt;div class=&quot;tile--blog--detailed__author-bg&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;tile--blog__hover tile__hover bg-orange&quot;&gt;
      &lt;p&gt;Five Drupal 8 tips to make the content authoring experience more enjoyable and productive!&lt;/p&gt;

      &lt;p class=&quot;link--cta link--cta--inverse&quot;&gt;Read more&lt;/p&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;



















&lt;div class=&quot;tile--blog tile--blog--detailed tile&quot;&gt;
  &lt;a href=&quot;/2017/02/20/drupal-docker-pattern-lab.html&quot; class=&quot;tile--blog__link&quot;&gt;
    &lt;div class=&quot;tile--blog__content tile__content bg-light-teal&quot;&gt;
      
      &lt;div class=&quot;tile--blog__image&quot; style=&quot;background-image: url(/assets/img/blog/docker-drupal-pattern-lab.jpg);&quot;&gt;
        
        
        
        &lt;p class=&quot;tile--blog--detailed__primary-tag&quot;&gt;Drupal&lt;/p&gt;
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      &lt;/div&gt;
      &lt;div class=&quot;tile--blog__post-title&quot;&gt;
        &lt;p&gt;Docker and the Drupal Pattern Lab Starter Theme&lt;/p&gt;

        &lt;div class=&quot;tile--blog--detailed__author&quot;&gt;
          
          
          &lt;picture&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-120by120-370cd4.jpg&quot; media=&quot;(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)&quot;&gt;
    &lt;source srcset=&quot;http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg&quot;&gt;
    &lt;img src=&quot;http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg&quot; class=&quot;image--team-blog-tile&quot; itemprop=&quot;image&quot; alt=&quot;Dan Murphy&quot; &gt;
  &lt;/picture&gt;

          
          
        &lt;/div&gt;
        &lt;div class=&quot;tile--blog--detailed__author-bg&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;tile--blog__hover tile__hover bg-orange&quot;&gt;
      &lt;p&gt;This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern Lab Starter theme and/or with other common front-end applications such as npm, Gulp, and Bower.&lt;/p&gt;

      &lt;p class=&quot;link--cta link--cta--inverse&quot;&gt;Read more&lt;/p&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;




























































































































































































































































































        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;region--post-aside__section__wrapper--case-studies&quot;&gt;
      &lt;div class=&quot;region--post-aside__section region--post-aside__section--case-studies&quot;&gt;
        &lt;h2 class=&quot;heading--sans-serif c-grey h3&quot;&gt;Related Case Studies&lt;/h2&gt;
        &lt;div class=&quot;region--post-aside__section__items region--post-aside__section--posts__items&quot;&gt;
          







&lt;div class=&quot;case-study-block&quot;&gt;
  &lt;a class=&quot;case-study-block__link&quot; href=&quot;/results/case-studies/duke-today/&quot;&gt;
    &lt;div class=&quot;case-study-block__image&quot; style=&quot;background-image: url(/assets/img/work/logos/duke-today-logo-eggshell.png);&quot;&gt;
      &lt;img src=&quot;/assets/img/work/duke-today/duke-today-block.jpg&quot; alt=&quot;Duke Today Redesign&quot;&gt;
    &lt;/div&gt;
    
    &lt;h3 class=&quot;case-study-block__title&quot;&gt;Duke Today Redesign&lt;/h3&gt;
    
    &lt;div class=&quot;case-study-block__tags&quot;&gt;
      
      
      &lt;p&gt;Drupal &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Content Migration &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;UX &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Docker &lt;/p&gt;
      
      
      
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;












&lt;div class=&quot;case-study-block&quot;&gt;
  &lt;a class=&quot;case-study-block__link&quot; href=&quot;/results/case-studies/hptn/&quot;&gt;
    &lt;div class=&quot;case-study-block__image&quot; style=&quot;background-image: url(/assets/img/work/logos/hptn-logo-eggshell.png);&quot;&gt;
      &lt;img src=&quot;/assets/img/work/hptn/hptn-block.jpg&quot; alt=&quot;HIV Prevention Trials Network (HPTN) Site Redesign&quot;&gt;
    &lt;/div&gt;
    
    &lt;h3 class=&quot;case-study-block__title&quot;&gt;HIV Prevention Trials Network (HPTN) Site Redesign&lt;/h3&gt;
    
    &lt;div class=&quot;case-study-block__tags&quot;&gt;
      
      
      &lt;p&gt;Drupal 8 &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Responsive Design &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;UX &lt;/p&gt;
      
      &lt;p&gt;&amp;bull; &lt;/p&gt;
      
      
      
      &lt;p&gt;Client Server Integration &lt;/p&gt;
      
      
      
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/div&gt;







































        &lt;/div&gt;
        &lt;div class=&quot;region--post-aside__section--case-studies__cta flex-center&quot;&gt;
          &lt;a href=&quot;/results&quot; class=&quot;button--arrow--orange&quot;&gt;Our work&lt;/a&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;region--prev-next-links region--prev-next-links--post pagination&quot;&gt;
  &lt;div class=&quot;outer-container&quot;&gt;
  
  &lt;a href=&quot;/2015/06/23/a-man-a-plan-a-canal-a-savas.html&quot; class=&quot;pagination__previous&quot;&gt;&lt;i class=&quot;fa fa-angle-left &quot;&gt;&lt;/i&gt; Prev&lt;/a&gt;
  
  &lt;a href=&quot;/blog&quot; class=&quot;pagination__view-all&quot;&gt;View All Blog Posts&lt;/a&gt;
  
  &lt;a href=&quot;/2015/07/06/map-in-drupal-8.html&quot; class=&quot;pagination__next&quot;&gt; Next &lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;
  
&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;region--comments&quot;&gt;
  
  &lt;div class=&quot;expander&quot;&gt;
    &lt;a href=&quot;javascript:void(0)&quot; id=&quot;js-expander-trigger&quot; class=&quot;expander-trigger expander--hidden&quot;&gt;
      &lt;p id=&quot;comments-trigger&quot;&gt;Comments&lt;/p&gt;
    &lt;/a&gt;
    &lt;div id=&quot;js-expander-content&quot; class=&quot;expander-content region&quot;&gt;

      &lt;!-- If there are existing comments, output them here. --&gt;
      &lt;div id=&quot;region--comments__comments&quot; class=&quot;region--comments__comments&quot;&gt;&lt;/div&gt;
      &lt;form id=&quot;form--comment&quot; class=&quot;form--comment&quot;&gt;
  &lt;div class=&quot;form--comment__row&quot;&gt;
    &lt;div class=&quot;form--comment__row__item&quot;&gt;
      &lt;div class=&quot;form--comment__field form--comment__field--name&quot;&gt;
        &lt;label for=&quot;name&quot;&gt;Name&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; required&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form--comment__field form--comment__field--email&quot;&gt;
        &lt;label for=&quot;email&quot;&gt;Email&lt;/label&gt;
        &lt;input type=&quot;email&quot; name=&quot;email&quot; id=&quot;email&quot; required&gt;
        &lt;p class=&quot;form--comment__helptext&quot;&gt;Savas Labs will never sell your email address or spam you.&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form--comment__field form--comment__field--comment form--comment__row__item&quot;&gt;
      &lt;label for=&quot;comment&quot;&gt;Comment&lt;/label&gt;
      &lt;textarea name=&quot;comment&quot; id=&quot;comment&quot; rows=&quot;4&quot; required&gt;&lt;/textarea&gt;
      &lt;p class=&quot;form--comment__helptext&quot;&gt;Plain text format only please.&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;input type=&quot;hidden&quot; name=&quot;slug&quot; id=&quot;slug&quot; value=&quot;/2015/06/23/implementing-ctools-multi-step-form-block.html&quot;&gt;
  &lt;input type=&quot;text&quot; name=&quot;url&quot; id=&quot;url&quot;&gt;

  &lt;div class=&quot;form--comment__row&quot;&gt;
    &lt;div class=&quot;form--comment__field form--comment__field--nocaptcha form--comment__row__item&quot;&gt;
      &lt;div class=&quot;form--comment__field--nocaptcha__image&quot;&gt;
        &lt;img src=&quot;/assets/img/icons-and-logos/owl.png&quot; alt=&quot;Savas Labs logo&quot;&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form--comment__field--nocaptcha__input&quot;&gt;
        &lt;label for=&quot;nocaptcha&quot;&gt;What type of animal is the Savas Labs logo?&lt;/label&gt;
        &lt;p class=&quot;form--comment__helptext&quot;&gt;Hint: 3 letters long, starts with an &quot;o&quot; and ends with an &quot;l&quot;.&lt;/p&gt;
        &lt;input type=&quot;text&quot; name=&quot;nocaptcha&quot; id=&quot;nocaptcha&quot; required&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form--comment__row__item&quot;&gt;
      &lt;input type=&quot;submit&quot; value=&quot;Post comment&quot; id=&quot;submit&quot; class=&quot;form--comment__submit&quot;&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/form&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  
&lt;/div&gt;
",
      "url": "http://savaslabs.com/2015/06/23/implementing-ctools-multi-step-form-block.html"
    }
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  <script>
    !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function l(){d.addEventListener&&d.removeEventListener("load",l),d.media=r||"all"}var a,i=e.document,d=i.createElement("link");if(n)a=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;a=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){a.parentNode.insertBefore(d,n?a:a.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",l),d.onloadcssdefined=f,f(l),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(t){}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){e.clearInterval(n)})}}}(this);
    loadCSS('/assets/styles/main.css');
    loadCSS('https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700|Roboto+Slab:300,400');
  </script>
  
  <style>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.bg-magenta{background-color:#9e023b}.bg-orange{background-color:#d3281b}.bg-eggshell{background-color:#fff8f3}.bg-teal{background-color:#0a5365}.bg-dark-teal{background-color:#06282d}.bg-grey{background-color:#565d5e}.bg-light-grey{background-color:#bdc2c3}.bg-light-teal{background-color:#f3f6f7}.bg-light-orange{background-color:#f29c96}.bg-purple{background-color:#501888}.bg-pink{background-color:#d33682}.bg-yellow{background-color:#f2a324}.bg-green{background-color:#055c2b}.c-magenta{color:#9e023b}.c-orange{color:#d3281b}.c-eggshell{color:#fff8f3}.c-teal{color:#0a5365}.c-dark-teal{color:#06282d}.c-grey{color:#565d5e}.c-light-grey{color:#bdc2c3}.c-light-teal{color:#f3f6f7}.c-light-orange{color:#f29c96}.c-purple{color:#501888}.c-pink{color:#d33682}.c-yellow{color:#f2a324}.c-green{color:#055c2b}[type=button],[type=reset],[type=submit],button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#0a5365;border:0;border-radius:3px;color:#fff;cursor:pointer;display:inline-block;font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1em;-webkit-font-smoothing:antialiased;font-weight:600;line-height:1;padding:.75em 1em;text-align:center;text-decoration:none;transition:background-color 150ms ease;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;white-space:nowrap}[type=button]:focus,[type=button]:hover,[type=reset]:focus,[type=reset]:hover,[type=submit]:focus,[type=submit]:hover,button:focus,button:hover{background-color:#084251;color:#fff}[type=button]:disabled,[type=reset]:disabled,[type=submit]:disabled,button:disabled{cursor:not-allowed;opacity:.5}[type=button]:disabled:hover,[type=reset]:disabled:hover,[type=submit]:disabled:hover,button:disabled:hover{background-color:#0a5365}fieldset{background-color:transparent;border:0;margin:0;padding:0}legend{font-weight:600;margin-bottom:.375em;padding:0}label{display:block;font-weight:600;margin-bottom:.375em}input,select,textarea{display:block;font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1em}[type=color],[type=date],[type=datetime-local],[type=datetime],[type=email],[type=month],[type=number],[type=password],[type=search],[type=tel],[type=text],[type=time],[type=url],[type=week],input:not([type]),textarea{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#fff;border:1px solid #ddd;border-radius:3px;box-shadow:inset 0 1px 3px rgba(0,0,0,.06);box-sizing:border-box;margin-bottom:.75em;padding:.33333em;transition:border-color 150ms ease;width:100%}[type=color]:hover,[type=date]:hover,[type=datetime-local]:hover,[type=datetime]:hover,[type=email]:hover,[type=month]:hover,[type=number]:hover,[type=password]:hover,[type=search]:hover,[type=tel]:hover,[type=text]:hover,[type=time]:hover,[type=url]:hover,[type=week]:hover,input:not([type]):hover,textarea:hover{border-color:#b1b1b1}[type=color]:focus,[type=date]:focus,[type=datetime-local]:focus,[type=datetime]:focus,[type=email]:focus,[type=month]:focus,[type=number]:focus,[type=password]:focus,[type=search]:focus,[type=tel]:focus,[type=text]:focus,[type=time]:focus,[type=url]:focus,[type=week]:focus,input:not([type]):focus,textarea:focus{border-color:#0a5365;box-shadow:inset 0 1px 3px rgba(0,0,0,.06),0 0 5px rgba(18,89,169,.7);outline:0}[type=color]:disabled,[type=date]:disabled,[type=datetime-local]:disabled,[type=datetime]:disabled,[type=email]:disabled,[type=month]:disabled,[type=number]:disabled,[type=password]:disabled,[type=search]:disabled,[type=tel]:disabled,[type=text]:disabled,[type=time]:disabled,[type=url]:disabled,[type=week]:disabled,input:not([type]):disabled,textarea:disabled{background-color:#f2f2f2;cursor:not-allowed}[type=color]:disabled:hover,[type=date]:disabled:hover,[type=datetime-local]:disabled:hover,[type=datetime]:disabled:hover,[type=email]:disabled:hover,[type=month]:disabled:hover,[type=number]:disabled:hover,[type=password]:disabled:hover,[type=search]:disabled:hover,[type=tel]:disabled:hover,[type=text]:disabled:hover,[type=time]:disabled:hover,[type=url]:disabled:hover,[type=week]:disabled:hover,input:not([type]):disabled:hover,textarea:disabled:hover{border:1px solid #ddd}[type=color]::-webkit-input-placeholder,[type=date]::-webkit-input-placeholder,[type=datetime-local]::-webkit-input-placeholder,[type=datetime]::-webkit-input-placeholder,[type=email]::-webkit-input-placeholder,[type=month]::-webkit-input-placeholder,[type=number]::-webkit-input-placeholder,[type=password]::-webkit-input-placeholder,[type=search]::-webkit-input-placeholder,[type=tel]::-webkit-input-placeholder,[type=text]::-webkit-input-placeholder,[type=time]::-webkit-input-placeholder,[type=url]::-webkit-input-placeholder,[type=week]::-webkit-input-placeholder,input:not([type])::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#858585}[type=color]:-ms-input-placeholder,[type=date]:-ms-input-placeholder,[type=datetime-local]:-ms-input-placeholder,[type=datetime]:-ms-input-placeholder,[type=email]:-ms-input-placeholder,[type=month]:-ms-input-placeholder,[type=number]:-ms-input-placeholder,[type=password]:-ms-input-placeholder,[type=search]:-ms-input-placeholder,[type=tel]:-ms-input-placeholder,[type=text]:-ms-input-placeholder,[type=time]:-ms-input-placeholder,[type=url]:-ms-input-placeholder,[type=week]:-ms-input-placeholder,input:not([type]):-ms-input-placeholder,textarea:-ms-input-placeholder{color:#858585}[type=color]::placeholder,[type=date]::placeholder,[type=datetime-local]::placeholder,[type=datetime]::placeholder,[type=email]::placeholder,[type=month]::placeholder,[type=number]::placeholder,[type=password]::placeholder,[type=search]::placeholder,[type=tel]::placeholder,[type=text]::placeholder,[type=time]::placeholder,[type=url]::placeholder,[type=week]::placeholder,input:not([type])::placeholder,textarea::placeholder{color:#858585}textarea{resize:vertical}[type=checkbox],[type=radio]{display:inline;margin-right:.375em}[type=file]{margin-bottom:.75em;width:100%}select{margin-bottom:.75em;width:100%}html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}body,html{height:100%}ol,ul{list-style-type:none;margin:0;padding:0}dl{margin:0}dt{font-weight:600;margin:0}dd{margin:0}figure{margin:0}img,picture{margin:0;max-width:100%}table{border-collapse:collapse;margin:.75em 0;table-layout:fixed;width:100%}th{border-bottom:1px solid #a6a6a6;font-weight:600;padding:.75em 0;text-align:left}td{border-bottom:1px solid #ddd;padding:.75em 0}td,th,tr{vertical-align:middle}body{color:#333;font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1em;line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,"Avenir Next",Avenir,"Segoe UI","Lucida Grande","Helvetica Neue",Helvetica,"Fira Sans",Roboto,Noto,"Droid Sans",Cantarell,Oxygen,Ubuntu,"Franklin Gothic Medium","Century Gothic","Liberation Sans",sans-serif;font-size:1.25em;line-height:1.2;margin:0 0 .75em}p{margin:0 0 .75em}a{color:#0a5365;text-decoration:none;transition:color 150ms ease}a:active,a:focus,a:hover{color:#083e4c}hr{border-bottom:1px solid #ddd;border-left:0;border-right:0;border-top:0;margin:1em 0}.nowrap{white-space:nowrap}.region{max-width:1440px;margin-left:auto;margin-right:auto;clear:both;max-width:1400px;padding:1.5em 1em;vertical-align:baseline}.region::after{clear:both;content:"";display:block}@media only screen and (min-width:640px){.region{padding:3em 1em}}@media only screen and (min-width:1440px){.region{padding:3em 0}}.region--full-width{clear:both;margin:1.5em 0}@media only screen and (min-width:640px){.region--full-width{margin:3em 0}}.region--full-width .region--full-width__wrapper{max-width:1440px;margin-left:auto;margin-right:auto;margin:0 auto;max-width:1400px;vertical-align:baseline}.region--full-width .region--full-width__wrapper::after{clear:both;content:"";display:block}.outer-container{max-width:1440px;margin-left:auto;margin-right:auto;width:100%}.outer-container::after{clear:both;content:"";display:block}.flex-center{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}h1,h2,h3,h4,h5,h6{color:#0a5365;font-family:"Roboto Slab",Verdana,sans-serif;font-weight:300}.h1,h1{font-size:2.074em}@media only screen and (min-width:640px){.h1,h1{font-size:2.441em}}.h2,h2{font-size:1.728em}@media only screen and (min-width:640px){.h2,h2{font-size:1.953em}}.h3,h3{font-size:1.44em}@media only screen and (min-width:640px){.h3,h3{font-size:1.563em}}.h4,h4{font-size:1.2em}@media only screen and (min-width:640px){.h4,h4{font-size:1.25em}}.h5,h5{font-size:1.1em}.h6,h6{font-size:1em}.heading--bold{font-weight:700}.heading--sans-serif{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}article h2,article h3,article h4,article h5,article h6{margin-top:1.5em}article h2::after{background:#0a5365;content:'';display:block;height:1px;margin:10px 0 .5em;width:30px}.page--post__main h1,.page--post__main h2,.page--post__main h3,.page--post__main h4,.page--post__main h5,.page--post__main h6{color:#9e023b}a{color:#0a5365;transition:all .1s linear}a:focus,a:hover{color:#0f7993}.link--light{color:#fff8f3}.link--light:focus,.link--light:hover{color:#d3281b}.link--light--no-hover{color:#fff8f3}.link--light--no-hover:focus,.link--light--no-hover:hover{color:#fff8f3}body{color:#565d5e;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}.paragraph--loud{font-size:1.25em}.paragraph--louder{font-size:1.563em}.paragraph--loud--responsive{font-size:1.25em}@media only screen and (min-width:860px){.paragraph--loud--responsive{font-size:1.563em}}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-angle-double-down:before{content:""}.fa-angle-right:before{content:""}.fa-building-o:before{content:""}.fa-circle:before{content:""}.fa-comment:before{content:""}.fa-comment-o:before{content:""}.fa-drupal:before{content:""}.fa-envelope-o:before{content:""}.fa-file-text:before{content:""}.fa-github:before{content:""}.fa-globe:before{content:""}.fa-linkedin:before{content:""}.fa-long-arrow-right:before{content:""}.fa-phone:before{content:""}.fa-stack-exchange:before{content:""}.fa-tags:before{content:""}.fa-twitter:before{content:""}.header-navigation{float:none;z-index:9999999}@media only screen and (min-width:640px){.header-navigation{clear:none;float:right;padding-bottom:0;padding-right:.75em}}.header-navigation__menu{clear:both;display:none;margin:0 auto;overflow:visible;padding:0;-webkit-transform-style:preserve-3d;width:100%;z-index:9999}@media only screen and (min-width:640px){.header-navigation__menu{display:inline;margin:0;padding:0}}.header-navigation__menu.show{display:block}.header-navigation__mobile-menu-link{color:#06282d;display:block;float:right;font-weight:700;line-height:5.25em;margin:0;padding-right:1em;text-transform:uppercase}@media only screen and (min-width:640px){.header-navigation__mobile-menu-link{display:none}}.header-navigation__mobile-menu-link:focus,.header-navigation__mobile-menu-link:hover{color:#9e023b}.header-navigation__menu-link{display:block;line-height:2.625em;overflow:hidden;padding-right:.8em;text-align:right;width:100%;z-index:9999}@media only screen and (min-width:640px){.header-navigation__menu-link{display:inline;line-height:5.25em;margin-right:-5px;padding-right:0;width:auto}.header-navigation__menu-link:last-child{margin-right:0}}.header-navigation__menu-link:last-child:not(.header-navigation__active-nav-item):not(:hover):not(:focus) a{color:#9e023b}.header-navigation__menu-link:last-child a{font-weight:700}.header-navigation__menu-link a{color:#06282d;display:inline-block;font-weight:400;text-transform:uppercase;transition:background-color ease .2s}.header-navigation__menu-link a:focus,.header-navigation__menu-link a:hover{color:#9e023b}@media only screen and (min-width:640px){.header-navigation__menu-link a{padding-left:.75em;padding-right:.75em}.header-navigation__menu-link a:focus,.header-navigation__menu-link a:hover{background-color:rgba(158,2,59,.9);color:#fff}}.header-navigation__active-nav-item{background-color:rgba(158,2,59,.9)}@media only screen and (min-width:640px){.header-navigation__active-nav-item{background-color:rgba(255,255,255,.9);color:#06282d}}.header-navigation__active-nav-item a{color:#fff}@media only screen and (min-width:640px){.header-navigation__active-nav-item a{background-color:rgba(158,2,59,.9)}}.savas-logo{display:block;height:5.25em;padding:1.5em 0}.savas-logo--main{display:block;height:2.25em;margin:1.5em 0;padding:0;width:5.125em}.tile{position:relative}.tile .tile__hover{-ms-flex-align:center;align-items:center;color:#fff8f3;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;left:0;opacity:0;padding:1em;position:absolute;text-align:center;top:0;transition:all .3s ease;width:100%;z-index:1}.tile .tile__hover p:first-child{margin-bottom:1.5em;max-width:15em}.tile .tile__hover .link--cta{margin-bottom:0;transition:all .2s ease-in-out}.tile:focus .tile__hover,.tile:hover .tile__hover{opacity:1}.tile:focus .tile--blog--detailed__primary-tag,.tile:hover .tile--blog--detailed__primary-tag{margin-left:1em}.tile:focus .tile--blog__post-title .tile--blog--detailed__author-bg,.tile:hover .tile--blog__post-title .tile--blog--detailed__author-bg{bottom:0;right:0}@media only screen and (min-width:1120px){.tile p{font-size:1.1em}}.tile--title--blog{padding:2em}.tile--blog .tile--blog__content{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;position:relative;z-index:0}.tile--blog .tile--blog__content>div{height:150px}@media only screen and (min-width:450px){.tile--blog .tile--blog__content>div{height:200px}}@media only screen and (min-width:640px){.tile--blog .tile--blog__content>div{height:150px}}@media only screen and (min-width:1120px){.tile--blog .tile--blog__content>div{height:175px}}@media only screen and (min-width:1440px){.tile--blog .tile--blog__content>div{height:200px}}.tile--blog .tile--blog__content .tile--blog__image{background-position:center center;background-repeat:no-repeat;background-size:cover;width:100%}.tile--blog .tile--blog__content .tile--blog__post-title{-ms-flex-align:center;align-items:center;color:#06282d;display:-ms-flexbox;display:flex;padding:1em;width:100%}.tile--blog .tile--blog__content .tile--blog__post-title p::before{background:#9e023b;content:'';display:block;height:1px;margin:10px 0 .5em;width:30px}.tile--blog .tile--blog__hover{height:300px}@media only screen and (min-width:450px){.tile--blog .tile--blog__hover{height:400px}}@media only screen and (min-width:640px){.tile--blog .tile--blog__hover{height:300px}}@media only screen and (min-width:1120px){.tile--blog .tile--blog__hover{height:350px}}@media only screen and (min-width:1440px){.tile--blog .tile--blog__hover{height:400px}}.tile--blog--detailed{-ms-flex-preferred-size:auto;flex-basis:auto;-ms-flex-positive:0;flex-grow:0}.tile--blog--detailed .tile--blog__image{position:relative}.tile--blog--detailed .tile--blog__image .tile--blog--detailed__primary-tag{background-color:#0a5365;bottom:1em;color:#fff8f3;font-size:.9em;font-style:italic;left:-1em;margin-bottom:0;padding:.25em 1em;position:absolute;text-transform:uppercase;transition:all .3s ease-in-out}.tile--blog--detailed .tile--blog__post-title{position:relative;z-index:99}.tile--blog--detailed .tile--blog__post-title p{padding-right:44px}.tile--blog--detailed .tile--blog__post-title .tile--blog--detailed__author{bottom:0;position:absolute;right:0;z-index:999}.tile--blog--detailed .tile--blog__post-title .tile--blog--detailed__author img{display:block;filter:grayscale(100%);height:60px;width:60px}.tile--blog--detailed .tile--blog__post-title .tile--blog--detailed__author-bg{background-color:rgba(10,83,101,.2);bottom:-8px;height:60px;position:absolute;right:-8px;transition:all .3s ease-in-out;width:60px}.tile--blog--detailed .tile--blog__hover{margin:1em;width:calc(100% - 2em)}.region--header{background-color:rgba(255,255,255,.9);min-height:5.25em;width:100%;z-index:999}.region--header a{text-decoration:none}.region--header .region--header__wrapper{max-width:1440px;margin-left:auto;margin-right:auto;position:relative;z-index:9999}.region--header .region--header__wrapper::after{clear:both;content:"";display:block}.region--header .region--header__logo{display:inline-block;float:left;height:5.25em;margin:0;padding-left:1em}@media only screen and (min-width:640px){.region--header .region--header__logo{padding-left:1.5em;padding-right:1em}}.region--post-aside{margin-top:3em}@media only screen and (min-width:860px){.region--post-aside{float:left;margin-top:0;width:33.333%}}.region--post-aside .region--post-aside__section{padding:3em 1em}@media only screen and (min-width:860px){.region--post-aside .region--post-aside__section{padding:3em 1.5em}}@media only screen and (min-width:1120px){.region--post-aside .region--post-aside__section{padding:3em 2em}}.region--post-aside .region--post-aside__section__wrapper--posts{border-bottom:solid 1px #bdc2c3}.region--post-aside .region--post-aside__section__wrapper--posts .tile--blog__hover{margin:0;width:100%}@media only screen and (min-width:640px){.region--post-aside .region--post-aside__section__items{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}}@media only screen and (min-width:860px){.region--post-aside .region--post-aside__section__items{display:block}}.region--post-aside .region--post-aside__section__items>div{margin-bottom:1em}@media only screen and (min-width:640px){.region--post-aside .region--post-aside__section__items>div{-ms-flex-positive:0;flex-grow:0;margin-bottom:0;width:48.5%}}@media only screen and (min-width:860px){.region--post-aside .region--post-aside__section__items>div{margin-bottom:1em;width:100%}}.region--post-aside h2{font-weight:400}.region--post-aside .region--post-aside__section--case-studies .case-study-block__title{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif;font-weight:400}.region--post-aside .region--post-aside__section--case-studies__cta{margin-top:3em}.page--post .region--header{border-bottom:solid 1px #bdc2c3}@media only screen and (min-width:860px){.page--post .page--post__main{border-right:solid 1px #bdc2c3;float:left;padding-bottom:3em;width:66.666%}}.page--post .page--post__main .region--post-content,.page--post .page--post__main .region--post-header{padding:0 1em}@media only screen and (min-width:640px){.page--post .page--post__main .region--post-content,.page--post .page--post__main .region--post-header{padding:0 1.5em}}@media only screen and (min-width:1120px){.page--post .page--post__main .region--post-content,.page--post .page--post__main .region--post-header{padding-right:2em}}.page--post .page--post__main .region--post-header h1{font-weight:400}.page--post .page--post__main .region--post-content{color:#06282d}.page--post .page--post__main .region--post-content h2,.page--post .page--post__main .region--post-content h3,.page--post .page--post__main .region--post-content h4,.page--post .page--post__main .region--post-content h5,.page--post .page--post__main .region--post-content h6{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif;font-weight:400}.page--post .page--post__main .region--post-content .caption{color:#565d5e;font-style:italic}.page--post .page--post__aside{border-bottom:solid 1px #bdc2c3;margin-top:0}@media only screen and (min-width:860px){.page--post .page--post__aside{border-bottom:0;border-top:0}}.page--post .region--prev-next-links--post{clear:both;display:none}@media only screen and (min-width:860px){.page--post .region--prev-next-links--post{display:-ms-flexbox;display:flex}}.page--post .region--prev-next-links--mobile{display:-ms-flexbox;display:flex;margin-top:3em}@media only screen and (min-width:860px){.page--post .region--prev-next-links--mobile{display:none}}.page--post .region--footer{margin-top:0}.region--post-header{margin:3em 0}.region--post-header .region--post-header__title{margin-bottom:1.5em}@media only screen and (min-width:640px){.region--post-header__post-info{display:-ms-flexbox;display:flex}.region--post-header__post-info>div{width:50%}}.region--post-header__post-info p{font-style:italic;margin-bottom:.25em}.region--post-header__post-info i{margin-right:.5em}.region--post-header__post-info .post-author:not(:first-child){clear:left;margin-top:1em}.region--post-header__post-info .post-author picture{float:left;margin-right:1em}.region--post-header__post-info .post-author picture img{display:block;height:60px;width:60px}.region--post-header__post-info .region--post-header__post-info__stats{clear:both;margin-top:1.5em}@media only screen and (min-width:640px){.region--post-header__post-info .region--post-header__post-info__stats{clear:none;margin-top:0}}.region--post-header__post-info .region--post-header__post-info__stats p{display:inline-block;margin-right:1em}@media only screen and (min-width:640px){.region--post-header__post-info .region--post-header__post-info__stats p{display:block;margin-right:0}}</style>
  
</head>


  <body class="page--post">

    <header class="region--header" role="banner">
  <div class="region--header__wrapper">

    <a href="/" class="region--header__logo">
      <img src="http://savaslabs.com/assets/img/logo.svg" alt="Savas Labs logo" class="savas-logo savas-logo--main">
    </a>

    <!-- Mobile menu button. -->
<a href="/" id="js-mobile-menu" class="header-navigation__mobile-menu-link">MENU</a>

<!-- Main menu. -->
<nav role="navigation" class="header-navigation">
  <ul id="js-navigation-menu" class="header-navigation__menu show">
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/company">Company</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/results">Results</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/services">Services</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/blog">Blog</a>
      </li>
    
      
      
      
      <li class="header-navigation__menu-link ">
        <a href="/contact">Contact</a>
      </li>
    
  </ul>
</nav>

  </div>
</header>

    <div class="page-content">
      







<div class="outer-container">
  <div class="page--post__main">
    <div class="region--featured-image">
      
      <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-1245by700-89f5b6.jpg" media="(min-width: 1120px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 1120px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-959by539-89f5b6.jpg" media="(min-width: 1120px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-1246by700-89f5b6.jpg" media="(min-width: 860px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 860px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-746by419-89f5b6.jpg" media="(min-width: 860px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-1244by700-89f5b6.jpg" media="(min-width: 640px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 640px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-860by484-89f5b6.jpg" media="(min-width: 640px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-1244by700-89f5b6.jpg" media="(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-640by360-89f5b6.jpg" media="(min-width: 400px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-800by450-89f5b6.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/default-400by225-89f5b6.jpg">
    <img src="http://savaslabs.com/assets/processed-img/blog/default-400by225-89f5b6.jpg" class="image--post-featured-image" itemprop="image" alt="Savas Labs blog" >
  </picture>

      
    </div>
    <div class="region--post-header">
      <h1 class="region--post-header__title">Implementing a CTools multi-step form in a block</h1>
      <div class="region--post-header__post-info">
        <div class="region--post-header__post-info__authors">
          
<div class="post-author">
  <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-120by120-c7115d.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-60by60-c7115d.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/kosta/kosta-square-outside-60by60-c7115d.jpg" class="image--team-blog-tile" itemprop="image" alt="Kosta Harlan" >
  </picture>

  <p class="post-author__name">By <a href="/team/kosta-harlan">Kosta Harlan</a></p>
  <p class="post-author__title">Director of Technology</p>
</div>

        </div>
        <div class="region--post-header__post-info__stats">
          <p><i class="fa fa-calendar"></i>Jun 23, 2015 </p>
          <p><i class="fa fa-tags"></i><a href="/blog/tag/drupal/">Drupal</a>, <a href="/blog/tag/drupal-planet/">Drupal Planet</a></p>
          
          <p><span id="comment-count"></span></p>
          
        </div>
      </div>
      
    </div>
    <article class="region--post-content">
      <p>No one likes long forms. They’re overwhelming to look at and it’s easy to lose your place. Multi-step forms are a way to simplify data collection and make your users’ lives easier.</p>

<p>Drupal’s Form API combined with the CTools module provide a solid platform for building a multi-step form. There are <a href="https://duckduckgo.com/?q=ctools+multistep+form">many wonderful guides</a> on how to build a CTools multi-step form in Drupal. But as far as I can tell, all of the guides assume that the form will live on a page — which makes sense, as that’s the most common use case.</p>

<p>On a recent project, though, a client asked us to create a multi-step form using only a block, so it could be placed on a page using Panels. It turns out this is pretty straightforward but as it’s not well documented elsewhere, here’s a quick guide to what you need to do. (Note: I created <a href="git@github.com:savaslabs/ctools_multistep_form_block.git">an example module on GitHub</a>, so please reference that as needed. This post is just covering the highlights.)</p>

<h2 id="update-your-ctools-form-definition">Update your CTools form definition</h2>

<p>In the main CTools form definition, which looks something like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$form_info</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="s1">'quote-form'</span><span class="p">,</span>
  <span class="s1">'ajax'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="s1">'path'</span> <span class="o">=&gt;</span> <span class="s1">'example-form/%step'</span><span class="p">,</span>
  <span class="s1">'show trail'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="s1">'show back'</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
  <span class="s1">'show return'</span> <span class="o">=&gt;</span> <span class="k">FALSE</span><span class="p">,</span>
<span class="p">);</span>
</code></pre>
</div>

<p>We need to change path to use query parameters for advancing the form. So let’s change <code class="highlighter-rouge">path</code> to <code class="highlighter-rouge">'path' =&gt; 'example-form?step=%step'</code>. The path <code class="highlighter-rouge">example-form</code> could be generated by a View, a node page, a Panel page, etc.</p>

<h2 id="define-the-block">Define the block</h2>

<p>Next, we need an implementation of <code class="highlighter-rouge">hook_block_info()</code> and <code class="highlighter-rouge">hook_block_view()</code>. <code class="highlighter-rouge">hook_block_info()</code> is pretty unremarkable so I’m not including it here, other than to say you should consider setting <code class="highlighter-rouge">cache</code> to <code class="highlighter-rouge">DRUPAL_NO_CACHE</code> when declaring your block. Now, on to <code class="highlighter-rouge">hook_block_view()</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Implements hook_block_view().
 */</span>
<span class="k">function</span> <span class="nf">example_block_view</span><span class="p">(</span><span class="nv">$delta</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$block</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$delta</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'example_form'</span><span class="o">:</span>
      <span class="nv">$block</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">'Our example form'</span><span class="p">);</span>
      <span class="nv">$parameters</span> <span class="o">=</span> <span class="nx">drupal_get_query_parameters</span><span class="p">();</span>
      <span class="nv">$next_step</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">[</span><span class="s1">'step'</span><span class="p">])</span> <span class="o">?</span> <span class="s1">'step-one'</span> <span class="o">:</span> <span class="nv">$parameters</span><span class="p">[</span><span class="s1">'step'</span><span class="p">];</span>
      <span class="nv">$block</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">example_ctools_wizard</span><span class="p">(</span><span class="nv">$next_step</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Let’s take a closer look at this. <code class="highlighter-rouge">drupal_get_query_parameters()</code> is checking to see if there’s a query parameter for <code class="highlighter-rouge">step</code> in the current URL (e.g. <code class="highlighter-rouge">http://localhost?step=step-two</code>). If so, we set the <code class="highlighter-rouge">$next_step</code> variable to that value; if not, we default to <code class="highlighter-rouge">step-one</code> as the starting point for the form. We then pass in the <code class="highlighter-rouge">$next_step</code> variable to our <code class="highlighter-rouge">example_ctools_wizard()</code> function, which generates the multi-step form.</p>

<h2 id="send-the-user-on-their-way">Send the user on their way</h2>

<p>So far, so good. But there’s one problem at this stage. If we try to use the form now, we’ll get errors: clicking “Continue” on the form will take you to a 404 page of <code class="highlighter-rouge">http://localhost/example-form%3Fstep%3Dstep-two</code> instead of <code class="highlighter-rouge">http://localhost?step=step-two</code>. That’s because CTools runs the path we declared in <code class="highlighter-rouge">'path' =&gt; 'example-form?step=%step'</code> through an encoding function.</p>

<p>The workaround is to use our <code class="highlighter-rouge">subtask_next</code> callback to redirect our user where we want them to go using <code class="highlighter-rouge">drupal_goto()</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Callback executed when the 'next' button is clicked.
 */</span>
<span class="k">function</span> <span class="nf">example_subtask_next</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$values</span> <span class="o">=</span> <span class="p">(</span><span class="k">array</span><span class="p">)</span> <span class="nx">example_get_page_cache</span><span class="p">(</span><span class="s1">'quote'</span><span class="p">);</span>
  <span class="nx">example_set_page_cache</span><span class="p">(</span><span class="s1">'quote'</span><span class="p">,</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$values</span><span class="p">,</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">'values'</span><span class="p">]));</span>
  <span class="c1">// Because we are using query parameters to advance/rewind the form, and
</span>  <span class="c1">// Ctools doesn't like query parameters (URL encoding fails), we'll use
</span>  <span class="c1">// drupal_goto() to take the user where they need to go.
</span>  <span class="nv">$destination</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$form_state</span><span class="p">[</span><span class="s1">'redirect'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">strlen</span><span class="p">(</span><span class="nx">example</span><span class="o">-</span><span class="nx">form</span><span class="o">?</span><span class="nx">step</span><span class="o">=</span><span class="s1">'));
  drupal_goto('</span><span class="nx">example</span><span class="o">-</span><span class="nx">form</span><span class="s1">', array('</span><span class="nx">query</span><span class="s1">' =&gt; array('</span><span class="nx">step</span><span class="err">'</span> <span class="o">=&gt;</span> <span class="nv">$destination</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The first two lines are caching form values so that as the user goes back and forth between steps on the form, their data is cached. Moving on: remember how CTools is sending us to a 404 page with the encoded value of the path we want to go to? It turns out the un-encoded value is in <code class="highlighter-rouge">$form_state['redirect'][0]</code>, in the form of <code class="highlighter-rouge">example-form?step=step-two</code>.</p>

<p>Since we know the base path, we can use <code class="highlighter-rouge">substr()</code> and <code class="highlighter-rouge">strlen()</code> to extract the value of <code class="highlighter-rouge">step=</code> and then pass that along to <code class="highlighter-rouge">drupal_goto()</code>. <code class="highlighter-rouge">drupal_goto()</code> bypasses CTools’ own redirection, and thus we are able to avoid the unwanted encoding of the path, and can send our users happily along their way.</p>

    </article>
  </div>
  <div class="region--prev-next-links region--prev-next-links--mobile pagination">
    <div class="outer-container">
  
  <a href="/2015/06/23/a-man-a-plan-a-canal-a-savas.html" class="pagination__previous"><i class="fa fa-angle-left "></i> Prev</a>
  
  <a href="/blog" class="pagination__view-all">View All Blog Posts</a>
  
  <a href="/2015/07/06/map-in-drupal-8.html" class="pagination__next"> Next <i class="fa fa-angle-right"></i></a>
  
</div>
  </div>
  <div class="page--post__aside region--post-aside">
    <div class="region--post-aside__section__wrapper--posts">
      <div class="region--post-aside__section region--post-aside__section--posts">
        <h2 class="heading--sans-serif c-grey h3">Related Blog Posts</h2>
        <div class="region--post-aside__section__items region--post-aside__section--posts__items">
          

















<div class="tile--blog tile--blog--detailed tile">
  <a href="/2017/03/06/five-drupal-8-tips-to-empower-content-authors.html" class="tile--blog__link">
    <div class="tile--blog__content tile__content bg-light-teal">
      
      <div class="tile--blog__image" style="background-image: url(/assets/img/blog/content-authoring-d8.jpg);">
        
        
        
        <p class="tile--blog--detailed__primary-tag">Drupal</p>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
      <div class="tile--blog__post-title">
        <p>Five Drupal 8 Tips to Empower Content Authors</p>

        <div class="tile--blog--detailed__author">
          
          
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-120by122-82a418.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/oksana/oksana-square-outside-60by61-82a418.jpg" class="image--team-blog-tile" itemprop="image" alt="Oksana Cyrwus" >
  </picture>

          
          
        </div>
        <div class="tile--blog--detailed__author-bg"></div>
      </div>
    </div>
    <div class="tile--blog__hover tile__hover bg-orange">
      <p>Five Drupal 8 tips to make the content authoring experience more enjoyable and productive!</p>

      <p class="link--cta link--cta--inverse">Read more</p>
    </div>
  </a>
</div>



















<div class="tile--blog tile--blog--detailed tile">
  <a href="/2017/02/20/drupal-docker-pattern-lab.html" class="tile--blog__link">
    <div class="tile--blog__content tile__content bg-light-teal">
      
      <div class="tile--blog__image" style="background-image: url(/assets/img/blog/docker-drupal-pattern-lab.jpg);">
        
        
        
        <p class="tile--blog--detailed__primary-tag">Drupal</p>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
      <div class="tile--blog__post-title">
        <p>Docker and the Drupal Pattern Lab Starter Theme</p>

        <div class="tile--blog--detailed__author">
          
          
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-120by120-370cd4.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/dan/dan-square-outside-60by60-370cd4.jpg" class="image--team-blog-tile" itemprop="image" alt="Dan Murphy" >
  </picture>

          
          
        </div>
        <div class="tile--blog--detailed__author-bg"></div>
      </div>
    </div>
    <div class="tile--blog__hover tile__hover bg-orange">
      <p>This post demonstrates how to build a Docker image that can be used in local Drupal development with the Pattern Lab Starter theme and/or with other common front-end applications such as npm, Gulp, and Bower.</p>

      <p class="link--cta link--cta--inverse">Read more</p>
    </div>
  </a>
</div>




























































































































































































































































































        </div>
      </div>
    </div>
    <div class="region--post-aside__section__wrapper--case-studies">
      <div class="region--post-aside__section region--post-aside__section--case-studies">
        <h2 class="heading--sans-serif c-grey h3">Related Case Studies</h2>
        <div class="region--post-aside__section__items region--post-aside__section--posts__items">
          







<div class="case-study-block">
  <a class="case-study-block__link" href="/results/case-studies/duke-today/">
    <div class="case-study-block__image" style="background-image: url(/assets/img/work/logos/duke-today-logo-eggshell.png);">
      <img src="/assets/img/work/duke-today/duke-today-block.jpg" alt="Duke Today Redesign">
    </div>
    
    <h3 class="case-study-block__title">Duke Today Redesign</h3>
    
    <div class="case-study-block__tags">
      
      
      <p>Drupal </p>
      
      <p>&bull; </p>
      
      
      
      <p>Content Migration </p>
      
      <p>&bull; </p>
      
      
      
      <p>UX </p>
      
      <p>&bull; </p>
      
      
      
      <p>Docker </p>
      
      
      
    </div>
  </a>
</div>












<div class="case-study-block">
  <a class="case-study-block__link" href="/results/case-studies/hptn/">
    <div class="case-study-block__image" style="background-image: url(/assets/img/work/logos/hptn-logo-eggshell.png);">
      <img src="/assets/img/work/hptn/hptn-block.jpg" alt="HIV Prevention Trials Network (HPTN) Site Redesign">
    </div>
    
    <h3 class="case-study-block__title">HIV Prevention Trials Network (HPTN) Site Redesign</h3>
    
    <div class="case-study-block__tags">
      
      
      <p>Drupal 8 </p>
      
      <p>&bull; </p>
      
      
      
      <p>Responsive Design </p>
      
      <p>&bull; </p>
      
      
      
      <p>UX </p>
      
      <p>&bull; </p>
      
      
      
      <p>Client Server Integration </p>
      
      
      
    </div>
  </a>
</div>







































        </div>
        <div class="region--post-aside__section--case-studies__cta flex-center">
          <a href="/results" class="button--arrow--orange">Our work</a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="region--prev-next-links region--prev-next-links--post pagination">
  <div class="outer-container">
  
  <a href="/2015/06/23/a-man-a-plan-a-canal-a-savas.html" class="pagination__previous"><i class="fa fa-angle-left "></i> Prev</a>
  
  <a href="/blog" class="pagination__view-all">View All Blog Posts</a>
  
  <a href="/2015/07/06/map-in-drupal-8.html" class="pagination__next"> Next <i class="fa fa-angle-right"></i></a>
  
</div>
</div>

<div class="region--comments">
  
  <div class="expander">
    <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander--hidden">
      <p id="comments-trigger">Comments</p>
    </a>
    <div id="js-expander-content" class="expander-content region">

      <!-- If there are existing comments, output them here. -->
      <div id="region--comments__comments" class="region--comments__comments"></div>
      <form id="form--comment" class="form--comment">
  <div class="form--comment__row">
    <div class="form--comment__row__item">
      <div class="form--comment__field form--comment__field--name">
        <label for="name">Name</label>
        <input type="text" name="name" id="name" required>
      </div>
      <div class="form--comment__field form--comment__field--email">
        <label for="email">Email</label>
        <input type="email" name="email" id="email" required>
        <p class="form--comment__helptext">Savas Labs will never sell your email address or spam you.</p>
      </div>
    </div>
    <div class="form--comment__field form--comment__field--comment form--comment__row__item">
      <label for="comment">Comment</label>
      <textarea name="comment" id="comment" rows="4" required></textarea>
      <p class="form--comment__helptext">Plain text format only please.</p>
    </div>
  </div>

  <input type="hidden" name="slug" id="slug" value="/2015/06/23/implementing-ctools-multi-step-form-block.html">
  <input type="text" name="url" id="url">

  <div class="form--comment__row">
    <div class="form--comment__field form--comment__field--nocaptcha form--comment__row__item">
      <div class="form--comment__field--nocaptcha__image">
        <img src="/assets/img/icons-and-logos/owl.png" alt="Savas Labs logo">
      </div>
      <div class="form--comment__field--nocaptcha__input">
        <label for="nocaptcha">What type of animal is the Savas Labs logo?</label>
        <p class="form--comment__helptext">Hint: 3 letters long, starts with an "o" and ends with an "l".</p>
        <input type="text" name="nocaptcha" id="nocaptcha" required>
      </div>
    </div>
    <div class="form--comment__row__item">
      <input type="submit" value="Post comment" id="submit" class="form--comment__submit">
    </div>
  </div>
</form>
    </div>
  </div>
  
</div>

    </div>

    <footer class="region--footer" role="contentinfo">
  <div class="region--footer__main">
    <div class="region--footer__main__menu">
      <a href="/" class="region--footer__logo">
        <img src="http://savaslabs.com/assets/img/logo-light.svg" alt="Savas Labs" class="savas-logo savas-logo--light">
      </a>
      <nav role="navigation" class="footer-navigation">
  <ul class="footer-navigation__menu">
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/company">Company</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/results">Results</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/services">Services</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/blog">Blog</a>
      </li>
    
      
      
      
      <li class="footer-navigation__menu-link ">
        <a href="/contact">Contact</a>
      </li>
    
  </ul>
</nav>
    </div>
    <div class="region--footer__main__contact">
      <h4 class="region--footer__main__contact__title h5">Connect with us</h4>
      <a href="mailto:info@savaslabs.com">info@savaslabs.com</a>
      <p>(919) 432-4660</p>
      <address>
        SAVAS LABS<br>
        PMB 210<br>
        201 W Main Street, Suite 100<br>
        Durham, NC 27701
      </address>
    </div>
    <div class="region--footer__main__social">
      <div class="region--footer__main__social__icons">
        <a href="https://github.com/savaslabs"><span class="fa fa-github fa-lg fa-2x"></span></a>
        <a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a>
        <a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a>
        <a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a>
      </div>
      <div class="region--footer__main__social__twitter">
        <a class="twitter-timeline"  href="https://twitter.com/Savas_Labs" data-widget-id="720223236315815936">Tweets by @Savas_Labs</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>
    </div>
  </div>
  <div class="region--footer__bottom">
    <div class="region--footer__bottom__wrapper">
      <p class="region--footer__bottom__copyright">
        Copyright &copy; Savas Labs 2017
      </p>
    </div>
  </div>
</footer>

    <script type="text/javascript" src="http://savaslabs.com/assets/js/main.js" async></script>

<noscript>
  <link href='/assets/styles/main.css' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Source+Sans+Pro' rel='stylesheet' type='text/css'>
</noscript>

  </body>

</html>
