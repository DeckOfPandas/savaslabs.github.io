<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Dramatically Improve MySQL Import Performance with Docker | Savas Labs</title>
  
  <meta name="description" content="We use Docker for our development environments because it helps us adhere to our commitment to excellence. It ensures an identical development platform acros...">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="canonical" href="http://savaslabs.com/2017/02/15/docker-mysql-performance.html">
  <link rel="alternate" type="application/rss+xml" title="Savas Labs" href="http://savaslabs.com/feed.xml" />
  
  
  
  



  
  
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "about": "How to dramatically improve MySQL database import performance on Drupal with Docker stacks",
      "articleBody": "&lt;p&gt;We use &lt;a href=&quot;https://www.docker.com/&quot;&gt;Docker&lt;/a&gt; for our development environments because it helps us adhere to our &lt;a href=&quot;/mission-and-values/#excel&quot;&gt;commitment to excellence&lt;/a&gt;. It ensures an identical development platform across the team while also achieving parity with the production environment. These efficiency gains (among others we’ll share in an ongoing &lt;a href=&quot;/blog/tag/docker/&quot;&gt;Docker series&lt;/a&gt;) over traditional development methods enable us to spend less time on setup and more time building amazing things.&lt;/p&gt;

&lt;p&gt;Part of our workflow includes a mechanism to establish and update the &lt;a href=&quot;https://en.wikipedia.org/wiki/Database_seeding&quot;&gt;seed database&lt;/a&gt; which we use to load near-real-time production content to our development environments as well as our &lt;a href=&quot;/blog/tag/testing/&quot;&gt;automated testing&lt;/a&gt; infrastructure. We’ve found it’s best to have real data throughout the development process, rather than using stale or dummy data which runs the risk of encountering unexpected issues toward the end of a project. One efficiency boon we’ve recently implemented and are excited to share is a technique that dramatically speeds up database imports, especially large ones. This is a big win for us since we’re often importing large databases multiple times a day on a project. In this post we’ll look at:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;how much faster data volume imports are compared to traditional database dumps piped to &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;how to set up a data volume import with your Drupal Docker stack&lt;/li&gt;
  &lt;li&gt;how to tie in this process with your local and continuous integration environments&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;the-old-way&quot;&gt;The &lt;em&gt;old&lt;/em&gt; way&lt;/h2&gt;

&lt;p&gt;The way we historically imported a database was to pipe a SQL database dump file into the MySQL command-line client:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_user&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; -p&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_pass&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;database_name&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &amp;lt; /path/to/database.sql
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;An improvement upon the default method above which we’ve been using for some time allows us to monitor import progress utilizing the &lt;a href=&quot;https://www.ivarch.com/programs/pv.shtml&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pv&lt;/code&gt;&lt;/a&gt; command. Large imports can take many minutes, so having insight into how much time remains is helpful to our workflow:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pv /path/to/database.sql | mysql -u&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_user&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; -p &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_pass&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;database_name&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;On large databases, though, MYSQL imports can be slow. If we look at a database dump SQL file, we can see why. For example, a 19 MB database dump file we are using in one of our test cases further on in this post contains these instructions:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;--
-- Table structure for table `block_content`
--
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40101 SET @saved_cs_client     = @@character_set_client */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40101 SET character_set_client = utf8 */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`revision_id`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`type`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ascii&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;The ID of the target entity.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`uuid`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ascii&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`langcode`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ascii&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;UNIQUE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content_field__uuid__value`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`uuid`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;UNIQUE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content__revision_id`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`revision_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content_field__type__target_id`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`type`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8mb4&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COMMENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;The base table for block_content entities.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40101 SET character_set_client = @saved_cs_client */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;--
-- Dumping data for table `block_content`
--
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;LOCK&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TABLES&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40000 ALTER TABLE `block_content` DISABLE KEYS */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;autocommit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;a9167ea6-c6b7-48a1-ac06-6d04a67a5d54&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;2114eee9-1674-4873-8800-aaf06aaf9773&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;855c13ba-689e-40fd-9b00-d7e3dd7998ae&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;8c68671b-715e-457d-a497-2d38c1562f67&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;bc7701dd-b31c-45a6-9f96-48b0b91c7fa2&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;d8e23385-5bda-41da-8e1f-ba60fc25c1dc&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;ea6a93eb-b0c3-4d1c-8690-c16b3c52b3f1&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;3d314051-567f-4e74-aae4-a8b076603e44&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;2ef5ae05-6819-4571-8872-4d994ae793ef&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;3deaa1a9-4144-43cc-9a3d-aeb635dfc2ca&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;d57e81e8-c613-45be-b1d5-5844ba15413c&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40000 ALTER TABLE `block_content` ENABLE KEYS */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNLOCK&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TABLES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;commit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;When we pipe the contents of the MySQL database dump to the &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; command, the client processes each of these instructions sequentially in order to (1) create the structure for each table defined in the file, (2) populate the database with data from the SQL dump and (3) do post-processing work like create indices to ensure the database performs well. The example here processes pretty quickly, but if your site has a lot of historic content, as many of our clients do, then the import process can take enough time that it throws a wrench in our rapid workflow!&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;What happens when &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; finishes importing the SQL dump file? The database contents (&lt;em&gt;often&lt;/em&gt;) live in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql/{database}&lt;/code&gt;, so for example for the &lt;code class=&quot;highlighter-rouge&quot;&gt;block_content&lt;/code&gt; table mentioned above, assuming you’re using the typically preferred InnoDB storage engine, there are two files called &lt;code class=&quot;highlighter-rouge&quot;&gt;block_content.frm&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;block_content.ibd&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql/{database}/&lt;/code&gt;. The &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql&lt;/code&gt; directory will also contain a number of other directories and files related to the configuration of the MySQL server.&lt;/p&gt;

&lt;p&gt;Now, suppose that instead of sequentially processing the SQL instructions contained in a database dump file, we were able to provide developers with a snapshot of the &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql&lt;/code&gt; directory for a given Drupal site. Could this swap faster than the traditional database import methods? Let’s have a look at two test cases to find out!&lt;/p&gt;

&lt;h3 id=&quot;mysql-import-test-cases&quot;&gt;MySQL import test cases&lt;/h3&gt;

&lt;p&gt;The table below shows the results of two test cases, one using a 19 MB database and the other using a 4.7 GB database.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Method&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Database size&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Time to drop tables and restore (seconds)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Traditional &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19 MB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;128&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Docker data volume restore&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19 MB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Traditional &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.7 GB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;606&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Docker data volume restore&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.7 GB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;85&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;In other words, the MySQL data volume import completes, on average, in about 11% of the time, or 9 times faster, than a traditional MySQL dump import would take!&lt;/p&gt;

&lt;p&gt;Since a GIF is worth a thousand words, compare these two processes side-by-side (both are using the same 19 MB source database; the first is using a data volume restore process while the second is using the traditional MySQL import process). You can see that the second process takes considerably longer!&lt;/p&gt;

&lt;h4 id=&quot;docker-data-volume-restore&quot;&gt;Docker data volume restore&lt;/h4&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;https://asciinema.org/a/102770.js&quot; id=&quot;asciicast-102770&quot; async=&quot;&quot; data-autoplay=&quot;true&quot; data-loop=&quot;true&quot; data-theme=&quot;solarized-dark&quot;&gt;&lt;/script&gt;

&lt;h4 id=&quot;traditional-mysql-database-dump-import&quot;&gt;Traditional MySQL database dump import&lt;/h4&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;https://asciinema.org/a/102769.js&quot; id=&quot;asciicast-102769&quot; async=&quot;&quot; data-autoplay=&quot;true&quot; data-loop=&quot;true&quot; data-theme=&quot;solarized-dark&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;use-mysql-volume-for-database-imports-with-docker&quot;&gt;Use MySQL volume for database imports with Docker&lt;/h2&gt;

&lt;p&gt;Here’s how the process works&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;. Suppose you have a Docker stack with a web container and a database container, and that the database container has data in it already (your site is up and running locally). Assuming a database container name of &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_database&lt;/code&gt;, to generate a volume for the MySQL &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql&lt;/code&gt; contents of the database container, you’d run these commands:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Stop the database container to prevent read/writes to it during the database&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# export process.&lt;/span&gt;
docker stop drupal_database
&lt;span class=&quot;c&quot;&gt;# Now use the carinamarinab/backup image with the `backup` command to generate a&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# tar.gz file based on the `/var/lib/mysql` directory in the `drupal_database`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# container.&lt;/span&gt;
docker run --rm --volumes-from drupal_database carinamarina/backup backup &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--source /var/lib/mysql/ --stdout --zip &amp;gt; db-data-volume.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With the 4.7 GB sample database above, this process takes 239 seconds and results in 702 MB compressed file.&lt;/p&gt;

&lt;p&gt;We’re making use of the &lt;a href=&quot;https://getcarina.com/docs/tutorials/backup-restore-data/&quot;&gt;carinamarina/backup&lt;/a&gt; image produced by Rackspace to create an archive of the database files.&lt;/p&gt;

&lt;p&gt;You can then distribute this file to your colleagues (at Savas Labs, we use &lt;a href=&quot;https://aws.amazon.com/s3/&quot;&gt;Amazon S3&lt;/a&gt;), or make use of it in continuous integration builds (more on that below), using these commands:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Copy the data volume tar.gz file from your team&#39;s AWS S3 bucket.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; ! -f db/db-data-volume.tar.gz &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;; &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;aws s3 cp &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
s3://&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;your-bucket&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/mysql-data-volume/db-data-volume.tar.gz db-data-volume.tar.gz; &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Stop the database container to prevent read/writes during the database&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# restore process.&lt;/span&gt;
docker stop drupal_database
&lt;span class=&quot;c&quot;&gt;# Remove the /var/lib/mysql contents from the database container.&lt;/span&gt;
docker run --rm --volumes-from drupal_database alpine:3.3 rm -rf /var/lib/mysql/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Use the carinamarina/backup image with the `restore` command to extract&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# the tar.gz file contents into /var/lib/mysql in the database container.&lt;/span&gt;
docker run --rm --interactive --volumes-from drupal_database &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
carinamarina/backup restore --destination /var/lib/mysql/ --stdin &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--zip &amp;lt; db-data-volume.tar.gz
&lt;span class=&quot;c&quot;&gt;# Start the database container again.&lt;/span&gt;
docker start drupal_database
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;So, not too complicated, but it will require a change in your processes for generating seed databases to distribute to your team for local development, or for CI builds. Instead of using &lt;code class=&quot;highlighter-rouge&quot;&gt;mysqldump&lt;/code&gt; to create the seed database file, you’ll need to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;carinamarina/backup&lt;/code&gt; image to create the &lt;code class=&quot;highlighter-rouge&quot;&gt;.tar.gz&lt;/code&gt; file for distribution. And instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql {database} &amp;lt; database.sql&lt;/code&gt; you’ll use &lt;code class=&quot;highlighter-rouge&quot;&gt;carinamarina/backup&lt;/code&gt; to restore the data volume.&lt;/p&gt;

&lt;p&gt;In our team’s view this is a small cost for the enormous gains in database import time, which in turn boosts productivity to the tune of faster CI builds and refreshes of local development environments.&lt;/p&gt;

&lt;h2 id=&quot;further-efficiency-gains-integrate-this-process-with-your-continuous-integration-workflow&quot;&gt;Further efficiency gains: integrate this process with your continuous integration workflow&lt;/h2&gt;

&lt;p&gt;The above steps can be manually performed by a technical lead responsible for generating and distributing the MySQL data volume to team members and your testing infrastructure. But we can get further productivity gains by automating this process completely with &lt;a href=&quot;https://www.travis-ci.com&quot;&gt;Travis CI&lt;/a&gt; and GitHub hooks. In outline, here’s what this process looks like:&lt;/p&gt;

&lt;h3 id=&quot;generate-a-new-seed-database-sql-dump-after-production-deployments&quot;&gt;1. Generate a new seed database SQL dump after production deployments&lt;/h3&gt;

&lt;p&gt;At Savas Labs, we use &lt;a href=&quot;http://www.fabfile.org&quot;&gt;Fabric&lt;/a&gt; to automate our deployment process. When we deploy to production (not on a Docker stack), our post-deployment tasks generate a traditional MySQL database dump and copy it to Amazon S3:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;update_seed_db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&#39;drush -r &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s/www/web sql-dump &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;    --result-file=/tmp/$(date +&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Y-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)--post-deployment.sql --gzip &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;    --structure-tables-list=cache,cache_*,history,search_*,sessions,watchdog&#39;&lt;/span&gt; \
    &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&#39;/usr/local/bin/aws s3 cp /tmp/$(date +&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Y-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)--post-deployment.sql.gz &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;    s3://{bucket-name}/seed-database/database.sql.gz --sse&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&#39;rm /tmp/$(date +&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Y-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)--post-deployment.sql.gz&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;when-work-is-merged-into-develop-create-a-new-mysql-data-volume-archive&quot;&gt;2. When work is merged into develop, create a new MySQL data volume archive&lt;/h3&gt;

&lt;p&gt;We use &lt;a href=&quot;http://developers.savaslabs.com/en/latest/git.html#basic-git-workflow-git-flow&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;git flow&lt;/code&gt;&lt;/a&gt; as our collaboration and documentation standard for source code management on our Drupal projects. Whenever a developer merges a feature branch into &lt;code class=&quot;highlighter-rouge&quot;&gt;develop&lt;/code&gt;, we update the MySQL data volume archive dump for use in Travis CI tasks and local development. First, there is a specification in our &lt;code class=&quot;highlighter-rouge&quot;&gt;.travis.yml&lt;/code&gt; file that calls a deployment script:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;deploy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;script&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;resources/scripts/travis-deploy.sh&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;skip_cleanup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;branch&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;develop&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And the &lt;code class=&quot;highlighter-rouge&quot;&gt;travis-deploy.sh&lt;/code&gt; script:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/env bash&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; -e

make import-seed-db
make &lt;span class=&quot;nb&quot;&gt;export&lt;/span&gt;-mysql-data
aws s3 cp db-data-volume.tar.gz &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
s3://&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;bucket-name&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/mysql-data-volume/db-data-volume.tar.gz --sse
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This script: (1) imports the traditional MySQL seed database file from production, and then (2) creates a MySQL data volume archive. We use a &lt;a href=&quot;https://github.com/savaslabs/docker-drupal-template/blob/master/Makefile&quot;&gt;Makefile&lt;/a&gt; to standardize common site provisioning tasks for developers and our CI systems.&lt;/p&gt;

&lt;h3 id=&quot;pull-requests-and-local-development-make-use-of-the-mysql-data-volume-archive&quot;&gt;3. Pull requests and local development make use of the MySQL data volume archive&lt;/h3&gt;

&lt;p&gt;Now, whenever developers want to refresh their local environment by wiping the existing database and re-importing the seed database, or, when a Travis CI build is triggered by a GitHub pull request, these processes can make use of an up-to-date MySQL data volume archive file which is super fast to restore! This way, we ensure we’re always testing against the latest content and configuration, and avoid running into costly issues having to troubleshoot inconsistencies with production.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We’ve invested heavily in Docker for our development stack, and this workflow update is a compelling addition to that toolkit since it has substantially sped up MySQL imports and boosted productivity. Try it out in your Docker workflow and we invite comments to field any questions and hear about your successes. Stay tuned for further &lt;a href=&quot;/blog/tag/docker/&quot;&gt;Docker&lt;/a&gt; updates!&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;It’s worth noting that there are &lt;a href=&quot;https://github.com/juampynr/syncdb&quot;&gt;cool projects out there&lt;/a&gt; for doing parallel imports of a SQL dump file which improve the import experience. &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;Hat tip to &lt;a href=&quot;/team/tim-stallmann/&quot;&gt;Tim Stallmann&lt;/a&gt; for taking a proof of concept and incorporating it into a &lt;a href=&quot;/work/hptn-case-study/&quot;&gt;real-world project&lt;/a&gt;, from which many of the code samples here are drawn. &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
",
      "author": {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Kosta Harlan and Chris Russo",
        "affiliation": "Savas Labs",
        "worksFor": "Savas Labs"
      },
      "dateCreated": "2017-02-15 00:00:00 +0000",
      "dateModified": "2017-02-15 00:00:00 +0000",
      "datePublished": "2017-02-15 00:00:00 +0000",
      "headline": "Dramatically Improve MySQL Import Performance with Docker",
      "image": {
        "@context": "http://schema.org",
        "@type": "ImageObject",
        "author": "Kosta Harlan and Chris Russo",
        "datePublished": "2017-02-15 00:00:00 +0000",
        "description": "Docker, ships, the sea",
        "height": "983px",
        "url": "http://savaslabs.com/assets/img/blog/sea-ocean-boats-port.jpg",
        "width": "1474px"
      },
      "inLanguage": "en-US",
      "keywords": "drupal, drupal-planet, docker, continuous-integration, performance, productivity",
      "mainEntityOfPage": "http://savaslabs.com/2017/02/15/docker-mysql-performance.html",
      "publisher": {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Durham, North Carolina",
          "postalCode": "27701",
          "streetAddress": "201 W Main St."
        },
        "description": "A full-service web agency leveraging the power of Drupal.
",
        "email": "info@savaslabs.com",
        "logo": {
          "@context": "http://schema.org",
          "@type": "ImageObject",
          "description": "Savas Labs logo",
          "height": "50px",
          "url": "http://savaslabs.com/assets/img/logo.png",
          "width": "114px"
        },
        "name": "Savas Labs",
        "telephone": "(919) 432-4660",
        "url": "http://savaslabs.com"
      },
      "sourceOrganization": "Savas Labs",
      "text": "&lt;p&gt;We use &lt;a href=&quot;https://www.docker.com/&quot;&gt;Docker&lt;/a&gt; for our development environments because it helps us adhere to our &lt;a href=&quot;/mission-and-values/#excel&quot;&gt;commitment to excellence&lt;/a&gt;. It ensures an identical development platform across the team while also achieving parity with the production environment. These efficiency gains (among others we’ll share in an ongoing &lt;a href=&quot;/blog/tag/docker/&quot;&gt;Docker series&lt;/a&gt;) over traditional development methods enable us to spend less time on setup and more time building amazing things.&lt;/p&gt;

&lt;p&gt;Part of our workflow includes a mechanism to establish and update the &lt;a href=&quot;https://en.wikipedia.org/wiki/Database_seeding&quot;&gt;seed database&lt;/a&gt; which we use to load near-real-time production content to our development environments as well as our &lt;a href=&quot;/blog/tag/testing/&quot;&gt;automated testing&lt;/a&gt; infrastructure. We’ve found it’s best to have real data throughout the development process, rather than using stale or dummy data which runs the risk of encountering unexpected issues toward the end of a project. One efficiency boon we’ve recently implemented and are excited to share is a technique that dramatically speeds up database imports, especially large ones. This is a big win for us since we’re often importing large databases multiple times a day on a project. In this post we’ll look at:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;how much faster data volume imports are compared to traditional database dumps piped to &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;how to set up a data volume import with your Drupal Docker stack&lt;/li&gt;
  &lt;li&gt;how to tie in this process with your local and continuous integration environments&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;the-old-way&quot;&gt;The &lt;em&gt;old&lt;/em&gt; way&lt;/h2&gt;

&lt;p&gt;The way we historically imported a database was to pipe a SQL database dump file into the MySQL command-line client:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_user&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; -p&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_pass&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;database_name&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &amp;lt; /path/to/database.sql
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;An improvement upon the default method above which we’ve been using for some time allows us to monitor import progress utilizing the &lt;a href=&quot;https://www.ivarch.com/programs/pv.shtml&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pv&lt;/code&gt;&lt;/a&gt; command. Large imports can take many minutes, so having insight into how much time remains is helpful to our workflow:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pv /path/to/database.sql | mysql -u&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_user&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; -p &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;some_pass&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;database_name&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;On large databases, though, MYSQL imports can be slow. If we look at a database dump SQL file, we can see why. For example, a 19 MB database dump file we are using in one of our test cases further on in this post contains these instructions:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;--
-- Table structure for table `block_content`
--
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40101 SET @saved_cs_client     = @@character_set_client */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40101 SET character_set_client = utf8 */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`revision_id`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`type`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ascii&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;The ID of the target entity.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`uuid`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ascii&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`langcode`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ascii&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;UNIQUE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content_field__uuid__value`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`uuid`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;UNIQUE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content__revision_id`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`revision_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content_field__type__target_id`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`type`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8mb4&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COMMENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;The base table for block_content entities.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40101 SET character_set_client = @saved_cs_client */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;--
-- Dumping data for table `block_content`
--
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;LOCK&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TABLES&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40000 ALTER TABLE `block_content` DISABLE KEYS */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;autocommit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`block_content`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;a9167ea6-c6b7-48a1-ac06-6d04a67a5d54&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;2114eee9-1674-4873-8800-aaf06aaf9773&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;855c13ba-689e-40fd-9b00-d7e3dd7998ae&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;8c68671b-715e-457d-a497-2d38c1562f67&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;bc7701dd-b31c-45a6-9f96-48b0b91c7fa2&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;d8e23385-5bda-41da-8e1f-ba60fc25c1dc&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;ea6a93eb-b0c3-4d1c-8690-c16b3c52b3f1&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;3d314051-567f-4e74-aae4-a8b076603e44&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;2ef5ae05-6819-4571-8872-4d994ae793ef&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;3deaa1a9-4144-43cc-9a3d-aeb635dfc2ca&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;basic&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;d57e81e8-c613-45be-b1d5-5844ba15413c&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;en&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*!40000 ALTER TABLE `block_content` ENABLE KEYS */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNLOCK&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TABLES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;commit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;When we pipe the contents of the MySQL database dump to the &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; command, the client processes each of these instructions sequentially in order to (1) create the structure for each table defined in the file, (2) populate the database with data from the SQL dump and (3) do post-processing work like create indices to ensure the database performs well. The example here processes pretty quickly, but if your site has a lot of historic content, as many of our clients do, then the import process can take enough time that it throws a wrench in our rapid workflow!&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;What happens when &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; finishes importing the SQL dump file? The database contents (&lt;em&gt;often&lt;/em&gt;) live in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql/{database}&lt;/code&gt;, so for example for the &lt;code class=&quot;highlighter-rouge&quot;&gt;block_content&lt;/code&gt; table mentioned above, assuming you’re using the typically preferred InnoDB storage engine, there are two files called &lt;code class=&quot;highlighter-rouge&quot;&gt;block_content.frm&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;block_content.ibd&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql/{database}/&lt;/code&gt;. The &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql&lt;/code&gt; directory will also contain a number of other directories and files related to the configuration of the MySQL server.&lt;/p&gt;

&lt;p&gt;Now, suppose that instead of sequentially processing the SQL instructions contained in a database dump file, we were able to provide developers with a snapshot of the &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql&lt;/code&gt; directory for a given Drupal site. Could this swap faster than the traditional database import methods? Let’s have a look at two test cases to find out!&lt;/p&gt;

&lt;h3 id=&quot;mysql-import-test-cases&quot;&gt;MySQL import test cases&lt;/h3&gt;

&lt;p&gt;The table below shows the results of two test cases, one using a 19 MB database and the other using a 4.7 GB database.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Method&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Database size&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Time to drop tables and restore (seconds)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Traditional &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19 MB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;128&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Docker data volume restore&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19 MB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Traditional &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.7 GB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;606&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Docker data volume restore&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.7 GB&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;85&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;In other words, the MySQL data volume import completes, on average, in about 11% of the time, or 9 times faster, than a traditional MySQL dump import would take!&lt;/p&gt;

&lt;p&gt;Since a GIF is worth a thousand words, compare these two processes side-by-side (both are using the same 19 MB source database; the first is using a data volume restore process while the second is using the traditional MySQL import process). You can see that the second process takes considerably longer!&lt;/p&gt;

&lt;h4 id=&quot;docker-data-volume-restore&quot;&gt;Docker data volume restore&lt;/h4&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;https://asciinema.org/a/102770.js&quot; id=&quot;asciicast-102770&quot; async=&quot;&quot; data-autoplay=&quot;true&quot; data-loop=&quot;true&quot; data-theme=&quot;solarized-dark&quot;&gt;&lt;/script&gt;

&lt;h4 id=&quot;traditional-mysql-database-dump-import&quot;&gt;Traditional MySQL database dump import&lt;/h4&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;https://asciinema.org/a/102769.js&quot; id=&quot;asciicast-102769&quot; async=&quot;&quot; data-autoplay=&quot;true&quot; data-loop=&quot;true&quot; data-theme=&quot;solarized-dark&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;use-mysql-volume-for-database-imports-with-docker&quot;&gt;Use MySQL volume for database imports with Docker&lt;/h2&gt;

&lt;p&gt;Here’s how the process works&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;. Suppose you have a Docker stack with a web container and a database container, and that the database container has data in it already (your site is up and running locally). Assuming a database container name of &lt;code class=&quot;highlighter-rouge&quot;&gt;drupal_database&lt;/code&gt;, to generate a volume for the MySQL &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/mysql&lt;/code&gt; contents of the database container, you’d run these commands:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Stop the database container to prevent read/writes to it during the database&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# export process.&lt;/span&gt;
docker stop drupal_database
&lt;span class=&quot;c&quot;&gt;# Now use the carinamarinab/backup image with the `backup` command to generate a&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# tar.gz file based on the `/var/lib/mysql` directory in the `drupal_database`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# container.&lt;/span&gt;
docker run --rm --volumes-from drupal_database carinamarina/backup backup &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--source /var/lib/mysql/ --stdout --zip &amp;gt; db-data-volume.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With the 4.7 GB sample database above, this process takes 239 seconds and results in 702 MB compressed file.&lt;/p&gt;

&lt;p&gt;We’re making use of the &lt;a href=&quot;https://getcarina.com/docs/tutorials/backup-restore-data/&quot;&gt;carinamarina/backup&lt;/a&gt; image produced by Rackspace to create an archive of the database files.&lt;/p&gt;

&lt;p&gt;You can then distribute this file to your colleagues (at Savas Labs, we use &lt;a href=&quot;https://aws.amazon.com/s3/&quot;&gt;Amazon S3&lt;/a&gt;), or make use of it in continuous integration builds (more on that below), using these commands:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Copy the data volume tar.gz file from your team&#39;s AWS S3 bucket.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; ! -f db/db-data-volume.tar.gz &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;; &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;aws s3 cp &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
s3://&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;your-bucket&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/mysql-data-volume/db-data-volume.tar.gz db-data-volume.tar.gz; &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Stop the database container to prevent read/writes during the database&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# restore process.&lt;/span&gt;
docker stop drupal_database
&lt;span class=&quot;c&quot;&gt;# Remove the /var/lib/mysql contents from the database container.&lt;/span&gt;
docker run --rm --volumes-from drupal_database alpine:3.3 rm -rf /var/lib/mysql/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Use the carinamarina/backup image with the `restore` command to extract&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# the tar.gz file contents into /var/lib/mysql in the database container.&lt;/span&gt;
docker run --rm --interactive --volumes-from drupal_database &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
carinamarina/backup restore --destination /var/lib/mysql/ --stdin &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--zip &amp;lt; db-data-volume.tar.gz
&lt;span class=&quot;c&quot;&gt;# Start the database container again.&lt;/span&gt;
docker start drupal_database
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;So, not too complicated, but it will require a change in your processes for generating seed databases to distribute to your team for local development, or for CI builds. Instead of using &lt;code class=&quot;highlighter-rouge&quot;&gt;mysqldump&lt;/code&gt; to create the seed database file, you’ll need to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;carinamarina/backup&lt;/code&gt; image to create the &lt;code class=&quot;highlighter-rouge&quot;&gt;.tar.gz&lt;/code&gt; file for distribution. And instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql {database} &amp;lt; database.sql&lt;/code&gt; you’ll use &lt;code class=&quot;highlighter-rouge&quot;&gt;carinamarina/backup&lt;/code&gt; to restore the data volume.&lt;/p&gt;

&lt;p&gt;In our team’s view this is a small cost for the enormous gains in database import time, which in turn boosts productivity to the tune of faster CI builds and refreshes of local development environments.&lt;/p&gt;

&lt;h2 id=&quot;further-efficiency-gains-integrate-this-process-with-your-continuous-integration-workflow&quot;&gt;Further efficiency gains: integrate this process with your continuous integration workflow&lt;/h2&gt;

&lt;p&gt;The above steps can be manually performed by a technical lead responsible for generating and distributing the MySQL data volume to team members and your testing infrastructure. But we can get further productivity gains by automating this process completely with &lt;a href=&quot;https://www.travis-ci.com&quot;&gt;Travis CI&lt;/a&gt; and GitHub hooks. In outline, here’s what this process looks like:&lt;/p&gt;

&lt;h3 id=&quot;generate-a-new-seed-database-sql-dump-after-production-deployments&quot;&gt;1. Generate a new seed database SQL dump after production deployments&lt;/h3&gt;

&lt;p&gt;At Savas Labs, we use &lt;a href=&quot;http://www.fabfile.org&quot;&gt;Fabric&lt;/a&gt; to automate our deployment process. When we deploy to production (not on a Docker stack), our post-deployment tasks generate a traditional MySQL database dump and copy it to Amazon S3:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;update_seed_db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&#39;drush -r &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s/www/web sql-dump &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;    --result-file=/tmp/$(date +&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Y-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)--post-deployment.sql --gzip &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;    --structure-tables-list=cache,cache_*,history,search_*,sessions,watchdog&#39;&lt;/span&gt; \
    &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&#39;/usr/local/bin/aws s3 cp /tmp/$(date +&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Y-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)--post-deployment.sql.gz &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;    s3://{bucket-name}/seed-database/database.sql.gz --sse&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&#39;rm /tmp/$(date +&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Y-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)--post-deployment.sql.gz&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;when-work-is-merged-into-develop-create-a-new-mysql-data-volume-archive&quot;&gt;2. When work is merged into develop, create a new MySQL data volume archive&lt;/h3&gt;

&lt;p&gt;We use &lt;a href=&quot;http://developers.savaslabs.com/en/latest/git.html#basic-git-workflow-git-flow&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;git flow&lt;/code&gt;&lt;/a&gt; as our collaboration and documentation standard for source code management on our Drupal projects. Whenever a developer merges a feature branch into &lt;code class=&quot;highlighter-rouge&quot;&gt;develop&lt;/code&gt;, we update the MySQL data volume archive dump for use in Travis CI tasks and local development. First, there is a specification in our &lt;code class=&quot;highlighter-rouge&quot;&gt;.travis.yml&lt;/code&gt; file that calls a deployment script:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;deploy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;script&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;resources/scripts/travis-deploy.sh&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;skip_cleanup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;branch&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;develop&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And the &lt;code class=&quot;highlighter-rouge&quot;&gt;travis-deploy.sh&lt;/code&gt; script:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/env bash&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; -e

make import-seed-db
make &lt;span class=&quot;nb&quot;&gt;export&lt;/span&gt;-mysql-data
aws s3 cp db-data-volume.tar.gz &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
s3://&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;bucket-name&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/mysql-data-volume/db-data-volume.tar.gz --sse
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This script: (1) imports the traditional MySQL seed database file from production, and then (2) creates a MySQL data volume archive. We use a &lt;a href=&quot;https://github.com/savaslabs/docker-drupal-template/blob/master/Makefile&quot;&gt;Makefile&lt;/a&gt; to standardize common site provisioning tasks for developers and our CI systems.&lt;/p&gt;

&lt;h3 id=&quot;pull-requests-and-local-development-make-use-of-the-mysql-data-volume-archive&quot;&gt;3. Pull requests and local development make use of the MySQL data volume archive&lt;/h3&gt;

&lt;p&gt;Now, whenever developers want to refresh their local environment by wiping the existing database and re-importing the seed database, or, when a Travis CI build is triggered by a GitHub pull request, these processes can make use of an up-to-date MySQL data volume archive file which is super fast to restore! This way, we ensure we’re always testing against the latest content and configuration, and avoid running into costly issues having to troubleshoot inconsistencies with production.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We’ve invested heavily in Docker for our development stack, and this workflow update is a compelling addition to that toolkit since it has substantially sped up MySQL imports and boosted productivity. Try it out in your Docker workflow and we invite comments to field any questions and hear about your successes. Stay tuned for further &lt;a href=&quot;/blog/tag/docker/&quot;&gt;Docker&lt;/a&gt; updates!&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;It’s worth noting that there are &lt;a href=&quot;https://github.com/juampynr/syncdb&quot;&gt;cool projects out there&lt;/a&gt; for doing parallel imports of a SQL dump file which improve the import experience. &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;Hat tip to &lt;a href=&quot;/team/tim-stallmann/&quot;&gt;Tim Stallmann&lt;/a&gt; for taking a proof of concept and incorporating it into a &lt;a href=&quot;/work/hptn-case-study/&quot;&gt;real-world project&lt;/a&gt;, from which many of the code samples here are drawn. &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
",
      "url": "http://savaslabs.com/2017/02/15/docker-mysql-performance.html"
    }
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61514316-1', 'auto');
  ga('send', 'pageview');

</script>

  <script>
    !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function l(){d.addEventListener&&d.removeEventListener("load",l),d.media=r||"all"}var a,i=e.document,d=i.createElement("link");if(n)a=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;a=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){a.parentNode.insertBefore(d,n?a:a.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",l),d.onloadcssdefined=f,f(l),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(t){}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){e.clearInterval(n)})}}}(this);
    loadCSS('/assets/styles/main.css');
    loadCSS('https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|Roboto+Slab:300,400|Source+Sans+Pro');
  </script>
  <style>html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.case-studies__case-study .case-study__description a,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link{border:2px solid #fff;border-radius:3px;color:#fff;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif;margin-top:2em;padding:.5em 1em;transition:all .2s ease-in-out}.case-studies__case-study .case-study__description a:focus,.case-studies__case-study .case-study__description a:hover,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link:focus,.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link:hover{background-color:#0f7993}.flash-alert{background-color:rgba(242,163,36,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-alert a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-alert a:focus,.flash-alert a:hover{color:rgba(0,0,0,.2)}.flash-error{background-color:rgba(158,2,59,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-error a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-error a:focus,.flash-error a:hover{color:rgba(0,0,0,.2)}.flash-notice{background-color:rgba(246,67,62,.2);color:rgba(2,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-notice a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-notice a:focus,.flash-notice a:hover{color:rgba(0,0,0,.2)}.flash-success{background-color:rgba(5,92,43,.2);color:rgba(0,0,0,.2);display:block;font-weight:600;margin-bottom:.75em;padding:.75em;text-align:center}.flash-success a{color:rgba(0,0,0,.2);text-decoration:underline}.flash-success a:focus,.flash-success a:hover{color:rgba(0,0,0,.2)}button,input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none;-webkit-font-smoothing:antialiased;background-color:#0a5365;border-radius:3px;border:none;color:#fff;cursor:pointer;display:inline-block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;font-weight:600;line-height:1;padding:.75em 1em;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;white-space:nowrap}button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{background-color:#031a1f;color:#fff}button:disabled,input[type=button]:disabled,input[type=reset]:disabled,input[type=submit]:disabled{cursor:not-allowed;opacity:.5}fieldset{background-color:#f7f7f7;border:1px solid #ddd;margin:0 0 .75em;padding:1.5em}input,label,select{display:block;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em}label{font-weight:600;margin-bottom:.375em}label.required::after{content:"*"}label abbr{display:none}input[type=color],input[type=date],input[type=datetime-local],input[type=datetime],input[type=email],input[type=month],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=time],input[type=url],input[type=week],select[multiple=multiple],textarea{background-color:#fff;border:1px solid #ddd;border-radius:3px;box-shadow:inset 0 1px 3px rgba(0,0,0,.06);box-sizing:border-box;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;margin-bottom:.75em;padding:.5em;transition:border-color;width:100%}input[type=color]:hover,input[type=date]:hover,input[type=datetime-local]:hover,input[type=datetime]:hover,input[type=email]:hover,input[type=month]:hover,input[type=number]:hover,input[type=password]:hover,input[type=search]:hover,input[type=tel]:hover,input[type=text]:hover,input[type=time]:hover,input[type=url]:hover,input[type=week]:hover,select[multiple=multiple]:hover,textarea:hover{border-color:#c4c4c4}input[type=color]:focus,input[type=date]:focus,input[type=datetime-local]:focus,input[type=datetime]:focus,input[type=email]:focus,input[type=month]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=time]:focus,input[type=url]:focus,input[type=week]:focus,select[multiple=multiple]:focus,textarea:focus{border-color:#0a5365;box-shadow:inset 0 1px 3px rgba(0,0,0,.06),0 0 5px rgba(55,112,192,.7);outline:0}textarea{resize:vertical}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none}input[type=checkbox],input[type=radio]{display:inline;margin-right:.375em}input[type=file]{padding-bottom:.75em;width:100%}select{margin-bottom:1.5em;max-width:100%;width:auto}ol,ul{list-style-type:none;margin:0;padding:0}dl{margin-bottom:.75em}dl dt{font-weight:700;margin-top:.75em}dl dd{margin:0}table{-ms-font-feature-settings:"kern","liga","tnum";font-feature-settings:"kern","liga","tnum";border-collapse:collapse;margin:.75em 0;table-layout:fixed;width:100%}th{border-bottom:1px solid #b7b7b7;font-weight:600;padding:.75em 0;text-align:left}td{border-bottom:1px solid #ddd;padding:.75em 0}td .label{font-weight:700}td,th,tr{vertical-align:middle}body{-ms-font-feature-settings:"kern","liga","pnum";font-feature-settings:"kern","liga","pnum";-webkit-font-smoothing:antialiased;color:#333;font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;line-height:1.5}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;font-size:1em;line-height:1.2;margin:0 0 .75em}p{margin:0 0 .75em}a{color:#0a5365;text-decoration:none;transition:color .1s linear}a:active,a:focus,a:hover{color:#031a1f}a:active,a:focus{outline:0}hr{border-bottom:1px solid #ddd;border-left:none;border-right:none;border-top:none;margin:1.5em 0}img,picture{margin:0;max-width:100%}.table-minimal{border-collapse:separate;border-spacing:0;width:100%}.table-minimal th{text-align:left}.table-minimal td{line-height:1.5}.table-minimal thead th{background-color:#fff;border-bottom:0;padding:.75em 1em}.table-minimal tbody{background-color:#fff}.table-minimal tbody td{border-bottom:0;border-top:1px solid #ddd;padding:.75em 1em}.table-minimal tbody td button{display:inline-block;font-size:.7em;line-height:1.5;margin-bottom:.3em;margin-right:.5em;outline:0;padding:.3em 1em;width:100%}@media screen and (min-width:40em){.table-minimal tbody td button{margin-bottom:0;width:auto}}.table-minimal tbody tr:hover>td,.table-minimal tbody tr:hover>th{background-color:#fafafa}.table-minimal tbody tr:first-child td{border-top:2px solid #ddd}.table-minimal--contact p{display:none}@media screen and (min-width:28.125em){.table-minimal--contact p{display:inline}}.table-minimal--contact .table-minimal--contact__label{width:30%}@media screen and (min-width:28.125em){.table-minimal--contact .table-minimal--contact__label{width:50%}}body{color:#14133b;font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}h1,h2,h3,h4,h5,h6{color:#9e023b;font-family:"Roboto Slab",Verdana,sans-serif;font-weight:300}.portfolio h2,.portfolio h3,.portfolio h4,.portfolio h5,.portfolio h6,.post h2,.post h3,.post h4,.post h5,.post h6{margin-top:1.5em}h1{font-size:250%}h2{font-size:200%}h3{font-size:160%}h4{font-size:140%}h5{font-size:120%}h6{font-size:100%}a{color:#0a5365;transition:all .1s linear}a:focus,a:hover{color:#0f7993}.post li a,p a{border-bottom:.1em solid rgba(10,83,101,.1)}.post li a:focus,.post li a:hover,p a:focus,p a:hover{border-bottom:.1em solid #0f7993}.name-description p,.page-description,.post li,.post p,.services__service p,.team-member p{color:#14133b;font-size:1.2em}ul{list-style-type:square}ol{list-style-type:decimal}ol,ul{margin-bottom:1em;margin-left:2em}ol ol,ol ol li,ol ul,ol ul li,ul ol,ul ol li,ul ul,ul ul li{font-size:1em!important}hr{clear:both;margin:3em 0}blockquote{background-color:#f7f7f7;border-left:10px solid rgba(20,19,59,.4);border-radius:0 9px 9px 0;font-style:italic;margin:2em 0;padding:1em;quotes:'\201C' '\201D'}blockquote::before{color:rgba(20,19,59,.4);content:open-quote;font-family:'Source Sans Pro',sans-serif;font-size:4em;line-height:.1em;margin-right:.25em;vertical-align:-.4em}blockquote p{display:inline}.callout{background-color:#14133b;border-left:solid 1em #9e023b;border-radius:6px;margin:1.5em auto;padding:1em;width:100%}.callout p{color:#fff;font-size:1.5em;margin-bottom:0}label{font-family:"Roboto Condensed",Arial Narrow,Arial,sans-serif}.wrapper{max-width:70em;margin-left:auto;margin-right:auto;max-width:70em;padding:3em 1em;vertical-align:baseline}.wrapper::after{clear:both;content:"";display:table}@media screen and (min-width:70em){.wrapper{padding:3em 0}}.flex-container{float:left;display:block;margin-right:2.35765%;width:100%}.flex-container:last-child{margin-right:0}.page-description,.view-all-link,header{text-align:center}.page-description{margin-bottom:2em}@media screen and (min-width:53.75em){.column-8{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.column-8:last-child{margin-right:0}}.view-more-link{font-size:1.2em;text-align:center}.cards{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center}.card{flex-basis:15em;-ms-flex-preferred-size:15em;-moz-flex-grow:1;flex-grow:1;-ms-flex-positive:1;transition:all .2s ease-in-out;background-color:#f7f7f7;border:1px solid #ddd;border-radius:3px;box-shadow:0 2px 4px #e6e6e6;cursor:auto;margin:0 1em 1.5em;position:relative}.card .card-image{max-height:200px;overflow:hidden}.card .card-image img{transition:all .2s ease-in-out;background:#ddd;border-top-left-radius:3px;border-top-right-radius:3px;width:100%}.card .card-header{transition:all .2s ease-in-out;background-color:#f7f7f7;border-bottom:1px solid #ddd;border-radius:3px 3px 0 0;font-family:"Roboto Slab",Verdana,sans-serif;line-height:1.5em;padding:.5em .75em}.card .fa-comment-o{margin-right:4px}.card .card-copy{color:#14133b;font-size:.9em;line-height:1.5em;padding:.75em}.card .card-copy p{margin:0 0 .75em}.card:focus,.card:hover{background-color:#fff}.card:focus .card-image img,.card:hover .card-image img{background:#eaeaea}.card:focus .card-header,.card:hover .card-header{background-color:#fff}.card:active{background-color:#f7f7f7}.card:active .card-header{background-color:#f7f7f7}.team-card{flex-basis:21em;-ms-flex-preferred-size:21em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;transition:all .2s ease-in-out}.team-card .card-image{max-height:350px;overflow:hidden}.team-card .card-image img{position:relative;top:-50px}.team-card .card-header{display:inline-block;font-size:1.1em;padding:.5em .75em 0}.team-card .card-copy{border-top:1px solid #dcdcdc;font-size:1em}.team-card .card-title{display:inline-block;float:right;font-size:.8em;line-height:2em;padding:.75em .75em 0;text-transform:uppercase}.blog-card{flex-basis:20em;-ms-flex-preferred-size:20em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0}.case-studies{margin:3em 0}.case-studies__case-study{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;background-position:top center;background-repeat:no-repeat;background-size:cover;margin:1.5em 0}@media screen and (min-width:40em){.case-studies__case-study{-webkit-box-lines:single;-moz-box-lines:single;box-lines:single;-ms-flex-wrap:nowrap;flex-wrap:nowrap}}.case-studies__case-study a,.case-studies__case-study h3,.case-studies__case-study p{color:#fff;margin-bottom:0}.case-studies__case-study .case-study__description,.case-studies__case-study .case-study__title{padding:1.5em}@media screen and (min-width:40em){.case-studies__case-study .case-study__description,.case-studies__case-study .case-study__title{padding:3em 1.5em}}.case-studies__case-study .case-study__title{padding-bottom:0;text-align:center}@media screen and (min-width:40em){.case-studies__case-study .case-study__title{padding-bottom:6em;width:40%}}.case-studies__case-study .case-study__title h3{font-size:200%}@media screen and (min-width:40em){.case-studies__case-study .case-study__description{width:60%}}.case-studies__case-study .case-study__description a,.case-studies__case-study .case-study__description p{font-size:1.25em;margin-bottom:0}.case-studies__case-study .case-study__description a{display:inline-block;margin-top:1.5em}.case-studies__case-study .case-study__description a i{margin-left:.5em}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-angle-double-down:before{content:""}.fa-building-o:before{content:""}.fa-circle:before{content:""}.fa-comment:before{content:""}.fa-comment-o:before{content:""}.fa-drupal:before{content:""}.fa-envelope-o:before{content:""}.fa-file-text:before{content:""}.fa-github:before{content:""}.fa-globe:before{content:""}.fa-linkedin:before{content:""}.fa-long-arrow-right:before{content:""}.fa-phone:before{content:""}.fa-stack-exchange:before{content:""}.fa-tags:before{content:""}.fa-twitter:before{content:""}.home__cover{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;background:url(/assets/img/home-cover-image/home-cover-code-400.png) #14133b center center no-repeat;background-size:cover;height:88vh;text-align:center}@media only screen and (-webkit-min-device-pixel-ratio:2),only screen and (min--moz-device-pixel-ratio:2),only screen and (min-resolution:192dpi),only screen and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-800.png)}}@media screen and (min-width:25em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-640.png)}}@media only screen and (min-width:25em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:25em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:25em) and (min-resolution:192dpi),only screen and (min-width:25em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1280.png)}}@media screen and (min-width:40em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-860.png);height:78vh}}@media only screen and (min-width:40em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:40em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:40em) and (min-resolution:192dpi),only screen and (min-width:40em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1720.png)}}@media screen and (min-width:53.75em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1120.png);height:88vh}}@media only screen and (min-width:53.75em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:53.75em) and (min-resolution:192dpi),only screen and (min-width:53.75em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-2240.png)}}@media screen and (min-width:70em){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code-1200.png)}}@media only screen and (min-width:70em) and (-webkit-min-device-pixel-ratio:2),only screen and (min-width:70em) and (min--moz-device-pixel-ratio:2),only screen and (min-width:70em) and (min-resolution:192dpi),only screen and (min-width:70em) and (min-resolution:2dppx){.home__cover{background-image:url(/assets/img/home-cover-image/home-cover-code.png)}}.home__cover .home__cover__heading,.home__cover .home__cover__site-description{margin:0}.home__cover .home__cover__heading{font-size:2em;font-weight:400;margin-top:30px}.home__cover hr{border:solid 2px #0a5365;border-radius:.5px;margin:10px auto 15px;width:170px}.home__cover .home__cover__site-description{color:#fff;font-size:1.5em;line-height:1.3em;width:230px}.home__cover i{color:#0a5365;font-size:2.8em;padding-top:20px}.navigation{background-color:#0a5365;min-height:70px;width:100%;z-index:999}.navigation a{text-decoration:none}.navigation .navigation-wrapper{max-width:70em;margin-left:auto;margin-right:auto;padding:25px 0;position:relative;z-index:9999}.navigation .navigation-wrapper::after{clear:both;content:"";display:table}.navigation .navigation-wrapper::after{clear:both;content:"";display:table}.navigation .logo{background-color:#14133b;border-radius:6px;display:inline-block;float:left;margin:0 0 0 1em;max-height:70px;padding-left:1em;padding-right:1em}@media screen and (min-width:40em){.navigation .logo{float:none;margin:0 auto}}@media screen and (min-width:53.75em){.navigation .logo{float:left;margin:0 0 0 1em}}.navigation .logo img{max-height:70px;padding:.8em 0}.navigation .navigation-menu-button{color:rgba(255,255,255,.7);display:block;float:right;font-weight:700;line-height:70px;margin:0;padding-right:1em;text-transform:uppercase}@media screen and (min-width:40em){.navigation .navigation-menu-button{display:none}}.navigation .navigation-menu-button:focus,.navigation .navigation-menu-button:hover{color:#fff}.navigation nav{float:none;min-height:70px;z-index:9999999}@media screen and (min-width:40em){.navigation nav{clear:left;margin:0 auto}}@media screen and (min-width:53.75em){.navigation nav{clear:none;float:right}}.navigation .navigation-menu{clear:both;display:none;margin:0 auto;overflow:visible;padding:0;-webkit-transform-style:preserve-3d;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .navigation-menu{display:inline;margin:0;padding:0}}.navigation .navigation-menu.show{display:block}.navigation .nav-link{background:#0a5365;display:block;line-height:70px;overflow:hidden;padding-right:.8em;text-align:right;width:100%;z-index:9999}@media screen and (min-width:40em){.navigation .nav-link{background:0 0;display:inline;line-height:70px;text-decoration:none;width:auto}}.navigation .nav-link a{color:rgba(255,255,255,.7);display:inline-block;font-size:1.1em;font-weight:400;text-transform:uppercase}@media screen and (min-width:40em){.navigation .nav-link a{padding-right:.5em}}@media screen and (min-width:53.75em){.navigation .nav-link a{padding-right:1em}}.navigation .nav-link a:focus,.navigation .nav-link a:hover{color:#fff}.navigation .active-nav-item a{color:#fff}.navigation .more.nav-link{overflow:visible;padding-right:0}@media screen and (min-width:40em){.navigation .more.nav-link{padding-right:.8em;position:relative}.navigation .more.nav-link>ul>li:first-child a{padding-top:1em}}.navigation .more.nav-link a{padding-right:.8em}.navigation .more.nav-link>a{padding-right:.6em;position:relative}@media screen and (min-width:40em){.navigation .more.nav-link>a{margin-right:1em}}.navigation .more.nav-link>a::after{position:absolute;top:auto;right:-.4em;bottom:auto;left:auto;color:rgba(255,255,255,.7)}@media screen and (min-width:40em){.navigation .more.nav-link>a::after{content:'\25BE'}}.navigation .more.nav-link:focus>.submenu,.navigation .more.nav-link:hover>.submenu{display:block}.navigation .submenu{display:none;padding-left:0}@media screen and (min-width:40em){.navigation .submenu{left:-1em;position:absolute;top:1.5em}}.navigation .submenu li{display:block;padding-right:0}@media screen and (min-width:40em){.navigation .submenu li{line-height:53.84615px}.navigation .submenu li:first-child>a{border-top-left-radius:3px;border-top-right-radius:3px}.navigation .submenu li:last-child>a{border-bottom-left-radius:3px;border-bottom-right-radius:3px;padding-bottom:.7em}}.navigation .submenu li a{background-color:#094857;display:inline-block;text-align:right;width:100%}@media screen and (min-width:40em){.navigation .submenu li a{background-color:#0a5365;padding-left:1em;text-align:left;width:10em}}.post .post__body{max-width:70em;margin-left:auto;margin-right:auto}.post .post__body::after{clear:both;content:"";display:table}@media screen and (min-width:53.75em){.post .post__body{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.post .post__body:last-child{margin-right:0}}.post .post__body .post-header{margin-bottom:1.875em}.post .post__body .post-header p{display:inline}.post .post__body .post-header i{color:#14133b;margin-right:5px}.post .post__body .post-header .centerdot{font-weight:700}.post .post__body .post-header .post-featured-image{margin:3em 0}.post .post__body .disclaimer{background-color:rgba(158,2,59,.1);border:solid 1px rgba(158,2,59,.3);border-radius:5px;margin-bottom:1.875em;padding:1em}.post .post__body .disclaimer h5{margin-top:0}@media screen and (min-width:53.75em){.post .post-bottom{float:left;display:block;margin-right:2.35765%;width:82.94039%;margin-left:8.5298%}.post .post-bottom:last-child{margin-right:0}}@media screen and (min-width:70em){.post .post-bottom{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.post .post-bottom:last-child{margin-right:0}}.previous-next-links .next{float:left;display:block;margin-right:2.35765%;width:48.82117%;float:left}.previous-next-links .next:last-child{margin-right:0}.previous-next-links .previous{float:left;display:block;margin-right:2.35765%;width:48.82117%;float:right;text-align:right}.previous-next-links .previous:last-child{margin-right:0}.services{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap}.services .services__service{margin-bottom:3em}.services .services__service .services__service__icon{float:left}.services .services__service p{display:inline;margin:0}@media screen and (min-width:53.75em){.services--main .services__service{margin-bottom:0;padding:1.5em;width:50%}}.services--main .services__service:last-child{margin-bottom:0}.services--main .services__service .services__service__icon{margin-right:1em}.tag h2{margin-bottom:1em;text-align:center}.tag .view-more-link{margin-top:1.5em}.tag .view-more-link .fa-arrow-right{margin-left:.25em}.tag__related-case-studies{overflow:hidden}.tag__related-case-studies .tag__related-case-studies__content{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study{flex-basis:20em;-ms-flex-preferred-size:20em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;margin:0 .75em 1.5em;text-align:center}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study h3{margin:0 auto;padding:3em 1.5em}.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a,.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a:focus,.tag__related-case-studies .tag__related-case-studies__content .case-studies__case-study a:hover{color:#fff}.tag__related-posts{margin-top:3em;overflow:hidden}.team-member{max-width:70em;margin-left:auto;margin-right:auto}.team-member::after{clear:both;content:"";display:table}@media screen and (min-width:40em){.team-member{float:left;display:block;margin-right:2.35765%;width:65.88078%;margin-left:17.05961%}.team-member:last-child{margin-right:0}}.team-member .team-header img{border-radius:3px;max-width:100%;width:350px}.team-member .team-links{margin:1em auto 3em;text-align:center}@media screen and (min-width:40em){.team-member .team-links{width:60%}}@media screen and (min-width:53.75em){.team-member .team-links{width:100%}}.team-member .team-links li{display:inline-block;list-style-type:none;min-width:45%;padding:0 .75em}@media screen and (min-width:53.75em){.team-member .team-links li{min-width:1%}}.team-member .fa-file-text{font-size:13px}.associations{clear:both}.page-work h2{text-align:center}.page-work .case-studies{clear:both}.page-work .client-logos{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:3em}.page-work .client-logos .client-logos__logo{flex-basis:15em;-ms-flex-preferred-size:15em;-moz-flex-grow:0;flex-grow:0;-ms-flex-positive:0;margin:0 0 2em;padding:.5em;text-align:center}@media screen and (min-width:30em){.page-work .client-logos .client-logos__logo{margin:0 1em 2em}}.case-study{clear:both}.case-study .case-study__header{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-pack:distribute;-moz-justify-content:space-around;-ms-justify-content:space-around;-o-justify-content:space-around;justify-content:space-around;-ms-flex-pack:distribute;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;background-position:top center;background-repeat:no-repeat;background-size:cover;height:88vh;min-height:320px}@media screen and (min-width:40em){.case-study .case-study__header{height:78vh}}@media screen and (min-width:53.75em){.case-study .case-study__header{height:88vh}}.case-study .case-study__header .case-study__header__text{display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;padding:1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text{box-orient:horizontal;-moz-flex-direction:row;flex-direction:row;-ms-flex-direction:row;width:90%}}@media screen and (min-width:53.75em){.case-study .case-study__header .case-study__header__text{width:80%}}.case-study .case-study__header .case-study__header__text h1,.case-study .case-study__header .case-study__header__text h3,.case-study .case-study__header .case-study__header__text li,.case-study .case-study__header .case-study__header__text p{color:#fff}.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{font-size:1.1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__link,.case-study .case-study__header .case-study__header__text p{font-size:1.25em}}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--left{border-right:solid 2px #fff;padding-right:1.5em}}.case-study .case-study__header .case-study__header__text .case-study__header__text--left h1{font-size:2em;margin-bottom:1em}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--left h1{font-size:2.5em}}.case-study .case-study__header .case-study__header__text .case-study__header__text--left .case-study__header__link{display:inline-block;margin-top:1.5em}.case-study .case-study__header .case-study__header__text .case-study__header__text--right{display:none}@media screen and (min-width:46.875em){.case-study .case-study__header .case-study__header__text .case-study__header__text--right{flex-basis:280px;-ms-flex-preferred-size:280px;flex-shrink:0;-ms-flex-negative:0;display:-webkit-box;display:-moz-box;display:box;display:-moz-flex;display:-ms-flexbox;display:flex;box-orient:vertical;-moz-flex-direction:column;flex-direction:column;-ms-flex-direction:column;box-pack:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center;padding:0 0 0 1.5em}.case-study .case-study__header .case-study__header__text .case-study__header__text--right ul{font-style:italic}}.case-study .wrapper{padding:0}</style>
  
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">

    <!-- Savas Labs logo. -->
    <a href="/" class="logo">
        <img width="101px" height="70px" src="http://savaslabs.com/assets/img/logo.png" alt="Savas Labs logo">
    </a>

    <!-- Mobile menu button. -->
    <a href="/" id="js-mobile-menu" class="navigation-menu-button">MENU</a>

    <!-- Main menu. -->
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">

        <!-- Loop through nav items in config.yml. -->
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  more">
            <a href="javascript:void(0)">Who we are</a>

            <!-- If there are sub-links, create them. -->
            

              <ul class="submenu">
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/team">Team</a>
                  </li>
                

                  <!-- Assign active nav item class. -->
                  
                  

                  <li class="nav-link ">
                    <a href="/mission-and-values">Mission & values</a>
                  </li>
                
              </ul>
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/services">Services</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/work">Our work</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/blog">Blog</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        

          <!-- These variables will be used for special CSS classes. -->
          

          <!-- Assign active nav item class. -->
          

          <!-- Assign class for menu items with sub-links. -->
          

          <!-- Build links. -->
          <li class="nav-link  ">
            <a href="/contact">Contact</a>

            <!-- If there are sub-links, create them. -->
            
          </li>
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        


<div class="post">
  <div class="post__body">
    <header class="post-header">
      <h1 class="post-title">Dramatically Improve MySQL Import Performance with Docker</h1>

      

<p>By <a href="/team/kosta-harlan">Kosta Harlan</a> and <a href="/team/chris-russo">Chris Russo</a></p>

      <p class="centerdot">&centerdot; </p>
      <p>Feb 15, 2017 </p><br>
      <i class="fa fa-tags"></i><p><a href="/blog/tag/drupal/">Drupal</a>, <a href="/blog/tag/drupal-planet/">Drupal Planet</a>, <a href="/blog/tag/docker/">Docker</a>, <a href="/blog/tag/continuous-integration/">Continuous Integration</a>, <a href="/blog/tag/performance/">Performance</a>, <a href="/blog/tag/productivity/">Productivity</a></p>
      
      <div><p><span id="comment-count"></span></p></div>
      
      
        <div class="post-featured-image">
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/blog/sea-ocean-boats-port-1474by829-36ea92.jpg" media="(min-width: 400px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 400px) and (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/sea-ocean-boats-port-737by415-36ea92.jpg" media="(min-width: 400px)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/sea-ocean-boats-port-800by450-36ea92.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/blog/sea-ocean-boats-port-400by225-36ea92.jpg">
    <img src="http://savaslabs.com/assets/processed-img/blog/sea-ocean-boats-port-400by225-36ea92.jpg" class="image--post-featured-image" itemprop="image" alt="Docker, ships, the sea" >
  </picture>

          
        </div>
      
    </header>

    

    <article class="post-content">
      <p>We use <a href="https://www.docker.com/">Docker</a> for our development environments because it helps us adhere to our <a href="/mission-and-values/#excel">commitment to excellence</a>. It ensures an identical development platform across the team while also achieving parity with the production environment. These efficiency gains (among others we’ll share in an ongoing <a href="/blog/tag/docker/">Docker series</a>) over traditional development methods enable us to spend less time on setup and more time building amazing things.</p>

<p>Part of our workflow includes a mechanism to establish and update the <a href="https://en.wikipedia.org/wiki/Database_seeding">seed database</a> which we use to load near-real-time production content to our development environments as well as our <a href="/blog/tag/testing/">automated testing</a> infrastructure. We’ve found it’s best to have real data throughout the development process, rather than using stale or dummy data which runs the risk of encountering unexpected issues toward the end of a project. One efficiency boon we’ve recently implemented and are excited to share is a technique that dramatically speeds up database imports, especially large ones. This is a big win for us since we’re often importing large databases multiple times a day on a project. In this post we’ll look at:</p>

<ul>
  <li>how much faster data volume imports are compared to traditional database dumps piped to <code class="highlighter-rouge">mysql</code></li>
  <li>how to set up a data volume import with your Drupal Docker stack</li>
  <li>how to tie in this process with your local and continuous integration environments</li>
</ul>

<h2 id="the-old-way">The <em>old</em> way</h2>

<p>The way we historically imported a database was to pipe a SQL database dump file into the MySQL command-line client:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mysql -u<span class="o">{</span>some_user<span class="o">}</span> -p<span class="o">{</span>some_pass<span class="o">}</span> <span class="o">{</span>database_name<span class="o">}</span> &lt; /path/to/database.sql
</code></pre>
</div>

<p>An improvement upon the default method above which we’ve been using for some time allows us to monitor import progress utilizing the <a href="https://www.ivarch.com/programs/pv.shtml"><code class="highlighter-rouge">pv</code></a> command. Large imports can take many minutes, so having insight into how much time remains is helpful to our workflow:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pv /path/to/database.sql | mysql -u<span class="o">{</span>some_user<span class="o">}</span> -p <span class="o">{</span>some_pass<span class="o">}</span> <span class="o">{</span>database_name<span class="o">}</span>
</code></pre>
</div>

<p>On large databases, though, MYSQL imports can be slow. If we look at a database dump SQL file, we can see why. For example, a 19 MB database dump file we are using in one of our test cases further on in this post contains these instructions:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">--
-- Table structure for table `block_content`
--
</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="nv">`block_content`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`block_content`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="n">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`revision_id`</span> <span class="n">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`type`</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="n">CHARACTER</span> <span class="k">SET</span> <span class="n">ascii</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'The ID of the target entity.'</span><span class="p">,</span>
  <span class="nv">`uuid`</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="n">CHARACTER</span> <span class="k">SET</span> <span class="n">ascii</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`langcode`</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="n">CHARACTER</span> <span class="k">SET</span> <span class="n">ascii</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`block_content_field__uuid__value`</span> <span class="p">(</span><span class="nv">`uuid`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`block_content__revision_id`</span> <span class="p">(</span><span class="nv">`revision_id`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="nv">`block_content_field__type__target_id`</span> <span class="p">(</span><span class="nv">`type`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">12</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'The base table for block_content entities.'</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--
-- Dumping data for table `block_content`
--
</span>
<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="nv">`block_content`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `block_content` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">set</span> <span class="n">autocommit</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nv">`block_content`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'a9167ea6-c6b7-48a1-ac06-6d04a67a5d54'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'2114eee9-1674-4873-8800-aaf06aaf9773'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'855c13ba-689e-40fd-9b00-d7e3dd7998ae'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'8c68671b-715e-457d-a497-2d38c1562f67'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'bc7701dd-b31c-45a6-9f96-48b0b91c7fa2'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'d8e23385-5bda-41da-8e1f-ba60fc25c1dc'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'ea6a93eb-b0c3-4d1c-8690-c16b3c52b3f1'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'3d314051-567f-4e74-aae4-a8b076603e44'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'2ef5ae05-6819-4571-8872-4d994ae793ef'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'3deaa1a9-4144-43cc-9a3d-aeb635dfc2ca'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="s1">'basic'</span><span class="p">,</span><span class="s1">'d57e81e8-c613-45be-b1d5-5844ba15413c'</span><span class="p">,</span><span class="s1">'en'</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `block_content` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>
<span class="k">commit</span><span class="p">;</span>
</code></pre>
</div>

<p>When we pipe the contents of the MySQL database dump to the <code class="highlighter-rouge">mysql</code> command, the client processes each of these instructions sequentially in order to (1) create the structure for each table defined in the file, (2) populate the database with data from the SQL dump and (3) do post-processing work like create indices to ensure the database performs well. The example here processes pretty quickly, but if your site has a lot of historic content, as many of our clients do, then the import process can take enough time that it throws a wrench in our rapid workflow!<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<p>What happens when <code class="highlighter-rouge">mysql</code> finishes importing the SQL dump file? The database contents (<em>often</em>) live in <code class="highlighter-rouge">/var/lib/mysql/{database}</code>, so for example for the <code class="highlighter-rouge">block_content</code> table mentioned above, assuming you’re using the typically preferred InnoDB storage engine, there are two files called <code class="highlighter-rouge">block_content.frm</code> and <code class="highlighter-rouge">block_content.ibd</code> in <code class="highlighter-rouge">/var/lib/mysql/{database}/</code>. The <code class="highlighter-rouge">/var/lib/mysql</code> directory will also contain a number of other directories and files related to the configuration of the MySQL server.</p>

<p>Now, suppose that instead of sequentially processing the SQL instructions contained in a database dump file, we were able to provide developers with a snapshot of the <code class="highlighter-rouge">/var/lib/mysql</code> directory for a given Drupal site. Could this swap faster than the traditional database import methods? Let’s have a look at two test cases to find out!</p>

<h3 id="mysql-import-test-cases">MySQL import test cases</h3>

<p>The table below shows the results of two test cases, one using a 19 MB database and the other using a 4.7 GB database.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Method</th>
      <th style="text-align: right">Database size</th>
      <th style="text-align: right">Time to drop tables and restore (seconds)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Traditional <code class="highlighter-rouge">mysql</code></td>
      <td style="text-align: right">19 MB</td>
      <td style="text-align: right">128</td>
    </tr>
    <tr>
      <td style="text-align: left">Docker data volume restore</td>
      <td style="text-align: right">19 MB</td>
      <td style="text-align: right">11</td>
    </tr>
    <tr>
      <td style="text-align: left">Traditional <code class="highlighter-rouge">mysql</code></td>
      <td style="text-align: right">4.7 GB</td>
      <td style="text-align: right">606</td>
    </tr>
    <tr>
      <td style="text-align: left">Docker data volume restore</td>
      <td style="text-align: right">4.7 GB</td>
      <td style="text-align: right">85</td>
    </tr>
  </tbody>
</table>

<p>In other words, the MySQL data volume import completes, on average, in about 11% of the time, or 9 times faster, than a traditional MySQL dump import would take!</p>

<p>Since a GIF is worth a thousand words, compare these two processes side-by-side (both are using the same 19 MB source database; the first is using a data volume restore process while the second is using the traditional MySQL import process). You can see that the second process takes considerably longer!</p>

<h4 id="docker-data-volume-restore">Docker data volume restore</h4>

<script type="text/javascript" src="https://asciinema.org/a/102770.js" id="asciicast-102770" async="" data-autoplay="true" data-loop="true" data-theme="solarized-dark"></script>

<h4 id="traditional-mysql-database-dump-import">Traditional MySQL database dump import</h4>

<script type="text/javascript" src="https://asciinema.org/a/102769.js" id="asciicast-102769" async="" data-autoplay="true" data-loop="true" data-theme="solarized-dark"></script>

<h2 id="use-mysql-volume-for-database-imports-with-docker">Use MySQL volume for database imports with Docker</h2>

<p>Here’s how the process works<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>. Suppose you have a Docker stack with a web container and a database container, and that the database container has data in it already (your site is up and running locally). Assuming a database container name of <code class="highlighter-rouge">drupal_database</code>, to generate a volume for the MySQL <code class="highlighter-rouge">/var/lib/mysql</code> contents of the database container, you’d run these commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Stop the database container to prevent read/writes to it during the database</span>
<span class="c"># export process.</span>
docker stop drupal_database
<span class="c"># Now use the carinamarinab/backup image with the `backup` command to generate a</span>
<span class="c"># tar.gz file based on the `/var/lib/mysql` directory in the `drupal_database`</span>
<span class="c"># container.</span>
docker run --rm --volumes-from drupal_database carinamarina/backup backup <span class="se">\</span>
--source /var/lib/mysql/ --stdout --zip &gt; db-data-volume.tar.gz
</code></pre>
</div>

<p>With the 4.7 GB sample database above, this process takes 239 seconds and results in 702 MB compressed file.</p>

<p>We’re making use of the <a href="https://getcarina.com/docs/tutorials/backup-restore-data/">carinamarina/backup</a> image produced by Rackspace to create an archive of the database files.</p>

<p>You can then distribute this file to your colleagues (at Savas Labs, we use <a href="https://aws.amazon.com/s3/">Amazon S3</a>), or make use of it in continuous integration builds (more on that below), using these commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Copy the data volume tar.gz file from your team's AWS S3 bucket.</span>
<span class="k">if</span> <span class="o">[</span> ! -f db/db-data-volume.tar.gz <span class="o">]</span>; <span class="k">then </span>aws s3 cp <span class="se">\</span>
s3://<span class="o">{</span>your-bucket<span class="o">}</span>/mysql-data-volume/db-data-volume.tar.gz db-data-volume.tar.gz; <span class="k">fi</span>
<span class="c"># Stop the database container to prevent read/writes during the database</span>
<span class="c"># restore process.</span>
docker stop drupal_database
<span class="c"># Remove the /var/lib/mysql contents from the database container.</span>
docker run --rm --volumes-from drupal_database alpine:3.3 rm -rf /var/lib/mysql/<span class="k">*</span>
<span class="c"># Use the carinamarina/backup image with the `restore` command to extract</span>
<span class="c"># the tar.gz file contents into /var/lib/mysql in the database container.</span>
docker run --rm --interactive --volumes-from drupal_database <span class="se">\</span>
carinamarina/backup restore --destination /var/lib/mysql/ --stdin <span class="se">\</span>
--zip &lt; db-data-volume.tar.gz
<span class="c"># Start the database container again.</span>
docker start drupal_database
</code></pre>
</div>

<p>So, not too complicated, but it will require a change in your processes for generating seed databases to distribute to your team for local development, or for CI builds. Instead of using <code class="highlighter-rouge">mysqldump</code> to create the seed database file, you’ll need to use the <code class="highlighter-rouge">carinamarina/backup</code> image to create the <code class="highlighter-rouge">.tar.gz</code> file for distribution. And instead of <code class="highlighter-rouge">mysql {database} &lt; database.sql</code> you’ll use <code class="highlighter-rouge">carinamarina/backup</code> to restore the data volume.</p>

<p>In our team’s view this is a small cost for the enormous gains in database import time, which in turn boosts productivity to the tune of faster CI builds and refreshes of local development environments.</p>

<h2 id="further-efficiency-gains-integrate-this-process-with-your-continuous-integration-workflow">Further efficiency gains: integrate this process with your continuous integration workflow</h2>

<p>The above steps can be manually performed by a technical lead responsible for generating and distributing the MySQL data volume to team members and your testing infrastructure. But we can get further productivity gains by automating this process completely with <a href="https://www.travis-ci.com">Travis CI</a> and GitHub hooks. In outline, here’s what this process looks like:</p>

<h3 id="generate-a-new-seed-database-sql-dump-after-production-deployments">1. Generate a new seed database SQL dump after production deployments</h3>

<p>At Savas Labs, we use <a href="http://www.fabfile.org">Fabric</a> to automate our deployment process. When we deploy to production (not on a Docker stack), our post-deployment tasks generate a traditional MySQL database dump and copy it to Amazon S3:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">update_seed_db</span><span class="p">():</span>
    <span class="n">run</span><span class="p">(</span><span class="s">'drush -r </span><span class="si">%</span><span class="s">s/www/web sql-dump </span><span class="se">\
</span><span class="s">    --result-file=/tmp/$(date +</span><span class="si">%%</span><span class="s">Y-</span><span class="si">%%</span><span class="s">m-</span><span class="si">%%</span><span class="s">d)--post-deployment.sql --gzip </span><span class="se">\
</span><span class="s">    --structure-tables-list=cache,cache_*,history,search_*,sessions,watchdog'</span> \
    <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">code_dir</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="s">'/usr/local/bin/aws s3 cp /tmp/$(date +</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d)--post-deployment.sql.gz </span><span class="se">\
</span><span class="s">    s3://{bucket-name}/seed-database/database.sql.gz --sse'</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="s">'rm /tmp/$(date +</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d)--post-deployment.sql.gz'</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="when-work-is-merged-into-develop-create-a-new-mysql-data-volume-archive">2. When work is merged into develop, create a new MySQL data volume archive</h3>

<p>We use <a href="http://developers.savaslabs.com/en/latest/git.html#basic-git-workflow-git-flow"><code class="highlighter-rouge">git flow</code></a> as our collaboration and documentation standard for source code management on our Drupal projects. Whenever a developer merges a feature branch into <code class="highlighter-rouge">develop</code>, we update the MySQL data volume archive dump for use in Travis CI tasks and local development. First, there is a specification in our <code class="highlighter-rouge">.travis.yml</code> file that calls a deployment script:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">deploy</span><span class="pi">:</span>
  <span class="s">provider</span><span class="pi">:</span> <span class="s">script</span>
  <span class="s">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">resources/scripts/travis-deploy.sh</span>
  <span class="s">skip_cleanup</span><span class="pi">:</span> <span class="s">true</span>
  <span class="s">on</span><span class="pi">:</span>
    <span class="s">branch</span><span class="pi">:</span> <span class="s">develop</span>
</code></pre>
</div>

<p>And the <code class="highlighter-rouge">travis-deploy.sh</code> script:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="nb">set</span> -e

make import-seed-db
make <span class="nb">export</span>-mysql-data
aws s3 cp db-data-volume.tar.gz <span class="se">\</span>
s3://<span class="o">{</span>bucket-name<span class="o">}</span>/mysql-data-volume/db-data-volume.tar.gz --sse
</code></pre>
</div>

<p>This script: (1) imports the traditional MySQL seed database file from production, and then (2) creates a MySQL data volume archive. We use a <a href="https://github.com/savaslabs/docker-drupal-template/blob/master/Makefile">Makefile</a> to standardize common site provisioning tasks for developers and our CI systems.</p>

<h3 id="pull-requests-and-local-development-make-use-of-the-mysql-data-volume-archive">3. Pull requests and local development make use of the MySQL data volume archive</h3>

<p>Now, whenever developers want to refresh their local environment by wiping the existing database and re-importing the seed database, or, when a Travis CI build is triggered by a GitHub pull request, these processes can make use of an up-to-date MySQL data volume archive file which is super fast to restore! This way, we ensure we’re always testing against the latest content and configuration, and avoid running into costly issues having to troubleshoot inconsistencies with production.</p>

<h2 id="conclusion">Conclusion</h2>

<p>We’ve invested heavily in Docker for our development stack, and this workflow update is a compelling addition to that toolkit since it has substantially sped up MySQL imports and boosted productivity. Try it out in your Docker workflow and we invite comments to field any questions and hear about your successes. Stay tuned for further <a href="/blog/tag/docker/">Docker</a> updates!</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>It’s worth noting that there are <a href="https://github.com/juampynr/syncdb">cool projects out there</a> for doing parallel imports of a SQL dump file which improve the import experience. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Hat tip to <a href="/team/tim-stallmann/">Tim Stallmann</a> for taking a proof of concept and incorporating it into a <a href="/work/hptn-case-study/">real-world project</a>, from which many of the code samples here are drawn. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

      <hr>

      
        <div class="post-comments">

  
    <div class="expander">
      <a href="javascript:void(0)" id="js-expander-trigger" class="expander-trigger expander-hidden">Comments!</a>

      <div id="js-expander-content" class="expander-content">

        <!-- If there are existing comments, output them here. -->
        <div id="post-comments" class="post-comments"></div>

        <!-- New comment form -->
        <form id="comment-form" class="comment-form">
          <h4>Leave a comment</h4>

          <div class="comment-form__field comment-form__field--name">
            <label class="comment-form__field__label" for="name">Name</label>
            <input type="text" name="name" id="name" required>
          </div>

          <div class="comment-form__field comment-form__field--email">
            <label class="comment-form__field__label" for="email">Email</label>
            <input type="email" name="email" id="email" required>
            <p class="comment-form__field__helptext">Savas Labs will never sell your email address or spam you.</p>
          </div>

          <div class="comment-form__field comment-form__field--comment">
            <label class="comment-form__field__label" for="comment">Comment</label>
            <textarea name="comment" id="comment" required></textarea>
            <p class="comment-form__field__helptext">Plain text format only please.</p>
          </div>

          <input type="hidden" name="slug" id="slug" value="/2017/02/15/docker-mysql-performance.html">
          <input type="text" name="url" id="url">

          <div class="comment-form__field comment-form__field--nocaptcha">
            <div class="comment-form__field--nocaptcha__image">
              <img src="/assets/img/icons-and-logos/owl.png" alt="Savas Labs logo">
            </div>
            <div class="comment-form__field--nocaptcha__input">
              <label class="comment-form__field__label" for="nocaptcha">What type of animal is the Savas Labs logo?</label>
              <p class="comment-form__field__helptext">Hint: 3 letters long, starts with an "o" and ends with an "l".</p>
              <input type="text" name="nocaptcha" id="nocaptcha" required>
            </div>
          </div>

          <input type="submit" value="Post comment" id="submit" class="comment-form__submit">
        </form>

      </div><!-- comments and comment form -->
    </div><!-- expander -->
  
  <hr>
</div>

      
    </article>
  </div><!-- post__body -->

  
    <div class="post-bottom">
  <div class="post-meta">

    
    
    
    
    

    
      <h4>About the authors</h4>
    

    

      
      
        <a href="/team/chris-russo">
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/chris-russo-576by516-704170.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/chris-russo-288by258-704170.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/chris-russo-288by258-704170.jpg" class="image--team-post-meta" itemprop="image" alt="Chris Russo" >
  </picture>

        </a>
        <p class="post-author-desc">Chris does his best to ensure that his team is learning and growing and that our clients feel like partners.</p>
      

      
      

    

      
      
        <a href="/team/kosta-harlan">
          <picture>
    <source srcset="http://savaslabs.com/assets/processed-img/team/kosta-harlan-576by546-447515.jpg" media="(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)">
    <source srcset="http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg">
    <img src="http://savaslabs.com/assets/processed-img/team/kosta-harlan-288by273-447515.jpg" class="image--team-post-meta" itemprop="image" alt="Kosta Harlan" >
  </picture>

        </a>
        <p class="post-author-desc">Kosta is responsible for code quality at Savas Labs, keeping up to date with emerging technologies and ensuring our team follows best practices.</p>
      

      
      

    
  </div>

  
  <div class="post-related flex-container">
    <h4>Recent posts by Savas Labs</h4>
    <div class="cards">
      
      
        
        
          <div class="card">
            <a href="/2017/03/20/lightning-q1-2017.html">
              <div class="card-header">
                Lightning Talks - Three Useful Additions to Any Developer Toolbox in Q1 2017
              </div>
              <div class="card-copy">
                <p>Mar 20, 2017</p>
                
                <p><p>What we’ve added to our developer toolboxes in Q1 2017!</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2017/03/06/five-drupal-8-tips-to-empower-content-authors.html">
              <div class="card-header">
                Five Drupal 8 Tips to Empower Content Authors
              </div>
              <div class="card-copy">
                <p>Mar 6, 2017</p>
                
                <p><p>Five Drupal 8 tips to make the content authoring experience more enjoyable and productive!</p>
</p>
              </div>
            </a>
          </div>
        
      
        
        
          <div class="card">
            <a href="/2017/02/27/on-web-typography-review.html">
              <div class="card-header">
                On Web Typography - a Book Review
              </div>
              <div class="card-copy">
                <p>Feb 27, 2017</p>
                
                <p><p>A review of Jason Santa Maria’s <em>On Web Typography</em>, and how we applied the
lessons learned to our workflow.</p>
</p>
              </div>
            </a>
          </div>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
</div>

  

  <div class="previous-next-links">
  <div class="next">
    
      <a href="/2017/02/20/drupal-docker-pattern-lab.html"><i class="fa fa-long-arrow-left "></i> Docker and the Drupal Pattern Lab Starter Theme</a>
    
  </div>
  <div class="previous">
    
      <a href="/2016/11/15/composer-mailchimp-subscriptions-v3-api.html"> Using MailChimp API v3.0 to subscribe users to email lists in Drupal custom modules <i class="fa fa-long-arrow-right"></i></a>
    
  </div>
</div>

</div><!-- post -->

      </div>
    </div>

    
    
      <div class="contact-block">
  <div class="contact-block__items">
    <h3>Interested in working with us?</h3>
    <a href="/contact">Get in touch!</a>
  </div>
</div>
    

    <footer class="footer" role="contentinfo">
  <div class="footer-links">
    <ul>
      <li><h3>Location</h3></li>
      <li>Savas Labs<br />
          PMB 210<br />
          201 W Main Street, Suite 100<br />
          Durham, NC 27701<br /></li>
    </ul>
    <ul>
      <li><h3>Around the Web</h3></li>
      <ul>
        <li><a href="https://github.com/savaslabs"><span class="fa fa-github fa-lg fa-2x"></span></a></li>
        <li><a href="https://www.drupal.org/node/2466865"><i class="fa fa-drupal fa-lg fa-2x"></i></a></li>
        <li><a href="https://twitter.com/savas_labs"><i class="fa fa-twitter fa-lg fa-2x"></i></a></li>
        <li><a href="https://www.linkedin.com/company/savas-labs"><i class="fa fa-linkedin fa-lg fa-2x"></i></a></li>
      </ul>
    </ul>
    <ul>
      <li><h3>Contact</h3></li>
      <li><a href="mailto:info@savaslabs.com">info@savaslabs.com</a></li>
      <li>(919) 432-4660</li>
    </ul>
  </div>

</footer>

<div class="footer-copyright">
  <p>Copyright &copy; Savas Labs 2017</p>
</div>

    <script type="text/javascript" src="http://savaslabs.com/assets/js/main.js" async></script>

<noscript>
  <link href='/assets/styles/main.css' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,400italic,700italic|PT+Serif|Source+Sans+Pro' rel='stylesheet' type='text/css'>
</noscript>

  </body>

</html>
